import{u as D,r as o,j as s,e as r,k as g,g as h,t as x,v as p}from"./index-4FXqbJ0i.js";import{B as f}from"./button-m7GXumE4.js";import{C as S,a as T,b as A,d as I}from"./card-CWS_VYqU.js";import{I as w}from"./input-4AJ6TGF6.js";import{L as j}from"./label-Douiz0aH.js";function R(){const{user:t,profile:i,loading:a,signIn:v}=D(),[U,C]=o.useState(null),[n,b]=o.useState("alkaptin7878@mail.ru"),[c,y]=o.useState("01123456");o.useEffect(()=>{const e=()=>{C({contextUser:t?{uid:t.uid,email:t.email,emailVerified:t.emailVerified}:null,contextProfile:i,contextLoading:a,firebaseCurrentUser:r.currentUser?{uid:r.currentUser.uid,email:r.currentUser.email,emailVerified:r.currentUser.emailVerified}:null,timestamp:new Date().toISOString()})};e();const l=setInterval(e,2e3);return()=>clearInterval(l)},[t,i,a]);const N=async()=>{console.log("🧪 Testing login with:",{email:n,password:"***"});try{const e=await v(n,c);console.log("🧪 Login result:",e)}catch(e){console.error("🧪 Login error:",e)}},F=async()=>{console.log("🔥 Testing Firestore connection..."),console.log("🔍 Current auth state:",{user:t?{uid:t.uid,email:t.email}:null,firebaseCurrentUser:r.currentUser?{uid:r.currentUser.uid,email:r.currentUser.email}:null});try{if(!t&&!r.currentUser){console.log("❌ No user logged in - please login first"),alert("يرجى تسجيل الدخول أولاً لاختبار الاتصال مع Firestore");return}const e=t||r.currentUser;console.log("✅ Using user:",e==null?void 0:e.email),console.log("📖 Testing user document read...");const l=g(h,"users",e.uid),d=await x(l);d.exists()?console.log("✅ User document exists:",d.data()):(console.log("⚠️ User document does not exist, creating..."),await p(l,{email:e.email,uid:e.uid,createdAt:new Date,role:"user",isActive:!0}),console.log("✅ User document created")),console.log("📖 Testing merchant wallet read...");const u=g(h,"merchantWallets",`test_${e.uid}`),m=await x(u);m.exists()?console.log("✅ Wallet document exists:",m.data()):(console.log("⚠️ Wallet document does not exist, creating test wallet..."),await p(u,{merchantUserId:e.uid,walletName:"محفظة تجريبية",balance:0,createdAt:new Date}),console.log("✅ Test wallet created")),console.log("🎉 Firestore connection test completed successfully!"),alert("تم اختبار الاتصال مع Firestore بنجاح! تحقق من وحدة التحكم للتفاصيل")}catch(e){console.error("❌ Firestore connection error:",e),alert(`خطأ في الاتصال مع Firestore: ${e.message}`)}};return s.jsx("div",{className:"min-h-screen bg-background p-6",children:s.jsx("div",{className:"max-w-4xl mx-auto space-y-6",children:s.jsxs(S,{children:[s.jsx(T,{children:s.jsx(A,{children:"🔐 اختبار حالة المصادقة"})}),s.jsxs(I,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(j,{htmlFor:"email",children:"البريد الإلكتروني"}),s.jsx(w,{id:"email",type:"email",value:n,onChange:e=>b(e.target.value),placeholder:"أدخل البريد الإلكتروني"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(j,{htmlFor:"password",children:"كلمة المرور"}),s.jsx(w,{id:"password",type:"password",value:c,onChange:e=>y(e.target.value),placeholder:"أدخل كلمة المرور"})]}),s.jsx(f,{onClick:N,className:"w-full",disabled:a,children:a?"جاري تسجيل الدخول...":"تسجيل دخول تجريبي"}),t&&s.jsx(f,{onClick:F,className:"w-full",variant:"outline",children:"اختبار الاتصال مع Firestore"}),s.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-bold mb-2",children:"حالة المصادقة الحالية:"}),s.jsx("pre",{className:"text-sm overflow-auto",children:JSON.stringify(U,null,2)})]})]})]})})})}export{R as default};
