const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UserDashboardPage-BvuQ6SJP.js","assets/index-5acpwqWG.js","assets/index-kxlRDqQk.css","assets/card-B5YGwUS-.js","assets/button-CHyeFMAC.js","assets/input-CtDW9KHe.js","assets/badge-ByQyqKT0.js","assets/select-k9Xz5yE7.js","assets/index-BlNrF3Va.js","assets/Combination-D8VmRMp-.js","assets/index-Dy4_6wQh.js","assets/dialog-CBQB7v6S.js","assets/label-D7Cs6IE5.js","assets/MasterPinDialog-CO0tlQTj.js","assets/shield-CijwJUGZ.js","assets/eye-B3Mcq56v.js","assets/circle-alert-DJmK9Fsi.js","assets/lock-DtYMaXCz.js","assets/walletDailyLimitsService-SXbBOqOW.js","assets/progress-B5hLwZid.js","assets/wallet-n-4SY3bD.js","assets/star-CBqiBQ0P.js","assets/square-pen-Cv8j1Qar.js","assets/phone-CdQwb124.js","assets/arrow-left-BtNQrk7b.js","assets/index.esm-BWpfQX7y.js","assets/calendar-CLG_1p71.js","assets/chart-column-DCX4g5tL.js","assets/dollar-sign-opO-Fb5G.js","assets/bell-CrGcW8l4.js","assets/circle-x-Dt28TVBx.js","assets/circle-check-big-Dcc1mAkn.js","assets/store-DygDsMPE.js","assets/arrow-right-DZR2HLQc.js","assets/user-D2YDRTa7.js","assets/PasswordConfirmDialog-BOhxMYBS.js","assets/whatsappService-Cm7Q-MYJ.js","assets/minus-CGXmpgoZ.js","assets/WalletsManagement-C0cL098X.js","assets/dropdown-menu-Ccmng4vN.js","assets/index-Bd_VmA7B.js","assets/reportsService-Bp1Io21u.js","assets/ProfileIcon-F0oSykwO.js","assets/avatars-D6eTXStP.js","assets/broadcastService-DYrYkuCO.js","assets/gift-C8Nn5x5D.js","assets/profitService-WOL_cZ8K.js","assets/refresh-cw-jdA8dw_D.js"])))=>i.map(i=>d[i]);
import{u as y,r as l,z as P,a as N,j as e,$ as S,R as k,_ as E,d as A}from"./index-5acpwqWG.js";import{s as I,E as R}from"./broadcastService-DYrYkuCO.js";import{L as _}from"./link-CFxtkbR_.js";const j="dismissedBroadcastIds",L=()=>{const{user:a,profile:s,isSubscriptionActive:t,userSubscription:o}=y(),[r,c]=l.useState(null),[n,m]=l.useState(!1),[p,u]=l.useState(!1),b=P(),f=N(),x=l.useMemo(()=>{const i=["global"];return s!=null&&s.shopId&&i.push(`shop:${s.shopId}`),a!=null&&a.uid&&i.push(`user:${a.uid}`),i},[s==null?void 0:s.shopId,a==null?void 0:a.uid]),g=b.pathname.startsWith("/admin");l.useEffect(()=>{if(!a||g||!((s==null?void 0:s.approved)===!0||t||(o==null?void 0:o.isOnFreeTrial)===!0))return;const h=I(x,d=>{if(d){c(d);try{const w=localStorage.getItem(j),U=w?JSON.parse(w):[],D=d.id&&U.includes(d.id);m(!D),u(!1),requestAnimationFrame(()=>u(!0))}catch{m(!0),u(!0)}}});return()=>h()},[a,x,g,s==null?void 0:s.approved,t,o]);const v=()=>{m(!1);try{const i=localStorage.getItem(j),h=i?JSON.parse(i):[],d=r==null?void 0:r.id;d&&!h.includes(d)&&(h.push(d),localStorage.setItem(j,JSON.stringify(h)))}catch{}};return!n||!r?null:e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:`absolute inset-0 bg-black/25 backdrop-blur-sm transition-opacity duration-300 ease-out ${p?"opacity-100":"opacity-0"}`}),e.jsxs("div",{className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[92%] sm:w-auto sm:min-w-[380px] sm:max-w-md md:max-w-lg bg-white shadow-2xl rounded-2xl border border-gray-100 ring-1 ring-black/5 transition-all duration-300 ease-out ${p?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e.jsx("div",{className:"relative overflow-hidden rounded-t-2xl",children:e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 relative",children:[e.jsx("button",{"aria-label":"إغلاق",onClick:v,className:"absolute top-3 right-3 p-2 rounded-full bg-white/10 hover:bg-white/20",children:e.jsx(S,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"p-4",children:e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-white tracking-wide text-center",children:r.title||"إشعار"})})]})}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"text-gray-700 leading-relaxed text-sm sm:text-base",children:r.message}),r.linkUrl&&e.jsxs("button",{"aria-label":"فتح الرابط",title:"فتح الرابط",onClick:()=>{const i=r.linkUrl;/^https?:\/\//i.test(i)?window.open(i,"_blank","noopener"):f(i)},className:"shrink-0 inline-flex items-center gap-2 px-3 py-2 rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 whitespace-nowrap",children:[/^https?:\/\//i.test(r.linkUrl)?e.jsx(R,{className:"w-6 h-6"}):e.jsx(_,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold",children:"فتح الرابط"})]})]})})]})]})},O=k.lazy(()=>E(()=>import("./UserDashboardPage-BvuQ6SJP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),B=()=>{const a=N(),{user:s,profile:t,loading:o,refreshProfile:r,isSubscriptionActive:c,userSubscription:n,checkSubscriptionStatus:m}=y(),[p,u]=l.useState(!1),{toast:b}=A();return l.useEffect(()=>{const f=async x=>{const{userId:g,isActive:v}=x.detail;console.log("🔔 ProtectedUserDashboard: Subscription update event received:",{userId:g,isActive:v,currentUserId:s==null?void 0:s.uid}),g===(s==null?void 0:s.uid)&&v&&(console.log("✅ ProtectedUserDashboard: Subscription activated for current user, refreshing status"),await m(),u(!0),b({title:"تم تفعيل الاشتراك",description:"مرحباً بك في لوحة التحكم!"}))};return window.addEventListener("userSubscriptionUpdated",f),()=>{window.removeEventListener("userSubscriptionUpdated",f)}},[s==null?void 0:s.uid,m,b]),l.useEffect(()=>{if(console.log("ProtectedUserDashboard - useEffect triggered",{loading:o,user:s?"exists":"null",profile:t?{role:t.role,approved:t.approved}:"null",isSubscriptionActive:c,userSubscription:n?"exists":"null"}),!o){if(!s)console.log("ProtectedUserDashboard - No user, redirecting to login"),a("/user/login");else if(t){if(console.log("ProtectedUserDashboard - Profile found:",{role:t.role,approved:t.approved,isSubscriptionActive:c,hasSubscription:!!(n!=null&&n.subscription)}),t.role==="user"){if(c){console.log("ProtectedUserDashboard - User has active subscription, allowing access"),u(!0);return}if(t.approved===!1){console.log("ProtectedUserDashboard - User not approved and no active subscription, redirecting to pending approval"),a("/user/pending-approval");return}}console.log("ProtectedUserDashboard - User approved or admin, setting authenticated"),u(!0)}}},[s,t,o,a,c,n]),o||!p?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):(console.log("ProtectedUserDashboard - Render state:",{isAuthenticated:p,profileRole:t==null?void 0:t.role,profileApproved:t==null?void 0:t.approved,isSubscriptionActive:c,hasSubscription:!!(n!=null&&n.subscription)}),console.log("🔥 ProtectedUserDashboard - user:",s?{uid:s.uid,email:s.email}:"null"),console.log("🔥 ProtectedUserDashboard - profile:",t?{userId:t.userId,role:t.role}:"null"),console.log("🔥 ProtectedUserDashboard - loading:",o),console.log("🔥 ProtectedUserDashboard - About to render UserDashboardPage"),e.jsxs("div",{className:"relative",children:[e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}),children:e.jsx(O,{})}),e.jsx(L,{})]}))};export{B as default};
