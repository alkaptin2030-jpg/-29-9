const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BJ4iSN16.js","assets/index-D6LCzO31.css"])))=>i.map(i=>d[i]);
var Fs=Object.defineProperty;var Bs=(t,s,r)=>s in t?Fs(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var kt=(t,s,r)=>Bs(t,typeof s!="symbol"?s+"":s,r);import{c as G,r as x,j as e,v as et,z as $s,A as qt,B as Vs,P as zt,E as Hs,aD as qs,d as zs,M as oe,S,a0 as H,k as P,Z as te,$ as Y,an as le,X as Te,C as de,aE as Ys,V as Gs,aF as Ws,aG as Ks,aH as Rt,aI as Xs,aJ as Qs,aK as Zs,aL as Ee,aM as Js,aN as er,aO as tr,aP as Yt,aQ as sr,aR as rr,aS as ar,H as ee,a1 as Ge,i as K,p as Se,U as ne,aT as ie,ai as St,o as tt,_ as De,O as nr,ae as ir,l as or,aU as lr,h as cr,f as dr,q as ur,al as mr,a as hr,u as xr,g as gr}from"./index-BJ4iSN16.js";import{P as fr}from"./ProfileIcon-CZDo56cc.js";import{C as Me,a as We,b as Ke,d as Ie,c as pr}from"./card-BopJNU_A.js";import{B as X}from"./button-CXg6sSGC.js";import{I as br}from"./input-Bf9kP-QO.js";import{L as Dt}from"./label-DA8rOXOx.js";import{u as yr,S as Nr,a as jr,b as wr,c as vr,d as we}from"./select-DU1_ekNR.js";import{A as _r,a as Tr}from"./alert-CBkknkb-.js";import{B as Oe}from"./badge-CnFJz_b8.js";import{a as Er,S as Xe,P as Cr}from"./separator-4OwbRSl2.js";import{u as kr,c as Rr,v as Sr}from"./whatsappService-BSKY43UC.js";import{R as Qe}from"./refresh-cw-CLgZnbnp.js";import{C as Dr}from"./circle-alert-ROMkRkI2.js";import{P as Ar}from"./phone-DSmQOUm2.js";import{S as Gt}from"./save-Dy58QF3w.js";import{E as Ur,a as Mr}from"./eye-G6cWz-1g.js";import{C as Ir}from"./copy-jaE4sjxO.js";import{E as Pr,p as Or}from"./broadcastService-kW9lJbwV.js";import{U as Le}from"./user-BDRmoapQ.js";import{C as se}from"./calendar-Domxwp8f.js";import{M as Lr}from"./mail-Cs0mfk7J.js";import{L as At}from"./lock-DDCyWI3f.js";import{Z as st}from"./zap-gwGQhO17.js";import{G as fe,U as rt}from"./users-DSHBf7sR.js";import{C as Pe}from"./crown-BmdbopFz.js";import{L as Ut}from"./dropdown-menu-On6HG3Et.js";import{C as at}from"./circle-check-big-BClEND4U.js";import{S as Fr}from"./shield-Cp_MsQxe.js";import{A as Mt}from"./activity-vTSDtHmq.js";import{g as It,l as Br,s as $r}from"./contentService-cEU3Jd7t.js";import"./dialog-ofaWNyXB.js";import"./Combination-DDOQl0Vu.js";import"./avatars-Dg0K7E1D.js";import"./key-round-BglmvpW3.js";import"./index-xjWmtRmb.js";import"./check-CK6CgXp8.js";import"./index-azYGEd4n.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=G("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=G("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=G("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=G("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=G("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=G("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=G("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=G("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=G("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=G("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=G("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Wt=x.forwardRef(({className:t,...s},r)=>e.jsx("textarea",{className:et("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...s}));Wt.displayName="Textarea";var $e="Switch",[Xr,yi]=$s($e),[Qr,Zr]=Xr($e),Kt=x.forwardRef((t,s)=>{const{__scopeSwitch:r,name:a,checked:i,defaultChecked:l,required:o,disabled:u,value:d="on",onCheckedChange:g,form:h,...j}=t,[m,w]=x.useState(null),y=qt(s,D=>w(D)),f=x.useRef(!1),k=m?h||!!m.closest("form"):!0,[A,v]=Vs({prop:i,defaultProp:l??!1,onChange:g,caller:$e});return e.jsxs(Qr,{scope:r,checked:A,disabled:u,children:[e.jsx(zt.button,{type:"button",role:"switch","aria-checked":A,"aria-required":o,"data-state":Jt(A),"data-disabled":u?"":void 0,disabled:u,value:d,...j,ref:y,onClick:Hs(t.onClick,D=>{v(M=>!M),k&&(f.current=D.isPropagationStopped(),f.current||D.stopPropagation())})}),k&&e.jsx(Zt,{control:m,bubbles:!f.current,name:a,value:d,checked:A,required:o,disabled:u,form:h,style:{transform:"translateX(-100%)"}})]})});Kt.displayName=$e;var Xt="SwitchThumb",Qt=x.forwardRef((t,s)=>{const{__scopeSwitch:r,...a}=t,i=Zr(Xt,r);return e.jsx(zt.span,{"data-state":Jt(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:s})});Qt.displayName=Xt;var Jr="SwitchBubbleInput",Zt=x.forwardRef(({__scopeSwitch:t,control:s,checked:r,bubbles:a=!0,...i},l)=>{const o=x.useRef(null),u=qt(o,l),d=yr(r),g=qs(s);return x.useEffect(()=>{const h=o.current;if(!h)return;const j=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(j,"checked").set;if(d!==r&&w){const y=new Event("click",{bubbles:a});w.call(h,r),h.dispatchEvent(y)}},[d,r,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:u,style:{...i.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Zt.displayName=Jr;function Jt(t){return t?"checked":"unchecked"}var es=Kt,ea=Qt;const ts=x.forwardRef(({className:t,...s},r)=>e.jsx(es,{className:et("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:r,children:e.jsx(ea,{className:et("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ts.displayName=es.displayName;const ta=()=>{const{settings:t,loading:s,error:r,updateSettings:a,refreshSettings:i}=kr(),{toast:l}=zs(),[o,u]=x.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[d,g]=x.useState(!1),[h,j]=x.useState(!1),[m,w]=x.useState(""),[y,f]=x.useState({});x.useEffect(()=>{t&&u({phoneNumber:t.phoneNumber,defaultMessage:t.defaultMessage,isEnabled:t.isEnabled})},[t]);const k=()=>{var I,p;const R={};return(I=o.phoneNumber)!=null&&I.trim()?Sr(o.phoneNumber)||(R.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):R.phoneNumber="رقم الواتساب مطلوب",(p=o.defaultMessage)!=null&&p.trim()?o.defaultMessage.length<10&&(R.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):R.defaultMessage="الرسالة الافتراضية مطلوبة",f(R),Object.keys(R).length===0},A=async()=>{if(!k()){l({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}g(!0);try{if(await a(o))l({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{l({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{g(!1)}},v=()=>{if(o.phoneNumber&&o.defaultMessage)try{const R=Rr(o.phoneNumber,o.defaultMessage);w(R),j(!0)}catch{l({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},D=async()=>{try{await navigator.clipboard.writeText(m),l({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{l({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},M=R=>{const I=R.replace(/[^\d+]/g,"");u(p=>({...p,phoneNumber:I})),y.phoneNumber&&f(p=>({...p,phoneNumber:""}))};return s?e.jsxs(Me,{children:[e.jsx(We,{children:e.jsxs(Ke,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Ie,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Qe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Me,{children:[e.jsxs(We,{children:[e.jsxs(Ke,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(pr,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Ie,{className:"space-y-6",children:[r&&e.jsxs(_r,{variant:"destructive",children:[e.jsx(Dr,{className:"h-4 w-4"}),e.jsx(Tr,{children:r})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${o.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(ts,{checked:o.isEnabled,onCheckedChange:R=>u(I=>({...I,isEnabled:R}))})]}),e.jsx(Er,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Dt,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(Ar,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(br,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:o.phoneNumber,onChange:R=>M(R.target.value),className:y.phoneNumber?"border-red-500":"",dir:"ltr"}),y.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:y.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Dt,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(Wt,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:o.defaultMessage,onChange:R=>{u(I=>({...I,defaultMessage:R.target.value})),y.defaultMessage&&f(I=>({...I,defaultMessage:""}))},className:y.defaultMessage?"border-red-500":"",rows:4}),y.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:y.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(X,{onClick:A,disabled:d,className:"flex items-center gap-2",children:[d?e.jsx(Qe,{className:"h-4 w-4 animate-spin"}):e.jsx(Gt,{className:"h-4 w-4"}),d?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(X,{variant:"outline",onClick:v,disabled:!o.phoneNumber||!o.defaultMessage,className:"flex items-center gap-2",children:[h?e.jsx(Ur,{className:"h-4 w-4"}):e.jsx(Mr,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(X,{variant:"outline",onClick:i,className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"تحديث"]})]}),h&&m&&e.jsxs(Me,{className:"bg-muted/50",children:[e.jsx(We,{children:e.jsx(Ke,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Ie,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:m}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{variant:"outline",size:"sm",onClick:D,className:"flex items-center gap-2",children:[e.jsx(Ir,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(X,{variant:"outline",size:"sm",onClick:()=>window.open(m,"_blank"),className:"flex items-center gap-2",children:[e.jsx(Pr,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),t&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(Oe,{variant:"outline",className:"mr-2",children:[t.lastUpdated.toLocaleDateString("ar-EG")," - ",t.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(Oe,{variant:t.isEnabled?"default":"secondary",className:"mr-2",children:t.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Be={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},sa=t=>{const s=new Date,a=new Date(t).getTime()-s.getTime();return Math.ceil(a/(1e3*60*60*24))},ra=(t,s=Be)=>t<0?"expired":t<=s.criticalDays?"critical":t<=s.warningDays?"warning":(t<=s.infoDays,"info"),aa=(t,s,r)=>{const a=na(r);return s<0?`انتهت صلاحية اشتراك ${a} للمستخدم ${t}`:s===0?`ينتهي اشتراك ${a} للمستخدم ${t} اليوم!`:s===1?`ينتهي اشتراك ${a} للمستخدم ${t} غداً`:`ينتهي اشتراك ${a} للمستخدم ${t} خلال ${s} أيام`},na=t=>{switch(t){case S.MONTHLY:return"الشهري";case S.YEARLY:return"السنوي";case S.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},ia=async()=>{try{const t=H(P,"users"),s=te(t,Y("subscription","!=",null)),r=await le(s),a=[];return r.forEach(i=>{var o,u,d,g;const l=i.data();l.subscription&&(l.subscription.planType||l.subscription.plan)&&a.push({id:i.id,...l,subscription:{...l.subscription,startDate:((u=(o=l.subscription.startDate)==null?void 0:o.toDate)==null?void 0:u.call(o))||new Date(l.subscription.startDate),endDate:((g=(d=l.subscription.endDate)==null?void 0:d.toDate)==null?void 0:g.call(d))||new Date(l.subscription.endDate),planType:l.subscription.planType||l.subscription.plan}})}),a}catch(t){return console.error("خطأ في جلب الاشتراكات النشطة:",t),[]}},oa=async(t=Be)=>{try{const s=await ia(),r=[];return s.forEach(a=>{if(!a.subscription||!a.subscription.endDate)return;const i=sa(a.subscription.endDate),l=ra(i,t);if(i<=t.infoDays||i<0){const o={id:`${a.id}_${Date.now()}`,userId:a.id,userName:a.displayName||a.email||"مستخدم غير معروف",userEmail:a.email||"",subscriptionPlan:a.subscription.planType,expiryDate:a.subscription.endDate,daysRemaining:i,type:l,message:aa(a.displayName||a.email||"مستخدم غير معروف",i,a.subscription.planType),isRead:!1,createdAt:new Date};r.push(o)}}),r.sort((a,i)=>{const l={expired:0,critical:1,warning:2,info:3};return l[a.type]!==l[i.type]?l[a.type]-l[i.type]:a.daysRemaining-i.daysRemaining}),r}catch(s){return console.error("خطأ في إنشاء إشعارات الاشتراك:",s),[]}},la=(t,s)=>s?t.filter(r=>r.type===s):t,ca=t=>{localStorage.setItem("notificationSettings",JSON.stringify(t))},da=()=>{try{const t=localStorage.getItem("notificationSettings");if(t)return{...Be,...JSON.parse(t)}}catch(t){console.error("خطأ في تحميل إعدادات الإشعارات:",t)}return Be},ua=({isOpen:t,onClose:s})=>{const[r,a]=x.useState([]),[i,l]=x.useState([]),[o,u]=x.useState("all"),[d,g]=x.useState(!0),[h,j]=x.useState(da());x.useEffect(()=>{t&&m()},[t]),x.useEffect(()=>{l(o==="all"?r:la(r,o))},[r,o]);const m=async()=>{g(!0);try{const v=await oa(h);a(v)}catch(v){console.error("خطأ في تحميل الإشعارات:",v)}finally{g(!1)}},w=v=>{switch(v){case"urgent":return e.jsx(Fe,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(de,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(pe,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(pe,{className:"w-5 h-5 text-gray-500"})}},y=v=>{switch(v){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},f=v=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(v),k=v=>{switch(v){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},A=v=>{const D={...h,[v]:!h[v]};j(D),ca(D)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),r.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:r.length})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hr,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(v=>e.jsx("button",{onClick:()=>u(v),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${o===v?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:k(v)},v))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.visualAlerts,onChange:()=>A("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.soundAlerts,onChange:()=>A("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.autoRefresh,onChange:()=>A("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:d?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):i.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(pe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:o==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${k(o)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:i.map(v=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${y(v.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[w(v.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:v.message}),e.jsx("span",{className:"text-xs text-gray-500",children:f(v.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",v.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",f(v.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",v.daysRemaining]})]})]})]})]})},v.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",f(new Date)]}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},ma=({notification:t,onClose:s,soundEnabled:r,onToggleSound:a})=>{const[i,l]=x.useState(!1),[o,u]=x.useState(null);x.useEffect(()=>{if(t&&(l(!0),r&&d(t.type),t.type!=="urgent")){const w=setTimeout(()=>{g()},1e4);return()=>clearTimeout(w)}},[t,r]),x.useEffect(()=>{typeof window<"u"&&window.AudioContext&&u(new AudioContext)},[]);const d=w=>{if(!(!o||!r))try{const y=o.createOscillator(),f=o.createGain();switch(y.connect(f),f.connect(o.destination),w){case"urgent":y.frequency.setValueAtTime(800,o.currentTime),y.frequency.setValueAtTime(1e3,o.currentTime+.1),y.frequency.setValueAtTime(800,o.currentTime+.2),f.gain.setValueAtTime(.3,o.currentTime),f.gain.exponentialRampToValueAtTime(.01,o.currentTime+.5),y.start(o.currentTime),y.stop(o.currentTime+.5);break;case"warning":y.frequency.setValueAtTime(600,o.currentTime),y.frequency.setValueAtTime(700,o.currentTime+.15),f.gain.setValueAtTime(.2,o.currentTime),f.gain.exponentialRampToValueAtTime(.01,o.currentTime+.3),y.start(o.currentTime),y.stop(o.currentTime+.3);break;case"info":y.frequency.setValueAtTime(400,o.currentTime),f.gain.setValueAtTime(.1,o.currentTime),f.gain.exponentialRampToValueAtTime(.01,o.currentTime+.2),y.start(o.currentTime),y.stop(o.currentTime+.2);break}}catch(y){console.error("خطأ في تشغيل الصوت:",y)}},g=()=>{l(!1),setTimeout(()=>{s()},300)},h=w=>{switch(w){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Fe,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(de,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(pe,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(pe,{className:"w-6 h-6"}),pulse:""}}},j=w=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(w);if(!t)return null;const m=h(t.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${i?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${m.bg} ${m.border} ${m.text} ${m.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[t.type==="urgent"&&"تنبيه عاجل!",t.type==="warning"&&"تحذير",t.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:a,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:r?"إيقاف الصوت":"تشغيل الصوت",children:r?e.jsx(Wr,{className:"w-4 h-4"}):e.jsx(Kr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(Te,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:t.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",t.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",j(t.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",t.daysRemaining," يوم"]})]})]}),t.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},ha=({user:t,onActivateSubscription:s,onDeactivateSubscription:r,onDeleteUser:a})=>{const[i,l]=x.useState(S.MONTHLY),[o,u]=x.useState(!1),d=Ys(),g=m=>{switch(m){case S.LIFETIME:return e.jsx(Pe,{className:"w-4 h-4 text-yellow-500"});case S.YEARLY:return e.jsx(fe,{className:"w-4 h-4 text-blue-500"});case S.QUARTERLY:return e.jsx(se,{className:"w-4 h-4 text-purple-500"});case S.MONTHLY:return e.jsx(st,{className:"w-4 h-4 text-green-500"});case S.ZERO:return e.jsx(At,{className:"w-4 h-4 text-gray-500"});default:return null}},h=m=>{switch(m){case S.MONTHLY:return"شهرية";case S.QUARTERLY:return"ربع سنوية";case S.YEARLY:return"سنوية";case S.LIFETIME:return"مدى الحياة";case S.ZERO:return"زيرو";default:return"غير محدد"}},j=m=>m?(m.toDate?m.toDate():new Date(m)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(Me,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Ie,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.fullName||"غير محدد"}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Lr,{className:"w-3 h-3 ml-1"}),t.email]})]})]}),e.jsx(Oe,{variant:t.isActive?"default":"secondary",children:t.isActive?"نشط":"غير نشط"})]}),t.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[g(t.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:h(t.subscription.planType)})]}),e.jsx(Oe,{variant:t.subscription.isActive?"default":"destructive",children:t.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(se,{className:"w-3 h-3 ml-1"}),"البداية: ",j(t.subscription.startDate)]}),t.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"w-3 h-3 ml-1"}),"النهاية: ",j(t.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[s&&o&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),d?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:i,onChange:m=>l(m.target.value),children:[e.jsx("option",{value:S.MONTHLY,children:"شهرية"}),e.jsx("option",{value:S.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:S.YEARLY,children:"سنوية"}),e.jsx("option",{value:S.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:S.ZERO,children:"زيرو"})]}):e.jsxs(Nr,{value:i,onValueChange:m=>l(m),children:[e.jsx(jr,{className:"w-full",children:e.jsx(wr,{placeholder:"اختر نوع الباقة"})}),e.jsxs(vr,{children:[e.jsx(we,{value:S.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(we,{value:S.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(we,{value:S.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(we,{value:S.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qr,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(we,{value:S.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(X,{size:"sm",onClick:()=>{s(t.id,i),u(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(X,{size:"sm",variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[s&&!o&&e.jsx(X,{size:"sm",variant:"outline",onClick:()=>u(!0),className:"flex-1",children:"تفعيل الاشتراك"}),r&&e.jsx(X,{size:"sm",variant:"outline",onClick:()=>r(t.id),className:"flex-1",children:"إلغاء الاشتراك"}),a&&e.jsx(X,{size:"sm",variant:"destructive",onClick:()=>a(t.id),children:e.jsx(Gs,{className:"w-4 h-4"})})]})]})]})})};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ss="firebasestorage.googleapis.com",rs="storageBucket",xa=2*60*1e3,ga=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L extends Zs{constructor(s,r,a=0){super(Ze(s),`Firebase Storage: ${r} (${Ze(s)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,L.prototype)}get status(){return this.status_}set status(s){this.status_=s}_codeEquals(s){return Ze(s)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(s){this.customData.serverResponse=s,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var O;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(O||(O={}));function Ze(t){return"storage/"+t}function it(){const t="An unknown error occurred, please check the error payload for server response.";return new L(O.UNKNOWN,t)}function fa(t){return new L(O.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function pa(t){return new L(O.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function ba(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new L(O.UNAUTHENTICATED,t)}function ya(){return new L(O.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Na(t){return new L(O.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function ja(){return new L(O.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function wa(){return new L(O.CANCELED,"User canceled the upload/download.")}function va(t){return new L(O.INVALID_URL,"Invalid URL '"+t+"'.")}function _a(t){return new L(O.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Ta(){return new L(O.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+rs+"' property when initializing the app?")}function Ea(){return new L(O.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Ca(){return new L(O.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function ka(t){return new L(O.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function nt(t){return new L(O.INVALID_ARGUMENT,t)}function as(){return new L(O.APP_DELETED,"The Firebase app was deleted.")}function Ra(t){return new L(O.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _e(t,s){return new L(O.INVALID_FORMAT,"String does not match format '"+t+"': "+s)}function ve(t){throw new L(O.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q{constructor(s,r){this.bucket=s,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const s=encodeURIComponent;return"/b/"+s(this.bucket)+"/o/"+s(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(s,r){let a;try{a=q.makeFromUrl(s,r)}catch{return new q(s,"")}if(a.path==="")return a;throw _a(s)}static makeFromUrl(s,r){let a=null;const i="([A-Za-z0-9.\\-_]+)";function l(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const o="(/(.*))?$",u=new RegExp("^gs://"+i+o,"i"),d={bucket:1,path:3};function g(M){M.path_=decodeURIComponent(M.path)}const h="v[A-Za-z0-9_]+",j=r.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",w=new RegExp(`^https?://${j}/${h}/b/${i}/o${m}`,"i"),y={bucket:1,path:3},f=r===ss?"(?:storage.googleapis.com|storage.cloud.google.com)":r,k="([^?#]*)",A=new RegExp(`^https?://${f}/${i}/${k}`,"i"),D=[{regex:u,indices:d,postModify:l},{regex:w,indices:y,postModify:g},{regex:A,indices:{bucket:1,path:2},postModify:g}];for(let M=0;M<D.length;M++){const R=D[M],I=R.regex.exec(s);if(I){const p=I[R.indices.bucket];let C=I[R.indices.path];C||(C=""),a=new q(p,C),R.postModify(a);break}}if(a==null)throw va(s);return a}}class Sa{constructor(s){this.promise_=Promise.reject(s)}getPromise(){return this.promise_}cancel(s=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(t,s,r){let a=1,i=null,l=null,o=!1,u=0;function d(){return u===2}let g=!1;function h(...k){g||(g=!0,s.apply(null,k))}function j(k){i=setTimeout(()=>{i=null,t(w,d())},k)}function m(){l&&clearTimeout(l)}function w(k,...A){if(g){m();return}if(k){m(),h.call(null,k,...A);return}if(d()||o){m(),h.call(null,k,...A);return}a<64&&(a*=2);let D;u===1?(u=2,D=0):D=(a+Math.random())*1e3,j(D)}let y=!1;function f(k){y||(y=!0,m(),!g&&(i!==null?(k||(u=2),clearTimeout(i),j(0)):k||(u=1)))}return j(0),l=setTimeout(()=>{o=!0,f(!0)},r),f}function Aa(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ua(t){return t!==void 0}function Ma(t){return typeof t=="object"&&!Array.isArray(t)}function ot(t){return typeof t=="string"||t instanceof String}function Ot(t){return lt()&&t instanceof Blob}function lt(){return typeof Blob<"u"}function Lt(t,s,r,a){if(a<s)throw nt(`Invalid value for '${t}'. Expected ${s} or greater.`);if(a>r)throw nt(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(t,s,r){let a=s;return r==null&&(a=`https://${s}`),`${r}://${a}/v0${t}`}function ns(t){const s=encodeURIComponent;let r="?";for(const a in t)if(t.hasOwnProperty(a)){const i=s(a)+"="+s(t[a]);r=r+i+"&"}return r=r.slice(0,-1),r}var ce;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ce||(ce={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ia(t,s){const r=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,l=s.indexOf(t)!==-1;return r||i||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(s,r,a,i,l,o,u,d,g,h,j,m=!0,w=!1){this.url_=s,this.method_=r,this.headers_=a,this.body_=i,this.successCodes_=l,this.additionalRetryCodes_=o,this.callback_=u,this.errorCallback_=d,this.timeout_=g,this.progressCallback_=h,this.connectionFactory_=j,this.retry=m,this.isUsingEmulator=w,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((y,f)=>{this.resolve_=y,this.reject_=f,this.start_()})}start_(){const s=(a,i)=>{if(i){a(!1,new Ae(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const o=u=>{const d=u.loaded,g=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,g)};this.progressCallback_!==null&&l.addUploadProgressListener(o),l.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(o),this.pendingConnection_=null;const u=l.getErrorCode()===ce.NO_ERROR,d=l.getStatus();if(!u||Ia(d,this.additionalRetryCodes_)&&this.retry){const h=l.getErrorCode()===ce.ABORT;a(!1,new Ae(!1,null,h));return}const g=this.successCodes_.indexOf(d)!==-1;a(!0,new Ae(g,l))})},r=(a,i)=>{const l=this.resolve_,o=this.reject_,u=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(u,u.getResponse());Ua(d)?l(d):l()}catch(d){o(d)}else if(u!==null){const d=it();d.serverResponse=u.getErrorText(),this.errorCallback_?o(this.errorCallback_(u,d)):o(d)}else if(i.canceled){const d=this.appDelete_?as():wa();o(d)}else{const d=ja();o(d)}};this.canceled_?r(!1,new Ae(!1,null,!0)):this.backoffId_=Da(s,r,this.timeout_)}getPromise(){return this.promise_}cancel(s){this.canceled_=!0,this.appDelete_=s||!1,this.backoffId_!==null&&Aa(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ae{constructor(s,r,a){this.wasSuccessCode=s,this.connection=r,this.canceled=!!a}}function Oa(t,s){s!==null&&s.length>0&&(t.Authorization="Firebase "+s)}function La(t,s){t["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager")}function Fa(t,s){s&&(t["X-Firebase-GMPID"]=s)}function Ba(t,s){s!==null&&(t["X-Firebase-AppCheck"]=s)}function $a(t,s,r,a,i,l,o=!0,u=!1){const d=ns(t.urlParams),g=t.url+d,h=Object.assign({},t.headers);return Fa(h,s),Oa(h,r),La(h,l),Ba(h,a),new Pa(g,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Va(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Ha(...t){const s=Va();if(s!==void 0){const r=new s;for(let a=0;a<t.length;a++)r.append(t[a]);return r.getBlob()}else{if(lt())return new Blob(t);throw new L(O.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function qa(t,s,r){return t.webkitSlice?t.webkitSlice(s,r):t.mozSlice?t.mozSlice(s,r):t.slice?t.slice(s,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function za(t){if(typeof atob>"u")throw ka("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Je{constructor(s,r){this.data=s,this.contentType=r||null}}function Ya(t,s){switch(t){case Q.RAW:return new Je(is(s));case Q.BASE64:case Q.BASE64URL:return new Je(os(t,s));case Q.DATA_URL:return new Je(Wa(s),Ka(s))}throw it()}function is(t){const s=[];for(let r=0;r<t.length;r++){let a=t.charCodeAt(r);if(a<=127)s.push(a);else if(a<=2047)s.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))s.push(239,191,189);else{const l=a,o=t.charCodeAt(++r);a=65536|(l&1023)<<10|o&1023,s.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?s.push(239,191,189):s.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(s)}function Ga(t){let s;try{s=decodeURIComponent(t)}catch{throw _e(Q.DATA_URL,"Malformed data URL.")}return is(s)}function os(t,s){switch(t){case Q.BASE64:{const i=s.indexOf("-")!==-1,l=s.indexOf("_")!==-1;if(i||l)throw _e(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Q.BASE64URL:{const i=s.indexOf("+")!==-1,l=s.indexOf("/")!==-1;if(i||l)throw _e(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");s=s.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=za(s)}catch(i){throw i.message.includes("polyfill")?i:_e(t,"Invalid character found")}const a=new Uint8Array(r.length);for(let i=0;i<r.length;i++)a[i]=r.charCodeAt(i);return a}class ls{constructor(s){this.base64=!1,this.contentType=null;const r=s.match(/^data:([^,]+)?,/);if(r===null)throw _e(Q.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=r[1]||null;a!=null&&(this.base64=Xa(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=s.substring(s.indexOf(",")+1)}}function Wa(t){const s=new ls(t);return s.base64?os(Q.BASE64,s.rest):Ga(s.rest)}function Ka(t){return new ls(t).contentType}function Xa(t,s){return t.length>=s.length?t.substring(t.length-s.length)===s:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(s,r){let a=0,i="";Ot(s)?(this.data_=s,a=s.size,i=s.type):s instanceof ArrayBuffer?(r?this.data_=new Uint8Array(s):(this.data_=new Uint8Array(s.byteLength),this.data_.set(new Uint8Array(s))),a=this.data_.length):s instanceof Uint8Array&&(r?this.data_=s:(this.data_=new Uint8Array(s.length),this.data_.set(s)),a=s.length),this.size_=a,this.type_=i}size(){return this.size_}type(){return this.type_}slice(s,r){if(Ot(this.data_)){const a=this.data_,i=qa(a,s,r);return i===null?null:new re(i)}else{const a=new Uint8Array(this.data_.buffer,s,r-s);return new re(a,!0)}}static getBlob(...s){if(lt()){const r=s.map(a=>a instanceof re?a.data_:a);return new re(Ha.apply(null,r))}else{const r=s.map(o=>ot(o)?Ya(Q.RAW,o).data:o.data_);let a=0;r.forEach(o=>{a+=o.byteLength});const i=new Uint8Array(a);let l=0;return r.forEach(o=>{for(let u=0;u<o.length;u++)i[l++]=o[u]}),new re(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cs(t){let s;try{s=JSON.parse(t)}catch{return null}return Ma(s)?s:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(t){if(t.length===0)return null;const s=t.lastIndexOf("/");return s===-1?"":t.slice(0,s)}function Za(t,s){const r=s.split("/").filter(a=>a.length>0).join("/");return t.length===0?r:t+"/"+r}function ds(t){const s=t.lastIndexOf("/",t.length-2);return s===-1?t:t.slice(s+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(t,s){return s}class V{constructor(s,r,a,i){this.server=s,this.local=r||s,this.writable=!!a,this.xform=i||Ja}}let Ue=null;function en(t){return!ot(t)||t.length<2?t:ds(t)}function us(){if(Ue)return Ue;const t=[];t.push(new V("bucket")),t.push(new V("generation")),t.push(new V("metageneration")),t.push(new V("name","fullPath",!0));function s(l,o){return en(o)}const r=new V("name");r.xform=s,t.push(r);function a(l,o){return o!==void 0?Number(o):o}const i=new V("size");return i.xform=a,t.push(i),t.push(new V("timeCreated")),t.push(new V("updated")),t.push(new V("md5Hash",null,!0)),t.push(new V("cacheControl",null,!0)),t.push(new V("contentDisposition",null,!0)),t.push(new V("contentEncoding",null,!0)),t.push(new V("contentLanguage",null,!0)),t.push(new V("contentType",null,!0)),t.push(new V("metadata","customMetadata",!0)),Ue=t,Ue}function tn(t,s){function r(){const a=t.bucket,i=t.fullPath,l=new q(a,i);return s._makeStorageReference(l)}Object.defineProperty(t,"ref",{get:r})}function sn(t,s,r){const a={};a.type="file";const i=r.length;for(let l=0;l<i;l++){const o=r[l];a[o.local]=o.xform(a,s[o.server])}return tn(a,t),a}function ms(t,s,r){const a=cs(s);return a===null?null:sn(t,a,r)}function rn(t,s,r,a){const i=cs(s);if(i===null||!ot(i.downloadTokens))return null;const l=i.downloadTokens;if(l.length===0)return null;const o=encodeURIComponent;return l.split(",").map(g=>{const h=t.bucket,j=t.fullPath,m="/b/"+o(h)+"/o/"+o(j),w=Ve(m,r,a),y=ns({alt:"media",token:g});return w+y})[0]}function an(t,s){const r={},a=s.length;for(let i=0;i<a;i++){const l=s[i];l.writable&&(r[l.server]=t[l.local])}return JSON.stringify(r)}class ct{constructor(s,r,a,i){this.url=s,this.method=r,this.handler=a,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(t){if(!t)throw it()}function nn(t,s){function r(a,i){const l=ms(t,i,s);return hs(l!==null),l}return r}function on(t,s){function r(a,i){const l=ms(t,i,s);return hs(l!==null),rn(l,i,t.host,t._protocol)}return r}function xs(t){function s(r,a){let i;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?i=ya():i=ba():r.getStatus()===402?i=pa(t.bucket):r.getStatus()===403?i=Na(t.path):i=a,i.status=r.getStatus(),i.serverResponse=a.serverResponse,i}return s}function gs(t){const s=xs(t);function r(a,i){let l=s(a,i);return a.getStatus()===404&&(l=fa(t.path)),l.serverResponse=i.serverResponse,l}return r}function ln(t,s,r){const a=s.fullServerUrl(),i=Ve(a,t.host,t._protocol),l="GET",o=t.maxOperationRetryTime,u=new ct(i,l,on(t,r),o);return u.errorHandler=gs(s),u}function cn(t,s){const r=s.fullServerUrl(),a=Ve(r,t.host,t._protocol),i="DELETE",l=t.maxOperationRetryTime;function o(d,g){}const u=new ct(a,i,o,l);return u.successCodes=[200,204],u.errorHandler=gs(s),u}function dn(t,s){return t&&t.contentType||s&&s.type()||"application/octet-stream"}function un(t,s,r){const a=Object.assign({},r);return a.fullPath=t.path,a.size=s.size(),a.contentType||(a.contentType=dn(null,s)),a}function mn(t,s,r,a,i){const l=s.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function u(){let D="";for(let M=0;M<2;M++)D=D+Math.random().toString().slice(2);return D}const d=u();o["Content-Type"]="multipart/related; boundary="+d;const g=un(s,a,i),h=an(g,r),j="--"+d+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+d+`\r
Content-Type: `+g.contentType+`\r
\r
`,m=`\r
--`+d+"--",w=re.getBlob(j,a,m);if(w===null)throw Ea();const y={name:g.fullPath},f=Ve(l,t.host,t._protocol),k="POST",A=t.maxUploadRetryTime,v=new ct(f,k,nn(t,r),A);return v.urlParams=y,v.headers=o,v.body=w.uploadData(),v.errorHandler=xs(s),v}class hn{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ce.NO_ERROR,this.sendPromise_=new Promise(s=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ce.ABORT,s()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ce.NETWORK_ERROR,s()}),this.xhr_.addEventListener("load",()=>{s()})})}send(s,r,a,i,l){if(this.sent_)throw ve("cannot .send() more than once");if(Yt(s)&&a&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(r,s,!0),l!==void 0)for(const o in l)l.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,l[o].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ve("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ve("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ve("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ve("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(s){return this.xhr_.getResponseHeader(s)}addUploadProgressListener(s){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",s)}removeUploadProgressListener(s){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",s)}}class xn extends hn{initXhr(){this.xhr_.responseType="text"}}function dt(){return new xn}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(s,r){this._service=s,r instanceof q?this._location=r:this._location=q.makeFromUrl(r,s.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(s,r){return new ue(s,r)}get root(){const s=new q(this._location.bucket,"");return this._newRef(this._service,s)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ds(this._location.path)}get storage(){return this._service}get parent(){const s=Qa(this._location.path);if(s===null)return null;const r=new q(this._location.bucket,s);return new ue(this._service,r)}_throwIfRoot(s){if(this._location.path==="")throw Ra(s)}}function gn(t,s,r){t._throwIfRoot("uploadBytes");const a=mn(t.storage,t._location,us(),new re(s,!0),r);return t.storage.makeRequestWithTokens(a,dt).then(i=>({metadata:i,ref:t}))}function fn(t){t._throwIfRoot("getDownloadURL");const s=ln(t.storage,t._location,us());return t.storage.makeRequestWithTokens(s,dt).then(r=>{if(r===null)throw Ca();return r})}function pn(t){t._throwIfRoot("deleteObject");const s=cn(t.storage,t._location);return t.storage.makeRequestWithTokens(s,dt)}function bn(t,s){const r=Za(t._location.path,s),a=new q(t._location.bucket,r);return new ue(t.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(t){return/^[A-Za-z]+:\/\//.test(t)}function Nn(t,s){return new ue(t,s)}function fs(t,s){if(t instanceof ut){const r=t;if(r._bucket==null)throw Ta();const a=new ue(r,r._bucket);return s!=null?fs(a,s):a}else return s!==void 0?bn(t,s):t}function jn(t,s){if(s&&yn(s)){if(t instanceof ut)return Nn(t,s);throw nt("To use ref(service, url), the first argument must be a Storage instance.")}else return fs(t,s)}function Ft(t,s){const r=s==null?void 0:s[rs];return r==null?null:q.makeFromBucketSpec(r,t)}function wn(t,s,r,a={}){t.host=`${s}:${r}`;const i=Yt(s);i&&(sr(`https://${t.host}/b`),rr("Storage",!0)),t._isUsingEmulator=!0,t._protocol=i?"https":"http";const{mockUserToken:l}=a;l&&(t._overrideAuthToken=typeof l=="string"?l:ar(l,t.app.options.projectId))}class ut{constructor(s,r,a,i,l,o=!1){this.app=s,this._authProvider=r,this._appCheckProvider=a,this._url=i,this._firebaseVersion=l,this._isUsingEmulator=o,this._bucket=null,this._host=ss,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=xa,this._maxUploadRetryTime=ga,this._requests=new Set,i!=null?this._bucket=q.makeFromBucketSpec(i,this._host):this._bucket=Ft(this._host,this.app.options)}get host(){return this._host}set host(s){this._host=s,this._url!=null?this._bucket=q.makeFromBucketSpec(this._url,s):this._bucket=Ft(s,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(s){Lt("time",0,Number.POSITIVE_INFINITY,s),this._maxUploadRetryTime=s}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(s){Lt("time",0,Number.POSITIVE_INFINITY,s),this._maxOperationRetryTime=s}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const s=this._authProvider.getImmediate({optional:!0});if(s){const r=await s.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){if(Qs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=this._appCheckProvider.getImmediate({optional:!0});return s?(await s.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(s=>s.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(s){return new ue(this,s)}_makeRequest(s,r,a,i,l=!0){if(this._deleted)return new Sa(as());{const o=$a(s,this._appId,a,i,r,this._firebaseVersion,l,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(s,r){const[a,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(s,r,a,i).getPromise()}}const Bt="@firebase/storage",$t="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ps="storage";function vn(t,s,r){return t=Ee(t),gn(t,s,r)}function _n(t){return t=Ee(t),fn(t)}function Tn(t){return t=Ee(t),pn(t)}function Vt(t,s){return t=Ee(t),jn(t,s)}function Ht(t=tr(),s){t=Ee(t);const a=Js(t,ps).getImmediate({identifier:s}),i=er("storage");return i&&En(a,...i),a}function En(t,s,r,a={}){wn(t,s,r,a)}function Cn(t,{instanceIdentifier:s}){const r=t.getProvider("app").getImmediate(),a=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new ut(r,a,i,s,Xs)}function kn(){Ws(new Ks(ps,Cn,"PUBLIC").setMultipleInstances(!0)),Rt(Bt,$t,""),Rt(Bt,$t,"esm2020")}kn();class Rn{constructor(){kt(this,"hooks",[])}registerHooks(s){console.log("📝 Registering hooks:",Object.keys(s)),this.hooks.push(s)}async sendImageMessage(s,r,a,i,l){try{console.log("📤 Uploading image message:",{chatId:s,fileName:r.name,fileSize:r.size,senderType:a,senderId:i});const o=Ht(),u=Date.now(),d=`chat-images/${s}/${u}_${r.name}`,g=Vt(o,d),h=await vn(g,r);console.log("✅ Image uploaded successfully:",h.metadata.fullPath);const j=await _n(g);console.log("✅ Image URL obtained:",j);const m={chatId:s,message:l||"صورة",content:l||"صورة",senderType:a,senderId:i,timestamp:ee(),isRead:!1,type:"image",imageUrl:j,imageFileName:r.name},w=await Ge(H(P,"chatMessages"),m);console.log("✅ Image message added to chatMessages:",w.id);const y=K(P,"chatRooms",s);if(a==="client"){const f=await Se(y);if(f.exists()){const k=f.data().unreadCount||0;await ne(y,{lastMessage:l||"صورة",lastMessageTime:ee(),unreadCount:k+1})}}else await ne(y,{lastMessage:l||"صورة",lastMessageTime:ee()});console.log("✅ Image message sent successfully")}catch(o){throw console.error("🔥 Error sending image message:",o),o}}async deleteChat(s){try{console.log("🗑️ Deleting chat:",s);const r=te(H(P,"chatMessages"),Y("chatId","==",s)),a=await le(r),i=[];for(const o of a.docs){const u=o.data();if(u.type==="image"&&u.imageUrl)try{const d=Ht(),g=Vt(d,u.imageUrl);i.push(Tn(g))}catch(d){console.warn("⚠️ Could not delete image from storage:",d)}i.push(ie(o.ref))}const l=K(P,"chatRooms",s);i.push(ie(l)),await Promise.all(i),console.log("✅ Chat deleted successfully:",{chatId:s,messagesDeleted:a.size})}catch(r){throw console.error("🔥 Error deleting chat:",r),r}}unregisterHooks(s){console.log("🗑️ Unregistering hooks"),s?this.hooks=this.hooks.filter(r=>r!==s):this.hooks=[]}async createChatRoom(s,r=!1){try{const a=r?"clientEmail":"clientPhone",i=te(H(P,"chatRooms"),Y(a,"==",s),Y("status","==","active")),l=await le(i);if(!l.empty)return l.docs[0].id;const o={clientId:`client_${s}`,clientPhone:r?"":s,clientEmail:r?s:void 0,customerName:r?`عميل ${s}`:`عميل ${s}`,status:"active",unreadCount:0,createdAt:ee(),lastMessageTime:ee()};return(await Ge(H(P,"chatRooms"),o)).id}catch(a){throw console.error("Error creating chat room:",a),a}}async sendMessage(s,r,a,i){try{for(let o=1;o<=3;o++)try{console.log(`📤 Sending message (attempt ${o}):`,{chatId:s,message:r.substring(0,50)+"...",senderType:a,senderId:i});const u={chatId:s,message:r,content:r,senderType:a,senderId:i,timestamp:ee(),isRead:!1},d=await Ge(H(P,"chatMessages"),u);console.log("✅ Message added to chatMessages:",d.id);const g=K(P,"chatRooms",s);if(a==="client"){const h=await Se(g),j=h.exists()&&h.data().unreadCount||0;await ne(g,{lastMessage:r,lastMessageTime:ee(),unreadCount:j+1}),this.hooks.length>0&&this.hooks.forEach(m=>{if(m.onUnreadCountChange&&typeof m.onUnreadCountChange=="function")try{m.onUnreadCountChange(s,j+1)}catch(w){console.error("Error calling onUnreadCountChange hook:",w)}})}else await ne(g,{lastMessage:r,lastMessageTime:ee()});if(this.hooks.length>0)try{const h=await Se(g);if(h.exists()){const j={id:h.id,...h.data()},m={id:d.id,...u,timestamp:new Date};this.hooks.forEach(w=>{if(w.onNewMessage&&typeof w.onNewMessage=="function")try{w.onNewMessage(m,j)}catch(y){console.error("Error calling onNewMessage hook:",y)}})}}catch(h){console.error("Error calling onNewMessage hooks:",h)}console.log("✅ Message sent successfully");return}catch(u){if(console.error(`❌ Attempt ${o} failed:`,u),o===3)throw u;await new Promise(d=>setTimeout(d,1e3*o))}throw new Error("Max retry attempts reached")}catch(o){throw console.error("🔥 Error sending message:",o),o}}subscribeToMessages(s,r){let a=0;const i=5;let l=null,o=null,u=0;const d=()=>{try{console.log("🔔 Starting subscription to messages for room:",s,`(attempt ${a+1})`);const g=te(H(P,"chatMessages"),Y("chatId","==",s),St("timestamp","asc"));o=tt(g,h=>{console.log("📨 Received messages snapshot:",h.docs.length,"messages"),a=0;const j=h.docs.map(m=>{const w=m.data();return{id:m.id,...w,message:w.message||w.content||"",content:w.content||w.message||""}});if(j.length>u&&u>0){const m=j.slice(u);console.log("🆕 New messages detected:",m.length),m.forEach(w=>{this.hooks.forEach(y=>{if(y.onNewMessage&&typeof y.onNewMessage=="function")try{Se(K(P,"chatRooms",s)).then(f=>{if(f.exists()){const k={id:f.id,...f.data()},A=y.onNewMessage;A&&A(w,k)}}).catch(f=>{console.error("Error fetching chat room for hook:",f)})}catch(f){console.error("Error calling onNewMessage hook:",f)}})})}u=j.length,console.log("📨 Processed messages:",j),r(j)},h=>{var j,m,w,y;if(console.error("❌ Error in messages subscription:",h),h.name==="AbortError"||(j=h.message)!=null&&j.includes("AbortError")){console.log("🔄 Request was aborted, will retry..."),a<i&&(a++,l=setTimeout(()=>{d()},1e3));return}(m=h.message)!=null&&m.includes("index is currently building")||(w=h.message)!=null&&w.includes("cannot be used yet")||h.code==="failed-precondition"?(console.log("🔨 Index is still building, will retry in 10 seconds..."),a<i?(a++,l=setTimeout(()=>{console.log("🔄 Retrying subscription after index building delay..."),d()},1e4)):(console.log("⚠️ Max retries reached for index building. Please wait for index to complete."),r([]))):h.code==="unavailable"||(y=h.message)!=null&&y.includes("ERR_ABORTED")?(console.log("🔄 Connection issue detected, will retry automatically..."),a<i&&(a++,l=setTimeout(()=>{d()},2e3))):(console.error("❌ Unhandled error in messages subscription:",h),r([]))})}catch(g){console.error("❌ Error setting up messages subscription:",g),a<i&&(a++,l=setTimeout(()=>{d()},5e3))}};return d(),()=>{l&&clearTimeout(l),o&&o()}}subscribeToAdminChats(s){console.log("🔍 Admin: Starting subscription to admin chats");let r=0,a=0;const i=5;let l=null,o=null;const u=()=>{try{const d=te(H(P,"chatRooms"),Y("status","==","active"),St("lastMessageTime","desc"));o=tt(d,g=>{console.log("📊 Admin: Received chat rooms snapshot:",{size:g.size,empty:g.empty,docs:g.docs.length}),a=0;const h=g.docs.map(j=>{const m=j.data();return console.log("💬 Admin: Chat room data:",{id:j.id,customerName:m.customerName,lastMessage:m.lastMessage,unreadCount:m.unreadCount,status:m.status}),{id:j.id,...m}});h.length!==r&&(console.log("🆕 Chat rooms count changed:",{old:r,new:h.length}),h.forEach(j=>{this.hooks.length>0&&this.hooks.forEach(m=>{if(m.onChatRoomUpdate&&typeof m.onChatRoomUpdate=="function")try{m.onChatRoomUpdate(j)}catch(w){console.error("Error calling onChatRoomUpdate hook:",w)}})})),r=h.length,s(h)},g=>{var h,j;if(console.error("❌ Error in admin chats subscription:",g),g.name==="AbortError"||(h=g.message)!=null&&h.includes("AbortError")){console.log("🔄 Admin chats request was aborted, will retry..."),a<i&&(a++,l=setTimeout(()=>{u()},1e3));return}g.code==="unavailable"||(j=g.message)!=null&&j.includes("ERR_ABORTED")?(console.log("🔄 Admin chats connection issue detected, will retry..."),a<i&&(a++,l=setTimeout(()=>{u()},2e3))):(console.error("❌ Unhandled error in admin chats subscription:",g),s([]))})}catch(d){console.error("❌ Error setting up admin chats subscription:",d),a<i&&(a++,l=setTimeout(()=>{u()},5e3))}};return u(),()=>{l&&clearTimeout(l),o&&o()}}async markMessagesAsRead(s,r){try{const a=te(H(P,"chatMessages"),Y("chatId","==",s),Y("senderType","!=",r),Y("isRead","==",!1)),l=(await le(a)).docs.map(o=>ne(K(P,"chatMessages",o.id),{isRead:!0}));if(await Promise.all(l),r==="admin"){const o=K(P,"chatRooms",s);await ne(o,{unreadCount:0})}}catch(a){throw console.error("Error marking messages as read:",a),a}}async closeChatRoom(s){try{const r=K(P,"chatRooms",s);await ne(r,{status:"closed",lastMessageTime:ee()})}catch(r){throw console.error("Error closing chat room:",r),r}}}const ge=new Rn,Sn=({isOpen:t,onClose:s})=>{var R,I;const[r,a]=x.useState([]),[i,l]=x.useState(null),[o,u]=x.useState([]),[d,g]=x.useState(""),[h,j]=x.useState(!0),[m,w]=x.useState(!1),[y,f]=x.useState({}),k=x.useRef(null);x.useEffect(()=>{const p={onNewMessage:(C,U)=>{console.log("🔔 New message notification:",C,U),C.senderType==="client"&&C.chatId!==i&&(f(F=>({...F,[C.chatId]:(F[C.chatId]||0)+1})),console.log("🔔 New message from client in chat:",U.customerName||U.clientPhone))},onChatRoomUpdate:C=>{console.log("🔄 Chat room updated:",C),a(U=>{const F=U.findIndex(E=>E.id===C.id);if(F>=0){const E=[...U];return E[F]=C,E.sort((Z,$)=>{var be,ye,W,Ce;const ae=((ye=(be=Z.lastMessageTime)==null?void 0:be.toMillis)==null?void 0:ye.call(be))||0;return(((Ce=(W=$.lastMessageTime)==null?void 0:W.toMillis)==null?void 0:Ce.call(W))||0)-ae})}else return[C,...U]})},onUnreadCountChange:(C,U)=>{console.log("📊 Unread count changed:",C,U),a(F=>F.map(E=>E.id===C?{...E,unreadCount:U}:E))}};return ge.registerHooks(p),()=>{ge.unregisterHooks()}},[i]),x.useEffect(()=>{console.log("🔍 AdminChatPanel: Setting up chat rooms subscription"),j(!0);const p=ge.subscribeToAdminChats(C=>{console.log("📊 AdminChatPanel: Received chats update:",C.length),a(C),j(!1)});return()=>{console.log("🔌 AdminChatPanel: Cleaning up chat rooms subscription"),p()}},[]),x.useEffect(()=>{if(!i){u([]);return}console.log("📨 AdminChatPanel: Setting up messages subscription for chat:",i);const p=ge.subscribeToMessages(i,C=>{console.log("📨 AdminChatPanel: Received messages update:",C.length),u(C),f(U=>{const F={...U};return delete F[i],F})});return ge.markMessagesAsRead(i,"admin").catch(console.error),()=>{console.log("🔌 AdminChatPanel: Cleaning up messages subscription"),p()}},[i]),x.useEffect(()=>{var p;(p=k.current)==null||p.scrollIntoView({behavior:"smooth"})},[o]);const A=async()=>{if(!(!d.trim()||!i||m)){w(!0);try{await ge.sendMessage(i,d.trim(),"admin","admin_user"),g("")}catch(p){console.error("Error sending message:",p),alert("حدث خطأ في إرسال الرسالة")}finally{w(!1)}}},v=p=>{l(p),f(C=>{const U={...C};return delete U[p],U})},D=Object.values(y).reduce((p,C)=>p+C,0),M=r.reduce((p,C)=>p+(C.unreadCount||0),0);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[80vh] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"المحادثات"}),(M>0||D>0)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Vr,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold",children:"جديد"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(Ut,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-2 text-gray-600",children:"جاري التحميل..."})]}):r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[e.jsx(rt,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"لا توجد محادثات نشطة"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"ستظهر المحادثات الجديدة هنا"})]}):r.map(p=>{const C=i===p.id,U=(p.unreadCount||0)>0,F=y[p.id]>0,E=(p.unreadCount||0)+(y[p.id]||0);return e.jsx("div",{onClick:()=>v(p.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-all duration-200 ${C?"bg-blue-50 border-r-4 border-r-blue-500":U||F?"bg-yellow-50 hover:bg-yellow-100 border-r-4 border-r-yellow-400":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${U||F?"bg-yellow-200":"bg-gray-200"}`,children:e.jsx(Le,{className:`w-5 h-5 ${U||F?"text-yellow-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:p.customerName||p.clientPhone}),C&&e.jsx(at,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]}),p.customerName&&p.customerName!==p.clientPhone&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:p.clientPhone}),p.lastMessage&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:p.lastMessage.length>50?p.lastMessage.substring(0,50)+"...":p.lastMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(de,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:p.lastMessageTime&&p.lastMessageTime.toMillis?new Date(p.lastMessageTime.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${U||F?"bg-red-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:U||F?"رسائل جديدة":"مقروءة"})]})]})]}),E>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[20px] text-center",children:E>99?"99+":E})]})},p.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:((R=r.find(p=>p.id===i))==null?void 0:R.customerName)||((I=r.find(p=>p.id===i))==null?void 0:I.clientPhone)})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.map(p=>e.jsx("div",{className:`flex ${p.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${p.senderType==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:p.message||p.content}),e.jsx("p",{className:`text-xs mt-1 ${p.senderType==="admin"?"text-blue-100":"text-gray-500"}`,children:p.timestamp&&p.timestamp.toMillis?new Date(p.timestamp.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"})]})},p.id)),e.jsx("div",{ref:k})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:p=>g(p.target.value),onKeyPress:p=>p.key==="Enter"&&A(),placeholder:"اكتب رسالتك هنا...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m}),e.jsxs("button",{onClick:A,disabled:!d.trim()||m,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[m?e.jsx(Ut,{className:"w-4 h-4 animate-spin"}):e.jsx(Yr,{className:"w-4 h-4"}),"إرسال"]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(oe,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر محادثة للبدء"}),e.jsx("p",{children:"اختر محادثة من القائمة لعرض الرسائل والرد عليها"})]})})})]})}):null},Dn={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"true",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.firebasestorage.app",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_USE_EMULATORS:"false"},An=({navigate:t,auth:s,devMode:r,setDevMode:a,error:i,setError:l,authLoading:o,setAuthLoading:u,activeTab:d,setActiveTab:g,setNotificationCenterOpen:h,setNotificationSettings:j,setNotifications:m,notificationCount:w,setNotificationCount:y,users:f,setUsers:k,filteredUsers:A,setFilteredUsers:v,loading:D,setLoading:M,setEditingPlan:R,isSavingContent:I,setIsSavingContent:p,lastUpdateInfo:C,loadContentFromFirebase:U,saveContentToFirebase:F})=>{var Ct;const[E,Z]=x.useState(!0),[$,ae]=x.useState(""),[me,be]=x.useState(null),[ye,W]=x.useState({});x.useState(!1),x.useState(null),x.useState(!1);const[Ce,bs]=x.useState({sound:!0}),[ys,Un]=x.useState(!1),[Ns,js]=x.useState(null),He=n=>{const c=n==null?void 0:n.displayName;let b="";typeof c=="string"?b=c:c&&typeof c=="object"&&(b=(c.ar||c.en||"").toString()),!b&&typeof(n==null?void 0:n.email)=="string"&&(b=n.email);const _=String(b).trim().charAt(0);return _?_.toUpperCase():"؟"},Ne=n=>{const c=n==null?void 0:n.displayName;if(typeof c=="string"&&c.trim())return c.trim();if(c&&typeof c=="object"){const b=c.full_name||c.name||c.ar||c.en;if(typeof b=="string"&&b.trim())return b.trim()}return typeof(n==null?void 0:n.email)=="string"&&n.email.includes("@")?n.email.split("@")[0]:"غير محدد"},[qe,mt]=x.useState(""),[ze,ht]=x.useState(""),[xt,gt]=x.useState(""),[Ye,ft]=x.useState(""),[pt,bt]=x.useState(!1),[ke,yt]=x.useState(""),[z,Nt]=x.useState(24),[jt,wt]=x.useState("24"),[vt,_t]=x.useState(!1),[Mn,Tt]=x.useState(!1);x.useEffect(()=>{d==="trials"&&(async()=>{try{Tt(!0);const{FreeTrialService:n}=await De(async()=>{const{FreeTrialService:b}=await import("./index-BJ4iSN16.js").then(_=>_.a_);return{FreeTrialService:b}},__vite__mapDeps([0,1])),c=await n.getTrialDurationHours();Nt(c),wt(String(c))}catch(n){console.error("Failed to load trial duration",n)}finally{Tt(!1)}})()},[d]);const ws=async()=>{var n;if(!qe.trim()||!ze.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{bt(!0);const c=Ye.trim()?`user:${Ye.trim()}`:"global";await Or({title:qe.trim(),message:ze.trim(),audienceKey:c,createdBy:(n=s==null?void 0:s.currentUser)==null?void 0:n.uid,linkUrl:xt.trim()||void 0}),mt(""),ht(""),gt(""),ft(""),alert("تم إرسال الإشعار بنجاح!")}catch(c){console.error("خطأ في إرسال الإشعار:",c),alert("حدث خطأ أثناء إرسال الإشعار")}finally{bt(!1)}};x.useEffect(()=>{if(!$.trim())v(f);else{const n=f.filter(c=>c.email&&typeof c.email=="string"&&c.email.toLowerCase().includes($.toLowerCase())||c.displayName&&typeof c.displayName=="string"&&c.displayName.toLowerCase().includes($.toLowerCase())||c.name&&typeof c.name=="string"&&c.name.toLowerCase().includes($.toLowerCase()));v(n)}},[f,$,v]);const vs=()=>{s!=null&&s.signOut&&s.signOut(),t("/admin/login")},_s=async(n,c,b=null)=>{var _;try{console.log("Activating subscription for user:",n,"with plan:",c,"and variant:",b);const T=((_=s==null?void 0:s.currentUser)==null?void 0:_.uid)||"admin-user-id";await or(n,c,T,b),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(T){console.error("❌ خطأ في تفعيل الاشتراك:",T),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Ts=async n=>{try{console.log("Deactivating subscription for user:",n),await lr(n),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(c){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",c),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Es=async n=>{var c;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",n);const _=((c=s==null?void 0:s.currentUser)==null?void 0:c.uid)||"unknown-admin";try{const N=await cr(dr,"deleteUserPermanently")({userId:n});console.log("استجابة دالة الحذف النهائي:",N),k(B=>B.filter(J=>J.id!==n)),v(B=>B.filter(J=>J.id!==n)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(T){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(T==null?void 0:T.message)||T)}{const T=[];try{await ie(K(P,"profiles",n)),console.log("تم حذف الملف الشخصي")}catch(N){console.error("خطأ في حذف الملف الشخصي:",N),T.push(`الملف الشخصي: ${(N==null?void 0:N.message)||N}`)}try{await ie(K(P,"users",n)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(N){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",N),T.push(`users: ${(N==null?void 0:N.message)||N}`)}try{const N=te(H(P,"transactions"),Y("userId","==",n)),B=await le(N),J=B.docs.map(je=>ie(je.ref)),he=await Promise.allSettled(J),xe=he.filter(je=>je.status==="rejected");xe.length?(console.warn("فشل حذف بعض المعاملات:",xe.length),T.push(`المعاملات: فشل حذف ${xe.length} من أصل ${he.length}`)):console.log(`تم حذف ${B.size} معاملة`)}catch(N){console.error("خطأ في جلب/حذف المعاملات:",N),T.push(`المعاملات: ${(N==null?void 0:N.message)||N}`)}try{const N=te(H(P,"chatRooms"),Y("participants","array-contains",n)),B=await le(N),J=B.docs.map(async he=>{try{const je=(await le(H(he.ref,"messages"))).docs.map(Ls=>ie(Ls.ref));await Promise.allSettled(je),await ie(he.ref)}catch(xe){console.error("فشل حذف محادثة/رسائل:",xe),T.push(`المحادثات: ${he.id}`)}});await Promise.all(J),console.log(`تم إنهاء معالجة ${B.size} محادثة`)}catch(N){console.error("خطأ في جلب/حذف المحادثات:",N),T.push(`المحادثات: ${(N==null?void 0:N.message)||N}`)}try{await ur(K(P,"deletedUsers",n),{deletedAt:new Date,deletedBy:_,reason:"حذف نهائي من لوحة الإدارة"})}catch(N){console.error("خطأ في تسجيل المستخدم كمحذوف:",N),T.push(`deletedUsers: ${(N==null?void 0:N.message)||N}`)}k(N=>N.filter(B=>B.id!==n)),v(N=>N.filter(B=>B.id!==n)),T.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${T.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(b){console.error("❌ خطأ في حذف المستخدم:",b),alert(`حدث خطأ في حذف المستخدم: ${b.message||"خطأ غير معروف"}`)}};x.useEffect(()=>{(async()=>{try{if(typeof U=="function"){const c=await U();c&&(c.monthly||c.yearly||c.lifetime)&&W(c)}}catch(c){console.warn("Failed to load content data:",c)}})()},[]);const Cs=async()=>{var n;try{if(typeof F!="function")return;p(!0);const c=((n=s==null?void 0:s.currentUser)==null?void 0:n.uid)||"admin-user-id";await F(ye,c),alert("تم حفظ جميع التغييرات بنجاح")}catch(c){console.error("❌ خطأ في حفظ المحتوى:",c),alert(`فشل في حفظ المحتوى: ${(c==null?void 0:c.message)||"خطأ غير معروف"}`)}finally{p(!1)}},Re=(n,c,b)=>{W(_=>({..._,[n]:{...(_==null?void 0:_[n])||{},[c]:b}}))},ks=n=>{W(c=>{var b;return{...c,[n]:{...(c==null?void 0:c[n])||{},features:[...((b=c==null?void 0:c[n])==null?void 0:b.features)||[],""]}}})},Rs=(n,c,b)=>{W(_=>{var N;const T=[...((N=_==null?void 0:_[n])==null?void 0:N.features)||[]];return T[c]=b,{..._,[n]:{...(_==null?void 0:_[n])||{},features:T}}})},Ss=(n,c)=>{W(b=>{var T;const _=[...((T=b==null?void 0:b[n])==null?void 0:T.features)||[]];return _.splice(c,1),{...b,[n]:{...(b==null?void 0:b[n])||{},features:_}}})},Ds=()=>{bs(n=>({...n,sound:!n.sound}))},As=()=>{js(null)},Us=async()=>{try{const n=Number(jt);if(isNaN(n)||n<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}_t(!0);const{FreeTrialService:c}=await De(async()=>{const{FreeTrialService:_}=await import("./index-BJ4iSN16.js").then(T=>T.a_);return{FreeTrialService:_}},__vite__mapDeps([0,1])),b=await c.updateTrialDurationHours(n);b.success?(Nt(n),alert(b.message)):alert(b.message||"فشل تحديث مدة التجربة")}catch(n){console.error("Error updating trial duration:",n),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{_t(!1)}},Ms=async n=>{try{const{FreeTrialService:c}=await De(async()=>{const{FreeTrialService:_}=await import("./index-BJ4iSN16.js").then(T=>T.a_);return{FreeTrialService:_}},__vite__mapDeps([0,1])),b=await c.startFreeTrialFromAdmin(n);alert(b.message||`تم تفعيل التجربة المجانية لمدة ${z} ${z>=3&&z<=10?"ساعات":z===2?"ساعتين":"ساعة"}`)}catch(c){console.error("Error activating free trial:",c),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},Is=async n=>{try{const{FreeTrialService:c}=await De(async()=>{const{FreeTrialService:_}=await import("./index-BJ4iSN16.js").then(T=>T.a_);return{FreeTrialService:_}},__vite__mapDeps([0,1])),b=await c.resetActiveTrialToCurrentDuration(n);alert(b.message)}catch(c){console.error("Error resetting user trial end:",c),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},Ps=(n,c)=>{console.log("Toggling user status:",n,c)},Et=n=>n?(n.toDate?n.toDate():new Date(n)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",Os=[{id:"users",label:"المستخدمين",icon:rt},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:se},{id:"trials",label:"إدارة التجارب المجانية",icon:fe},{id:"content",label:"إدارة المحتوى",icon:mr},{id:"chat",label:"الدردشة",icon:oe},{id:"whatsapp",label:"إدارة الواتساب",icon:oe},{id:"analytics",label:"الإحصائيات",icon:Mt}];return o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:i})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{l(null),u(!0),window.location.reload()},className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"🔄 إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{l(null),t("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",i),console.log("🔍 Auth state:",s.currentUser),console.log("🔍 Dev mode:",r),console.log("🔍 Environment:",Dn)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!r&&!s.currentUser?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>t("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:`${E?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[E&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Fr,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>Z(!E),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:E?e.jsx(Te,{className:"w-5 h-5"}):e.jsx(zr,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:Os.map(n=>{const c=n.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>g(n.id),className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${d===n.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(c,{className:"w-5 h-5"}),E&&e.jsx("span",{className:"font-medium",children:n.label})]})},n.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:vs,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(nr,{className:"w-5 h-5"}),E&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[d==="users"&&"إدارة المستخدمين",d==="subscriptions"&&"مواعيد الاشتراكات",d==="trials"&&"إدارة التجارب المجانية",d==="chat"&&"إدارة الدردشة",d==="analytics"&&"الإحصائيات"]}),r&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",r?"المطور":"المدير"]}),e.jsx(fr,{})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[d==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:f.length})]}),e.jsx(rt,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Ye,onChange:n=>ft(n.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.filter(n=>n.isActive).length})]}),e.jsx(Pt,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.filter(n=>!n.isActive).length})]}),e.jsx(Gr,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:$,onChange:n=>ae(n.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),$&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",A.length," من أصل ",f.length," مستخدم",$&&e.jsx("button",{onClick:()=>ae(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:D?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):A.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:$?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(n=>e.jsx(ha,{user:n,onActivateSubscription:_s,onToggleUserStatus:Ps,onDeactivateSubscription:Ts,onDeleteUser:Es},n.id))})})]})]}),d==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.filter(n=>{var c;return(c=n.subscription)==null?void 0:c.isActive}).length})]}),e.jsx(at,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:f.filter(n=>{var N,B;if(!((N=n.subscription)!=null&&N.endDate)||!((B=n.subscription)!=null&&B.isActive))return!1;const c=n.subscription.endDate.toDate?n.subscription.endDate.toDate():new Date(n.subscription.endDate),b=new Date,_=c.getTime()-b.getTime(),T=Math.ceil(_/(1e3*60*60*24));return T<=7&&T>0}).length})]}),e.jsx(Fe,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.filter(n=>{var b;return(b=n.subscription)!=null&&b.endDate?(n.subscription.endDate.toDate?n.subscription.endDate.toDate():new Date(n.subscription.endDate))<new Date:!1}).length})]}),e.jsx(de,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:f.filter(n=>{var c;return((c=n.subscription)==null?void 0:c.planType)===S.LIFETIME}).length})]}),e.jsx(Pe,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:D?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.filter(n=>{var c;return(c=n.subscription)==null?void 0:c.planType}).sort((n,c)=>{var T,N;if(!((T=n.subscription)!=null&&T.endDate)||!((N=c.subscription)!=null&&N.endDate))return 0;const b=n.subscription.endDate.toDate?n.subscription.endDate.toDate():new Date(n.subscription.endDate),_=c.subscription.endDate.toDate?c.subscription.endDate.toDate():new Date(c.subscription.endDate);return b.getTime()-_.getTime()}).map(n=>{const c=n.subscription;if(!c)return null;const b=c.startDate?c.startDate.toDate?c.startDate.toDate():new Date(c.startDate):null,_=c.endDate?c.endDate.toDate?c.endDate.toDate():new Date(c.endDate):null;let T=null,N="غير محدد";if(c.planType===S.LIFETIME)N="مدى الحياة";else if(_){const B=new Date,J=_.getTime()-B.getTime();T=Math.ceil(J/(1e3*60*60*24)),T<0?N="منتهي":T<=7?N="ينتهي قريباً":N="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:He(n)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ne(n)}),e.jsx("div",{className:"text-sm text-gray-500",children:n.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[c.planType===S.LIFETIME&&e.jsx(Pe,{className:"w-4 h-4 text-yellow-500 ml-2"}),c.planType===S.YEARLY&&e.jsx(fe,{className:"w-4 h-4 text-blue-500 ml-2"}),c.planType===S.QUARTERLY&&e.jsx(se,{className:"w-4 h-4 text-purple-500 ml-2"}),c.planType===S.MONTHLY&&e.jsx(st,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ir(c.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:b?b.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.planType===S.LIFETIME?"مدى الحياة":_?_.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N==="نشط"?"bg-green-100 text-green-800":N==="ينتهي قريباً"?"bg-orange-100 text-orange-800":N==="منتهي"?"bg-red-100 text-red-800":N==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:N})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.planType===S.LIFETIME?"∞":T!==null?T<0?"منتهي":`${T} يوم`:"غير محدد"})]},n.id)}).filter(Boolean)})]})})]})]}),d==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),C&&C.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(C.lastUpdated).toLocaleString("ar-SA"),C.updatedBy&&` بواسطة: ${C.updatedBy}`]})]}),e.jsxs("button",{onClick:Cs,disabled:I,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(Gt,{className:"w-4 h-4"}),I?"جاري الحفظ...":"حفظ جميع التغييرات"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(ye).map(([n,c])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[n==="monthly"&&e.jsx(st,{className:"w-4 h-4 text-green-500"}),n==="quarterly"&&e.jsx(se,{className:"w-4 h-4 text-purple-500"}),n==="yearly"&&e.jsx(fe,{className:"w-4 h-4 text-blue-500"}),n==="lifetime"&&e.jsx(Pe,{className:"w-4 h-4 text-yellow-500"}),c.name]}),e.jsx("button",{onClick:()=>R(me===n?null:n),className:"text-purple-600 hover:text-purple-800",children:e.jsx(Cr,{className:"w-4 h-4"})})]}),me===n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:c.name,onChange:b=>Re(n,"name",b.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:c.price,onChange:b=>Re(n,"price",b.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:c.period,onChange:b=>Re(n,"period",b.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:c.description,onChange:b=>Re(n,"description",b.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>ks(n),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:c.features.map((b,_)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:b,onChange:T=>Rs(n,_,T.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>Ss(n,_),className:"text-red-500 hover:text-red-700",children:e.jsx(Te,{className:"w-4 h-4"})})]},_))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.price}),e.jsx("div",{className:"text-sm text-gray-600",children:c.period}),e.jsx("div",{className:"text-sm text-gray-700",children:c.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),c.features.map((b,_)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(at,{className:"w-3 h-3 text-green-500"}),b]},_))]})]})]},n))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:qe,onChange:n=>mt(n.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:ze,onChange:n=>ht(n.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:xt,onChange:n=>gt(n.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:ws,disabled:pt,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:pt?"جاري الإرسال...":"إرسال إشعار"})})]})]})]}),d==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",f),console.log("🔍 Users count:",(f==null?void 0:f.length)||0),console.log("🔍 Users on trial:",((Ct=f==null?void 0:f.filter(n=>n.isOnFreeTrial))==null?void 0:Ct.length)||0),D&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),i&&!D&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Fe,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:i}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!D&&!i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f.filter(n=>n.isOnFreeTrial).length})]}),e.jsx(fe,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.filter(n=>n.hasUsedFreeTrial&&!n.isOnFreeTrial).length})]}),e.jsx(de,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.filter(n=>!n.hasUsedFreeTrial&&!n.isOnFreeTrial&&!n.approved).length})]}),e.jsx(Pt,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:jt,onChange:n=>wt(n.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",z," ",z>=3&&z<=10?"ساعات":z===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:Us,disabled:vt,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:vt?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ke,onChange:n=>yt(n.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Xe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[f.filter(n=>!n.hasUsedFreeTrial&&!n.isOnFreeTrial&&!n.approved).filter(n=>{const c=ke.trim().toLowerCase();if(!c)return!0;const b=Ne(n).toLowerCase(),_=(n.email||"").toLowerCase();return b.includes(c)||_.includes(c)}).map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:He(n)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:Ne(n)}),e.jsx("p",{className:"text-sm text-gray-500",children:n.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",Et(n.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>Ms(n.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${z} ${z>=3&&z<=10?"ساعات":z===2?"ساعتين":"ساعة"}`})})]},n.id)),f.filter(n=>!n.hasUsedFreeTrial&&!n.isOnFreeTrial&&!n.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),f.filter(n=>n.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ke,onChange:n=>yt(n.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Xe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:f.filter(n=>n.isOnFreeTrial).filter(n=>{const c=ke.trim().toLowerCase();if(!c)return!0;const b=Ne(n).toLowerCase(),_=(n.email||"").toLowerCase();return b.includes(c)||_.includes(c)}).map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:He(n)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:Ne(n)}),e.jsx("p",{className:"text-sm text-gray-500",children:n.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",n.freeTrialEndDate?Et(n.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>Is(n.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"})]})]},n.id))})})]})]})]}),d==="chat"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx(Sn,{isOpen:!0,onClose:()=>{}})}),d==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(oe,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(ta,{})]}),d==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(Mt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(ua,{isOpen:ys,onClose:()=>h(!1)}),e.jsx(ma,{notification:Ns,onClose:As,soundEnabled:Ce.soundAlerts,onToggleSound:Ds})]})},Ni=()=>{const t=hr(),{user:s,loading:r}=xr(),[a,i]=x.useState(!1),[l,o]=x.useState(null),[u,d]=x.useState(!1),[g,h]=x.useState("users"),[j,m]=x.useState(0),[w,y]=x.useState([]),[f,k]=x.useState([]),[A,v]=x.useState(!1),[D,M]=x.useState(null);x.useEffect(()=>{const E=localStorage.getItem("admin_dev_mode")==="true";i(E)},[]),x.useEffect(()=>{if(!(!a&&!s)){d(!0),o(null);try{const E=te(H(P,"users")),Z=tt(E,$=>{const ae=$.docs.map(me=>({id:me.id,...me.data()}));y(ae),k(ae),d(!1),o(null)},$=>{console.error("Error loading users:",$),a?(y([]),k([]),d(!1),o(null)):(o("فشل في تحميل بيانات المستخدمين"),d(!1))});return()=>Z()}catch(E){console.error("Error setting up users listener:",E),a?(y([]),k([]),d(!1),o(null)):(o("فشل في إعداد مراقب البيانات"),d(!1))}}},[s,a]);const R=E=>{console.log("Notification center:",E)},I=E=>{console.log("Notification settings:",E)},p=E=>{console.log("Notifications:",E)},C=E=>{console.log("Editing plan:",E)};x.useEffect(()=>{(async()=>{try{const E=await It();M(E)}catch(E){console.warn("Failed to load last update info:",E),M(null)}})()},[]);const U=async()=>{try{return await Br()}catch(E){return console.error("Error loading content:",E),{}}},F=async E=>{try{v(!0);try{localStorage.setItem("siteContent_plans_cache",JSON.stringify(E))}catch{}await $r(E,(s==null?void 0:s.uid)||"admin");const Z=await It();return M(Z),!0}catch(Z){return console.error("Error saving content:",Z),!1}finally{v(!1)}};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):e.jsx(An,{navigate:t,auth:gr,devMode:a,setDevMode:i,error:l,setError:o,authLoading:r,setAuthLoading:()=>{},activeTab:g,setActiveTab:h,setNotificationCenterOpen:R,setNotificationSettings:I,setNotifications:p,notificationCount:j,setNotificationCount:m,users:w,setUsers:y,filteredUsers:f,setFilteredUsers:k,loading:u,setLoading:d,setEditingPlan:C,isSavingContent:A,setIsSavingContent:v,lastUpdateInfo:D,loadContentFromFirebase:U,saveContentToFirebase:F})};export{Ni as default};
