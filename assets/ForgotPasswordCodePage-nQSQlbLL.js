import{a as q,r,j as e,i as t,k as g,m as w,s as P,e as R}from"./index-Ca3eV4DY.js";import{I as m}from"./input-CcAHxhSk.js";import{B as h}from"./button-B8hb0I4Y.js";import{C as S,a as E,b as B,d as D}from"./card-BAygbdfj.js";import{M as F}from"./mail-BQLPCsBF.js";import{K as I}from"./key-round-DnVE44vk.js";import{C as K}from"./circle-check-big-Dt0-a74l.js";const J=()=>{const u=q(),[o,f]=r.useState("request"),[a,b]=r.useState(""),[d,p]=r.useState(""),[i,j]=r.useState(""),[n,c]=r.useState(!1),[x,v]=r.useState(void 0),C=async()=>{if(!a){t.error("يرجى إدخال البريد الإلكتروني أولاً");return}c(!0);try{const l=await g(w,"requestPasswordResetCode")({email:a}),{sent:N,devCode:k}=l.data||{};N?t.success("تم إرسال الكود إلى بريدك الإلكتروني"):t.message("تم إنشاء الكود (وضع التطوير)",{description:"يعرض الكود مباشرة لعدم إعداد البريد."}),v(k),f("confirm")}catch(s){console.warn("requestPasswordResetCode failed, falling back to sendPasswordResetEmail:",s);try{await P(R,a),t.message("تم إرسال رابط استعادة كلمة المرور",{description:"لم نستطع استخدام كود التحقق، استخدم الرابط المرسل."})}catch(l){t.error((l==null?void 0:l.message)||(s==null?void 0:s.message)||"حدث خطأ أثناء طلب الكود")}}finally{c(!1)}},y=async()=>{if(!a||!d||!i){t.error("الرجاء ملء جميع الحقول");return}if(i.length<6){t.error("كلمة المرور يجب ألا تقل عن 6 أحرف");return}c(!0);try{await g(w,"confirmPasswordResetCode")({email:a,code:d,newPassword:i}),t.success("تم تحديث كلمة المرور بنجاح"),u("/user/login")}catch(s){t.error((s==null?void 0:s.message)||"تعذر تأكيد الكود")}finally{c(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"relative w-full max-w-md",children:e.jsxs(S,{className:"bg-white/10 backdrop-blur-lg border border-white/20 text-white",children:[e.jsx(E,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[o==="request"?e.jsx(F,{className:"w-5 h-5"}):e.jsx(I,{className:"w-5 h-5"}),o==="request"?"استعادة كلمة المرور بواسطة كود":"أدخل الكود وكلمة مرور جديدة"]})}),e.jsxs(D,{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-200 mb-2",children:"البريد الإلكتروني"}),e.jsx(m,{type:"email",placeholder:"أدخل بريدك الإلكتروني",value:a,onChange:s=>b(s.target.value),className:"bg-white/20 border-white/30 text-white placeholder-gray-300",dir:"rtl",required:!0})]}),o==="confirm"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-200 mb-2",children:"رمز التحقق"}),e.jsx(m,{type:"text",placeholder:"أدخل الكود المرسل بالبريد",value:d,onChange:s=>p(s.target.value),className:"bg-white/20 border-white/30 text-white placeholder-gray-300",dir:"rtl",required:!0}),x&&e.jsxs("div",{className:"mt-2 text-xs text-yellow-300 flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),"كود التطوير: ",x]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-2 00 mb-2",children:"كلمة مرور جديدة"}),e.jsx(m,{type:"password",placeholder:"أدخل كلمة مرور جديدة",value:i,onChange:s=>j(s.target.value),className:"bg-white/20 border-white/30 text-white placeholder-gray-300",dir:"rtl",autoComplete:"new-password",required:!0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[o==="request"?e.jsx(h,{onClick:C,disabled:n,className:"bg-green-600 hover:bg-green-700",children:n?"جاري الإرسال...":"إرسال الكود"}):e.jsx(h,{onClick:y,disabled:n,className:"bg-green-600 hover:bg-green-700",children:n?"جاري التأكيد...":"تأكيد وتحديث كلمة السر"}),e.jsx(h,{variant:"ghost",onClick:()=>u("/user/login"),className:"text-gray-300 hover:text-white",children:"العودة لتسجيل الدخول"})]})]})]})})]})};export{J as default};
