const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B05GXhax.js","assets/index-Dy4ENMz6.css"])))=>i.map(i=>d[i]);
var Vs=Object.defineProperty;var Bs=(n,a,l)=>a in n?Vs(n,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[a]=l;var is=(n,a,l)=>Bs(n,typeof a!="symbol"?a+"":a,l);import{c as J,r as d,j as e,x as qs,d as Hs,M as de,S as D,f as H,g as R,q as K,a6 as Q,h as me,a2 as je,C as xe,aW as Ae,D as zs,a3 as Ys,B as te,a7 as Ve,k as X,t as ve,H as ce,aX as oe,o as cs,m as Me,_ as le,a0 as Gs,al as Qs,n as Zs,aY as Xs,z as Ks,A as Ws,v as Js,ar as et,a as st,u as tt,e as at}from"./index-B05GXhax.js";import{P as rt}from"./ProfileIcon-RQGjfE2L.js";import{C as Ce,a as Be,b as qe,d as Se,c as nt}from"./card-DnZtAmLe.js";import{B as W}from"./button-DNYNxb0H.js";import{I as lt}from"./input-DE-9RJ6u.js";import{L as os}from"./label-CVapxVb2.js";import{a as it,S as bs}from"./switch-CkVkILy_.js";import{A as ct,a as ot}from"./alert-Cmm2KE29.js";import{B as Re}from"./badge-O1KCDNsE.js";import{a as dt,g as ds,r as ms,u as mt,b as xt,d as ht,S as Ee,P as ut}from"./index.esm-Dqgos2mf.js";import{u as gt,c as pt,v as ft}from"./whatsappService-VfK5XhOP.js";import{R as He}from"./refresh-cw-C6Cq1ycK.js";import{C as bt}from"./circle-alert-BXSlfsUr.js";import{P as js}from"./phone-BYaA-zy9.js";import{E as jt,a as yt}from"./eye-49eeZoaq.js";import{C as Nt}from"./copy-CY4ksowd.js";import{E as wt,p as vt}from"./broadcastService-CulKPKse.js";import{B as pe,A as xs}from"./bell-CWN3bjOs.js";import{U as _e}from"./user-BjiYJ9NG.js";import{C as ae}from"./calendar-Bfk6t8jP.js";import{S as Et,a as Ct,b as St,c as Tt,d as be}from"./select-BGui_6yp.js";import{M as Dt}from"./mail-DM_adZvo.js";import{L as hs}from"./lock-BshQ53fM.js";import{Z as ze}from"./zap-C1ic_8XJ.js";import{G as ge}from"./gift-CCjdLa8p.js";import{C as Te}from"./crown-U3AWpl3E.js";import{L as us}from"./dropdown-menu-DCAMWCAH.js";import{U as De}from"./users-DLhxQS-y.js";import{C as ke}from"./circle-check-big-dbSAJ0fm.js";import{S as kt}from"./shield-Cr4chWJ5.js";import{C as At}from"./circle-x-h3-_jscp.js";import{g as gs,l as Mt,s as Rt}from"./contentService-JNklldyI.js";import"./dialog-CppTfRgl.js";import"./Combination-AlMTIFu-.js";import"./MasterPinDialog-BAeKf9QC.js";import"./avatars-BwvW0kkQ.js";import"./index-BfnZ2KTE.js";import"./index-BBEcR8YQ.js";import"./index-Bc8R4ius.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=J("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=J("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=J("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=J("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=J("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=J("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=J("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=J("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=J("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=J("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ys=d.forwardRef(({className:n,...a},l)=>e.jsx("textarea",{className:qs("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:l,...a}));ys.displayName="Textarea";const Vt=()=>{const{settings:n,loading:a,error:l,updateSettings:i,refreshSettings:o}=gt(),{toast:h}=Hs(),[r,v]=d.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[u,w]=d.useState(!1),[j,C]=d.useState(!1),[y,p]=d.useState(""),[f,m]=d.useState({});d.useEffect(()=>{n&&v({phoneNumber:n.phoneNumber,defaultMessage:n.defaultMessage,isEnabled:n.isEnabled})},[n]);const O=()=>{var U,x;const k={};return(U=r.phoneNumber)!=null&&U.trim()?ft(r.phoneNumber)||(k.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):k.phoneNumber="رقم الواتساب مطلوب",(x=r.defaultMessage)!=null&&x.trim()?r.defaultMessage.length<10&&(k.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):k.defaultMessage="الرسالة الافتراضية مطلوبة",m(k),Object.keys(k).length===0},I=async()=>{if(!O()){h({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}w(!0);try{if(await i(r))h({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{h({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{w(!1)}},E=()=>{if(r.phoneNumber&&r.defaultMessage)try{const k=pt(r.phoneNumber,r.defaultMessage);p(k),C(!0)}catch{h({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},B=async()=>{try{await navigator.clipboard.writeText(y),h({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{h({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},re=k=>{const U=k.replace(/[^\d+]/g,"");v(x=>({...x,phoneNumber:U})),f.phoneNumber&&m(x=>({...x,phoneNumber:""}))};return a?e.jsxs(Ce,{children:[e.jsx(Be,{children:e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Se,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(He,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Ce,{children:[e.jsxs(Be,{children:[e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(nt,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Se,{className:"space-y-6",children:[l&&e.jsxs(ct,{variant:"destructive",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx(ot,{children:l})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${r.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(it,{checked:r.isEnabled,onCheckedChange:k=>v(U=>({...U,isEnabled:k}))})]}),e.jsx(dt,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(os,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(lt,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:r.phoneNumber,onChange:k=>re(k.target.value),className:f.phoneNumber?"border-red-500":"",dir:"ltr"}),f.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:f.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(os,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(ys,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:r.defaultMessage,onChange:k=>{v(U=>({...U,defaultMessage:k.target.value})),f.defaultMessage&&m(U=>({...U,defaultMessage:""}))},className:f.defaultMessage?"border-red-500":"",rows:4}),f.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:f.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(W,{onClick:I,disabled:u,className:"flex items-center gap-2",children:[u?e.jsx(He,{className:"h-4 w-4 animate-spin"}):e.jsx(bs,{className:"h-4 w-4"}),u?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(W,{variant:"outline",onClick:E,disabled:!r.phoneNumber||!r.defaultMessage,className:"flex items-center gap-2",children:[j?e.jsx(jt,{className:"h-4 w-4"}):e.jsx(yt,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(W,{variant:"outline",onClick:o,className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4"}),"تحديث"]})]}),j&&y&&e.jsxs(Ce,{className:"bg-muted/50",children:[e.jsx(Be,{children:e.jsx(qe,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Se,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:y}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{variant:"outline",size:"sm",onClick:B,className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(W,{variant:"outline",size:"sm",onClick:()=>window.open(y,"_blank"),className:"flex items-center gap-2",children:[e.jsx(wt,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),n&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(Re,{variant:"outline",className:"mr-2",children:[n.lastUpdated.toLocaleDateString("ar-EG")," - ",n.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(Re,{variant:n.isEnabled?"default":"secondary",className:"mr-2",children:n.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Le={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},Bt=n=>{const a=new Date,i=new Date(n).getTime()-a.getTime();return Math.ceil(i/(1e3*60*60*24))},qt=(n,a=Le)=>n<0?"expired":n<=a.criticalDays?"critical":n<=a.warningDays?"warning":(n<=a.infoDays,"info"),Ht=(n,a,l)=>{const i=zt(l);return a<0?`انتهت صلاحية اشتراك ${i} للمستخدم ${n}`:a===0?`ينتهي اشتراك ${i} للمستخدم ${n} اليوم!`:a===1?`ينتهي اشتراك ${i} للمستخدم ${n} غداً`:`ينتهي اشتراك ${i} للمستخدم ${n} خلال ${a} أيام`},zt=n=>{switch(n){case D.MONTHLY:return"الشهري";case D.YEARLY:return"السنوي";case D.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},Yt=async()=>{try{const n=H(R,"users"),a=K(n,Q("subscription","!=",null)),l=await me(a),i=[];return l.forEach(o=>{var r,v,u,w;const h=o.data();h.subscription&&(h.subscription.planType||h.subscription.plan)&&i.push({id:o.id,...h,subscription:{...h.subscription,startDate:((v=(r=h.subscription.startDate)==null?void 0:r.toDate)==null?void 0:v.call(r))||new Date(h.subscription.startDate),endDate:((w=(u=h.subscription.endDate)==null?void 0:u.toDate)==null?void 0:w.call(u))||new Date(h.subscription.endDate),planType:h.subscription.planType||h.subscription.plan}})}),i}catch(n){return console.error("خطأ في جلب الاشتراكات النشطة:",n),[]}},Gt=async(n=Le)=>{try{const a=await Yt(),l=[];return a.forEach(i=>{if(!i.subscription||!i.subscription.endDate)return;const o=Bt(i.subscription.endDate),h=qt(o,n);if(o<=n.infoDays||o<0){const r={id:`${i.id}_${Date.now()}`,userId:i.id,userName:i.displayName||i.email||"مستخدم غير معروف",userEmail:i.email||"",subscriptionPlan:i.subscription.planType,expiryDate:i.subscription.endDate,daysRemaining:o,type:h,message:Ht(i.displayName||i.email||"مستخدم غير معروف",o,i.subscription.planType),isRead:!1,createdAt:new Date};l.push(r)}}),l.sort((i,o)=>{const h={expired:0,critical:1,warning:2,info:3};return h[i.type]!==h[o.type]?h[i.type]-h[o.type]:i.daysRemaining-o.daysRemaining}),l}catch(a){return console.error("خطأ في إنشاء إشعارات الاشتراك:",a),[]}},Qt=(n,a)=>a?n.filter(l=>l.type===a):n,Zt=n=>{localStorage.setItem("notificationSettings",JSON.stringify(n))},Xt=()=>{try{const n=localStorage.getItem("notificationSettings");if(n)return{...Le,...JSON.parse(n)}}catch(n){console.error("خطأ في تحميل إعدادات الإشعارات:",n)}return Le},Kt=({isOpen:n,onClose:a})=>{const[l,i]=d.useState([]),[o,h]=d.useState([]),[r,v]=d.useState("all"),[u,w]=d.useState(!0),[j,C]=d.useState(Xt());d.useEffect(()=>{n&&y()},[n]),d.useEffect(()=>{h(r==="all"?l:Qt(l,r))},[l,r]);const y=async()=>{w(!0);try{const E=await Gt(j);i(E)}catch(E){console.error("خطأ في تحميل الإشعارات:",E)}finally{w(!1)}},p=E=>{switch(E){case"urgent":return e.jsx(Ae,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(xe,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(pe,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(pe,{className:"w-5 h-5 text-gray-500"})}},f=E=>{switch(E){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},m=E=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(E),O=E=>{switch(E){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},I=E=>{const B={...j,[E]:!j[E]};C(B),Zt(B)};return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),l.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:l.length})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(je,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(E=>e.jsx("button",{onClick:()=>v(E),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${r===E?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:O(E)},E))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.visualAlerts,onChange:()=>I("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.soundAlerts,onChange:()=>I("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.autoRefresh,onChange:()=>I("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:u?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):o.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(pe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:r==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${O(r)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:o.map(E=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${f(E.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[p(E.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:E.message}),e.jsx("span",{className:"text-xs text-gray-500",children:m(E.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",E.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",m(E.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",E.daysRemaining]})]})]})]})]})},E.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",m(new Date)]}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},Wt=({notification:n,onClose:a,soundEnabled:l,onToggleSound:i})=>{const[o,h]=d.useState(!1),[r,v]=d.useState(null);d.useEffect(()=>{if(n&&(h(!0),l&&u(n.type),n.type!=="urgent")){const p=setTimeout(()=>{w()},1e4);return()=>clearTimeout(p)}},[n,l]),d.useEffect(()=>{typeof window<"u"&&window.AudioContext&&v(new AudioContext)},[]);const u=p=>{if(!(!r||!l))try{const f=r.createOscillator(),m=r.createGain();switch(f.connect(m),m.connect(r.destination),p){case"urgent":f.frequency.setValueAtTime(800,r.currentTime),f.frequency.setValueAtTime(1e3,r.currentTime+.1),f.frequency.setValueAtTime(800,r.currentTime+.2),m.gain.setValueAtTime(.3,r.currentTime),m.gain.exponentialRampToValueAtTime(.01,r.currentTime+.5),f.start(r.currentTime),f.stop(r.currentTime+.5);break;case"warning":f.frequency.setValueAtTime(600,r.currentTime),f.frequency.setValueAtTime(700,r.currentTime+.15),m.gain.setValueAtTime(.2,r.currentTime),m.gain.exponentialRampToValueAtTime(.01,r.currentTime+.3),f.start(r.currentTime),f.stop(r.currentTime+.3);break;case"info":f.frequency.setValueAtTime(400,r.currentTime),m.gain.setValueAtTime(.1,r.currentTime),m.gain.exponentialRampToValueAtTime(.01,r.currentTime+.2),f.start(r.currentTime),f.stop(r.currentTime+.2);break}}catch(f){console.error("خطأ في تشغيل الصوت:",f)}},w=()=>{h(!1),setTimeout(()=>{a()},300)},j=p=>{switch(p){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Ae,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(xe,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(pe,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(pe,{className:"w-6 h-6"}),pulse:""}}},C=p=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(p);if(!n)return null;const y=j(n.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${o?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${y.bg} ${y.border} ${y.text} ${y.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[y.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[n.type==="urgent"&&"تنبيه عاجل!",n.type==="warning"&&"تحذير",n.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:l?"إيقاف الصوت":"تشغيل الصوت",children:l?e.jsx(Ot,{className:"w-4 h-4"}):e.jsx($t,{className:"w-4 h-4"})}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(je,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:n.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",n.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",C(n.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",n.daysRemaining," يوم"]})]})]}),n.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Jt=({user:n,onActivateSubscription:a,onDeactivateSubscription:l,onDeleteUser:i})=>{const[o,h]=d.useState(D.MONTHLY),[r,v]=d.useState(!1),u=zs(),w=p=>{const f=p==null?void 0:p.displayName;if(typeof f=="string"&&f.trim())return f.trim();if(f&&typeof f=="object"){const m=f.full_name||f.name||f.ar||f.en;if(typeof m=="string"&&m.trim())return m.trim()}return typeof(p==null?void 0:p.email)=="string"&&p.email.includes("@")?p.email.split("@")[0]:"غير محدد"},j=p=>{switch(p){case D.LIFETIME:return e.jsx(Te,{className:"w-4 h-4 text-yellow-500"});case D.YEARLY:return e.jsx(ge,{className:"w-4 h-4 text-blue-500"});case D.QUARTERLY:return e.jsx(ae,{className:"w-4 h-4 text-purple-500"});case D.MONTHLY:return e.jsx(ze,{className:"w-4 h-4 text-green-500"});case D.ZERO:return e.jsx(hs,{className:"w-4 h-4 text-gray-500"});default:return null}},C=p=>{switch(p){case D.MONTHLY:return"شهرية";case D.QUARTERLY:return"ربع سنوية";case D.YEARLY:return"سنوية";case D.LIFETIME:return"مدى الحياة";case D.ZERO:return"زيرو";default:return"غير محدد"}},y=p=>p?(p.toDate?p.toDate():new Date(p)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(Ce,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Se,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w(n)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Dt,{className:"w-3 h-3 ml-1"}),n.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(js,{className:"w-3 h-3 ml-1"}),n.phone||"غير محدد"]})]})]}),e.jsx(Re,{variant:n.isActive?"default":"secondary",children:n.isActive?"نشط":"غير نشط"})]}),n.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[j(n.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:C(n.subscription.planType)})]}),e.jsx(Re,{variant:n.subscription.isActive?"default":"destructive",children:n.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ae,{className:"w-3 h-3 ml-1"}),"البداية: ",y(n.subscription.startDate)]}),n.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"w-3 h-3 ml-1"}),"النهاية: ",y(n.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[a&&r&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),u?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:o,onChange:p=>h(p.target.value),children:[e.jsx("option",{value:D.MONTHLY,children:"شهرية"}),e.jsx("option",{value:D.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:D.YEARLY,children:"سنوية"}),e.jsx("option",{value:D.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:D.ZERO,children:"زيرو"})]}):e.jsxs(Et,{value:o,onValueChange:p=>h(p),children:[e.jsx(Ct,{className:"w-full",children:e.jsx(St,{placeholder:"اختر نوع الباقة"})}),e.jsxs(Tt,{children:[e.jsx(be,{value:D.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(be,{value:D.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(be,{value:D.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(be,{value:D.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Pt,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(be,{value:D.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(hs,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(W,{size:"sm",onClick:()=>{a(n.id,o),v(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(W,{size:"sm",variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[a&&!r&&e.jsx(W,{size:"sm",variant:"outline",onClick:()=>v(!0),className:"flex-1",children:"تفعيل الاشتراك"}),l&&e.jsx(W,{size:"sm",variant:"outline",onClick:()=>l(n.id),className:"flex-1",children:"إلغاء الاشتراك"}),i&&e.jsx(W,{size:"sm",variant:"destructive",onClick:()=>i(n.id),children:e.jsx(Ys,{className:"w-4 h-4"})})]})]})]})})};class ea{constructor(){is(this,"hooks",[])}registerHooks(a){console.log("📝 Registering hooks:",Object.keys(a)),this.hooks.push(a)}async sendImageMessage(a,l,i,o,h){try{console.log("📤 Uploading image message:",{chatId:a,fileName:l.name,fileSize:l.size,senderType:i,senderId:o});const r=ds(),v=Date.now(),u=`chat-images/${a}/${v}_${l.name}`,w=ms(r,u),j=await mt(w,l);console.log("✅ Image uploaded successfully:",j.metadata.fullPath);const C=await xt(w);console.log("✅ Image URL obtained:",C);const y={chatId:a,message:h||"صورة",content:h||"صورة",senderType:i,senderId:o,timestamp:te(),isRead:!1,type:"image",imageUrl:C,imageFileName:l.name},p=await Ve(H(R,"chatMessages"),y);console.log("✅ Image message added to chatMessages:",p.id);const f=X(R,"chatRooms",a);if(i==="client"){const m=await ve(f);if(m.exists()){const O=m.data().unreadCount||0;await ce(f,{lastMessage:h||"صورة",lastMessageTime:te(),unreadCount:O+1})}}else await ce(f,{lastMessage:h||"صورة",lastMessageTime:te()});console.log("✅ Image message sent successfully")}catch(r){throw console.error("🔥 Error sending image message:",r),r}}async deleteChat(a){try{console.log("🗑️ Deleting chat:",a);const l=K(H(R,"chatMessages"),Q("chatId","==",a)),i=await me(l),o=[];for(const r of i.docs){const v=r.data();if(v.type==="image"&&v.imageUrl)try{const u=ds(),w=ms(u,v.imageUrl);o.push(ht(w))}catch(u){console.warn("⚠️ Could not delete image from storage:",u)}o.push(oe(r.ref))}const h=X(R,"chatRooms",a);o.push(oe(h)),await Promise.all(o),console.log("✅ Chat deleted successfully:",{chatId:a,messagesDeleted:i.size})}catch(l){throw console.error("🔥 Error deleting chat:",l),l}}unregisterHooks(a){console.log("🗑️ Unregistering hooks"),a?this.hooks=this.hooks.filter(l=>l!==a):this.hooks=[]}async createChatRoom(a,l=!1){try{const i=l?"clientEmail":"clientPhone",o=K(H(R,"chatRooms"),Q(i,"==",a),Q("status","==","active")),h=await me(o);if(!h.empty)return h.docs[0].id;const r={clientId:`client_${a}`,clientPhone:l?"":a,clientEmail:l?a:void 0,customerName:l?`عميل ${a}`:`عميل ${a}`,status:"active",unreadCount:0,createdAt:te(),lastMessageTime:te()};return(await Ve(H(R,"chatRooms"),r)).id}catch(i){throw console.error("Error creating chat room:",i),i}}async sendMessage(a,l,i,o){try{for(let r=1;r<=3;r++)try{console.log(`📤 Sending message (attempt ${r}):`,{chatId:a,message:l.substring(0,50)+"...",senderType:i,senderId:o});const v={chatId:a,message:l,content:l,senderType:i,senderId:o,timestamp:te(),isRead:!1},u=await Ve(H(R,"chatMessages"),v);console.log("✅ Message added to chatMessages:",u.id);const w=X(R,"chatRooms",a);if(i==="client"){const j=await ve(w),C=j.exists()&&j.data().unreadCount||0;await ce(w,{lastMessage:l,lastMessageTime:te(),unreadCount:C+1}),this.hooks.length>0&&this.hooks.forEach(y=>{if(y.onUnreadCountChange&&typeof y.onUnreadCountChange=="function")try{y.onUnreadCountChange(a,C+1)}catch(p){console.error("Error calling onUnreadCountChange hook:",p)}})}else await ce(w,{lastMessage:l,lastMessageTime:te()});if(this.hooks.length>0)try{const j=await ve(w);if(j.exists()){const C={id:j.id,...j.data()},y={id:u.id,...v,timestamp:new Date};this.hooks.forEach(p=>{if(p.onNewMessage&&typeof p.onNewMessage=="function")try{p.onNewMessage(y,C)}catch(f){console.error("Error calling onNewMessage hook:",f)}})}}catch(j){console.error("Error calling onNewMessage hooks:",j)}console.log("✅ Message sent successfully");return}catch(v){if(console.error(`❌ Attempt ${r} failed:`,v),r===3)throw v;await new Promise(u=>setTimeout(u,1e3*r))}throw new Error("Max retry attempts reached")}catch(r){throw console.error("🔥 Error sending message:",r),r}}subscribeToMessages(a,l){let i=0;const o=5;let h=null,r=null,v=0;const u=()=>{try{console.log("🔔 Starting subscription to messages for room:",a,`(attempt ${i+1})`);const w=K(H(R,"chatMessages"),Q("chatId","==",a),cs("timestamp","asc"));r=Me(w,j=>{console.log("📨 Received messages snapshot:",j.docs.length,"messages"),i=0;const C=j.docs.map(y=>{const p=y.data();return{id:y.id,...p,message:p.message||p.content||"",content:p.content||p.message||""}});if(C.length>v&&v>0){const y=C.slice(v);console.log("🆕 New messages detected:",y.length),y.forEach(p=>{this.hooks.forEach(f=>{if(f.onNewMessage&&typeof f.onNewMessage=="function")try{ve(X(R,"chatRooms",a)).then(m=>{if(m.exists()){const O={id:m.id,...m.data()},I=f.onNewMessage;I&&I(p,O)}}).catch(m=>{console.error("Error fetching chat room for hook:",m)})}catch(m){console.error("Error calling onNewMessage hook:",m)}})})}v=C.length,console.log("📨 Processed messages:",C),l(C)},j=>{var C,y,p,f;if(console.error("❌ Error in messages subscription:",j),j.name==="AbortError"||(C=j.message)!=null&&C.includes("AbortError")){console.log("🔄 Request was aborted, will retry..."),i<o&&(i++,h=setTimeout(()=>{u()},1e3));return}(y=j.message)!=null&&y.includes("index is currently building")||(p=j.message)!=null&&p.includes("cannot be used yet")||j.code==="failed-precondition"?(console.log("🔨 Index is still building, will retry in 10 seconds..."),i<o?(i++,h=setTimeout(()=>{console.log("🔄 Retrying subscription after index building delay..."),u()},1e4)):(console.log("⚠️ Max retries reached for index building. Please wait for index to complete."),l([]))):j.code==="unavailable"||(f=j.message)!=null&&f.includes("ERR_ABORTED")?(console.log("🔄 Connection issue detected, will retry automatically..."),i<o&&(i++,h=setTimeout(()=>{u()},2e3))):(console.error("❌ Unhandled error in messages subscription:",j),l([]))})}catch(w){console.error("❌ Error setting up messages subscription:",w),i<o&&(i++,h=setTimeout(()=>{u()},5e3))}};return u(),()=>{h&&clearTimeout(h),r&&r()}}subscribeToAdminChats(a){console.log("🔍 Admin: Starting subscription to admin chats");let l=0,i=0;const o=5;let h=null,r=null;const v=()=>{try{const u=K(H(R,"chatRooms"),Q("status","==","active"),cs("lastMessageTime","desc"));r=Me(u,w=>{console.log("📊 Admin: Received chat rooms snapshot:",{size:w.size,empty:w.empty,docs:w.docs.length}),i=0;const j=w.docs.map(C=>{const y=C.data();return console.log("💬 Admin: Chat room data:",{id:C.id,customerName:y.customerName,lastMessage:y.lastMessage,unreadCount:y.unreadCount,status:y.status}),{id:C.id,...y}});j.length!==l&&(console.log("🆕 Chat rooms count changed:",{old:l,new:j.length}),j.forEach(C=>{this.hooks.length>0&&this.hooks.forEach(y=>{if(y.onChatRoomUpdate&&typeof y.onChatRoomUpdate=="function")try{y.onChatRoomUpdate(C)}catch(p){console.error("Error calling onChatRoomUpdate hook:",p)}})})),l=j.length,a(j)},w=>{var j,C;if(console.error("❌ Error in admin chats subscription:",w),w.name==="AbortError"||(j=w.message)!=null&&j.includes("AbortError")){console.log("🔄 Admin chats request was aborted, will retry..."),i<o&&(i++,h=setTimeout(()=>{v()},1e3));return}w.code==="unavailable"||(C=w.message)!=null&&C.includes("ERR_ABORTED")?(console.log("🔄 Admin chats connection issue detected, will retry..."),i<o&&(i++,h=setTimeout(()=>{v()},2e3))):(console.error("❌ Unhandled error in admin chats subscription:",w),a([]))})}catch(u){console.error("❌ Error setting up admin chats subscription:",u),i<o&&(i++,h=setTimeout(()=>{v()},5e3))}};return v(),()=>{h&&clearTimeout(h),r&&r()}}async markMessagesAsRead(a,l){try{const i=K(H(R,"chatMessages"),Q("chatId","==",a),Q("senderType","!=",l),Q("isRead","==",!1)),h=(await me(i)).docs.map(r=>ce(X(R,"chatMessages",r.id),{isRead:!0}));if(await Promise.all(h),l==="admin"){const r=X(R,"chatRooms",a);await ce(r,{unreadCount:0})}}catch(i){throw console.error("Error marking messages as read:",i),i}}async closeChatRoom(a){try{const l=X(R,"chatRooms",a);await ce(l,{status:"closed",lastMessageTime:te()})}catch(l){throw console.error("Error closing chat room:",l),l}}}const ue=new ea,sa=({isOpen:n,onClose:a})=>{var k,U;const[l,i]=d.useState([]),[o,h]=d.useState(null),[r,v]=d.useState([]),[u,w]=d.useState(""),[j,C]=d.useState(!0),[y,p]=d.useState(!1),[f,m]=d.useState({}),O=d.useRef(null);d.useEffect(()=>{const x={onNewMessage:(S,A)=>{console.log("🔔 New message notification:",S,A),S.senderType==="client"&&S.chatId!==o&&(m(_=>({..._,[S.chatId]:(_[S.chatId]||0)+1})),console.log("🔔 New message from client in chat:",A.customerName||A.clientPhone))},onChatRoomUpdate:S=>{console.log("🔄 Chat room updated:",S),i(A=>{const _=A.findIndex(L=>L.id===S.id);if(_>=0){const L=[...A];return L[_]=S,L.sort((fe,$)=>{var P,F,V,z;const ne=((F=(P=fe.lastMessageTime)==null?void 0:P.toMillis)==null?void 0:F.call(P))||0;return(((z=(V=$.lastMessageTime)==null?void 0:V.toMillis)==null?void 0:z.call(V))||0)-ne})}else return[S,...A]})},onUnreadCountChange:(S,A)=>{console.log("📊 Unread count changed:",S,A),i(_=>_.map(L=>L.id===S?{...L,unreadCount:A}:L))}};return ue.registerHooks(x),()=>{ue.unregisterHooks()}},[o]),d.useEffect(()=>{console.log("🔍 AdminChatPanel: Setting up chat rooms subscription"),C(!0);const x=ue.subscribeToAdminChats(S=>{console.log("📊 AdminChatPanel: Received chats update:",S.length),i(S),C(!1)});return()=>{console.log("🔌 AdminChatPanel: Cleaning up chat rooms subscription"),x()}},[]),d.useEffect(()=>{if(!o){v([]);return}console.log("📨 AdminChatPanel: Setting up messages subscription for chat:",o);const x=ue.subscribeToMessages(o,S=>{console.log("📨 AdminChatPanel: Received messages update:",S.length),v(S),m(A=>{const _={...A};return delete _[o],_})});return ue.markMessagesAsRead(o,"admin").catch(console.error),()=>{console.log("🔌 AdminChatPanel: Cleaning up messages subscription"),x()}},[o]),d.useEffect(()=>{var x;(x=O.current)==null||x.scrollIntoView({behavior:"smooth"})},[r]);const I=async()=>{if(!(!u.trim()||!o||y)){p(!0);try{await ue.sendMessage(o,u.trim(),"admin","admin_user"),w("")}catch(x){console.error("Error sending message:",x),alert("حدث خطأ في إرسال الرسالة")}finally{p(!1)}}},E=x=>{h(x),m(S=>{const A={...S};return delete A[x],A})},B=Object.values(f).reduce((x,S)=>x+S,0),re=l.reduce((x,S)=>x+(S.unreadCount||0),0);return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[80vh] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"المحادثات"}),(re>0||B>0)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_t,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold",children:"جديد"})]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(je,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:j?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(us,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-2 text-gray-600",children:"جاري التحميل..."})]}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[e.jsx(De,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"لا توجد محادثات نشطة"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"ستظهر المحادثات الجديدة هنا"})]}):l.map(x=>{const S=o===x.id,A=(x.unreadCount||0)>0,_=f[x.id]>0,L=(x.unreadCount||0)+(f[x.id]||0);return e.jsx("div",{onClick:()=>E(x.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-all duration-200 ${S?"bg-blue-50 border-r-4 border-r-blue-500":A||_?"bg-yellow-50 hover:bg-yellow-100 border-r-4 border-r-yellow-400":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${A||_?"bg-yellow-200":"bg-gray-200"}`,children:e.jsx(_e,{className:`w-5 h-5 ${A||_?"text-yellow-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:x.customerName||x.clientPhone}),S&&e.jsx(ke,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]}),x.customerName&&x.customerName!==x.clientPhone&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:x.clientPhone}),x.lastMessage&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:x.lastMessage.length>50?x.lastMessage.substring(0,50)+"...":x.lastMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(xe,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:x.lastMessageTime&&x.lastMessageTime.toMillis?new Date(x.lastMessageTime.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${A||_?"bg-red-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:A||_?"رسائل جديدة":"مقروءة"})]})]})]}),L>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[20px] text-center",children:L>99?"99+":L})]})},x.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:((k=l.find(x=>x.id===o))==null?void 0:k.customerName)||((U=l.find(x=>x.id===o))==null?void 0:U.clientPhone)})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.map(x=>e.jsx("div",{className:`flex ${x.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${x.senderType==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:x.message||x.content}),e.jsx("p",{className:`text-xs mt-1 ${x.senderType==="admin"?"text-blue-100":"text-gray-500"}`,children:x.timestamp&&x.timestamp.toMillis?new Date(x.timestamp.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"})]})},x.id)),e.jsx("div",{ref:O})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:x=>w(x.target.value),onKeyPress:x=>x.key==="Enter"&&I(),placeholder:"اكتب رسالتك هنا...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y}),e.jsxs("button",{onClick:I,disabled:!u.trim()||y,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[y?e.jsx(us,{className:"w-4 h-4 animate-spin"}):e.jsx(It,{className:"w-4 h-4"}),"إرسال"]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(de,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر محادثة للبدء"}),e.jsx("p",{children:"اختر محادثة من القائمة لعرض الرسائل والرد عليها"})]})})})]})}):null},ta={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.firebasestorage.app",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},aa=({navigate:n,auth:a,devMode:l,setDevMode:i,error:o,setError:h,authLoading:r,setAuthLoading:v,activeTab:u,setActiveTab:w,setNotificationCenterOpen:j,setNotificationSettings:C,setNotifications:y,notificationCount:p,setNotificationCount:f,users:m,setUsers:O,filteredUsers:I,setFilteredUsers:E,loading:B,setLoading:re,setEditingPlan:k,isSavingContent:U,setIsSavingContent:x,lastUpdateInfo:S,loadContentFromFirebase:A,saveContentToFirebase:_})=>{var ls;const[L,fe]=d.useState(!0),[$,ne]=d.useState(""),[T,P]=d.useState(null),[F,V]=d.useState({});d.useState(!1),d.useState(null),d.useState(!1);const[z,Pe]=d.useState({sound:!0}),[Ns,ra]=d.useState(!1),[ws,vs]=d.useState(null),ye=s=>{const t=s==null?void 0:s.displayName;let c="";typeof t=="string"?c=t:t&&typeof t=="object"&&(c=(t.ar||t.en||"").toString()),!c&&typeof(s==null?void 0:s.email)=="string"&&(c=s.email);const b=String(c).trim().charAt(0);return b?b.toUpperCase():"؟"},he=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const c=t.full_name||t.name||t.ar||t.en;if(typeof c=="string"&&c.trim())return c.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[Ue,Ye]=d.useState(""),[Ie,Ge]=d.useState(""),[Qe,Ze]=d.useState(""),[Fe,Xe]=d.useState(""),[Ke,We]=d.useState(!1),[Ne,Je]=d.useState(""),[Y,es]=d.useState(24),[ss,ts]=d.useState("24"),[as,rs]=d.useState(!1),[na,ns]=d.useState(!1);d.useEffect(()=>{u==="trials"&&(async()=>{try{ns(!0);const{FreeTrialService:s}=await le(async()=>{const{FreeTrialService:c}=await import("./index-B05GXhax.js").then(b=>b.b3);return{FreeTrialService:c}},__vite__mapDeps([0,1])),t=await s.getTrialDurationHours();es(t),ts(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{ns(!1)}})()},[u]);const Es=async()=>{var s;if(!Ue.trim()||!Ie.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{We(!0);const t=Fe.trim()?`user:${Fe.trim()}`:"global";await vt({title:Ue.trim(),message:Ie.trim(),audienceKey:t,createdBy:(s=a==null?void 0:a.currentUser)==null?void 0:s.uid,linkUrl:Qe.trim()||void 0}),Ye(""),Ge(""),Ze(""),Xe(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{We(!1)}};d.useEffect(()=>{if(!$.trim())E(m);else{const s=m.filter(t=>t.email&&typeof t.email=="string"&&t.email.toLowerCase().includes($.toLowerCase())||t.displayName&&typeof t.displayName=="string"&&t.displayName.toLowerCase().includes($.toLowerCase())||t.name&&typeof t.name=="string"&&t.name.toLowerCase().includes($.toLowerCase()));E(s)}},[m,$,E]);const Cs=()=>{a!=null&&a.signOut&&a.signOut(),n("/admin/login")},Ss=async(s,t,c=null)=>{var b;try{console.log("Activating subscription for user:",s,"with plan:",t,"and variant:",c);const N=((b=a==null?void 0:a.currentUser)==null?void 0:b.uid)||"admin-user-id";await Zs(s,t,N,c),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(N){console.error("❌ خطأ في تفعيل الاشتراك:",N),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Ts=async s=>{try{console.log("Deactivating subscription for user:",s),await Xs(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Ds=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const b=((t=a==null?void 0:a.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const g=await Ks(Ws,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",g),O(M=>M.filter(q=>q.id!==s)),E(M=>M.filter(q=>q.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(N){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(N==null?void 0:N.message)||N)}{const N=[];try{await oe(X(R,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(g){console.error("خطأ في حذف الملف الشخصي:",g),N.push(`الملف الشخصي: ${(g==null?void 0:g.message)||g}`)}try{await oe(X(R,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(g){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",g),N.push(`users: ${(g==null?void 0:g.message)||g}`)}try{const g=K(H(R,"transactions"),Q("userId","==",s)),M=await me(g),q=M.docs.map(ee=>oe(ee.ref)),Z=await Promise.allSettled(q),G=Z.filter(ee=>ee.status==="rejected");G.length?(console.warn("فشل حذف بعض المعاملات:",G.length),N.push(`المعاملات: فشل حذف ${G.length} من أصل ${Z.length}`)):console.log(`تم حذف ${M.size} معاملة`)}catch(g){console.error("خطأ في جلب/حذف المعاملات:",g),N.push(`المعاملات: ${(g==null?void 0:g.message)||g}`)}try{const g=K(H(R,"chatRooms"),Q("participants","array-contains",s)),M=await me(g),q=M.docs.map(async Z=>{try{const ee=(await me(H(Z.ref,"messages"))).docs.map(se=>oe(se.ref));await Promise.allSettled(ee),await oe(Z.ref)}catch(G){console.error("فشل حذف محادثة/رسائل:",G),N.push(`المحادثات: ${Z.id}`)}});await Promise.all(q),console.log(`تم إنهاء معالجة ${M.size} محادثة`)}catch(g){console.error("خطأ في جلب/حذف المحادثات:",g),N.push(`المحادثات: ${(g==null?void 0:g.message)||g}`)}try{await Js(X(R,"deletedUsers",s),{deletedAt:new Date,deletedBy:b,reason:"حذف نهائي من لوحة الإدارة"})}catch(g){console.error("خطأ في تسجيل المستخدم كمحذوف:",g),N.push(`deletedUsers: ${(g==null?void 0:g.message)||g}`)}O(g=>g.filter(M=>M.id!==s)),E(g=>g.filter(M=>M.id!==s)),N.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${N.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(c){console.error("❌ خطأ في حذف المستخدم:",c),alert(`حدث خطأ في حذف المستخدم: ${c.message||"خطأ غير معروف"}`)}};d.useEffect(()=>{(async()=>{try{if(typeof A=="function"){const t=await A();t&&(t.monthly||t.yearly||t.lifetime)&&V(t)}}catch(t){console.warn("Failed to load content data:",t)}})()},[]);const ks=async()=>{var s;try{if(typeof _!="function")return;x(!0);const t=((s=a==null?void 0:a.currentUser)==null?void 0:s.uid)||"admin-user-id";await _(F,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{x(!1)}},we=(s,t,c)=>{V(b=>({...b,[s]:{...(b==null?void 0:b[s])||{},[t]:c}}))},As=s=>{V(t=>{var c;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((c=t==null?void 0:t[s])==null?void 0:c.features)||[],""]}}})},Ms=(s,t,c)=>{V(b=>{var g;const N=[...((g=b==null?void 0:b[s])==null?void 0:g.features)||[]];return N[t]=c,{...b,[s]:{...(b==null?void 0:b[s])||{},features:N}}})},Rs=(s,t)=>{V(c=>{var N;const b=[...((N=c==null?void 0:c[s])==null?void 0:N.features)||[]];return b.splice(t,1),{...c,[s]:{...(c==null?void 0:c[s])||{},features:b}}})},_s=()=>{Pe(s=>({...s,sound:!s.sound}))},Ls=()=>{vs(null)},Ps=async()=>{try{const s=Number(ss);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}rs(!0);const{FreeTrialService:t}=await le(async()=>{const{FreeTrialService:b}=await import("./index-B05GXhax.js").then(N=>N.b3);return{FreeTrialService:b}},__vite__mapDeps([0,1])),c=await t.updateTrialDurationHours(s);c.success?(es(s),alert(c.message)):alert(c.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{rs(!1)}},Us=async s=>{try{const{FreeTrialService:t}=await le(async()=>{const{FreeTrialService:b}=await import("./index-B05GXhax.js").then(N=>N.b3);return{FreeTrialService:b}},__vite__mapDeps([0,1])),c=await t.startFreeTrialFromAdmin(s);alert(c.message||`تم تفعيل التجربة المجانية لمدة ${Y} ${Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"}`)}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},Is=async s=>{try{const{FreeTrialService:t}=await le(async()=>{const{FreeTrialService:b}=await import("./index-B05GXhax.js").then(N=>N.b3);return{FreeTrialService:b}},__vite__mapDeps([0,1])),c=await t.resetActiveTrialToCurrentDuration(s);alert(c.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},Fs=(s,t)=>{console.log("Toggling user status:",s,t)},Oe=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",Os=[{id:"users",label:"المستخدمين",icon:De},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:ae},{id:"trials",label:"إدارة التجارب المجانية",icon:ge},{id:"content",label:"إدارة المحتوى",icon:et},{id:"chat",label:"الدردشة",icon:de},{id:"whatsapp",label:"إدارة الواتساب",icon:de},{id:"branches",label:"باقات الفروع",icon:ps},{id:"analytics",label:"الإحصائيات",icon:xs}];return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:o})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{h(null),v(!0),window.location.reload()},className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"🔄 إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{h(null),n("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",o),console.log("🔍 Auth state:",a.currentUser),console.log("🔍 Dev mode:",l),console.log("🔍 Environment:",ta)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!l&&!a.currentUser?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>n("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:`${L?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[L&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(kt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>fe(!L),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:L?e.jsx(je,{className:"w-5 h-5"}):e.jsx(Ut,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:Os.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>w(s.id),className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${u===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:Cs,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Gs,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[u==="users"&&"إدارة المستخدمين",u==="subscriptions"&&"مواعيد الاشتراكات",u==="trials"&&"إدارة التجارب المجانية",u==="chat"&&"إدارة الدردشة",u==="analytics"&&"الإحصائيات",u==="branches"&&"باقات الفروع"]}),l&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",l?"المطور":"المدير"]}),e.jsx(rt,{})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[u==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.length})]}),e.jsx(De,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Fe,onChange:s=>Xe(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>s.isActive).length})]}),e.jsx(fs,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>!s.isActive).length})]}),e.jsx(Ft,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:$,onChange:s=>ne(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),$&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",I.length," من أصل ",m.length," مستخدم",$&&e.jsx("button",{onClick:()=>ne(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):I.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:$?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map(s=>e.jsx(Jt,{user:s,onActivateSubscription:Ss,onToggleUserStatus:Fs,onDeactivateSubscription:Ts,onDeleteUser:Ds},s.id))})})]})]}),u==="branches"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"طلبات باقات الفروع (بانتظار التفعيل)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.filter(s=>{var t,c;return((t=s.branchPackage)==null?void 0:t.status)==="pending"||((c=s.branchPackage)==null?void 0:c.requested)}).length})]}),e.jsx(ps,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"باقات الفروع المفعّلة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>{var t;return((t=s.branchPackage)==null?void 0:t.status)==="active"}).length})]}),e.jsx(ke,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي حسابات باقات الفروع"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(s=>{var t,c;return((t=s.branchPackage)==null?void 0:t.requested)||((c=s.branchPackage)==null?void 0:c.status)}).length})]}),e.jsx(De,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قسم باقات الفروع"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن حساب باقات الفروع...",value:$,onChange:s=>ne(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),$&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",I.filter(s=>{var t,c;return((t=s.branchPackage)==null?void 0:t.requested)||((c=s.branchPackage)==null?void 0:c.status)}).length," من أصل ",m.filter(s=>{var t,c;return((t=s.branchPackage)==null?void 0:t.requested)||((c=s.branchPackage)==null?void 0:c.status)}).length," حساب",$&&e.jsx("button",{onClick:()=>ne(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:($?I:m).filter(s=>{var t,c;return((t=s.branchPackage)==null?void 0:t.requested)||((c=s.branchPackage)==null?void 0:c.status)}).map(s=>{var c,b,N;const t=((c=s.branchPackage)==null?void 0:c.status)||((b=s.branchPackage)!=null&&b.requested?"pending":"none");return e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold",children:ye(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:he(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),((N=s.branchPackage)==null?void 0:N.requestedAt)&&e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ الطلب: ",Oe(s.branchPackage.requestedAt)]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t==="active"?"bg-green-100 text-green-700":t==="pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:t==="active"?"مفعّل":t==="pending"?"بانتظار التفعيل":"غير محدد"}),t==="active"&&e.jsx("button",{title:"إلغاء باقة الفروع",onClick:async()=>{var M;if(window.confirm("هل تريد إلغاء تفعيل باقة الفروع لهذا الحساب؟"))try{const{doc:q,updateDoc:Z}=await le(async()=>{const{doc:se,updateDoc:ie}=await import("./index-B05GXhax.js").then($e=>$e.b1);return{doc:se,updateDoc:ie}},__vite__mapDeps([0,1])),{db:G}=await le(async()=>{const{db:se}=await import("./index-B05GXhax.js").then(ie=>ie.b2);return{db:se}},__vite__mapDeps([0,1])),ee=((M=a==null?void 0:a.currentUser)==null?void 0:M.uid)||"admin-user-id";await Z(q(G,"users",s.id),{branchPackage:{requested:!0,status:"canceled",canceledAt:new Date,canceledBy:ee},updatedAt:new Date}),alert("تم إلغاء باقة الفروع لهذا الحساب")}catch(q){console.error("فشل في إلغاء باقة الفروع:",q),alert("حدث خطأ أثناء الإلغاء، حاول مرة أخرى")}},className:"p-1 rounded-md text-red-600 hover:bg-red-50",children:e.jsx(At,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:t!=="active"&&e.jsx("button",{onClick:async()=>{var g;try{const{doc:M,updateDoc:q,setDoc:Z}=await le(async()=>{const{doc:se,updateDoc:ie,setDoc:$e}=await import("./index-B05GXhax.js").then($s=>$s.b1);return{doc:se,updateDoc:ie,setDoc:$e}},__vite__mapDeps([0,1])),{db:G}=await le(async()=>{const{db:se}=await import("./index-B05GXhax.js").then(ie=>ie.b2);return{db:se}},__vite__mapDeps([0,1])),ee=((g=a==null?void 0:a.currentUser)==null?void 0:g.uid)||"admin-user-id";await q(M(G,"users",s.id),{branchPackage:{requested:!0,status:"active",activatedAt:new Date,activatedBy:ee},isActive:!0,approved:!0,role:"merchant",updatedAt:new Date}),await Z(M(G,"profiles",s.id),{role:"merchant",approved:!0,updatedAt:new Date},{merge:!0}),alert("تم تفعيل باقة الفروع لهذا الحساب")}catch(M){console.error("فشل في تفعيل باقة الفروع:",M),alert("حدث خطأ أثناء التفعيل، حاول مرة أخرى")}},className:"px-3 py-1 text-sm rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"تفعيل باقة الفروع"})})]})]},s.id)})})})]})]}),u==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(ke,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:m.filter(s=>{var g,M;if(!((g=s.subscription)!=null&&g.endDate)||!((M=s.subscription)!=null&&M.isActive))return!1;const t=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),c=new Date,b=t.getTime()-c.getTime(),N=Math.ceil(b/(1e3*60*60*24));return N<=7&&N>0}).length})]}),e.jsx(Ae,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>{var c;return(c=s.subscription)!=null&&c.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(xe,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:m.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===D.LIFETIME}).length})]}),e.jsx(Te,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.planType}).sort((s,t)=>{var N,g;if(!((N=s.subscription)!=null&&N.endDate)||!((g=t.subscription)!=null&&g.endDate))return 0;const c=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),b=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return c.getTime()-b.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const c=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,b=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let N=null,g="غير محدد";if(t.planType===D.LIFETIME)g="مدى الحياة";else if(b){const M=new Date,q=b.getTime()-M.getTime();N=Math.ceil(q/(1e3*60*60*24)),N<0?g="منتهي":N<=7?g="ينتهي قريباً":g="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:ye(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:he(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===D.LIFETIME&&e.jsx(Te,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===D.YEARLY&&e.jsx(ge,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===D.QUARTERLY&&e.jsx(ae,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===D.MONTHLY&&e.jsx(ze,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Qs(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?c.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===D.LIFETIME?"مدى الحياة":b?b.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${g==="نشط"?"bg-green-100 text-green-800":g==="ينتهي قريباً"?"bg-orange-100 text-orange-800":g==="منتهي"?"bg-red-100 text-red-800":g==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:g})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===D.LIFETIME?"∞":N!==null?N<0?"منتهي":`${N} يوم`:"غير محدد"})]},s.id)}).filter(Boolean)})]})})]})]}),u==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),S&&S.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(S.lastUpdated).toLocaleString("ar-SA"),S.updatedBy&&` بواسطة: ${S.updatedBy}`]})]}),e.jsxs("button",{onClick:ks,disabled:U,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(bs,{className:"w-4 h-4"}),U?"جاري الحفظ...":"حفظ جميع التغييرات"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(F).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(ze,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(ae,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(ge,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(Te,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>k(T===s?null:s),className:"text-purple-600 hover:text-purple-800",children:e.jsx(ut,{className:"w-4 h-4"})})]}),T===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:c=>we(s,"name",c.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:c=>we(s,"price",c.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:c=>we(s,"period",c.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:c=>we(s,"description",c.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>As(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((c,b)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:N=>Ms(s,b,N.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>Rs(s,b),className:"text-red-500 hover:text-red-700",children:e.jsx(je,{className:"w-4 h-4"})})]},b))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((c,b)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3 text-green-500"}),c]},b))]})]})]},s))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:Ue,onChange:s=>Ye(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:Ie,onChange:s=>Ge(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:Qe,onChange:s=>Ze(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:Es,disabled:Ke,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:Ke?"جاري الإرسال...":"إرسال إشعار"})})]})]})]}),u==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",m),console.log("🔍 Users count:",(m==null?void 0:m.length)||0),console.log("🔍 Users on trial:",((ls=m==null?void 0:m.filter(s=>s.isOnFreeTrial))==null?void 0:ls.length)||0),B&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),o&&!B&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Ae,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:o}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!B&&!o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(ge,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(xe,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(fs,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:ss,onChange:s=>ts(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",Y," ",Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:Ps,disabled:as,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:as?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ne,onChange:s=>Je(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Ee,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=Ne.trim().toLowerCase();if(!t)return!0;const c=he(s).toLowerCase(),b=(s.email||"").toLowerCase();return c.includes(t)||b.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ye(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:he(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",Oe(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>Us(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${Y} ${Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"}`})})]},s.id)),m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),m.filter(s=>s.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ne,onChange:s=>Je(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Ee,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:m.filter(s=>s.isOnFreeTrial).filter(s=>{const t=Ne.trim().toLowerCase();if(!t)return!0;const c=he(s).toLowerCase(),b=(s.email||"").toLowerCase();return c.includes(t)||b.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ye(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:he(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?Oe(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>Is(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"})]})]},s.id))})})]})]})]}),u==="chat"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx(sa,{isOpen:!0,onClose:()=>{}})}),u==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(de,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(Vt,{})]}),u==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(xs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(Kt,{isOpen:Ns,onClose:()=>j(!1)}),e.jsx(Wt,{notification:ws,onClose:Ls,soundEnabled:z.soundAlerts,onToggleSound:_s})]})},Ya=()=>{const n=st(),{user:a,loading:l}=tt(),[i,o]=d.useState(!1),[h,r]=d.useState(null),[v,u]=d.useState(!1),[w,j]=d.useState("users"),[C,y]=d.useState(0),[p,f]=d.useState([]),[m,O]=d.useState([]),[I,E]=d.useState(!1),[B,re]=d.useState(null),[k,U]=d.useState([]),[x,S]=d.useState({});d.useEffect(()=>{const T=localStorage.getItem("admin_dev_mode")==="true";o(T)},[]),d.useEffect(()=>{if(!(!i&&!a)){u(!0),r(null);try{const T=K(H(R,"users")),P=Me(T,F=>{const V=F.docs.map(z=>({id:z.id,...z.data()}));U(V),u(!1),r(null)},F=>{console.error("Error loading users:",F),i?(U([]),u(!1),r(null)):(r("فشل في تحميل بيانات المستخدمين"),u(!1))});return()=>P()}catch(T){console.error("Error setting up users listener:",T),i?(U([]),u(!1),r(null)):(r("فشل في إعداد مراقب البيانات"),u(!1))}}},[a,i]),d.useEffect(()=>{if(!(!i&&!a))try{const T=K(H(R,"profiles")),P=Me(T,F=>{const V={};F.forEach(z=>{V[z.id]=z.data()}),S(V)},F=>{console.error("Error loading profiles:",F)});return()=>P()}catch(T){console.error("Error setting up profiles listener:",T)}},[a,i]),d.useEffect(()=>{const T=k.map(P=>{const F=x[P.id]||{},V=typeof F.fullName=="string"?F.fullName:void 0,z=typeof F.phone=="string"?F.phone:void 0,Pe=typeof P.displayName=="string"&&P.displayName.trim()?P.displayName:V||P.displayName||void 0;return{...P,displayName:Pe,phone:P.phone??z??null}});f(T),O(T)},[k,x]);const A=T=>{console.log("Notification center:",T)},_=T=>{console.log("Notification settings:",T)},L=T=>{console.log("Notifications:",T)},fe=T=>{console.log("Editing plan:",T)};d.useEffect(()=>{(async()=>{try{const T=await gs();re(T)}catch(T){console.warn("Failed to load last update info:",T),re(null)}})()},[]);const $=async()=>{try{return await Mt()}catch(T){return console.error("Error loading content:",T),{}}},ne=async T=>{try{E(!0);try{localStorage.setItem("siteContent_plans_cache",JSON.stringify(T))}catch{}await Rt(T,(a==null?void 0:a.uid)||"admin");const P=await gs();return re(P),!0}catch(P){return console.error("Error saving content:",P),!1}finally{E(!1)}};return l?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):e.jsx(aa,{navigate:n,auth:at,devMode:i,setDevMode:o,error:h,setError:r,authLoading:l,setAuthLoading:()=>{},activeTab:w,setActiveTab:j,setNotificationCenterOpen:A,setNotificationSettings:_,setNotifications:L,notificationCount:C,setNotificationCount:y,users:p,setUsers:f,filteredUsers:m,setFilteredUsers:O,loading:v,setLoading:u,setEditingPlan:fe,isSavingContent:I,setIsSavingContent:E,lastUpdateInfo:B,loadContentFromFirebase:$,saveContentToFirebase:ne})};export{Ya as default};
