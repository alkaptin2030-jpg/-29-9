import{v as c,f as d,H as f,s as u,K as m}from"./index-Bk7WpSNT.js";const w={getCurrentDayId(){const n=new Date;return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`},async getCounts(n,o){const r=o||this.getCurrentDayId(),e=c(d,"users",n,"dailyOps",r),s=await m(e);if(!s.exists()){const a={dayId:r,confirmTransferCount:0,confirmWithdrawCount:0,updatedAt:u()};return await f(e,a),{...a,updatedAt:new Date}}const t=s.data();return{dayId:r,confirmTransferCount:Number((t==null?void 0:t.confirmTransferCount)||0),confirmWithdrawCount:Number((t==null?void 0:t.confirmWithdrawCount)||0),updatedAt:(t==null?void 0:t.updatedAt)||u()}},async checkAndIncrement(n,o,r){const e=this.getCurrentDayId(),s=c(d,"users",n,"dailyOps",e),t=await this.getCounts(n,e),a=o==="transfer"?t.confirmTransferCount:t.confirmWithdrawCount;if(a>=r)return{allowed:!1,remaining:0};const i={updatedAt:u()};return o==="transfer"?i.confirmTransferCount=t.confirmTransferCount+1:i.confirmWithdrawCount=t.confirmWithdrawCount+1,await f(s,i,{merge:!0}),{allowed:!0,remaining:Math.max(0,r-(a+1))}}};export{w as dailyOperationCountService,w as default};
