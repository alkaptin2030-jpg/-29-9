import{v as l,f as o,H as d,d as h,s,K as f,a0 as y}from"./index-BaJ4CYlQ.js";const u={getCurrentDayId(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},async setLimits(t,e){var r;try{const i=l(o,"walletLimits",t),n={updatedAt:s(),ownerId:(r=h.currentUser)==null?void 0:r.uid};return e.dailyTransferLimit!==void 0&&(n.dailyTransferLimit=e.dailyTransferLimit),e.dailyWithdrawLimit!==void 0&&(n.dailyWithdrawLimit=e.dailyWithdrawLimit),e.monthlyTransferLimit!==void 0&&(n.monthlyTransferLimit=e.monthlyTransferLimit),e.monthlyWithdrawLimit!==void 0&&(n.monthlyWithdrawLimit=e.monthlyWithdrawLimit),await d(i,n,{merge:!0}),await this.getWalletLimits(t)}catch(i){return console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:",i),null}},getCurrentMonthId(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`},shouldResetDailyLimits(t){if(!t)return!0;const e=new Date,r=t.toDate();return e.getDate()!==r.getDate()||e.getMonth()!==r.getMonth()||e.getFullYear()!==r.getFullYear()},shouldResetMonthlyLimits(t){if(!t)return!0;const e=new Date,r=t.toDate();return e.getMonth()!==r.getMonth()||e.getFullYear()!==r.getFullYear()},async getWalletLimits(t){var e;try{const r=l(o,"walletLimits",t);try{const n=await f(r);if(n.exists()){const a=n.data();return{walletId:t,dailyTransferLimit:a.dailyTransferLimit||6e4,dailyWithdrawLimit:a.dailyWithdrawLimit||1e5,dailyTransferUsed:a.dailyTransferUsed||0,dailyWithdrawUsed:a.dailyWithdrawUsed||0,lastDailyReset:a.lastDailyReset||null,monthlyTransferLimit:a.monthlyTransferLimit||2e5,monthlyWithdrawLimit:a.monthlyWithdrawLimit||2e5,monthlyTransferUsed:a.monthlyTransferUsed||0,monthlyWithdrawUsed:a.monthlyWithdrawUsed||0,lastMonthlyReset:a.lastMonthlyReset||null,updatedAt:a.updatedAt||y.now()}}}catch{}const i={walletId:t,dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:null,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:null,updatedAt:y.now()};return await d(r,{dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:null,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:null,updatedAt:s(),ownerId:(e=h.currentUser)==null?void 0:e.uid}),i}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:",r),null}},async resetDailyLimits(t){var e;try{const r=l(o,"walletLimits",t);return await d(r,{dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:s(),updatedAt:s(),ownerId:(e=h.currentUser)==null?void 0:e.uid},{merge:!0}),console.log(`ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø© ${t}`),!0}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:",r),!1}},async resetMonthlyLimits(t){var e;try{const r=l(o,"walletLimits",t);return await d(r,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:s(),updatedAt:s(),ownerId:(e=h.currentUser)==null?void 0:e.uid},{merge:!0}),console.log(`ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø© ${t}`),!0}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©:",r),!1}},async autoResetLimitsIfNeeded(t){try{const e=await this.getWalletLimits(t);if(!e)return null;let r=!1;return this.shouldResetDailyLimits(e.lastDailyReset)&&(await this.resetDailyLimits(t),r=!0),this.shouldResetMonthlyLimits(e.lastMonthlyReset)&&(await this.resetMonthlyLimits(t),r=!0),r?await this.getWalletLimits(t):e}catch(e){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯:",e),null}},async canPerformOperation(t,e,r){try{const i=await this.autoResetLimitsIfNeeded(t);if(!i)return{canPerform:!1,message:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©"};if(r==="transfer"){const n=i.dailyTransferLimit-i.dailyTransferUsed;if(e>n)return{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${n.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.dailyTransferLimit.toLocaleString()} Ø¬.Ù…`,dailyRemaining:n,limitType:"daily"};const a=i.monthlyTransferLimit-i.monthlyTransferUsed;return e>a?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${a.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.monthlyTransferLimit.toLocaleString()} Ø¬.Ù…`,monthlyRemaining:a,limitType:"monthly"}:{canPerform:!0,dailyRemaining:n-e,monthlyRemaining:a-e}}if(r==="withdraw"){const n=i.dailyWithdrawLimit-i.dailyWithdrawUsed;if(e>n)return{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø³Ø­Ø¨. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${n.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.dailyWithdrawLimit.toLocaleString()} Ø¬.Ù…`,dailyRemaining:n,limitType:"daily"};const a=i.monthlyWithdrawLimit-i.monthlyWithdrawUsed;return e>a?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ø³Ø­Ø¨. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${a.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.monthlyWithdrawLimit.toLocaleString()} Ø¬.Ù…`,monthlyRemaining:a,limitType:"monthly"}:{canPerform:!0,dailyRemaining:n-e,monthlyRemaining:a-e}}return{canPerform:!1,message:"Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­"}}catch(i){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:",i),{canPerform:!1,message:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯"}}},async updateUsage(t,e,r){try{const i=await this.canPerformOperation(t,e,r);if(!i.canPerform)throw new Error(i.message||"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©");const n=l(o,"walletLimits",t),a=await this.getWalletLimits(t);if(!a)throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©");const m={updatedAt:s()};return r==="transfer"?(m.dailyTransferUsed=a.dailyTransferUsed+e,m.monthlyTransferUsed=a.monthlyTransferUsed+e):r==="withdraw"&&(m.dailyWithdrawUsed=a.dailyWithdrawUsed+e,m.monthlyWithdrawUsed=a.monthlyWithdrawUsed+e),await d(n,{...m},{merge:!0}),await this.getWalletLimits(t)}catch(i){throw console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©:",i),i}},calculateRemaining(t){return{dailyTransferRemaining:Math.max(0,t.dailyTransferLimit-t.dailyTransferUsed),dailyWithdrawRemaining:Math.max(0,t.dailyWithdrawLimit-t.dailyWithdrawUsed),monthlyTransferRemaining:Math.max(0,t.monthlyTransferLimit-t.monthlyTransferUsed),monthlyWithdrawRemaining:Math.max(0,t.monthlyWithdrawLimit-t.monthlyWithdrawUsed)}},async resetAllLimits(t){var e;try{const r=l(o,"walletLimits",t);return await d(r,{dailyTransferUsed:0,dailyWithdrawUsed:0,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastDailyReset:s(),lastMonthlyReset:s(),updatedAt:s(),ownerId:(e=h.currentUser)==null?void 0:e.uid},{merge:!0}),console.log(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ${t}`),await this.getWalletLimits(t)}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¯ÙˆØ¯:",r),null}}};export{u as default,u as walletDailyLimitsService};
