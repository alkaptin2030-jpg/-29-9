const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./UserDashboardPage-Praofy4t.js","./index-CnUgNyqd.js","./index-BuVQaBwr.css","./card-B96kdBV_.js","./badge-FcLpN2XG.js","./select-B6NSNQKV.js","./Combination-DML-9tAV.js","./index-CqJmK4aa.js","./dialog-6_NUZRmj.js","./label-5KBRAS3O.js","./MasterPinDialog-vDLqGua3.js","./shield-E0ErX5WI.js","./circle-alert-BkPvyxKp.js","./walletDailyLimitsService-Brr-GqFy.js","./progress-CVxVbMcM.js","./wallet-Dm5nmWA0.js","./star-9dQZzoMn.js","./square-pen-CsmsYLty.js","./phone-qPogFsbl.js","./arrow-left-Dsivz1EU.js","./separator-BpDKewZl.js","./calendar-DD3A2bfj.js","./chart-column-BMxe9TiY.js","./dollar-sign-DuRaG-S0.js","./NotificationBell-bLDiWT6P.js","./dropdown-menu-Bj-2ikrK.js","./index-xPwwh6Ix.js","./avatars-CU4TVsxR.js","./refresh-cw-COnE41ll.js","./broadcastService-D3yVQmZ2.js","./textarea-CLNWpPiO.js","./circle-check-big-BSrrJlRb.js","./circle-x-R7tmbAG8.js","./MaintenanceDialog-CR7Iqsx6.js","./whatsappService-DwwL9C-9.js","./download-BjM3cf8t.js","./profitService-8-9whIF3.js","./store-BDQrBCHY.js","./gift-C7sY6tCd.js","./WalletsManagement-DNZVQeAX.js","./walletSelectionPinService-DT8hiBYb.js"])))=>i.map(i=>d[i]);
import{u as J,r as i,_ as V,a as M,v as _,f as O,w as q,j as t,ax as F,O as T,az as z,c as Y,ah as E,R as G,a9 as Q}from"./index-CnUgNyqd.js";import{s as W,E as X}from"./broadcastService-D3yVQmZ2.js";import{L as H}from"./link-B6D7rAeM.js";import{M as L}from"./MasterPinDialog-vDLqGua3.js";import"./label-5KBRAS3O.js";import"./dialog-6_NUZRmj.js";import"./Combination-DML-9tAV.js";import"./shield-E0ErX5WI.js";import"./circle-alert-BkPvyxKp.js";const D="dismissedBroadcastIds",Z=()=>{const{user:s,profile:e,isSubscriptionActive:a,userSubscription:c}=J(),[n,f]=i.useState(null),[d,x]=i.useState(!1),[S,l]=i.useState(!1),[v,b]=i.useState([]),A=V(),u=M(),m=i.useMemo(()=>`dismissedBroadcastIds:${(s==null?void 0:s.uid)||"global"}`,[s==null?void 0:s.uid]),y=i.useMemo(()=>{const o=["global"];return e!=null&&e.shopId&&o.push(`shop:${e.shopId}`),s!=null&&s.uid&&o.push(`user:${s.uid}`),o},[e==null?void 0:e.shopId,s==null?void 0:s.uid]),w=A.pathname.startsWith("/admin");i.useEffect(()=>{if(!(s!=null&&s.uid))return;const o=_(O,"users",s.uid),g=q(o,r=>{const p=r.data(),j=Array.isArray(p==null?void 0:p.dismissedBroadcastIds)?p.dismissedBroadcastIds:[];b(j);try{const N=localStorage.getItem(m),k=N?JSON.parse(N):[],h=Array.from(new Set([...Array.isArray(k)?k:[],...j]));localStorage.setItem(m,JSON.stringify(h)),localStorage.setItem(D,JSON.stringify(h))}catch{}},r=>{console.error("UserBroadcastModal: onSnapshot user error",r)});return()=>g()},[s==null?void 0:s.uid,m]),i.useEffect(()=>{if(!s||w||!((e==null?void 0:e.approved)===!0||a||(c==null?void 0:c.isOnFreeTrial)===!0))return;const g=W(y,r=>{if(r){f(r);try{const p=localStorage.getItem(m),j=localStorage.getItem(D),N=p?JSON.parse(p):[],k=j?JSON.parse(j):[],h=Array.isArray(N)?[...N]:[];if(Array.isArray(k))for(const U of k)h.includes(U)||h.push(U);if(Array.isArray(v))for(const U of v)h.includes(U)||h.push(U);const K=r.id&&h.includes(r.id);x(!K),l(!1),requestAnimationFrame(()=>l(!0))}catch{x(!0),l(!0)}}});return()=>g()},[s,y,w,e==null?void 0:e.approved,a,c,v]);const C=async()=>{x(!1);try{const o=localStorage.getItem(m),g=o?JSON.parse(o):[],r=n==null?void 0:n.id;if(r&&!g.includes(r)){g.push(r),localStorage.setItem(m,JSON.stringify(g));try{localStorage.setItem(D,JSON.stringify(g))}catch{}try{s!=null&&s.uid&&await T(_(O,"users",s.uid),{dismissedBroadcastIds:z(r)})}catch(p){console.warn("UserBroadcastModal: failed to update dismissedBroadcastIds in Firestore",p)}}}catch{}};return!d||!n?null:t.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[t.jsx("div",{className:`absolute inset-0 transition-opacity duration-300 ease-out ${S?"opacity-100":"opacity-0"} bg-black/20 dark:bg-black/20`}),t.jsxs("div",{className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[92%] sm:w-auto sm:min-w-[380px] sm:max-w-md md:max-w-lg bg-white shadow-2xl rounded-2xl border border-gray-100 ring-1 ring-black/5 transition-all duration-300 ease-out ${S?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[t.jsx("div",{className:"relative overflow-hidden rounded-t-2xl",children:t.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 relative",children:[t.jsx("button",{"aria-label":"Ø¥ØºÙ„Ø§Ù‚",onClick:C,className:"absolute top-3 right-3 p-2 rounded-full bg-white/10 hover:bg-white/20",children:t.jsx(F,{className:"w-5 h-5 text-white"})}),t.jsx("div",{className:"p-4",children:t.jsx("h3",{className:"text-base sm:text-lg font-semibold text-white tracking-wide text-center",children:n.title||"Ø¥Ø´Ø¹Ø§Ø±"})})]})}),t.jsx("div",{className:"p-5",children:t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsx("p",{className:"text-gray-700 leading-relaxed text-sm sm:text-base",children:n.message}),n.linkUrl&&t.jsxs("button",{"aria-label":"ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·",title:"ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·",onClick:()=>{const o=n.linkUrl;/^https?:\/\//i.test(o)?window.open(o,"_blank","noopener"):u(o)},className:"shrink-0 inline-flex items-center gap-2 px-3 py-2 rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 whitespace-nowrap",children:[/^https?:\/\//i.test(n.linkUrl)?t.jsx(X,{className:"w-6 h-6"}):t.jsx(H,{className:"w-6 h-6"}),t.jsx("span",{className:"text-xs sm:text-sm font-semibold",children:"ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·"})]})]})})]})]})},B="quick_login_enabled",R="quick_login_session_verified";function $(s){return s?`${B}_${s}`:B}function P(s){return s?`${R}_${s}`:R}const I={isEnabled(s){try{return localStorage.getItem($(s))==="true"}catch{return!1}},setEnabled(s,e){try{localStorage.setItem($(e),s?"true":"false"),sessionStorage.removeItem(P(e))}catch{}},isSessionVerified(s){try{return sessionStorage.getItem(P(s))==="true"}catch{return!1}},markSessionVerified(s){try{sessionStorage.setItem(P(s),"true")}catch{}}},ee=G.lazy(()=>Q(()=>import("./UserDashboardPage-Praofy4t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]),import.meta.url)),le=()=>{const s=M(),{user:e,profile:a,loading:c,refreshProfile:n,isSubscriptionActive:f,userSubscription:d,checkSubscriptionStatus:x}=J(),[S,l]=i.useState(!1),[v,b]=i.useState(!1),{toast:A}=Y();return i.useEffect(()=>{const u=async m=>{const{userId:y,isActive:w}=m.detail;console.log("ðŸ”” ProtectedUserDashboard: Subscription update event received:",{userId:y,isActive:w,currentUserId:e==null?void 0:e.uid}),y===(e==null?void 0:e.uid)&&w&&(console.log("âœ… ProtectedUserDashboard: Subscription activated for current user, refreshing status"),await x(),l(!0),A({title:"ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",description:"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…!"}))};return window.addEventListener("userSubscriptionUpdated",u),()=>{window.removeEventListener("userSubscriptionUpdated",u)}},[e==null?void 0:e.uid,x,A]),i.useEffect(()=>{if(console.log("ProtectedUserDashboard - useEffect triggered",{loading:c,user:e?"exists":"null",profile:a?{role:a.role,approved:a.approved}:"null",isSubscriptionActive:f,userSubscription:d?"exists":"null"}),!c){if(!e)console.log("ProtectedUserDashboard - No user, redirecting to login"),s("/user/login");else if(a){if(console.log("ProtectedUserDashboard - Profile found:",{role:a.role,approved:a.approved,isSubscriptionActive:f,hasSubscription:!!(d!=null&&d.subscription)}),a.role==="user"){if(f){console.log("ProtectedUserDashboard - User has active subscription, allowing access"),l(!0);return}if(a.approved===!1){console.log("ProtectedUserDashboard - User not approved and no active subscription, redirecting to pending approval"),s("/user/pending-approval");return}}console.log("ProtectedUserDashboard - User approved or admin, checking quick-login gate");const u=I.isEnabled(e==null?void 0:e.uid),m=I.isSessionVerified(e==null?void 0:e.uid);u&&!m?(b(!0),l(!1)):l(!0)}}},[e,a,c,s,f,d]),c?t.jsx(E,{}):e&&!a?t.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center gap-4",children:[t.jsx(E,{}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨â€¦ Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ù„Ø­Ø¸Ø§Øª"}),t.jsx("div",{className:"mt-2",children:t.jsx("button",{type:"button",onClick:()=>{try{n()}catch{}},className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white text-xs",children:"ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„"})})]})]}):S?(console.log("ProtectedUserDashboard - Render state:",{isAuthenticated:S,profileRole:a==null?void 0:a.role,profileApproved:a==null?void 0:a.approved,isSubscriptionActive:f,hasSubscription:!!(d!=null&&d.subscription)}),console.log("ðŸ”¥ ProtectedUserDashboard - user:",e?{uid:e.uid,email:e.email}:"null"),console.log("ðŸ”¥ ProtectedUserDashboard - profile:",a?{userId:a.userId,role:a.role}:"null"),console.log("ðŸ”¥ ProtectedUserDashboard - loading:",c),console.log("ðŸ”¥ ProtectedUserDashboard - About to render UserDashboardPage"),t.jsxs("div",{className:"relative",children:[t.jsx(i.Suspense,{fallback:t.jsx(E,{}),children:t.jsx(ee,{})}),t.jsx(Z,{}),t.jsx(L,{open:v,onOpenChange:u=>b(u),mode:"verify",title:"Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",onSuccess:()=>{I.markSessionVerified(e==null?void 0:e.uid),b(!1),l(!0)}})]})):t.jsxs(t.Fragment,{children:[t.jsx(E,{}),t.jsx(L,{open:v,onOpenChange:u=>b(u),mode:"verify",title:"Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",onSuccess:()=>{I.markSessionVerified(e==null?void 0:e.uid),b(!1),l(!0)}})]})};export{le as default};
