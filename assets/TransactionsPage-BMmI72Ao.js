const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/walletDailyLimitsService-Cz13top2.js","assets/index-B3Sy396l.js","assets/index-DlBM-tqJ.css","assets/profitService-DLXAbadF.js","assets/reportsService-Cf71NkrA.js"])))=>i.map(i=>d[i]);
import{c as pt,G as ht,r as n,I as xt,j as t,P as Z,K as ne,ao as gt,y as de,a as ft,u as vt,R as ie,S as bt,az as yt,X as Nt,q as jt,f as St,g as Ae,a4 as Ct,o as Tt,m as At,Q as J,aA as X,aB as v,a8 as De,aC as Dt,aD as wt,e as le,C as we,$ as _t,k as Ot,_ as E}from"./index-B3Sy396l.js";import{C as It,a as kt,b as Pt,d as Et}from"./card-bdveKTt5.js";import{B as N}from"./button-DcUCheen.js";import{I as ce}from"./input-BH66h0_i.js";import{D as Rt,a as Mt,b as Lt,c as $t}from"./dialog-BEJLtmNa.js";import{S as zt,a as Bt,b as Ft,c as Wt,d as q}from"./select-CYAD96EL.js";import{B as H}from"./badge-CG2S7vEC.js";import{c as Oe,R as Ut,I as Vt}from"./index-Du3QqN2K.js";import{u as Gt}from"./index-CbY_SPo2.js";import{u as Kt}from"./Combination-Xxamr9e8.js";import{C as Jt,a as Xt,M as qt,b as Ht,P as Zt,R as Qt}from"./PasswordConfirmDialog-CKm6jeh9.js";import{M as Yt}from"./MasterPinDialog-zI1185TT.js";import{A as es}from"./arrow-left-t9uBNcdg.js";import{S as ts}from"./separator-o90-uOCc.js";import{C as ss}from"./calendar-BinHhQhg.js";import{T as _e}from"./progress-B9OhvrMm.js";import{C as as}from"./circle-x-BAPBqdqK.js";import{C as rs}from"./circle-check-big-P1_m8uII.js";import"./index-DROq3oZt.js";import"./whatsappService-HaS0UbLj.js";import"./index.esm-CJK2PHEg.js";import"./lock-D34V0B5O.js";import"./eye-Ci5DKxRU.js";import"./label-DO0UIhQ0.js";import"./circle-alert-DtI8nqFK.js";import"./shield-DjxfsNxb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=pt("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);var Q="Tabs",[ns,Bs]=ht(Q,[Oe]),Ie=Oe(),[is,me]=ns(Q),ke=n.forwardRef((p,s)=>{const{__scopeTabs:d,value:m,onValueChange:y,defaultValue:w,orientation:f="horizontal",dir:j,activationMode:I="automatic",..._}=p,C=Gt(j),[S,D]=xt({prop:m,onChange:y,defaultProp:w??"",caller:Q});return t.jsx(is,{scope:d,baseId:Kt(),value:S,onValueChange:D,orientation:f,dir:C,activationMode:I,children:t.jsx(Z.div,{dir:C,"data-orientation":f,..._,ref:s})})});ke.displayName=Q;var Pe="TabsList",Ee=n.forwardRef((p,s)=>{const{__scopeTabs:d,loop:m=!0,...y}=p,w=me(Pe,d),f=Ie(d);return t.jsx(Ut,{asChild:!0,...f,orientation:w.orientation,dir:w.dir,loop:m,children:t.jsx(Z.div,{role:"tablist","aria-orientation":w.orientation,...y,ref:s})})});Ee.displayName=Pe;var Re="TabsTrigger",Me=n.forwardRef((p,s)=>{const{__scopeTabs:d,value:m,disabled:y=!1,...w}=p,f=me(Re,d),j=Ie(d),I=ze(f.baseId,m),_=Be(f.baseId,m),C=m===f.value;return t.jsx(Vt,{asChild:!0,...j,focusable:!y,active:C,children:t.jsx(Z.button,{type:"button",role:"tab","aria-selected":C,"aria-controls":_,"data-state":C?"active":"inactive","data-disabled":y?"":void 0,disabled:y,id:I,...w,ref:s,onMouseDown:ne(p.onMouseDown,S=>{!y&&S.button===0&&S.ctrlKey===!1?f.onValueChange(m):S.preventDefault()}),onKeyDown:ne(p.onKeyDown,S=>{[" ","Enter"].includes(S.key)&&f.onValueChange(m)}),onFocus:ne(p.onFocus,()=>{const S=f.activationMode!=="manual";!C&&!y&&S&&f.onValueChange(m)})})})});Me.displayName=Re;var Le="TabsContent",$e=n.forwardRef((p,s)=>{const{__scopeTabs:d,value:m,forceMount:y,children:w,...f}=p,j=me(Le,d),I=ze(j.baseId,m),_=Be(j.baseId,m),C=m===j.value,S=n.useRef(C);return n.useEffect(()=>{const D=requestAnimationFrame(()=>S.current=!1);return()=>cancelAnimationFrame(D)},[]),t.jsx(gt,{present:y||C,children:({present:D})=>t.jsx(Z.div,{"data-state":C?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":I,hidden:!D,id:_,tabIndex:0,...f,ref:s,style:{...p.style,animationDuration:S.current?"0s":void 0},children:D&&w})})});$e.displayName=Le;function ze(p,s){return`${p}-trigger-${s}`}function Be(p,s){return`${p}-content-${s}`}var ls=ke,Fe=Ee,We=Me,Ue=$e;const cs=ls,Ve=n.forwardRef(({className:p,...s},d)=>t.jsx(Fe,{ref:d,className:de("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",p),...s}));Ve.displayName=Fe.displayName;const z=n.forwardRef(({className:p,...s},d)=>t.jsx(We,{ref:d,className:de("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",p),...s}));z.displayName=We.displayName;const B=n.forwardRef(({className:p,...s},d)=>t.jsx(Ue,{ref:d,className:de("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",p),...s}));B.displayName=Ue.displayName;const Fs=()=>{var je,Se,Ce,Te;const p=ft(),{user:s,profile:d,userSubscription:m}=vt(),y=ie.useMemo(()=>{var a,r,c,o;const e=((a=m==null?void 0:m.subscription)==null?void 0:a.planType)??((r=m==null?void 0:m.subscription)==null?void 0:r.plan)??((c=d==null?void 0:d.subscription)==null?void 0:c.planType)??((o=d==null?void 0:d.subscription)==null?void 0:o.plan)??null;return e===bt.ZERO||String(e).toLowerCase()==="zero"},[(je=m==null?void 0:m.subscription)==null?void 0:je.planType,(Se=m==null?void 0:m.subscription)==null?void 0:Se.plan,(Ce=d==null?void 0:d.subscription)==null?void 0:Ce.planType,(Te=d==null?void 0:d.subscription)==null?void 0:Te.plan]),{shopName:w}=yt();Nt();const[f,j]=n.useState([]),[I,_]=n.useState([]),[C,S]=n.useState("all"),[D,ue]=n.useState(""),[R,Ge]=n.useState(""),[M,Ke]=n.useState(""),[ds,Je]=n.useState(!1),[ms,Xe]=n.useState(!1),[us,qe]=n.useState(!1),[ps,He]=n.useState(!1),[Y,ee]=n.useState(!1),[Ze,pe]=n.useState(!1),[Qe,he]=n.useState(!1),[Ye,te]=n.useState(!1),[et,tt]=n.useState(null),[st,se]=n.useState(!1),[at,F]=n.useState(!1),[W,xe]=n.useState(""),[L,ge]=n.useState(""),[U,fe]=n.useState(""),[ve,be]=n.useState(!1),[ye,V]=n.useState(0),P=ie.useCallback(()=>{try{const e=`debts_${(s==null?void 0:s.uid)||"default"}`,a=localStorage.getItem(e)||localStorage.getItem("debts_default");if(!a){V(0);return}const r=JSON.parse(a);if(!Array.isArray(r)){V(0);return}const c=r.filter(o=>(o==null?void 0:o.status)==="pending"&&((o==null?void 0:o.amount)??0)>0).length;V(c)}catch{V(0)}},[s==null?void 0:s.uid]);n.useEffect(()=>{P()},[P]),n.useEffect(()=>{const e=a=>{a.key&&(a.key===`debts_${(s==null?void 0:s.uid)||"default"}`||a.key==="debts_default")&&P()};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[P,s==null?void 0:s.uid]),n.useEffect(()=>{Y||P()},[Y,P]),n.useEffect(()=>{rt(),ot()},[s]),n.useEffect(()=>{if(s!=null&&s.uid)try{const e=jt(St(Ae,"userTransactions"),Ct("userId","==",s.uid),Tt("createdAt","desc")),a=At(e,r=>{const c=r.docs.map(o=>{const u=o.data(),l=u==null?void 0:u.createdAt,i=l!=null&&l.toDate?l.toDate():l instanceof Date?l:new Date(l);return{id:o.id,...u,createdAt:i}}).filter(o=>(o==null?void 0:o.status)!=="cancelled"&&!(o!=null&&o.isDeleted)).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية")));j(c.map(re))},r=>{console.error("خطأ في الاشتراك لمعاملات المستخدم:",r)});return()=>a()}catch(e){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم:",e)}},[s==null?void 0:s.uid]);const rt=async()=>{try{if(!s)return;const a=(await J.getUserTransactions(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)})).filter(r=>!((r==null?void 0:r.type)==="report"||((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية")));j(a.map(re))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e)}},ot=async()=>{try{if(!s)return;const a=(await X.getDeletedTransactionsByUser(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)}));_(a.map(re))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e)}},$=ie.useMemo(()=>{const e=s!=null&&s.uid?`recentTransactionsResetAt:${s.uid}`:null,a=e?localStorage.getItem(e):null;let r=null;if(a){const c=new Date(a);isNaN(c.getTime())||(r=c)}return f.filter(c=>!r||c.createdAt>=r)},[f,s==null?void 0:s.uid]),Ne=$.filter(e=>{const a=!D||e.senderPhone.includes(D)||e.receiverPhone.includes(D),r=!R||e.createdAt.toDateString()===new Date(R).toDateString(),c=!M||e.createdAt.toTimeString().startsWith(M);return a&&r&&c}),G=e=>{switch(e){case"completed":return t.jsx(rs,{className:"h-4 w-4 text-green-500"});case"pending":return t.jsx(we,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(as,{className:"h-4 w-4 text-red-500"});default:return t.jsx(we,{className:"h-4 w-4 text-gray-500"})}},ae=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},re=e=>{const a=((e==null?void 0:e.status)??"").toString().toLowerCase(),r=a==="confirmed"||a==="success"||a==="completed"?"completed":a==="failed"||a==="error"||a==="cancelled"||a==="canceled"?"cancelled":"pending",o=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",u=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",l=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",i=e==null?void 0:e.createdAt,h=i instanceof Date?i:i!=null&&i.toDate?i.toDate():new Date(i);return{id:e==null?void 0:e.id,senderPhone:u||"غير معروف",receiverPhone:l||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:r,type:o,createdAt:h,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0}},nt=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:w??(d==null?void 0:d.shopName)??(s==null?void 0:s.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0}),oe=e=>{const a=nt(e);tt(a),te(!0)},it=async e=>{try{const a=I.find(o=>o.id===e);if(!a||!s)return;const r=await J.saveUserTransaction(s.uid,{...a,userId:s.uid,status:"completed",cashierName:a.cashierName??"الحساب الرئيسي"});await X.permanentlyDeleteTransaction(e,s.uid);const c={...a,id:r};j(o=>[...o,c]),_(o=>o.filter(u=>u.id!==e)),v({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(a){console.error("خطأ في استرجاع المعاملة من Firestore:",a),v({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},lt=async e=>{try{if(!s)return;_(a=>a.filter(r=>r.id!==e)),await X.permanentlyDeleteTransaction(e,s.uid),await J.removeUserTransaction(s.uid,e),v({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(a){console.error("فشل الحذف النهائي للمعاملة:",a),v({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ct=async e=>{try{const a=f.find(i=>i.id===e);if(!a||!s)return;const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,c=`userCashBalance_${(s==null?void 0:s.uid)||"default"}`,o=`walletBalances_${(s==null?void 0:s.uid)||"default"}`;let u=(()=>{const i=localStorage.getItem(r);if(i!=null)return parseFloat(i);const h=localStorage.getItem(c);if(h!=null){const b=parseFloat(h);if(!Number.isNaN(b)){try{localStorage.setItem(r,b.toString()),localStorage.removeItem(c)}catch{}return b}}return 0})(),l=(()=>{const i=localStorage.getItem(o);try{return i?JSON.parse(i):{}}catch{return{}}})();if(a.type==="withdraw"){const i=a.fromWallet||Object.keys(l)[0],h=Number(a.withdrawnAmount??a.amount??0),b=Number(a.commission??0),O=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let x=[];try{const T=localStorage.getItem(O);x=T?JSON.parse(T):[]}catch{x=[]}const g=(a==null?void 0:a.walletEffectAppliedOnCreation)||x.includes(e);if(!g&&i&&h>0){const T=l[i]||0;l[i]=T+h}if(u=u-h+b,localStorage.setItem(r,u.toString()),localStorage.setItem(o,JSON.stringify(l)),g)try{const T=x.filter(K=>K!==e);localStorage.setItem(O,JSON.stringify(T))}catch{}}await _t(Ot(Ae,"userTransactions",e),{status:"completed",confirmedAt:new Date}),j(i=>i.map(h=>h.id===e?{...h,status:"completed"}:h)),v({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),te(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),v({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},dt=async e=>{try{const a=f.find(r=>r.id===e);if(!a||!s)return;j(r=>r.filter(c=>c.id!==e)),_(r=>[{...a},...r]);try{await J.removeUserTransaction(s.uid,e),await X.saveDeletedTransaction({...a,userId:s.uid,originalTransactionId:e})}catch(r){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",r)}try{const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,c=`userCashBalance_${(s==null?void 0:s.uid)||"default"}`,o=`walletBalances_${(s==null?void 0:s.uid)||"default"}`,u=localStorage.getItem(r);let l;if(u!=null)l=parseFloat(u);else{const A=localStorage.getItem(c);if(A!=null){const k=parseFloat(A);if(Number.isNaN(k))l=0;else{l=k;try{localStorage.setItem(r,k.toString()),localStorage.removeItem(c)}catch{}}}else l=0}const i=localStorage.getItem(o);let h=(()=>{try{return i?JSON.parse(i):{}}catch{return{}}})();const b=Number(a.withdrawnAmount??a.amount??0),O=Number(a.commission??0),x=a.fromWallet||Object.keys(h)[0],g=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let T=[];try{const A=localStorage.getItem(g);T=A?JSON.parse(A):[]}catch{T=[]}const K=(a==null?void 0:a.walletEffectAppliedOnCreation)||T.includes(e);if(a.type==="send"){const A=Number(a.fee??0),k=O+A;if(l-=k,x&&b>0){const ut=h[x]||0;h[x]=ut+b}}else if(a.type==="withdraw"){if(a.status==="completed"){if(l=l+b-O,x&&b>0){const A=h[x]||0;h[x]=A-b}}else if(x&&K&&b>0){const A=h[x]||0;h[x]=A-b}}if(localStorage.setItem(r,l.toString()),localStorage.setItem(o,JSON.stringify(h)),K)try{const A=T.filter(k=>k!==e);localStorage.setItem(g,JSON.stringify(A))}catch{}}catch(r){console.warn("فشل عكس تأثير الأرصدة محليًا:",r)}try{const r=a.fromWallet;if(r){const{walletDailyLimitsService:c}=await E(async()=>{const{walletDailyLimitsService:u}=await import("./walletDailyLimitsService-Cz13top2.js");return{walletDailyLimitsService:u}},__vite__mapDeps([0,1,2])),o=await c.getWalletLimits(r);if(o){const u=a.type==="send",l={updatedAt:(await E(async()=>{const{serverTimestamp:x}=await import("./index-B3Sy396l.js").then(g=>g.a$);return{serverTimestamp:x}},__vite__mapDeps([1,2]))).serverTimestamp()};u?(l.dailyTransferUsed=Math.max(0,(o.dailyTransferUsed||0)-a.amount),l.monthlyTransferUsed=Math.max(0,(o.monthlyTransferUsed||0)-a.amount)):(l.dailyWithdrawUsed=Math.max(0,(o.dailyWithdrawUsed||0)-a.amount),l.monthlyWithdrawUsed=Math.max(0,(o.monthlyWithdrawUsed||0)-a.amount));const{doc:i,setDoc:h}=await E(async()=>{const{doc:x,setDoc:g}=await import("./index-B3Sy396l.js").then(T=>T.a$);return{doc:x,setDoc:g}},__vite__mapDeps([1,2])),{db:b}=await E(async()=>{const{db:x}=await import("./index-B3Sy396l.js").then(g=>g.b0);return{db:x}},__vite__mapDeps([1,2])),O=i(b,"walletLimits",r);await h(O,l,{merge:!0})}}}catch(r){console.warn("فشل استرجاع حدود المحفظة:",r)}try{const{ProfitService:r}=await E(async()=>{const{ProfitService:i}=await import("./profitService-DLXAbadF.js");return{ProfitService:i}},__vite__mapDeps([3,4,1,2])),{ReportsService:c}=await E(async()=>{const{ReportsService:i}=await import("./reportsService-Cf71NkrA.js");return{ReportsService:i}},__vite__mapDeps([4,1,2])),u={txnType:a.type==="send"?"send":"receive",amount:a.amount,commission:a.commission||0,createdAt:a.createdAt,status:"confirmed"},l=r.calculateProfitFromTransaction(u);l>0&&r.addProfit(-l,s.uid);try{c.removeTransactionEffects(a,s.uid)}catch{}}catch(r){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",r)}}catch(a){console.error("خطأ أثناء حذف الإيصال:",a)}},mt=async()=>{var r,c,o;const e="alkaptin678678@gmail.com",a=(c=(r=le.currentUser)==null?void 0:r.email)==null?void 0:c.toLowerCase();if(!a||a!==e){v({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!W||!L||!U){v({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}be(!0);try{const l={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[L]??L,i=new AbortController,h=setTimeout(()=>i.abort(),15e3),b=await((o=le.currentUser)==null?void 0:o.getIdToken()),O=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({phone:W,countryCode:"EG",operator:l,amount:Number(U),useLocalAmount:!0}),signal:i.signal});clearTimeout(h);const x=await O.text();let g;try{g=JSON.parse(x)}catch{g={success:!1,message:x||"فشل قراءة استجابة الخادم"}}O.ok&&(g!=null&&g.success)?(v({title:"تم الشحن",description:(g==null?void 0:g.message)||"تم تنفيذ عملية الشحن بنجاح"}),F(!1),xe(""),ge(""),fe("")):v({title:"فشل الشحن",description:(g==null?void 0:g.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(u){console.error("Topup request error:",u),(u==null?void 0:u.name)==="AbortError"?v({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):v({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{be(!1)}};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>p("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(es,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(It,{className:"card-modern fade-in-up",children:[t.jsxs(kt,{className:"pb-2 px-3 pt-3",children:[t.jsx(Pt,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(ts,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(ce,{placeholder:"بحث...",value:D,onChange:e=>ue(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105",onClick:()=>{v({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."})},title:"نافذة شحن سريعة",children:t.jsx(De,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شحن"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Je(!0),title:"آلة حاسبة",children:t.jsx(Jt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){v({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}Xe(!0)},title:"بيانات المبيعات",children:t.jsx(Xt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(N,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${R||M?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>qe(!0),title:"اختيار التاريخ",children:[t.jsx(ss,{className:"h-2.5 w-2.5"}),(R||M)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){v({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}ee(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Dt,{className:"h-2.5 w-2.5"}),ye>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:ye})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){v({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}he(!0)},title:"الصيانة",children:t.jsx(wt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{p("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(os,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){v({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}pe(!0)},title:"الفيز الائتمانية",children:t.jsx(De,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{se(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(_e,{className:"h-2.5 w-2.5"}),(s==null?void 0:s.uid)&&localStorage.getItem(`recentTransactionsResetAt:${s.uid}`)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(D||R||M)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{ue(""),Ge(""),Ke("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(Et,{className:"px-3 pb-3",children:t.jsxs(cs,{value:C,onValueChange:S,className:"w-full",children:[t.jsxs(Ve,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(z,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(B,{value:"all",className:"mt-2",children:Ne.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:Ne.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>oe(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-600",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(H,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.type==="withdraw"?"bg-green-100 text-green-800":""}`,children:e.type==="withdraw"?"سحب":ae(e.status)})]})]},e.id))})}),t.jsx(B,{value:"send",className:"mt-2",children:$.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:$.filter(e=>e.type==="send").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>oe(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(H,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:ae(e.status)})]})]},e.id))})}),t.jsx(B,{value:"withdraw",className:"mt-2",children:$.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:$.filter(e=>e.type==="withdraw").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer",onClick:()=>oe(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),t.jsx(H,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:ae(e.status)})]})]},e.id))})}),t.jsx(B,{value:"deleted",className:"mt-2",children:I.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:I.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[e.amount," جنيه"]}),t.jsx(H,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(N,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>it(e.id),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(N,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>lt(e.id),children:t.jsx(_e,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(qt,{open:Qe,onOpenChange:he})]}),t.jsx(Ht,{isOpen:Ze,onClose:()=>pe(!1)}),t.jsx(Yt,{open:Y,onOpenChange:ee,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{ee(!1),He(!0)}}),t.jsx(Zt,{open:st,onOpenChange:se,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"لن يتم حذف الإيصالات؛ سنبدأ القائمة من الآن.",onSuccess:()=>{try{s!=null&&s.uid&&(localStorage.setItem(`recentTransactionsResetAt:${s.uid}`,new Date().toISOString()),v({title:"تم التصفير",description:"تم بدء قائمة المعاملات من الآن."}))}catch{}se(!1)}}),t.jsx(Rt,{open:at,onOpenChange:e=>{var a,r;if(e){const c="alkaptin678678@gmail.com",o=(r=(a=le.currentUser)==null?void 0:a.email)==null?void 0:r.toLowerCase();if(!o||o!==c){v({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}F(!0)}else F(!1)},children:t.jsxs(Mt,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Lt,{children:t.jsx($t,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(ce,{value:W,onChange:e=>xe(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(zt,{value:L,onValueChange:ge,children:[t.jsx(Bt,{className:"w-full",children:t.jsx(Ft,{placeholder:"اختر الشركة"})}),t.jsxs(Wt,{children:[t.jsx(q,{value:"vodafone_eg",children:"فودافون"}),t.jsx(q,{value:"orange_eg",children:"أورنج"}),t.jsx(q,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(q,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(ce,{type:"number",min:1,value:U,onChange:e=>fe(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(N,{variant:"outline",onClick:()=>F(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{variant:"secondary",onClick:()=>p("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(N,{onClick:mt,disabled:ve||!W||!L||!U,children:ve?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Qt,{isOpen:Ye,onClose:()=>te(!1),transaction:et,onPrint:()=>window.print(),onDelete:dt,onComplete:ct})]})};export{Fs as default};
