const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BfErj1u3.js","assets/index-hBtk-z8N.css"])))=>i.map(i=>d[i]);
var ks=Object.defineProperty;var Ss=(t,s,r)=>s in t?ks(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var Rt=(t,s,r)=>Ss(t,typeof s!="symbol"?s+"":s,r);import{c as ae,r as f,j as e,A as As,d as Ds,M as ce,S,f as Y,g as O,q as J,a5 as X,h as de,a1 as Ee,C as me,aF as Le,aG as Us,a2 as Ms,aH as Is,aI as Os,aJ as Ct,aK as Ls,aL as Ps,aM as Fs,aN as Re,aO as Bs,aP as $s,aQ as Vs,aR as Ht,aS as Hs,aT as qs,aU as zs,U as re,a6 as We,n as Z,x as Se,a0 as le,aV as oe,o as kt,p as Pe,_ as Ae,Z as Ys,ak as Gs,t as Ws,aW as Ks,k as Qs,m as Xs,y as Zs,aq as Js,a as er,u as tr,e as sr}from"./index-BfErj1u3.js";import{P as rr}from"./ProfileIcon-Cq2LHFjY.js";import{C as Me,a as Ke,b as Qe,d as Ie,c as nr}from"./card-B7aCG465.js";import{B as ee}from"./button-C33n6e-t.js";import{I as ar}from"./input-Ce4x6xN4.js";import{L as St}from"./label-BdsBkF35.js";import{a as ir,S as qt}from"./switch-BeBmzq7m.js";import{A as lr,a as or}from"./alert-BJemjAyb.js";import{B as Fe}from"./badge-l38fuztt.js";import{a as cr,S as Xe,P as dr}from"./separator-BXQmO0i_.js";import{u as ur,c as mr,v as hr}from"./whatsappService-tP8akUhi.js";import{R as Ze}from"./refresh-cw-BjfiKfrX.js";import{C as xr}from"./circle-alert-BElBGiVJ.js";import{P as zt}from"./phone-CBOMTHym.js";import{E as gr,a as fr}from"./eye-7BzltgjP.js";import{C as pr}from"./copy-Bc_GDXNQ.js";import{E as br,p as yr}from"./broadcastService-aqEk1Ak0.js";import{B as ye,A as At}from"./bell-CBo8lYYY.js";import{U as Be}from"./user-CiJEiUYg.js";import{C as ne}from"./calendar-0sdSk4Dv.js";import{S as Nr,a as jr,b as wr,c as vr,d as ve}from"./select-BucUHdWd.js";import{M as _r}from"./mail-0nMuT3nY.js";import{L as Dt}from"./lock-9fFsInuP.js";import{Z as tt}from"./zap-DDUZRP8Q.js";import{G as be}from"./gift-B1k3v1B7.js";import{C as Oe}from"./crown-C1XiCXUd.js";import{L as Ut}from"./dropdown-menu-BEQm7UNl.js";import{U as st}from"./users-C7EmYfUM.js";import{C as rt}from"./circle-check-big-RoHYtYtD.js";import{S as Tr}from"./shield-j2uNseeW.js";import{g as Mt,l as Er,s as Rr}from"./contentService-BUU4hMbX.js";import"./dialog-D22NOFhT.js";import"./Combination-Dbz2um4F.js";import"./MasterPinDialog-C4_ZCygR.js";import"./avatars-VhiHliEZ.js";import"./key-round-Dg6fNxHt.js";import"./index-DSb8rXO1.js";import"./index-DbGHPz4c.js";import"./index-D8jjNfvn.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=ae("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=ae("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=ae("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=ae("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=ae("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=ae("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=ae("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=ae("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=ae("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Yt=f.forwardRef(({className:t,...s},r)=>e.jsx("textarea",{className:As("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...s}));Yt.displayName="Textarea";const Or=()=>{const{settings:t,loading:s,error:r,updateSettings:n,refreshSettings:i}=ur(),{toast:o}=Ds(),[l,u]=f.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[d,p]=f.useState(!1),[h,w]=f.useState(!1),[N,x]=f.useState(""),[b,m]=f.useState({});f.useEffect(()=>{t&&u({phoneNumber:t.phoneNumber,defaultMessage:t.defaultMessage,isEnabled:t.isEnabled})},[t]);const k=()=>{var M,g;const C={};return(M=l.phoneNumber)!=null&&M.trim()?hr(l.phoneNumber)||(C.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):C.phoneNumber="رقم الواتساب مطلوب",(g=l.defaultMessage)!=null&&g.trim()?l.defaultMessage.length<10&&(C.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):C.defaultMessage="الرسالة الافتراضية مطلوبة",m(C),Object.keys(C).length===0},U=async()=>{if(!k()){o({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}p(!0);try{if(await n(l))o({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{o({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{p(!1)}},v=()=>{if(l.phoneNumber&&l.defaultMessage)try{const C=mr(l.phoneNumber,l.defaultMessage);x(C),w(!0)}catch{o({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},D=async()=>{try{await navigator.clipboard.writeText(N),o({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{o({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},I=C=>{const M=C.replace(/[^\d+]/g,"");u(g=>({...g,phoneNumber:M})),b.phoneNumber&&m(g=>({...g,phoneNumber:""}))};return s?e.jsxs(Me,{children:[e.jsx(Ke,{children:e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Ie,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ze,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Me,{children:[e.jsxs(Ke,{children:[e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(nr,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Ie,{className:"space-y-6",children:[r&&e.jsxs(lr,{variant:"destructive",children:[e.jsx(xr,{className:"h-4 w-4"}),e.jsx(or,{children:r})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${l.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(ir,{checked:l.isEnabled,onCheckedChange:C=>u(M=>({...M,isEnabled:C}))})]}),e.jsx(cr,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(St,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(zt,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(ar,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:l.phoneNumber,onChange:C=>I(C.target.value),className:b.phoneNumber?"border-red-500":"",dir:"ltr"}),b.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:b.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(St,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(Yt,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:l.defaultMessage,onChange:C=>{u(M=>({...M,defaultMessage:C.target.value})),b.defaultMessage&&m(M=>({...M,defaultMessage:""}))},className:b.defaultMessage?"border-red-500":"",rows:4}),b.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:b.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(ee,{onClick:U,disabled:d,className:"flex items-center gap-2",children:[d?e.jsx(Ze,{className:"h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4"}),d?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(ee,{variant:"outline",onClick:v,disabled:!l.phoneNumber||!l.defaultMessage,className:"flex items-center gap-2",children:[h?e.jsx(gr,{className:"h-4 w-4"}):e.jsx(fr,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(ee,{variant:"outline",onClick:i,className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"تحديث"]})]}),h&&N&&e.jsxs(Me,{className:"bg-muted/50",children:[e.jsx(Ke,{children:e.jsx(Qe,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Ie,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:N}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{variant:"outline",size:"sm",onClick:D,className:"flex items-center gap-2",children:[e.jsx(pr,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>window.open(N,"_blank"),className:"flex items-center gap-2",children:[e.jsx(br,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),t&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(Fe,{variant:"outline",className:"mr-2",children:[t.lastUpdated.toLocaleDateString("ar-EG")," - ",t.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(Fe,{variant:t.isEnabled?"default":"secondary",className:"mr-2",children:t.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},$e={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},Lr=t=>{const s=new Date,n=new Date(t).getTime()-s.getTime();return Math.ceil(n/(1e3*60*60*24))},Pr=(t,s=$e)=>t<0?"expired":t<=s.criticalDays?"critical":t<=s.warningDays?"warning":(t<=s.infoDays,"info"),Fr=(t,s,r)=>{const n=Br(r);return s<0?`انتهت صلاحية اشتراك ${n} للمستخدم ${t}`:s===0?`ينتهي اشتراك ${n} للمستخدم ${t} اليوم!`:s===1?`ينتهي اشتراك ${n} للمستخدم ${t} غداً`:`ينتهي اشتراك ${n} للمستخدم ${t} خلال ${s} أيام`},Br=t=>{switch(t){case S.MONTHLY:return"الشهري";case S.YEARLY:return"السنوي";case S.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},$r=async()=>{try{const t=Y(O,"users"),s=J(t,X("subscription","!=",null)),r=await de(s),n=[];return r.forEach(i=>{var l,u,d,p;const o=i.data();o.subscription&&(o.subscription.planType||o.subscription.plan)&&n.push({id:i.id,...o,subscription:{...o.subscription,startDate:((u=(l=o.subscription.startDate)==null?void 0:l.toDate)==null?void 0:u.call(l))||new Date(o.subscription.startDate),endDate:((p=(d=o.subscription.endDate)==null?void 0:d.toDate)==null?void 0:p.call(d))||new Date(o.subscription.endDate),planType:o.subscription.planType||o.subscription.plan}})}),n}catch(t){return console.error("خطأ في جلب الاشتراكات النشطة:",t),[]}},Vr=async(t=$e)=>{try{const s=await $r(),r=[];return s.forEach(n=>{if(!n.subscription||!n.subscription.endDate)return;const i=Lr(n.subscription.endDate),o=Pr(i,t);if(i<=t.infoDays||i<0){const l={id:`${n.id}_${Date.now()}`,userId:n.id,userName:n.displayName||n.email||"مستخدم غير معروف",userEmail:n.email||"",subscriptionPlan:n.subscription.planType,expiryDate:n.subscription.endDate,daysRemaining:i,type:o,message:Fr(n.displayName||n.email||"مستخدم غير معروف",i,n.subscription.planType),isRead:!1,createdAt:new Date};r.push(l)}}),r.sort((n,i)=>{const o={expired:0,critical:1,warning:2,info:3};return o[n.type]!==o[i.type]?o[n.type]-o[i.type]:n.daysRemaining-i.daysRemaining}),r}catch(s){return console.error("خطأ في إنشاء إشعارات الاشتراك:",s),[]}},Hr=(t,s)=>s?t.filter(r=>r.type===s):t,qr=t=>{localStorage.setItem("notificationSettings",JSON.stringify(t))},zr=()=>{try{const t=localStorage.getItem("notificationSettings");if(t)return{...$e,...JSON.parse(t)}}catch(t){console.error("خطأ في تحميل إعدادات الإشعارات:",t)}return $e},Yr=({isOpen:t,onClose:s})=>{const[r,n]=f.useState([]),[i,o]=f.useState([]),[l,u]=f.useState("all"),[d,p]=f.useState(!0),[h,w]=f.useState(zr());f.useEffect(()=>{t&&N()},[t]),f.useEffect(()=>{o(l==="all"?r:Hr(r,l))},[r,l]);const N=async()=>{p(!0);try{const v=await Vr(h);n(v)}catch(v){console.error("خطأ في تحميل الإشعارات:",v)}finally{p(!1)}},x=v=>{switch(v){case"urgent":return e.jsx(Le,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(me,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(ye,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(ye,{className:"w-5 h-5 text-gray-500"})}},b=v=>{switch(v){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},m=v=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(v),k=v=>{switch(v){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},U=v=>{const D={...h,[v]:!h[v]};w(D),qr(D)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),r.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:r.length})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(Ee,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kr,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(v=>e.jsx("button",{onClick:()=>u(v),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${l===v?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:k(v)},v))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.visualAlerts,onChange:()=>U("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.soundAlerts,onChange:()=>U("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.autoRefresh,onChange:()=>U("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:d?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):i.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(ye,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:l==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${k(l)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:i.map(v=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${b(v.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[x(v.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:v.message}),e.jsx("span",{className:"text-xs text-gray-500",children:m(v.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",v.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",m(v.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",v.daysRemaining]})]})]})]})]})},v.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",m(new Date)]}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},Gr=({notification:t,onClose:s,soundEnabled:r,onToggleSound:n})=>{const[i,o]=f.useState(!1),[l,u]=f.useState(null);f.useEffect(()=>{if(t&&(o(!0),r&&d(t.type),t.type!=="urgent")){const x=setTimeout(()=>{p()},1e4);return()=>clearTimeout(x)}},[t,r]),f.useEffect(()=>{typeof window<"u"&&window.AudioContext&&u(new AudioContext)},[]);const d=x=>{if(!(!l||!r))try{const b=l.createOscillator(),m=l.createGain();switch(b.connect(m),m.connect(l.destination),x){case"urgent":b.frequency.setValueAtTime(800,l.currentTime),b.frequency.setValueAtTime(1e3,l.currentTime+.1),b.frequency.setValueAtTime(800,l.currentTime+.2),m.gain.setValueAtTime(.3,l.currentTime),m.gain.exponentialRampToValueAtTime(.01,l.currentTime+.5),b.start(l.currentTime),b.stop(l.currentTime+.5);break;case"warning":b.frequency.setValueAtTime(600,l.currentTime),b.frequency.setValueAtTime(700,l.currentTime+.15),m.gain.setValueAtTime(.2,l.currentTime),m.gain.exponentialRampToValueAtTime(.01,l.currentTime+.3),b.start(l.currentTime),b.stop(l.currentTime+.3);break;case"info":b.frequency.setValueAtTime(400,l.currentTime),m.gain.setValueAtTime(.1,l.currentTime),m.gain.exponentialRampToValueAtTime(.01,l.currentTime+.2),b.start(l.currentTime),b.stop(l.currentTime+.2);break}}catch(b){console.error("خطأ في تشغيل الصوت:",b)}},p=()=>{o(!1),setTimeout(()=>{s()},300)},h=x=>{switch(x){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Le,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(me,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(ye,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(ye,{className:"w-6 h-6"}),pulse:""}}},w=x=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(x);if(!t)return null;const N=h(t.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${i?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${N.bg} ${N.border} ${N.text} ${N.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[t.type==="urgent"&&"تنبيه عاجل!",t.type==="warning"&&"تحذير",t.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:n,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:r?"إيقاف الصوت":"تشغيل الصوت",children:r?e.jsx(Mr,{className:"w-4 h-4"}):e.jsx(Ir,{className:"w-4 h-4"})}),e.jsx("button",{onClick:p,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:t.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",t.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",w(t.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",t.daysRemaining," يوم"]})]})]}),t.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Wr=({user:t,onActivateSubscription:s,onDeactivateSubscription:r,onDeleteUser:n})=>{const[i,o]=f.useState(S.MONTHLY),[l,u]=f.useState(!1),d=Us(),p=x=>{const b=x==null?void 0:x.displayName;if(typeof b=="string"&&b.trim())return b.trim();if(b&&typeof b=="object"){const m=b.full_name||b.name||b.ar||b.en;if(typeof m=="string"&&m.trim())return m.trim()}return typeof(x==null?void 0:x.email)=="string"&&x.email.includes("@")?x.email.split("@")[0]:"غير محدد"},h=x=>{switch(x){case S.LIFETIME:return e.jsx(Oe,{className:"w-4 h-4 text-yellow-500"});case S.YEARLY:return e.jsx(be,{className:"w-4 h-4 text-blue-500"});case S.QUARTERLY:return e.jsx(ne,{className:"w-4 h-4 text-purple-500"});case S.MONTHLY:return e.jsx(tt,{className:"w-4 h-4 text-green-500"});case S.ZERO:return e.jsx(Dt,{className:"w-4 h-4 text-gray-500"});default:return null}},w=x=>{switch(x){case S.MONTHLY:return"شهرية";case S.QUARTERLY:return"ربع سنوية";case S.YEARLY:return"سنوية";case S.LIFETIME:return"مدى الحياة";case S.ZERO:return"زيرو";default:return"غير محدد"}},N=x=>x?(x.toDate?x.toDate():new Date(x)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(Me,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Ie,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Be,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:p(t)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(_r,{className:"w-3 h-3 ml-1"}),t.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(zt,{className:"w-3 h-3 ml-1"}),t.phone||"غير محدد"]})]})]}),e.jsx(Fe,{variant:t.isActive?"default":"secondary",children:t.isActive?"نشط":"غير نشط"})]}),t.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[h(t.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:w(t.subscription.planType)})]}),e.jsx(Fe,{variant:t.subscription.isActive?"default":"destructive",children:t.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ne,{className:"w-3 h-3 ml-1"}),"البداية: ",N(t.subscription.startDate)]}),t.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"w-3 h-3 ml-1"}),"النهاية: ",N(t.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[s&&l&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),d?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:i,onChange:x=>o(x.target.value),children:[e.jsx("option",{value:S.MONTHLY,children:"شهرية"}),e.jsx("option",{value:S.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:S.YEARLY,children:"سنوية"}),e.jsx("option",{value:S.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:S.ZERO,children:"زيرو"})]}):e.jsxs(Nr,{value:i,onValueChange:x=>o(x),children:[e.jsx(jr,{className:"w-full",children:e.jsx(wr,{placeholder:"اختر نوع الباقة"})}),e.jsxs(vr,{children:[e.jsx(ve,{value:S.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(ve,{value:S.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(ve,{value:S.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(ve,{value:S.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Sr,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(ve,{value:S.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Dt,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(ee,{size:"sm",onClick:()=>{s(t.id,i),u(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(ee,{size:"sm",variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[s&&!l&&e.jsx(ee,{size:"sm",variant:"outline",onClick:()=>u(!0),className:"flex-1",children:"تفعيل الاشتراك"}),r&&e.jsx(ee,{size:"sm",variant:"outline",onClick:()=>r(t.id),className:"flex-1",children:"إلغاء الاشتراك"}),n&&e.jsx(ee,{size:"sm",variant:"destructive",onClick:()=>n(t.id),children:e.jsx(Ms,{className:"w-4 h-4"})})]})]})]})})};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gt="firebasestorage.googleapis.com",Wt="storageBucket",Kr=2*60*1e3,Qr=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P extends Fs{constructor(s,r,n=0){super(Je(s),`Firebase Storage: ${r} (${Je(s)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,P.prototype)}get status(){return this.status_}set status(s){this.status_=s}_codeEquals(s){return Je(s)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(s){this.customData.serverResponse=s,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var L;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(L||(L={}));function Je(t){return"storage/"+t}function at(){const t="An unknown error occurred, please check the error payload for server response.";return new P(L.UNKNOWN,t)}function Xr(t){return new P(L.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function Zr(t){return new P(L.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Jr(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new P(L.UNAUTHENTICATED,t)}function en(){return new P(L.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function tn(t){return new P(L.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function sn(){return new P(L.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function rn(){return new P(L.CANCELED,"User canceled the upload/download.")}function nn(t){return new P(L.INVALID_URL,"Invalid URL '"+t+"'.")}function an(t){return new P(L.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function ln(){return new P(L.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Wt+"' property when initializing the app?")}function on(){return new P(L.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function cn(){return new P(L.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function dn(t){return new P(L.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function nt(t){return new P(L.INVALID_ARGUMENT,t)}function Kt(){return new P(L.APP_DELETED,"The Firebase app was deleted.")}function un(t){return new P(L.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Te(t,s){return new P(L.INVALID_FORMAT,"String does not match format '"+t+"': "+s)}function _e(t){throw new P(L.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(s,r){this.bucket=s,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const s=encodeURIComponent;return"/b/"+s(this.bucket)+"/o/"+s(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(s,r){let n;try{n=W.makeFromUrl(s,r)}catch{return new W(s,"")}if(n.path==="")return n;throw an(s)}static makeFromUrl(s,r){let n=null;const i="([A-Za-z0-9.\\-_]+)";function o(I){I.path.charAt(I.path.length-1)==="/"&&(I.path_=I.path_.slice(0,-1))}const l="(/(.*))?$",u=new RegExp("^gs://"+i+l,"i"),d={bucket:1,path:3};function p(I){I.path_=decodeURIComponent(I.path)}const h="v[A-Za-z0-9_]+",w=r.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",x=new RegExp(`^https?://${w}/${h}/b/${i}/o${N}`,"i"),b={bucket:1,path:3},m=r===Gt?"(?:storage.googleapis.com|storage.cloud.google.com)":r,k="([^?#]*)",U=new RegExp(`^https?://${m}/${i}/${k}`,"i"),D=[{regex:u,indices:d,postModify:o},{regex:x,indices:b,postModify:p},{regex:U,indices:{bucket:1,path:2},postModify:p}];for(let I=0;I<D.length;I++){const C=D[I],M=C.regex.exec(s);if(M){const g=M[C.indices.bucket];let E=M[C.indices.path];E||(E=""),n=new W(g,E),C.postModify(n);break}}if(n==null)throw nn(s);return n}}class mn{constructor(s){this.promise_=Promise.reject(s)}getPromise(){return this.promise_}cancel(s=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(t,s,r){let n=1,i=null,o=null,l=!1,u=0;function d(){return u===2}let p=!1;function h(...k){p||(p=!0,s.apply(null,k))}function w(k){i=setTimeout(()=>{i=null,t(x,d())},k)}function N(){o&&clearTimeout(o)}function x(k,...U){if(p){N();return}if(k){N(),h.call(null,k,...U);return}if(d()||l){N(),h.call(null,k,...U);return}n<64&&(n*=2);let D;u===1?(u=2,D=0):D=(n+Math.random())*1e3,w(D)}let b=!1;function m(k){b||(b=!0,N(),!p&&(i!==null?(k||(u=2),clearTimeout(i),w(0)):k||(u=1)))}return w(0),o=setTimeout(()=>{l=!0,m(!0)},r),m}function xn(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gn(t){return t!==void 0}function fn(t){return typeof t=="object"&&!Array.isArray(t)}function it(t){return typeof t=="string"||t instanceof String}function Ot(t){return lt()&&t instanceof Blob}function lt(){return typeof Blob<"u"}function Lt(t,s,r,n){if(n<s)throw nt(`Invalid value for '${t}'. Expected ${s} or greater.`);if(n>r)throw nt(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(t,s,r){let n=s;return r==null&&(n=`https://${s}`),`${r}://${n}/v0${t}`}function Qt(t){const s=encodeURIComponent;let r="?";for(const n in t)if(t.hasOwnProperty(n)){const i=s(n)+"="+s(t[n]);r=r+i+"&"}return r=r.slice(0,-1),r}var ue;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ue||(ue={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(t,s){const r=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,o=s.indexOf(t)!==-1;return r||i||o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(s,r,n,i,o,l,u,d,p,h,w,N=!0,x=!1){this.url_=s,this.method_=r,this.headers_=n,this.body_=i,this.successCodes_=o,this.additionalRetryCodes_=l,this.callback_=u,this.errorCallback_=d,this.timeout_=p,this.progressCallback_=h,this.connectionFactory_=w,this.retry=N,this.isUsingEmulator=x,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((b,m)=>{this.resolve_=b,this.reject_=m,this.start_()})}start_(){const s=(n,i)=>{if(i){n(!1,new De(!1,null,!0));return}const o=this.connectionFactory_();this.pendingConnection_=o;const l=u=>{const d=u.loaded,p=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,p)};this.progressCallback_!==null&&o.addUploadProgressListener(l),o.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(l),this.pendingConnection_=null;const u=o.getErrorCode()===ue.NO_ERROR,d=o.getStatus();if(!u||pn(d,this.additionalRetryCodes_)&&this.retry){const h=o.getErrorCode()===ue.ABORT;n(!1,new De(!1,null,h));return}const p=this.successCodes_.indexOf(d)!==-1;n(!0,new De(p,o))})},r=(n,i)=>{const o=this.resolve_,l=this.reject_,u=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(u,u.getResponse());gn(d)?o(d):o()}catch(d){l(d)}else if(u!==null){const d=at();d.serverResponse=u.getErrorText(),this.errorCallback_?l(this.errorCallback_(u,d)):l(d)}else if(i.canceled){const d=this.appDelete_?Kt():rn();l(d)}else{const d=sn();l(d)}};this.canceled_?r(!1,new De(!1,null,!0)):this.backoffId_=hn(s,r,this.timeout_)}getPromise(){return this.promise_}cancel(s){this.canceled_=!0,this.appDelete_=s||!1,this.backoffId_!==null&&xn(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class De{constructor(s,r,n){this.wasSuccessCode=s,this.connection=r,this.canceled=!!n}}function yn(t,s){s!==null&&s.length>0&&(t.Authorization="Firebase "+s)}function Nn(t,s){t["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager")}function jn(t,s){s&&(t["X-Firebase-GMPID"]=s)}function wn(t,s){s!==null&&(t["X-Firebase-AppCheck"]=s)}function vn(t,s,r,n,i,o,l=!0,u=!1){const d=Qt(t.urlParams),p=t.url+d,h=Object.assign({},t.headers);return jn(h,s),yn(h,r),Nn(h,o),wn(h,n),new bn(p,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,l,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _n(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Tn(...t){const s=_n();if(s!==void 0){const r=new s;for(let n=0;n<t.length;n++)r.append(t[n]);return r.getBlob()}else{if(lt())return new Blob(t);throw new P(L.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function En(t,s,r){return t.webkitSlice?t.webkitSlice(s,r):t.mozSlice?t.mozSlice(s,r):t.slice?t.slice(s,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rn(t){if(typeof atob>"u")throw dn("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const te={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class et{constructor(s,r){this.data=s,this.contentType=r||null}}function Cn(t,s){switch(t){case te.RAW:return new et(Xt(s));case te.BASE64:case te.BASE64URL:return new et(Zt(t,s));case te.DATA_URL:return new et(Sn(s),An(s))}throw at()}function Xt(t){const s=[];for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);if(n<=127)s.push(n);else if(n<=2047)s.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))s.push(239,191,189);else{const o=n,l=t.charCodeAt(++r);n=65536|(o&1023)<<10|l&1023,s.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?s.push(239,191,189):s.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(s)}function kn(t){let s;try{s=decodeURIComponent(t)}catch{throw Te(te.DATA_URL,"Malformed data URL.")}return Xt(s)}function Zt(t,s){switch(t){case te.BASE64:{const i=s.indexOf("-")!==-1,o=s.indexOf("_")!==-1;if(i||o)throw Te(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case te.BASE64URL:{const i=s.indexOf("+")!==-1,o=s.indexOf("/")!==-1;if(i||o)throw Te(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");s=s.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=Rn(s)}catch(i){throw i.message.includes("polyfill")?i:Te(t,"Invalid character found")}const n=new Uint8Array(r.length);for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);return n}class Jt{constructor(s){this.base64=!1,this.contentType=null;const r=s.match(/^data:([^,]+)?,/);if(r===null)throw Te(te.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=r[1]||null;n!=null&&(this.base64=Dn(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=s.substring(s.indexOf(",")+1)}}function Sn(t){const s=new Jt(t);return s.base64?Zt(te.BASE64,s.rest):kn(s.rest)}function An(t){return new Jt(t).contentType}function Dn(t,s){return t.length>=s.length?t.substring(t.length-s.length)===s:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(s,r){let n=0,i="";Ot(s)?(this.data_=s,n=s.size,i=s.type):s instanceof ArrayBuffer?(r?this.data_=new Uint8Array(s):(this.data_=new Uint8Array(s.byteLength),this.data_.set(new Uint8Array(s))),n=this.data_.length):s instanceof Uint8Array&&(r?this.data_=s:(this.data_=new Uint8Array(s.length),this.data_.set(s)),n=s.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(s,r){if(Ot(this.data_)){const n=this.data_,i=En(n,s,r);return i===null?null:new ie(i)}else{const n=new Uint8Array(this.data_.buffer,s,r-s);return new ie(n,!0)}}static getBlob(...s){if(lt()){const r=s.map(n=>n instanceof ie?n.data_:n);return new ie(Tn.apply(null,r))}else{const r=s.map(l=>it(l)?Cn(te.RAW,l).data:l.data_);let n=0;r.forEach(l=>{n+=l.byteLength});const i=new Uint8Array(n);let o=0;return r.forEach(l=>{for(let u=0;u<l.length;u++)i[o++]=l[u]}),new ie(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(t){let s;try{s=JSON.parse(t)}catch{return null}return fn(s)?s:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(t){if(t.length===0)return null;const s=t.lastIndexOf("/");return s===-1?"":t.slice(0,s)}function Mn(t,s){const r=s.split("/").filter(n=>n.length>0).join("/");return t.length===0?r:t+"/"+r}function ts(t){const s=t.lastIndexOf("/",t.length-2);return s===-1?t:t.slice(s+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function In(t,s){return s}class z{constructor(s,r,n,i){this.server=s,this.local=r||s,this.writable=!!n,this.xform=i||In}}let Ue=null;function On(t){return!it(t)||t.length<2?t:ts(t)}function ss(){if(Ue)return Ue;const t=[];t.push(new z("bucket")),t.push(new z("generation")),t.push(new z("metageneration")),t.push(new z("name","fullPath",!0));function s(o,l){return On(l)}const r=new z("name");r.xform=s,t.push(r);function n(o,l){return l!==void 0?Number(l):l}const i=new z("size");return i.xform=n,t.push(i),t.push(new z("timeCreated")),t.push(new z("updated")),t.push(new z("md5Hash",null,!0)),t.push(new z("cacheControl",null,!0)),t.push(new z("contentDisposition",null,!0)),t.push(new z("contentEncoding",null,!0)),t.push(new z("contentLanguage",null,!0)),t.push(new z("contentType",null,!0)),t.push(new z("metadata","customMetadata",!0)),Ue=t,Ue}function Ln(t,s){function r(){const n=t.bucket,i=t.fullPath,o=new W(n,i);return s._makeStorageReference(o)}Object.defineProperty(t,"ref",{get:r})}function Pn(t,s,r){const n={};n.type="file";const i=r.length;for(let o=0;o<i;o++){const l=r[o];n[l.local]=l.xform(n,s[l.server])}return Ln(n,t),n}function rs(t,s,r){const n=es(s);return n===null?null:Pn(t,n,r)}function Fn(t,s,r,n){const i=es(s);if(i===null||!it(i.downloadTokens))return null;const o=i.downloadTokens;if(o.length===0)return null;const l=encodeURIComponent;return o.split(",").map(p=>{const h=t.bucket,w=t.fullPath,N="/b/"+l(h)+"/o/"+l(w),x=Ve(N,r,n),b=Qt({alt:"media",token:p});return x+b})[0]}function Bn(t,s){const r={},n=s.length;for(let i=0;i<n;i++){const o=s[i];o.writable&&(r[o.server]=t[o.local])}return JSON.stringify(r)}class ot{constructor(s,r,n,i){this.url=s,this.method=r,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(t){if(!t)throw at()}function $n(t,s){function r(n,i){const o=rs(t,i,s);return ns(o!==null),o}return r}function Vn(t,s){function r(n,i){const o=rs(t,i,s);return ns(o!==null),Fn(o,i,t.host,t._protocol)}return r}function as(t){function s(r,n){let i;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?i=en():i=Jr():r.getStatus()===402?i=Zr(t.bucket):r.getStatus()===403?i=tn(t.path):i=n,i.status=r.getStatus(),i.serverResponse=n.serverResponse,i}return s}function is(t){const s=as(t);function r(n,i){let o=s(n,i);return n.getStatus()===404&&(o=Xr(t.path)),o.serverResponse=i.serverResponse,o}return r}function Hn(t,s,r){const n=s.fullServerUrl(),i=Ve(n,t.host,t._protocol),o="GET",l=t.maxOperationRetryTime,u=new ot(i,o,Vn(t,r),l);return u.errorHandler=is(s),u}function qn(t,s){const r=s.fullServerUrl(),n=Ve(r,t.host,t._protocol),i="DELETE",o=t.maxOperationRetryTime;function l(d,p){}const u=new ot(n,i,l,o);return u.successCodes=[200,204],u.errorHandler=is(s),u}function zn(t,s){return t&&t.contentType||s&&s.type()||"application/octet-stream"}function Yn(t,s,r){const n=Object.assign({},r);return n.fullPath=t.path,n.size=s.size(),n.contentType||(n.contentType=zn(null,s)),n}function Gn(t,s,r,n,i){const o=s.bucketOnlyServerUrl(),l={"X-Goog-Upload-Protocol":"multipart"};function u(){let D="";for(let I=0;I<2;I++)D=D+Math.random().toString().slice(2);return D}const d=u();l["Content-Type"]="multipart/related; boundary="+d;const p=Yn(s,n,i),h=Bn(p,r),w="--"+d+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+d+`\r
Content-Type: `+p.contentType+`\r
\r
`,N=`\r
--`+d+"--",x=ie.getBlob(w,n,N);if(x===null)throw on();const b={name:p.fullPath},m=Ve(o,t.host,t._protocol),k="POST",U=t.maxUploadRetryTime,v=new ot(m,k,$n(t,r),U);return v.urlParams=b,v.headers=l,v.body=x.uploadData(),v.errorHandler=as(s),v}class Wn{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ue.NO_ERROR,this.sendPromise_=new Promise(s=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ue.ABORT,s()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ue.NETWORK_ERROR,s()}),this.xhr_.addEventListener("load",()=>{s()})})}send(s,r,n,i,o){if(this.sent_)throw _e("cannot .send() more than once");if(Ht(s)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(r,s,!0),o!==void 0)for(const l in o)o.hasOwnProperty(l)&&this.xhr_.setRequestHeader(l,o[l].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw _e("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw _e("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw _e("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw _e("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(s){return this.xhr_.getResponseHeader(s)}addUploadProgressListener(s){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",s)}removeUploadProgressListener(s){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",s)}}class Kn extends Wn{initXhr(){this.xhr_.responseType="text"}}function ct(){return new Kn}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(s,r){this._service=s,r instanceof W?this._location=r:this._location=W.makeFromUrl(r,s.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(s,r){return new he(s,r)}get root(){const s=new W(this._location.bucket,"");return this._newRef(this._service,s)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ts(this._location.path)}get storage(){return this._service}get parent(){const s=Un(this._location.path);if(s===null)return null;const r=new W(this._location.bucket,s);return new he(this._service,r)}_throwIfRoot(s){if(this._location.path==="")throw un(s)}}function Qn(t,s,r){t._throwIfRoot("uploadBytes");const n=Gn(t.storage,t._location,ss(),new ie(s,!0),r);return t.storage.makeRequestWithTokens(n,ct).then(i=>({metadata:i,ref:t}))}function Xn(t){t._throwIfRoot("getDownloadURL");const s=Hn(t.storage,t._location,ss());return t.storage.makeRequestWithTokens(s,ct).then(r=>{if(r===null)throw cn();return r})}function Zn(t){t._throwIfRoot("deleteObject");const s=qn(t.storage,t._location);return t.storage.makeRequestWithTokens(s,ct)}function Jn(t,s){const r=Mn(t._location.path,s),n=new W(t._location.bucket,r);return new he(t.storage,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ea(t){return/^[A-Za-z]+:\/\//.test(t)}function ta(t,s){return new he(t,s)}function ls(t,s){if(t instanceof dt){const r=t;if(r._bucket==null)throw ln();const n=new he(r,r._bucket);return s!=null?ls(n,s):n}else return s!==void 0?Jn(t,s):t}function sa(t,s){if(s&&ea(s)){if(t instanceof dt)return ta(t,s);throw nt("To use ref(service, url), the first argument must be a Storage instance.")}else return ls(t,s)}function Pt(t,s){const r=s==null?void 0:s[Wt];return r==null?null:W.makeFromBucketSpec(r,t)}function ra(t,s,r,n={}){t.host=`${s}:${r}`;const i=Ht(s);i&&(Hs(`https://${t.host}/b`),qs("Storage",!0)),t._isUsingEmulator=!0,t._protocol=i?"https":"http";const{mockUserToken:o}=n;o&&(t._overrideAuthToken=typeof o=="string"?o:zs(o,t.app.options.projectId))}class dt{constructor(s,r,n,i,o,l=!1){this.app=s,this._authProvider=r,this._appCheckProvider=n,this._url=i,this._firebaseVersion=o,this._isUsingEmulator=l,this._bucket=null,this._host=Gt,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Kr,this._maxUploadRetryTime=Qr,this._requests=new Set,i!=null?this._bucket=W.makeFromBucketSpec(i,this._host):this._bucket=Pt(this._host,this.app.options)}get host(){return this._host}set host(s){this._host=s,this._url!=null?this._bucket=W.makeFromBucketSpec(this._url,s):this._bucket=Pt(s,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(s){Lt("time",0,Number.POSITIVE_INFINITY,s),this._maxUploadRetryTime=s}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(s){Lt("time",0,Number.POSITIVE_INFINITY,s),this._maxOperationRetryTime=s}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const s=this._authProvider.getImmediate({optional:!0});if(s){const r=await s.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){if(Ps(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=this._appCheckProvider.getImmediate({optional:!0});return s?(await s.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(s=>s.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(s){return new he(this,s)}_makeRequest(s,r,n,i,o=!0){if(this._deleted)return new mn(Kt());{const l=vn(s,this._appId,n,i,r,this._firebaseVersion,o,this._isUsingEmulator);return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}}async makeRequestWithTokens(s,r){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(s,r,n,i).getPromise()}}const Ft="@firebase/storage",Bt="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const os="storage";function na(t,s,r){return t=Re(t),Qn(t,s,r)}function aa(t){return t=Re(t),Xn(t)}function ia(t){return t=Re(t),Zn(t)}function $t(t,s){return t=Re(t),sa(t,s)}function Vt(t=Vs(),s){t=Re(t);const n=Bs(t,os).getImmediate({identifier:s}),i=$s("storage");return i&&la(n,...i),n}function la(t,s,r,n={}){ra(t,s,r,n)}function oa(t,{instanceIdentifier:s}){const r=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new dt(r,n,i,s,Ls)}function ca(){Is(new Os(os,oa,"PUBLIC").setMultipleInstances(!0)),Ct(Ft,Bt,""),Ct(Ft,Bt,"esm2020")}ca();class da{constructor(){Rt(this,"hooks",[])}registerHooks(s){console.log("📝 Registering hooks:",Object.keys(s)),this.hooks.push(s)}async sendImageMessage(s,r,n,i,o){try{console.log("📤 Uploading image message:",{chatId:s,fileName:r.name,fileSize:r.size,senderType:n,senderId:i});const l=Vt(),u=Date.now(),d=`chat-images/${s}/${u}_${r.name}`,p=$t(l,d),h=await na(p,r);console.log("✅ Image uploaded successfully:",h.metadata.fullPath);const w=await aa(p);console.log("✅ Image URL obtained:",w);const N={chatId:s,message:o||"صورة",content:o||"صورة",senderType:n,senderId:i,timestamp:re(),isRead:!1,type:"image",imageUrl:w,imageFileName:r.name},x=await We(Y(O,"chatMessages"),N);console.log("✅ Image message added to chatMessages:",x.id);const b=Z(O,"chatRooms",s);if(n==="client"){const m=await Se(b);if(m.exists()){const k=m.data().unreadCount||0;await le(b,{lastMessage:o||"صورة",lastMessageTime:re(),unreadCount:k+1})}}else await le(b,{lastMessage:o||"صورة",lastMessageTime:re()});console.log("✅ Image message sent successfully")}catch(l){throw console.error("🔥 Error sending image message:",l),l}}async deleteChat(s){try{console.log("🗑️ Deleting chat:",s);const r=J(Y(O,"chatMessages"),X("chatId","==",s)),n=await de(r),i=[];for(const l of n.docs){const u=l.data();if(u.type==="image"&&u.imageUrl)try{const d=Vt(),p=$t(d,u.imageUrl);i.push(ia(p))}catch(d){console.warn("⚠️ Could not delete image from storage:",d)}i.push(oe(l.ref))}const o=Z(O,"chatRooms",s);i.push(oe(o)),await Promise.all(i),console.log("✅ Chat deleted successfully:",{chatId:s,messagesDeleted:n.size})}catch(r){throw console.error("🔥 Error deleting chat:",r),r}}unregisterHooks(s){console.log("🗑️ Unregistering hooks"),s?this.hooks=this.hooks.filter(r=>r!==s):this.hooks=[]}async createChatRoom(s,r=!1){try{const n=r?"clientEmail":"clientPhone",i=J(Y(O,"chatRooms"),X(n,"==",s),X("status","==","active")),o=await de(i);if(!o.empty)return o.docs[0].id;const l={clientId:`client_${s}`,clientPhone:r?"":s,clientEmail:r?s:void 0,customerName:r?`عميل ${s}`:`عميل ${s}`,status:"active",unreadCount:0,createdAt:re(),lastMessageTime:re()};return(await We(Y(O,"chatRooms"),l)).id}catch(n){throw console.error("Error creating chat room:",n),n}}async sendMessage(s,r,n,i){try{for(let l=1;l<=3;l++)try{console.log(`📤 Sending message (attempt ${l}):`,{chatId:s,message:r.substring(0,50)+"...",senderType:n,senderId:i});const u={chatId:s,message:r,content:r,senderType:n,senderId:i,timestamp:re(),isRead:!1},d=await We(Y(O,"chatMessages"),u);console.log("✅ Message added to chatMessages:",d.id);const p=Z(O,"chatRooms",s);if(n==="client"){const h=await Se(p),w=h.exists()&&h.data().unreadCount||0;await le(p,{lastMessage:r,lastMessageTime:re(),unreadCount:w+1}),this.hooks.length>0&&this.hooks.forEach(N=>{if(N.onUnreadCountChange&&typeof N.onUnreadCountChange=="function")try{N.onUnreadCountChange(s,w+1)}catch(x){console.error("Error calling onUnreadCountChange hook:",x)}})}else await le(p,{lastMessage:r,lastMessageTime:re()});if(this.hooks.length>0)try{const h=await Se(p);if(h.exists()){const w={id:h.id,...h.data()},N={id:d.id,...u,timestamp:new Date};this.hooks.forEach(x=>{if(x.onNewMessage&&typeof x.onNewMessage=="function")try{x.onNewMessage(N,w)}catch(b){console.error("Error calling onNewMessage hook:",b)}})}}catch(h){console.error("Error calling onNewMessage hooks:",h)}console.log("✅ Message sent successfully");return}catch(u){if(console.error(`❌ Attempt ${l} failed:`,u),l===3)throw u;await new Promise(d=>setTimeout(d,1e3*l))}throw new Error("Max retry attempts reached")}catch(l){throw console.error("🔥 Error sending message:",l),l}}subscribeToMessages(s,r){let n=0;const i=5;let o=null,l=null,u=0;const d=()=>{try{console.log("🔔 Starting subscription to messages for room:",s,`(attempt ${n+1})`);const p=J(Y(O,"chatMessages"),X("chatId","==",s),kt("timestamp","asc"));l=Pe(p,h=>{console.log("📨 Received messages snapshot:",h.docs.length,"messages"),n=0;const w=h.docs.map(N=>{const x=N.data();return{id:N.id,...x,message:x.message||x.content||"",content:x.content||x.message||""}});if(w.length>u&&u>0){const N=w.slice(u);console.log("🆕 New messages detected:",N.length),N.forEach(x=>{this.hooks.forEach(b=>{if(b.onNewMessage&&typeof b.onNewMessage=="function")try{Se(Z(O,"chatRooms",s)).then(m=>{if(m.exists()){const k={id:m.id,...m.data()},U=b.onNewMessage;U&&U(x,k)}}).catch(m=>{console.error("Error fetching chat room for hook:",m)})}catch(m){console.error("Error calling onNewMessage hook:",m)}})})}u=w.length,console.log("📨 Processed messages:",w),r(w)},h=>{var w,N,x,b;if(console.error("❌ Error in messages subscription:",h),h.name==="AbortError"||(w=h.message)!=null&&w.includes("AbortError")){console.log("🔄 Request was aborted, will retry..."),n<i&&(n++,o=setTimeout(()=>{d()},1e3));return}(N=h.message)!=null&&N.includes("index is currently building")||(x=h.message)!=null&&x.includes("cannot be used yet")||h.code==="failed-precondition"?(console.log("🔨 Index is still building, will retry in 10 seconds..."),n<i?(n++,o=setTimeout(()=>{console.log("🔄 Retrying subscription after index building delay..."),d()},1e4)):(console.log("⚠️ Max retries reached for index building. Please wait for index to complete."),r([]))):h.code==="unavailable"||(b=h.message)!=null&&b.includes("ERR_ABORTED")?(console.log("🔄 Connection issue detected, will retry automatically..."),n<i&&(n++,o=setTimeout(()=>{d()},2e3))):(console.error("❌ Unhandled error in messages subscription:",h),r([]))})}catch(p){console.error("❌ Error setting up messages subscription:",p),n<i&&(n++,o=setTimeout(()=>{d()},5e3))}};return d(),()=>{o&&clearTimeout(o),l&&l()}}subscribeToAdminChats(s){console.log("🔍 Admin: Starting subscription to admin chats");let r=0,n=0;const i=5;let o=null,l=null;const u=()=>{try{const d=J(Y(O,"chatRooms"),X("status","==","active"),kt("lastMessageTime","desc"));l=Pe(d,p=>{console.log("📊 Admin: Received chat rooms snapshot:",{size:p.size,empty:p.empty,docs:p.docs.length}),n=0;const h=p.docs.map(w=>{const N=w.data();return console.log("💬 Admin: Chat room data:",{id:w.id,customerName:N.customerName,lastMessage:N.lastMessage,unreadCount:N.unreadCount,status:N.status}),{id:w.id,...N}});h.length!==r&&(console.log("🆕 Chat rooms count changed:",{old:r,new:h.length}),h.forEach(w=>{this.hooks.length>0&&this.hooks.forEach(N=>{if(N.onChatRoomUpdate&&typeof N.onChatRoomUpdate=="function")try{N.onChatRoomUpdate(w)}catch(x){console.error("Error calling onChatRoomUpdate hook:",x)}})})),r=h.length,s(h)},p=>{var h,w;if(console.error("❌ Error in admin chats subscription:",p),p.name==="AbortError"||(h=p.message)!=null&&h.includes("AbortError")){console.log("🔄 Admin chats request was aborted, will retry..."),n<i&&(n++,o=setTimeout(()=>{u()},1e3));return}p.code==="unavailable"||(w=p.message)!=null&&w.includes("ERR_ABORTED")?(console.log("🔄 Admin chats connection issue detected, will retry..."),n<i&&(n++,o=setTimeout(()=>{u()},2e3))):(console.error("❌ Unhandled error in admin chats subscription:",p),s([]))})}catch(d){console.error("❌ Error setting up admin chats subscription:",d),n<i&&(n++,o=setTimeout(()=>{u()},5e3))}};return u(),()=>{o&&clearTimeout(o),l&&l()}}async markMessagesAsRead(s,r){try{const n=J(Y(O,"chatMessages"),X("chatId","==",s),X("senderType","!=",r),X("isRead","==",!1)),o=(await de(n)).docs.map(l=>le(Z(O,"chatMessages",l.id),{isRead:!0}));if(await Promise.all(o),r==="admin"){const l=Z(O,"chatRooms",s);await le(l,{unreadCount:0})}}catch(n){throw console.error("Error marking messages as read:",n),n}}async closeChatRoom(s){try{const r=Z(O,"chatRooms",s);await le(r,{status:"closed",lastMessageTime:re()})}catch(r){throw console.error("Error closing chat room:",r),r}}}const pe=new da,ua=({isOpen:t,onClose:s})=>{var C,M;const[r,n]=f.useState([]),[i,o]=f.useState(null),[l,u]=f.useState([]),[d,p]=f.useState(""),[h,w]=f.useState(!0),[N,x]=f.useState(!1),[b,m]=f.useState({}),k=f.useRef(null);f.useEffect(()=>{const g={onNewMessage:(E,A)=>{console.log("🔔 New message notification:",E,A),E.senderType==="client"&&E.chatId!==i&&(m(F=>({...F,[E.chatId]:(F[E.chatId]||0)+1})),console.log("🔔 New message from client in chat:",A.customerName||A.clientPhone))},onChatRoomUpdate:E=>{console.log("🔄 Chat room updated:",E),n(A=>{const F=A.findIndex(B=>B.id===E.id);if(F>=0){const B=[...A];return B[F]=E,B.sort((Ne,G)=>{var $,V,q,K;const xe=((V=($=Ne.lastMessageTime)==null?void 0:$.toMillis)==null?void 0:V.call($))||0;return(((K=(q=G.lastMessageTime)==null?void 0:q.toMillis)==null?void 0:K.call(q))||0)-xe})}else return[E,...A]})},onUnreadCountChange:(E,A)=>{console.log("📊 Unread count changed:",E,A),n(F=>F.map(B=>B.id===E?{...B,unreadCount:A}:B))}};return pe.registerHooks(g),()=>{pe.unregisterHooks()}},[i]),f.useEffect(()=>{console.log("🔍 AdminChatPanel: Setting up chat rooms subscription"),w(!0);const g=pe.subscribeToAdminChats(E=>{console.log("📊 AdminChatPanel: Received chats update:",E.length),n(E),w(!1)});return()=>{console.log("🔌 AdminChatPanel: Cleaning up chat rooms subscription"),g()}},[]),f.useEffect(()=>{if(!i){u([]);return}console.log("📨 AdminChatPanel: Setting up messages subscription for chat:",i);const g=pe.subscribeToMessages(i,E=>{console.log("📨 AdminChatPanel: Received messages update:",E.length),u(E),m(A=>{const F={...A};return delete F[i],F})});return pe.markMessagesAsRead(i,"admin").catch(console.error),()=>{console.log("🔌 AdminChatPanel: Cleaning up messages subscription"),g()}},[i]),f.useEffect(()=>{var g;(g=k.current)==null||g.scrollIntoView({behavior:"smooth"})},[l]);const U=async()=>{if(!(!d.trim()||!i||N)){x(!0);try{await pe.sendMessage(i,d.trim(),"admin","admin_user"),p("")}catch(g){console.error("Error sending message:",g),alert("حدث خطأ في إرسال الرسالة")}finally{x(!1)}}},v=g=>{o(g),m(E=>{const A={...E};return delete A[g],A})},D=Object.values(b).reduce((g,E)=>g+E,0),I=r.reduce((g,E)=>g+(E.unreadCount||0),0);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[80vh] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"المحادثات"}),(I>0||D>0)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cr,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold",children:"جديد"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(Ee,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(Ut,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-2 text-gray-600",children:"جاري التحميل..."})]}):r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[e.jsx(st,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"لا توجد محادثات نشطة"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"ستظهر المحادثات الجديدة هنا"})]}):r.map(g=>{const E=i===g.id,A=(g.unreadCount||0)>0,F=b[g.id]>0,B=(g.unreadCount||0)+(b[g.id]||0);return e.jsx("div",{onClick:()=>v(g.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-all duration-200 ${E?"bg-blue-50 border-r-4 border-r-blue-500":A||F?"bg-yellow-50 hover:bg-yellow-100 border-r-4 border-r-yellow-400":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${A||F?"bg-yellow-200":"bg-gray-200"}`,children:e.jsx(Be,{className:`w-5 h-5 ${A||F?"text-yellow-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:g.customerName||g.clientPhone}),E&&e.jsx(rt,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]}),g.customerName&&g.customerName!==g.clientPhone&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:g.clientPhone}),g.lastMessage&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:g.lastMessage.length>50?g.lastMessage.substring(0,50)+"...":g.lastMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(me,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:g.lastMessageTime&&g.lastMessageTime.toMillis?new Date(g.lastMessageTime.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${A||F?"bg-red-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:A||F?"رسائل جديدة":"مقروءة"})]})]})]}),B>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[20px] text-center",children:B>99?"99+":B})]})},g.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Be,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:((C=r.find(g=>g.id===i))==null?void 0:C.customerName)||((M=r.find(g=>g.id===i))==null?void 0:M.clientPhone)})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[l.map(g=>e.jsx("div",{className:`flex ${g.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${g.senderType==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:g.message||g.content}),e.jsx("p",{className:`text-xs mt-1 ${g.senderType==="admin"?"text-blue-100":"text-gray-500"}`,children:g.timestamp&&g.timestamp.toMillis?new Date(g.timestamp.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"})]})},g.id)),e.jsx("div",{ref:k})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:g=>p(g.target.value),onKeyPress:g=>g.key==="Enter"&&U(),placeholder:"اكتب رسالتك هنا...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:N}),e.jsxs("button",{onClick:U,disabled:!d.trim()||N,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[N?e.jsx(Ut,{className:"w-4 h-4 animate-spin"}):e.jsx(Dr,{className:"w-4 h-4"}),"إرسال"]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(ce,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر محادثة للبدء"}),e.jsx("p",{children:"اختر محادثة من القائمة لعرض الرسائل والرد عليها"})]})})})]})}):null},ma={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.firebasestorage.app",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},ha=({navigate:t,auth:s,devMode:r,setDevMode:n,error:i,setError:o,authLoading:l,setAuthLoading:u,activeTab:d,setActiveTab:p,setNotificationCenterOpen:h,setNotificationSettings:w,setNotifications:N,notificationCount:x,setNotificationCount:b,users:m,setUsers:k,filteredUsers:U,setFilteredUsers:v,loading:D,setLoading:I,setEditingPlan:C,isSavingContent:M,setIsSavingContent:g,lastUpdateInfo:E,loadContentFromFirebase:A,saveContentToFirebase:F})=>{var Et;const[B,Ne]=f.useState(!0),[G,xe]=f.useState(""),[R,$]=f.useState(null),[V,q]=f.useState({});f.useState(!1),f.useState(null),f.useState(!1);const[K,He]=f.useState({sound:!0}),[cs,xa]=f.useState(!1),[ds,us]=f.useState(null),qe=a=>{const c=a==null?void 0:a.displayName;let y="";typeof c=="string"?y=c:c&&typeof c=="object"&&(y=(c.ar||c.en||"").toString()),!y&&typeof(a==null?void 0:a.email)=="string"&&(y=a.email);const _=String(y).trim().charAt(0);return _?_.toUpperCase():"؟"},je=a=>{const c=a==null?void 0:a.displayName;if(typeof c=="string"&&c.trim())return c.trim();if(c&&typeof c=="object"){const y=c.full_name||c.name||c.ar||c.en;if(typeof y=="string"&&y.trim())return y.trim()}return typeof(a==null?void 0:a.email)=="string"&&a.email.includes("@")?a.email.split("@")[0]:"غير محدد"},[ze,ut]=f.useState(""),[Ye,mt]=f.useState(""),[ht,xt]=f.useState(""),[Ge,gt]=f.useState(""),[ft,pt]=f.useState(!1),[Ce,bt]=f.useState(""),[Q,yt]=f.useState(24),[Nt,jt]=f.useState("24"),[wt,vt]=f.useState(!1),[ga,_t]=f.useState(!1);f.useEffect(()=>{d==="trials"&&(async()=>{try{_t(!0);const{FreeTrialService:a}=await Ae(async()=>{const{FreeTrialService:y}=await import("./index-BfErj1u3.js").then(_=>_.b1);return{FreeTrialService:y}},__vite__mapDeps([0,1])),c=await a.getTrialDurationHours();yt(c),jt(String(c))}catch(a){console.error("Failed to load trial duration",a)}finally{_t(!1)}})()},[d]);const ms=async()=>{var a;if(!ze.trim()||!Ye.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{pt(!0);const c=Ge.trim()?`user:${Ge.trim()}`:"global";await yr({title:ze.trim(),message:Ye.trim(),audienceKey:c,createdBy:(a=s==null?void 0:s.currentUser)==null?void 0:a.uid,linkUrl:ht.trim()||void 0}),ut(""),mt(""),xt(""),gt(""),alert("تم إرسال الإشعار بنجاح!")}catch(c){console.error("خطأ في إرسال الإشعار:",c),alert("حدث خطأ أثناء إرسال الإشعار")}finally{pt(!1)}};f.useEffect(()=>{if(!G.trim())v(m);else{const a=m.filter(c=>c.email&&typeof c.email=="string"&&c.email.toLowerCase().includes(G.toLowerCase())||c.displayName&&typeof c.displayName=="string"&&c.displayName.toLowerCase().includes(G.toLowerCase())||c.name&&typeof c.name=="string"&&c.name.toLowerCase().includes(G.toLowerCase()));v(a)}},[m,G,v]);const hs=()=>{s!=null&&s.signOut&&s.signOut(),t("/admin/login")},xs=async(a,c,y=null)=>{var _;try{console.log("Activating subscription for user:",a,"with plan:",c,"and variant:",y);const T=((_=s==null?void 0:s.currentUser)==null?void 0:_.uid)||"admin-user-id";await Ws(a,c,T,y),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(T){console.error("❌ خطأ في تفعيل الاشتراك:",T),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},gs=async a=>{try{console.log("Deactivating subscription for user:",a),await Ks(a),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(c){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",c),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},fs=async a=>{var c;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",a);const _=((c=s==null?void 0:s.currentUser)==null?void 0:c.uid)||"unknown-admin";try{const j=await Qs(Xs,"deleteUserPermanently")({userId:a});console.log("استجابة دالة الحذف النهائي:",j),k(H=>H.filter(se=>se.id!==a)),v(H=>H.filter(se=>se.id!==a)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(T){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(T==null?void 0:T.message)||T)}{const T=[];try{await oe(Z(O,"profiles",a)),console.log("تم حذف الملف الشخصي")}catch(j){console.error("خطأ في حذف الملف الشخصي:",j),T.push(`الملف الشخصي: ${(j==null?void 0:j.message)||j}`)}try{await oe(Z(O,"users",a)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(j){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",j),T.push(`users: ${(j==null?void 0:j.message)||j}`)}try{const j=J(Y(O,"transactions"),X("userId","==",a)),H=await de(j),se=H.docs.map(we=>oe(we.ref)),ge=await Promise.allSettled(se),fe=ge.filter(we=>we.status==="rejected");fe.length?(console.warn("فشل حذف بعض المعاملات:",fe.length),T.push(`المعاملات: فشل حذف ${fe.length} من أصل ${ge.length}`)):console.log(`تم حذف ${H.size} معاملة`)}catch(j){console.error("خطأ في جلب/حذف المعاملات:",j),T.push(`المعاملات: ${(j==null?void 0:j.message)||j}`)}try{const j=J(Y(O,"chatRooms"),X("participants","array-contains",a)),H=await de(j),se=H.docs.map(async ge=>{try{const we=(await de(Y(ge.ref,"messages"))).docs.map(Cs=>oe(Cs.ref));await Promise.allSettled(we),await oe(ge.ref)}catch(fe){console.error("فشل حذف محادثة/رسائل:",fe),T.push(`المحادثات: ${ge.id}`)}});await Promise.all(se),console.log(`تم إنهاء معالجة ${H.size} محادثة`)}catch(j){console.error("خطأ في جلب/حذف المحادثات:",j),T.push(`المحادثات: ${(j==null?void 0:j.message)||j}`)}try{await Zs(Z(O,"deletedUsers",a),{deletedAt:new Date,deletedBy:_,reason:"حذف نهائي من لوحة الإدارة"})}catch(j){console.error("خطأ في تسجيل المستخدم كمحذوف:",j),T.push(`deletedUsers: ${(j==null?void 0:j.message)||j}`)}k(j=>j.filter(H=>H.id!==a)),v(j=>j.filter(H=>H.id!==a)),T.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${T.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(y){console.error("❌ خطأ في حذف المستخدم:",y),alert(`حدث خطأ في حذف المستخدم: ${y.message||"خطأ غير معروف"}`)}};f.useEffect(()=>{(async()=>{try{if(typeof A=="function"){const c=await A();c&&(c.monthly||c.yearly||c.lifetime)&&q(c)}}catch(c){console.warn("Failed to load content data:",c)}})()},[]);const ps=async()=>{var a;try{if(typeof F!="function")return;g(!0);const c=((a=s==null?void 0:s.currentUser)==null?void 0:a.uid)||"admin-user-id";await F(V,c),alert("تم حفظ جميع التغييرات بنجاح")}catch(c){console.error("❌ خطأ في حفظ المحتوى:",c),alert(`فشل في حفظ المحتوى: ${(c==null?void 0:c.message)||"خطأ غير معروف"}`)}finally{g(!1)}},ke=(a,c,y)=>{q(_=>({..._,[a]:{...(_==null?void 0:_[a])||{},[c]:y}}))},bs=a=>{q(c=>{var y;return{...c,[a]:{...(c==null?void 0:c[a])||{},features:[...((y=c==null?void 0:c[a])==null?void 0:y.features)||[],""]}}})},ys=(a,c,y)=>{q(_=>{var j;const T=[...((j=_==null?void 0:_[a])==null?void 0:j.features)||[]];return T[c]=y,{..._,[a]:{...(_==null?void 0:_[a])||{},features:T}}})},Ns=(a,c)=>{q(y=>{var T;const _=[...((T=y==null?void 0:y[a])==null?void 0:T.features)||[]];return _.splice(c,1),{...y,[a]:{...(y==null?void 0:y[a])||{},features:_}}})},js=()=>{He(a=>({...a,sound:!a.sound}))},ws=()=>{us(null)},vs=async()=>{try{const a=Number(Nt);if(isNaN(a)||a<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}vt(!0);const{FreeTrialService:c}=await Ae(async()=>{const{FreeTrialService:_}=await import("./index-BfErj1u3.js").then(T=>T.b1);return{FreeTrialService:_}},__vite__mapDeps([0,1])),y=await c.updateTrialDurationHours(a);y.success?(yt(a),alert(y.message)):alert(y.message||"فشل تحديث مدة التجربة")}catch(a){console.error("Error updating trial duration:",a),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{vt(!1)}},_s=async a=>{try{const{FreeTrialService:c}=await Ae(async()=>{const{FreeTrialService:_}=await import("./index-BfErj1u3.js").then(T=>T.b1);return{FreeTrialService:_}},__vite__mapDeps([0,1])),y=await c.startFreeTrialFromAdmin(a);alert(y.message||`تم تفعيل التجربة المجانية لمدة ${Q} ${Q>=3&&Q<=10?"ساعات":Q===2?"ساعتين":"ساعة"}`)}catch(c){console.error("Error activating free trial:",c),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},Ts=async a=>{try{const{FreeTrialService:c}=await Ae(async()=>{const{FreeTrialService:_}=await import("./index-BfErj1u3.js").then(T=>T.b1);return{FreeTrialService:_}},__vite__mapDeps([0,1])),y=await c.resetActiveTrialToCurrentDuration(a);alert(y.message)}catch(c){console.error("Error resetting user trial end:",c),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},Es=(a,c)=>{console.log("Toggling user status:",a,c)},Tt=a=>a?(a.toDate?a.toDate():new Date(a)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",Rs=[{id:"users",label:"المستخدمين",icon:st},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:ne},{id:"trials",label:"إدارة التجارب المجانية",icon:be},{id:"content",label:"إدارة المحتوى",icon:Js},{id:"chat",label:"الدردشة",icon:ce},{id:"whatsapp",label:"إدارة الواتساب",icon:ce},{id:"analytics",label:"الإحصائيات",icon:At}];return l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:i})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{o(null),u(!0),window.location.reload()},className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"🔄 إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{o(null),t("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",i),console.log("🔍 Auth state:",s.currentUser),console.log("🔍 Dev mode:",r),console.log("🔍 Environment:",ma)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!r&&!s.currentUser?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>t("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:`${B?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[B&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Tr,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>Ne(!B),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:B?e.jsx(Ee,{className:"w-5 h-5"}):e.jsx(Ar,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:Rs.map(a=>{const c=a.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>p(a.id),className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${d===a.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(c,{className:"w-5 h-5"}),B&&e.jsx("span",{className:"font-medium",children:a.label})]})},a.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:hs,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Ys,{className:"w-5 h-5"}),B&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[d==="users"&&"إدارة المستخدمين",d==="subscriptions"&&"مواعيد الاشتراكات",d==="trials"&&"إدارة التجارب المجانية",d==="chat"&&"إدارة الدردشة",d==="analytics"&&"الإحصائيات"]}),r&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",r?"المطور":"المدير"]}),e.jsx(rr,{})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[d==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.length})]}),e.jsx(st,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Ge,onChange:a=>gt(a.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(a=>a.isActive).length})]}),e.jsx(It,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(a=>!a.isActive).length})]}),e.jsx(Ur,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:G,onChange:a=>xe(a.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),G&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",U.length," من أصل ",m.length," مستخدم",G&&e.jsx("button",{onClick:()=>xe(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:D?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):U.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:G?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:U.map(a=>e.jsx(Wr,{user:a,onActivateSubscription:xs,onToggleUserStatus:Es,onDeactivateSubscription:gs,onDeleteUser:fs},a.id))})})]})]}),d==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(a=>{var c;return(c=a.subscription)==null?void 0:c.isActive}).length})]}),e.jsx(rt,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:m.filter(a=>{var j,H;if(!((j=a.subscription)!=null&&j.endDate)||!((H=a.subscription)!=null&&H.isActive))return!1;const c=a.subscription.endDate.toDate?a.subscription.endDate.toDate():new Date(a.subscription.endDate),y=new Date,_=c.getTime()-y.getTime(),T=Math.ceil(_/(1e3*60*60*24));return T<=7&&T>0}).length})]}),e.jsx(Le,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(a=>{var y;return(y=a.subscription)!=null&&y.endDate?(a.subscription.endDate.toDate?a.subscription.endDate.toDate():new Date(a.subscription.endDate))<new Date:!1}).length})]}),e.jsx(me,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:m.filter(a=>{var c;return((c=a.subscription)==null?void 0:c.planType)===S.LIFETIME}).length})]}),e.jsx(Oe,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:D?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.filter(a=>{var c;return(c=a.subscription)==null?void 0:c.planType}).sort((a,c)=>{var T,j;if(!((T=a.subscription)!=null&&T.endDate)||!((j=c.subscription)!=null&&j.endDate))return 0;const y=a.subscription.endDate.toDate?a.subscription.endDate.toDate():new Date(a.subscription.endDate),_=c.subscription.endDate.toDate?c.subscription.endDate.toDate():new Date(c.subscription.endDate);return y.getTime()-_.getTime()}).map(a=>{const c=a.subscription;if(!c)return null;const y=c.startDate?c.startDate.toDate?c.startDate.toDate():new Date(c.startDate):null,_=c.endDate?c.endDate.toDate?c.endDate.toDate():new Date(c.endDate):null;let T=null,j="غير محدد";if(c.planType===S.LIFETIME)j="مدى الحياة";else if(_){const H=new Date,se=_.getTime()-H.getTime();T=Math.ceil(se/(1e3*60*60*24)),T<0?j="منتهي":T<=7?j="ينتهي قريباً":j="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:qe(a)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:je(a)}),e.jsx("div",{className:"text-sm text-gray-500",children:a.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[c.planType===S.LIFETIME&&e.jsx(Oe,{className:"w-4 h-4 text-yellow-500 ml-2"}),c.planType===S.YEARLY&&e.jsx(be,{className:"w-4 h-4 text-blue-500 ml-2"}),c.planType===S.QUARTERLY&&e.jsx(ne,{className:"w-4 h-4 text-purple-500 ml-2"}),c.planType===S.MONTHLY&&e.jsx(tt,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Gs(c.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:y?y.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.planType===S.LIFETIME?"مدى الحياة":_?_.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${j==="نشط"?"bg-green-100 text-green-800":j==="ينتهي قريباً"?"bg-orange-100 text-orange-800":j==="منتهي"?"bg-red-100 text-red-800":j==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:j})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.planType===S.LIFETIME?"∞":T!==null?T<0?"منتهي":`${T} يوم`:"غير محدد"})]},a.id)}).filter(Boolean)})]})})]})]}),d==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),E&&E.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(E.lastUpdated).toLocaleString("ar-SA"),E.updatedBy&&` بواسطة: ${E.updatedBy}`]})]}),e.jsxs("button",{onClick:ps,disabled:M,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(qt,{className:"w-4 h-4"}),M?"جاري الحفظ...":"حفظ جميع التغييرات"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(V).map(([a,c])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[a==="monthly"&&e.jsx(tt,{className:"w-4 h-4 text-green-500"}),a==="quarterly"&&e.jsx(ne,{className:"w-4 h-4 text-purple-500"}),a==="yearly"&&e.jsx(be,{className:"w-4 h-4 text-blue-500"}),a==="lifetime"&&e.jsx(Oe,{className:"w-4 h-4 text-yellow-500"}),c.name]}),e.jsx("button",{onClick:()=>C(R===a?null:a),className:"text-purple-600 hover:text-purple-800",children:e.jsx(dr,{className:"w-4 h-4"})})]}),R===a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:c.name,onChange:y=>ke(a,"name",y.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:c.price,onChange:y=>ke(a,"price",y.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:c.period,onChange:y=>ke(a,"period",y.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:c.description,onChange:y=>ke(a,"description",y.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>bs(a),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:c.features.map((y,_)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:y,onChange:T=>ys(a,_,T.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>Ns(a,_),className:"text-red-500 hover:text-red-700",children:e.jsx(Ee,{className:"w-4 h-4"})})]},_))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.price}),e.jsx("div",{className:"text-sm text-gray-600",children:c.period}),e.jsx("div",{className:"text-sm text-gray-700",children:c.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),c.features.map((y,_)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(rt,{className:"w-3 h-3 text-green-500"}),y]},_))]})]})]},a))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:ze,onChange:a=>ut(a.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:Ye,onChange:a=>mt(a.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:ht,onChange:a=>xt(a.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:ms,disabled:ft,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:ft?"جاري الإرسال...":"إرسال إشعار"})})]})]})]}),d==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",m),console.log("🔍 Users count:",(m==null?void 0:m.length)||0),console.log("🔍 Users on trial:",((Et=m==null?void 0:m.filter(a=>a.isOnFreeTrial))==null?void 0:Et.length)||0),D&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),i&&!D&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Le,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:i}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!D&&!i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(a=>a.isOnFreeTrial).length})]}),e.jsx(be,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(a=>a.hasUsedFreeTrial&&!a.isOnFreeTrial).length})]}),e.jsx(me,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(a=>!a.hasUsedFreeTrial&&!a.isOnFreeTrial&&!a.approved).length})]}),e.jsx(It,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:Nt,onChange:a=>jt(a.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",Q," ",Q>=3&&Q<=10?"ساعات":Q===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:vs,disabled:wt,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:wt?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ce,onChange:a=>bt(a.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Xe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[m.filter(a=>!a.hasUsedFreeTrial&&!a.isOnFreeTrial&&!a.approved).filter(a=>{const c=Ce.trim().toLowerCase();if(!c)return!0;const y=je(a).toLowerCase(),_=(a.email||"").toLowerCase();return y.includes(c)||_.includes(c)}).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:qe(a)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:je(a)}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",Tt(a.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>_s(a.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${Q} ${Q>=3&&Q<=10?"ساعات":Q===2?"ساعتين":"ساعة"}`})})]},a.id)),m.filter(a=>!a.hasUsedFreeTrial&&!a.isOnFreeTrial&&!a.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),m.filter(a=>a.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ce,onChange:a=>bt(a.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Xe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:m.filter(a=>a.isOnFreeTrial).filter(a=>{const c=Ce.trim().toLowerCase();if(!c)return!0;const y=je(a).toLowerCase(),_=(a.email||"").toLowerCase();return y.includes(c)||_.includes(c)}).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:qe(a)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:je(a)}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",a.freeTrialEndDate?Tt(a.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>Ts(a.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"})]})]},a.id))})})]})]})]}),d==="chat"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx(ua,{isOpen:!0,onClose:()=>{}})}),d==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ce,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(Or,{})]}),d==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(At,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(Yr,{isOpen:cs,onClose:()=>h(!1)}),e.jsx(Gr,{notification:ds,onClose:ws,soundEnabled:K.soundAlerts,onToggleSound:js})]})},si=()=>{const t=er(),{user:s,loading:r}=tr(),[n,i]=f.useState(!1),[o,l]=f.useState(null),[u,d]=f.useState(!1),[p,h]=f.useState("users"),[w,N]=f.useState(0),[x,b]=f.useState([]),[m,k]=f.useState([]),[U,v]=f.useState(!1),[D,I]=f.useState(null),[C,M]=f.useState([]),[g,E]=f.useState({});f.useEffect(()=>{const R=localStorage.getItem("admin_dev_mode")==="true";i(R)},[]),f.useEffect(()=>{if(!(!n&&!s)){d(!0),l(null);try{const R=J(Y(O,"users")),$=Pe(R,V=>{const q=V.docs.map(K=>({id:K.id,...K.data()}));M(q),d(!1),l(null)},V=>{console.error("Error loading users:",V),n?(M([]),d(!1),l(null)):(l("فشل في تحميل بيانات المستخدمين"),d(!1))});return()=>$()}catch(R){console.error("Error setting up users listener:",R),n?(M([]),d(!1),l(null)):(l("فشل في إعداد مراقب البيانات"),d(!1))}}},[s,n]),f.useEffect(()=>{if(!(!n&&!s))try{const R=J(Y(O,"profiles")),$=Pe(R,V=>{const q={};V.forEach(K=>{q[K.id]=K.data()}),E(q)},V=>{console.error("Error loading profiles:",V)});return()=>$()}catch(R){console.error("Error setting up profiles listener:",R)}},[s,n]),f.useEffect(()=>{const R=C.map($=>{const V=g[$.id]||{},q=typeof V.fullName=="string"?V.fullName:void 0,K=typeof V.phone=="string"?V.phone:void 0,He=typeof $.displayName=="string"&&$.displayName.trim()?$.displayName:q||$.displayName||void 0;return{...$,displayName:He,phone:$.phone??K??null}});b(R),k(R)},[C,g]);const A=R=>{console.log("Notification center:",R)},F=R=>{console.log("Notification settings:",R)},B=R=>{console.log("Notifications:",R)},Ne=R=>{console.log("Editing plan:",R)};f.useEffect(()=>{(async()=>{try{const R=await Mt();I(R)}catch(R){console.warn("Failed to load last update info:",R),I(null)}})()},[]);const G=async()=>{try{return await Er()}catch(R){return console.error("Error loading content:",R),{}}},xe=async R=>{try{v(!0);try{localStorage.setItem("siteContent_plans_cache",JSON.stringify(R))}catch{}await Rr(R,(s==null?void 0:s.uid)||"admin");const $=await Mt();return I($),!0}catch($){return console.error("Error saving content:",$),!1}finally{v(!1)}};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):e.jsx(ha,{navigate:t,auth:sr,devMode:n,setDevMode:i,error:o,setError:l,authLoading:r,setAuthLoading:()=>{},activeTab:p,setActiveTab:h,setNotificationCenterOpen:A,setNotificationSettings:F,setNotifications:B,notificationCount:w,setNotificationCount:N,users:x,setUsers:b,filteredUsers:m,setFilteredUsers:k,loading:u,setLoading:d,setEditingPlan:Ne,isSavingContent:U,setIsSavingContent:v,lastUpdateInfo:D,loadContentFromFirebase:G,saveContentToFirebase:xe})};export{si as default};
