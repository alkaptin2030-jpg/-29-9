const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/walletDailyLimitsService-CGHLknt6.js","assets/index-Drf-Kel-.js","assets/index-CUGoRur3.css","assets/profitService-WOL_cZ8K.js","assets/reportsService-Bp1Io21u.js"])))=>i.map(i=>d[i]);
import{c as Qe,z as Xe,r as c,B as Ye,j as t,P as G,E as te,a9 as et,v as ae,a as tt,u as st,R as se,S as at,ak as rt,Q as nt,a0 as ot,a2 as it,k as pe,a1 as lt,al as ct,o as dt,a8 as U,am as V,an as _,ao as mt,ap as ut,a6 as ht,C as xe,W as pt,i as xt,_ as R}from"./index-Drf-Kel-.js";import{C as gt,a as ft,b as vt,d as bt}from"./card-B-oThBGQ.js";import{B as T}from"./button-BeXYwqdJ.js";import{I as yt}from"./input-BS89kG9l.js";import{B as K}from"./badge-UZez9OVE.js";import{c as fe,R as Nt,I as jt}from"./index-BoPwWMJr.js";import{u as St}from"./index-CexbHjis.js";import{u as Ct}from"./Combination-CwHaGt6n.js";import{C as Tt,a as At,M as Dt,b as _t,R as wt}from"./MaintenanceDialog-BIQPFR_D.js";import{P as It}from"./PasswordConfirmDialog-BMypOgjX.js";import{M as Ot}from"./MasterPinDialog-RsfCUjbM.js";import{A as Pt}from"./arrow-left-Cyn2rWTx.js";import{S as Rt}from"./separator-DRqor3jV.js";import{C as kt}from"./calendar-DYQ_aN-h.js";import{T as ge}from"./progress-DQxfmnh7.js";import{C as Et}from"./circle-x-C9dwYXo5.js";import{C as Mt}from"./circle-check-big-Byeak2Hh.js";import"./dialog-BnpzTiyj.js";import"./lock-D5jTNF9R.js";import"./eye-DCMRqakt.js";import"./label-LMuypoA6.js";import"./circle-alert-QaHEPkjm.js";import"./shield-DmIh40Jt.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=Qe("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);var J="Tabs",[zt,xs]=Xe(J,[fe]),ve=fe(),[Lt,re]=zt(J),be=c.forwardRef((u,s)=>{const{__scopeTabs:l,value:m,onValueChange:f,defaultValue:A,orientation:g="horizontal",dir:b,activationMode:I="automatic",...w}=u,N=St(b),[y,C]=Ye({prop:m,onChange:f,defaultProp:A??"",caller:J});return t.jsx(Lt,{scope:l,baseId:Ct(),value:y,onValueChange:C,orientation:g,dir:N,activationMode:I,children:t.jsx(G.div,{dir:N,"data-orientation":g,...w,ref:s})})});be.displayName=J;var ye="TabsList",Ne=c.forwardRef((u,s)=>{const{__scopeTabs:l,loop:m=!0,...f}=u,A=re(ye,l),g=ve(l);return t.jsx(Nt,{asChild:!0,...g,orientation:A.orientation,dir:A.dir,loop:m,children:t.jsx(G.div,{role:"tablist","aria-orientation":A.orientation,...f,ref:s})})});Ne.displayName=ye;var je="TabsTrigger",Se=c.forwardRef((u,s)=>{const{__scopeTabs:l,value:m,disabled:f=!1,...A}=u,g=re(je,l),b=ve(l),I=Ae(g.baseId,m),w=De(g.baseId,m),N=m===g.value;return t.jsx(jt,{asChild:!0,...b,focusable:!f,active:N,children:t.jsx(G.button,{type:"button",role:"tab","aria-selected":N,"aria-controls":w,"data-state":N?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:I,...A,ref:s,onMouseDown:te(u.onMouseDown,y=>{!f&&y.button===0&&y.ctrlKey===!1?g.onValueChange(m):y.preventDefault()}),onKeyDown:te(u.onKeyDown,y=>{[" ","Enter"].includes(y.key)&&g.onValueChange(m)}),onFocus:te(u.onFocus,()=>{const y=g.activationMode!=="manual";!N&&!f&&y&&g.onValueChange(m)})})})});Se.displayName=je;var Ce="TabsContent",Te=c.forwardRef((u,s)=>{const{__scopeTabs:l,value:m,forceMount:f,children:A,...g}=u,b=re(Ce,l),I=Ae(b.baseId,m),w=De(b.baseId,m),N=m===b.value,y=c.useRef(N);return c.useEffect(()=>{const C=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(C)},[]),t.jsx(et,{present:f||N,children:({present:C})=>t.jsx(G.div,{"data-state":N?"active":"inactive","data-orientation":b.orientation,role:"tabpanel","aria-labelledby":I,hidden:!C,id:w,tabIndex:0,...g,ref:s,style:{...u.style,animationDuration:y.current?"0s":void 0},children:C&&A})})});Te.displayName=Ce;function Ae(u,s){return`${u}-trigger-${s}`}function De(u,s){return`${u}-content-${s}`}var Bt=be,_e=Ne,we=Se,Ie=Te;const Ft=Bt,Oe=c.forwardRef(({className:u,...s},l)=>t.jsx(_e,{ref:l,className:ae("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",u),...s}));Oe.displayName=_e.displayName;const z=c.forwardRef(({className:u,...s},l)=>t.jsx(we,{ref:l,className:ae("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",u),...s}));z.displayName=we.displayName;const L=c.forwardRef(({className:u,...s},l)=>t.jsx(Ie,{ref:l,className:ae("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",u),...s}));L.displayName=Ie.displayName;const gs=()=>{var de,me,ue,he;const u=tt(),{user:s,profile:l,userSubscription:m}=st(),f=se.useMemo(()=>{var a,r,d,n;const e=((a=m==null?void 0:m.subscription)==null?void 0:a.planType)??((r=m==null?void 0:m.subscription)==null?void 0:r.plan)??((d=l==null?void 0:l.subscription)==null?void 0:d.planType)??((n=l==null?void 0:l.subscription)==null?void 0:n.plan)??null;return e===at.ZERO||String(e).toLowerCase()==="zero"},[(de=m==null?void 0:m.subscription)==null?void 0:de.planType,(me=m==null?void 0:m.subscription)==null?void 0:me.plan,(ue=l==null?void 0:l.subscription)==null?void 0:ue.planType,(he=l==null?void 0:l.subscription)==null?void 0:he.plan]),{shopName:A}=rt();nt();const[g,b]=c.useState([]),[I,w]=c.useState([]),[N,y]=c.useState("all"),[C,ne]=c.useState(""),[k,Pe]=c.useState(""),[E,Re]=c.useState(""),[Wt,ke]=c.useState(!1),[Ut,Ee]=c.useState(!1),[Vt,Me]=c.useState(!1),[Kt,$e]=c.useState(!1),[q,H]=c.useState(!1),[ze,oe]=c.useState(!1),[Le,ie]=c.useState(!1),[Be,Z]=c.useState(!1),[Fe,We]=c.useState(null),[Ue,Q]=c.useState(!1),[le,B]=c.useState(0),P=se.useCallback(()=>{try{const e=`debts_${(s==null?void 0:s.uid)||"default"}`,a=localStorage.getItem(e)||localStorage.getItem("debts_default");if(!a){B(0);return}const r=JSON.parse(a);if(!Array.isArray(r)){B(0);return}const d=r.filter(n=>(n==null?void 0:n.status)==="pending"&&((n==null?void 0:n.amount)??0)>0).length;B(d)}catch{B(0)}},[s==null?void 0:s.uid]);c.useEffect(()=>{P()},[P]),c.useEffect(()=>{const e=a=>{a.key&&(a.key===`debts_${(s==null?void 0:s.uid)||"default"}`||a.key==="debts_default")&&P()};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[P,s==null?void 0:s.uid]),c.useEffect(()=>{q||P()},[q,P]),c.useEffect(()=>{Ve(),Ke()},[s]),c.useEffect(()=>{if(s!=null&&s.uid)try{const e=ot(it(pe,"userTransactions"),lt("userId","==",s.uid),ct("createdAt","desc")),a=dt(e,r=>{const d=r.docs.map(n=>{const p=n.data(),o=p==null?void 0:p.createdAt,i=o!=null&&o.toDate?o.toDate():o instanceof Date?o:new Date(o);return{id:n.id,...p,createdAt:i}}).filter(n=>(n==null?void 0:n.status)!=="cancelled"&&!(n!=null&&n.isDeleted)).filter(n=>!((n==null?void 0:n.type)==="report"||((n==null?void 0:n.title)||"").includes("إيصال تسليم وردية")));b(d.map(Y))},r=>{console.error("خطأ في الاشتراك لمعاملات المستخدم:",r)});return()=>a()}catch(e){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم:",e)}},[s==null?void 0:s.uid]);const Ve=async()=>{try{if(!s)return;const a=(await U.getUserTransactions(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)})).filter(r=>!((r==null?void 0:r.type)==="report"||((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية")));b(a.map(Y))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e)}},Ke=async()=>{try{if(!s)return;const a=(await V.getDeletedTransactionsByUser(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)}));w(a.map(Y))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e)}},M=se.useMemo(()=>{const e=s!=null&&s.uid?`recentTransactionsResetAt:${s.uid}`:null,a=e?localStorage.getItem(e):null;let r=null;if(a){const d=new Date(a);isNaN(d.getTime())||(r=d)}return g.filter(d=>!r||d.createdAt>=r)},[g,s==null?void 0:s.uid]),ce=M.filter(e=>{const a=!C||e.senderPhone.includes(C)||e.receiverPhone.includes(C),r=!k||e.createdAt.toDateString()===new Date(k).toDateString(),d=!E||e.createdAt.toTimeString().startsWith(E);return a&&r&&d}),F=e=>{switch(e){case"completed":return t.jsx(Mt,{className:"h-4 w-4 text-green-500"});case"pending":return t.jsx(xe,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(Et,{className:"h-4 w-4 text-red-500"});default:return t.jsx(xe,{className:"h-4 w-4 text-gray-500"})}},X=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},Y=e=>{const a=((e==null?void 0:e.status)??"").toString().toLowerCase(),r=a==="confirmed"||a==="success"||a==="completed"?"completed":a==="failed"||a==="error"||a==="cancelled"||a==="canceled"?"cancelled":"pending",n=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",p=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",o=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",i=e==null?void 0:e.createdAt,h=i instanceof Date?i:i!=null&&i.toDate?i.toDate():new Date(i);return{id:e==null?void 0:e.id,senderPhone:p||"غير معروف",receiverPhone:o||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:r,type:n,createdAt:h,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1}},Ge=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:A??(l==null?void 0:l.shopName)??(s==null?void 0:s.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0}),ee=e=>{const a=Ge(e);We(a),Z(!0)},Je=async e=>{try{const a=I.find(n=>n.id===e);if(!a||!s)return;const r=await U.saveUserTransaction(s.uid,{...a,userId:s.uid,status:"completed",cashierName:a.cashierName??"الحساب الرئيسي"});await V.permanentlyDeleteTransaction(e,s.uid);const d={...a,id:r};b(n=>[...n,d]),w(n=>n.filter(p=>p.id!==e)),_({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(a){console.error("خطأ في استرجاع المعاملة من Firestore:",a),_({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},qe=async e=>{try{if(!s)return;w(a=>a.filter(r=>r.id!==e)),await V.permanentlyDeleteTransaction(e,s.uid),await U.removeUserTransaction(s.uid,e),_({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(a){console.error("فشل الحذف النهائي للمعاملة:",a),_({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},He=async e=>{try{const a=g.find(i=>i.id===e);if(!a||!s)return;const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,d=`userCashBalance_${(s==null?void 0:s.uid)||"default"}`,n=`walletBalances_${(s==null?void 0:s.uid)||"default"}`;let p=(()=>{const i=localStorage.getItem(r);if(i!=null)return parseFloat(i);const h=localStorage.getItem(d);if(h!=null){const v=parseFloat(h);if(!Number.isNaN(v)){try{localStorage.setItem(r,v.toString()),localStorage.removeItem(d)}catch{}return v}}return 0})(),o=(()=>{const i=localStorage.getItem(n);try{return i?JSON.parse(i):{}}catch{return{}}})();if(a.type==="withdraw"){const i=a.fromWallet||Object.keys(o)[0],h=Number(a.withdrawnAmount??a.amount??0),v=Number(a.commission??0),O=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let x=[];try{const j=localStorage.getItem(O);x=j?JSON.parse(j):[]}catch{x=[]}const D=(a==null?void 0:a.walletEffectAppliedOnCreation)||x.includes(e);if(!D&&i&&h>0){const j=o[i]||0;o[i]=j+h}if(p=p-h+v,localStorage.setItem(r,p.toString()),localStorage.setItem(n,JSON.stringify(o)),D)try{const j=x.filter(W=>W!==e);localStorage.setItem(O,JSON.stringify(j))}catch{}}await pt(xt(pe,"userTransactions",e),{status:"completed",confirmedAt:new Date}),b(i=>i.map(h=>h.id===e?{...h,status:"completed"}:h)),_({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),Z(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),_({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},Ze=async e=>{try{const a=g.find(r=>r.id===e);if(!a||!s)return;b(r=>r.filter(d=>d.id!==e)),w(r=>[{...a},...r]);try{await U.removeUserTransaction(s.uid,e),await V.saveDeletedTransaction({...a,userId:s.uid,originalTransactionId:e})}catch(r){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",r)}try{const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,d=`userCashBalance_${(s==null?void 0:s.uid)||"default"}`,n=`walletBalances_${(s==null?void 0:s.uid)||"default"}`,p=localStorage.getItem(r);let o;if(p!=null)o=parseFloat(p);else{const S=localStorage.getItem(d);if(S!=null){const $=parseFloat(S);if(Number.isNaN($))o=0;else{o=$;try{localStorage.setItem(r,$.toString()),localStorage.removeItem(d)}catch{}}}else o=0}const i=localStorage.getItem(n);let h=(()=>{try{return i?JSON.parse(i):{}}catch{return{}}})();const v=Number(a.withdrawnAmount??a.amount??0),O=Number(a.commission??0),x=a.fromWallet||Object.keys(h)[0],D=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let j=[];try{const S=localStorage.getItem(D);j=S?JSON.parse(S):[]}catch{j=[]}const W=(a==null?void 0:a.walletEffectAppliedOnCreation)||j.includes(e);if(a.type==="send"){if(o-=O,x&&v>0){const S=h[x]||0;h[x]=S+v}}else if(a.type==="withdraw"){if(a.status==="completed"){if(o=o+v-O,x&&v>0){const S=h[x]||0;h[x]=S-v}}else if(x&&W&&v>0){const S=h[x]||0;h[x]=S-v}}if(localStorage.setItem(r,o.toString()),localStorage.setItem(n,JSON.stringify(h)),W)try{const S=j.filter($=>$!==e);localStorage.setItem(D,JSON.stringify(S))}catch{}}catch(r){console.warn("فشل عكس تأثير الأرصدة محليًا:",r)}try{const r=a.fromWallet;if(r){const{walletDailyLimitsService:d}=await R(async()=>{const{walletDailyLimitsService:p}=await import("./walletDailyLimitsService-CGHLknt6.js");return{walletDailyLimitsService:p}},__vite__mapDeps([0,1,2])),n=await d.getWalletLimits(r);if(n){const p=a.type==="send",o={updatedAt:(await R(async()=>{const{serverTimestamp:x}=await import("./index-Drf-Kel-.js").then(D=>D.a_);return{serverTimestamp:x}},__vite__mapDeps([1,2]))).serverTimestamp()};p?(o.dailyTransferUsed=Math.max(0,(n.dailyTransferUsed||0)-a.amount),o.monthlyTransferUsed=Math.max(0,(n.monthlyTransferUsed||0)-a.amount)):(o.dailyWithdrawUsed=Math.max(0,(n.dailyWithdrawUsed||0)-a.amount),o.monthlyWithdrawUsed=Math.max(0,(n.monthlyWithdrawUsed||0)-a.amount));const{doc:i,setDoc:h}=await R(async()=>{const{doc:x,setDoc:D}=await import("./index-Drf-Kel-.js").then(j=>j.a_);return{doc:x,setDoc:D}},__vite__mapDeps([1,2])),{db:v}=await R(async()=>{const{db:x}=await import("./index-Drf-Kel-.js").then(D=>D.a$);return{db:x}},__vite__mapDeps([1,2])),O=i(v,"walletLimits",r);await h(O,o,{merge:!0})}}}catch(r){console.warn("فشل استرجاع حدود المحفظة:",r)}try{const{ProfitService:r}=await R(async()=>{const{ProfitService:i}=await import("./profitService-WOL_cZ8K.js");return{ProfitService:i}},__vite__mapDeps([3,4])),{ReportsService:d}=await R(async()=>{const{ReportsService:i}=await import("./reportsService-Bp1Io21u.js");return{ReportsService:i}},[]),p={txnType:a.type==="send"?"send":"receive",amount:a.amount,commission:a.commission||0,createdAt:a.createdAt,status:"confirmed"},o=r.calculateProfitFromTransaction(p);o>0&&r.addProfit(-o,s.uid);try{d.removeTransactionEffects(a,s.uid)}catch{}}catch(r){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",r)}}catch(a){console.error("خطأ أثناء حذف الإيصال:",a)}};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(T,{variant:"ghost",size:"sm",onClick:()=>u("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(Pt,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(gt,{className:"card-modern fade-in-up",children:[t.jsxs(ft,{className:"pb-2 px-3 pt-3",children:[t.jsx(vt,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(Rt,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(yt,{placeholder:"بحث...",value:C,onChange:e=>ne(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>ke(!0),title:"آلة حاسبة",children:t.jsx(Tt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(f){_({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}Ee(!0)},title:"بيانات المبيعات",children:t.jsx(At,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(T,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${k||E?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>Me(!0),title:"اختيار التاريخ",children:[t.jsx(kt,{className:"h-2.5 w-2.5"}),(k||E)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(f){_({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}H(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(mt,{className:"h-2.5 w-2.5"}),le>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:le})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(f){_({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}ie(!0)},title:"الصيانة",children:t.jsx(ut,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{u("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx($t,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(f){_({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}oe(!0)},title:"الفيز الائتمانية",children:t.jsx(ht,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{Q(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(ge,{className:"h-2.5 w-2.5"}),(s==null?void 0:s.uid)&&localStorage.getItem(`recentTransactionsResetAt:${s.uid}`)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(C||k||E)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{ne(""),Pe(""),Re("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(bt,{className:"px-3 pb-3",children:t.jsxs(Ft,{value:N,onValueChange:y,className:"w-full",children:[t.jsxs(Oe,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(z,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(L,{value:"all",className:"mt-2",children:ce.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ce.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>ee(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[F(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-600",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(K,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.type==="withdraw"?"bg-green-100 text-green-800":""}`,children:e.type==="withdraw"?"سحب":X(e.status)})]})]},e.id))})}),t.jsx(L,{value:"send",className:"mt-2",children:M.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:M.filter(e=>e.type==="send").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>ee(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[F(e.status),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(K,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:X(e.status)})]})]},e.id))})}),t.jsx(L,{value:"withdraw",className:"mt-2",children:M.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:M.filter(e=>e.type==="withdraw").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer",onClick:()=>ee(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[F(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),t.jsx(K,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:X(e.status)})]})]},e.id))})}),t.jsx(L,{value:"deleted",className:"mt-2",children:I.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:I.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[F(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[e.amount," جنيه"]}),t.jsx(K,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(T,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>Je(e.id),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(T,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>qe(e.id),children:t.jsx(ge,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Dt,{open:Le,onOpenChange:ie})]}),t.jsx(_t,{isOpen:ze,onClose:()=>oe(!1)}),t.jsx(Ot,{open:q,onOpenChange:H,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{H(!1),$e(!0)}}),t.jsx(It,{open:Ue,onOpenChange:Q,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"لن يتم حذف الإيصالات؛ سنبدأ القائمة من الآن.",onSuccess:()=>{try{s!=null&&s.uid&&(localStorage.setItem(`recentTransactionsResetAt:${s.uid}`,new Date().toISOString()),_({title:"تم التصفير",description:"تم بدء قائمة المعاملات من الآن."}))}catch{}Q(!1)}}),t.jsx(wt,{isOpen:Be,onClose:()=>Z(!1),transaction:Fe,onPrint:()=>window.print(),onDelete:Ze,onComplete:He})]})};export{gs as default};
