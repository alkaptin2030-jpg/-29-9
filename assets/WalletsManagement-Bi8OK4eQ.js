import{c as X,r as j,u as G,d as K,j as e,S as O,a7 as ee,a5 as D,k as R,g as w,t as H,T as Y,v as I,J as C,q as te,f as se,a3 as q,h as re,a as ie,a6 as V}from"./index-D7UOQXxn.js";import{B as U}from"./button-BxS4DIhR.js";import{C as Z,a as ae,b as ne,d as J}from"./card-DR0EcYEA.js";import{B as de}from"./badge-Cji0tDKw.js";import{T as oe,P as $}from"./progress-WJcvWiDw.js";import{I as M}from"./input-DO8Xe5R4.js";import{L as W}from"./label-Inl5Z1bb.js";import{S as ce,a as me,b as le,c as he,d as k}from"./select-BuYFqXCm.js";import{D as ue,a as ge,b as fe,c as xe}from"./dialog-DUwWVFAI.js";import{walletDailyLimitsService as Q}from"./walletDailyLimitsService-DEgHw7v8.js";import{L as ye}from"./dropdown-menu-CIqPwTTt.js";import{S as pe}from"./square-pen-DZJEE_FE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=X("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=X("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);function je({open:i,onOpenChange:a,wallet:t,onSuccess:n}){const[r,d]=j.useState({provider:(t==null?void 0:t.provider)||"",msisdn:(t==null?void 0:t.msisdn)||"",dailyLimit:(t==null?void 0:t.dailyLimit)||0,monthlyLimit:(t==null?void 0:t.monthlyLimit)||0,transferLimit:(t==null?void 0:t.transferLimit)||2e5,withdrawLimit:(t==null?void 0:t.withdrawLimit)||2e5,dailyTransferLimit:(t==null?void 0:t.dailyTransferLimit)||6e4,dailyWithdrawLimit:(t==null?void 0:t.dailyWithdrawLimit)||1e5,monthlyTransferLimit:(t==null?void 0:t.monthlyTransferLimit)||(t==null?void 0:t.transferLimit)||2e5,monthlyWithdrawLimit:(t==null?void 0:t.monthlyWithdrawLimit)||(t==null?void 0:t.withdrawLimit)||2e5,ownerName:(t==null?void 0:t.ownerName)||"",nationalId:(t==null?void 0:t.nationalId)||""}),[h,v]=j.useState(!1),[b,u]=j.useState(null),{user:f,userSubscription:g}=G(),{toast:T}=K();j.useEffect(()=>{i&&t?(d({provider:t.provider||"",msisdn:t.msisdn||"",dailyLimit:t.dailyLimit??0,monthlyLimit:t.monthlyLimit??0,transferLimit:t.transferLimit??2e5,withdrawLimit:t.withdrawLimit??2e5,dailyTransferLimit:t.dailyTransferLimit??6e4,dailyWithdrawLimit:t.dailyWithdrawLimit??1e5,monthlyTransferLimit:t.monthlyTransferLimit??t.transferLimit??2e5,monthlyWithdrawLimit:t.monthlyWithdrawLimit??t.withdrawLimit??2e5,ownerName:t.ownerName||"",nationalId:t.nationalId||""}),u(null)):i&&!t&&(d({provider:"",msisdn:"",dailyLimit:0,monthlyLimit:0,transferLimit:2e5,withdrawLimit:2e5,dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,ownerName:"",nationalId:""}),u(null))},[t,i]);const E=(o,L)=>{const c=o.slice(0,3);return L==="vodafone_cash"&&c==="010"||L==="orange_cash"&&c==="012"||L==="etisalat_cash"&&c==="011"||L==="instapay"&&c==="015"},p=o=>{switch(o){case"INVALID_MSISDN":return"رقم المحفظة غير صالح.";case"PROVIDER_MISMATCH":return"المزوّد لا يطابق مقدمة الرقم.";case"ALREADY_EXISTS":return"المحفظة مضافة قبل كده.";case"RLS_DENIED":return"ليست لديك صلاحية لإضافة المحفظة.";default:return"خطأ غير متوقع."}},S=async o=>{var L;if(o.preventDefault(),u(null),!/^01\d{9}$/.test(r.msisdn)){u("اكتب رقم 11 رقم يبدأ بـ 01.");return}if(!E(r.msisdn,r.provider)){u("مقدم الخدمة لا يتطابق مع مقدمة الرقم.");return}if(!(t!=null&&t.id)&&(f!=null&&f.uid))try{let c=!1;const x=((L=g==null?void 0:g.subscription)==null?void 0:L.planType)??(g==null?void 0:g.planType)??null,_=typeof x=="string"?x.toLowerCase():null;if(x===O.ZERO||_==="zero"||x===0||_==="0")c=!0;else{const N=await ee(f.uid),F=(N==null?void 0:N.planType)??(N==null?void 0:N.plan)??null,P=typeof F=="string"?F.toLowerCase():null;c=F===O.ZERO||P==="zero"||F===0||P==="0"}if(c&&(await D.getByMerchantId(f.uid)).length>=5){u("باقة زيرو تسمح بإضافة 5 محافظ فقط. قم بالترقية."),T({title:"تحذير",description:"لا يمكنك إضافة أكثر من 5 محافظ في باقة زيرو. قم بالترقية.",variant:"destructive"});return}}catch(c){console.warn("Zero plan limit check failed:",c)}v(!0);try{const c={...r,merchantUserId:f==null?void 0:f.uid,isActive:!0,provider:r.provider};if(console.log("Saving wallet data:",c),t!=null&&t.id)await D.update(t.id,c),await Q.setLimits(t.id,{dailyTransferLimit:r.dailyTransferLimit,dailyWithdrawLimit:r.dailyWithdrawLimit,monthlyTransferLimit:r.monthlyTransferLimit??r.transferLimit,monthlyWithdrawLimit:r.monthlyWithdrawLimit??r.withdrawLimit}),console.log("Wallet updated successfully"),n();else{console.log("Creating new wallet...");const x=await D.create(c);console.log("Wallet created with ID:",x),await Q.setLimits(x,{dailyTransferLimit:r.dailyTransferLimit,dailyWithdrawLimit:r.dailyWithdrawLimit,monthlyTransferLimit:r.monthlyTransferLimit??r.transferLimit,monthlyWithdrawLimit:r.monthlyWithdrawLimit??r.withdrawLimit});const _={id:x,...c,dailyUsage:0,monthlyUsage:0};console.log("Final wallet object:",_),n(_)}T({title:"تم إضافة المحفظة",description:`تم ${t!=null&&t.id?"تحديث":"إضافة"} المحفظة بنجاح`}),a(!1)}catch(c){console.error("Error saving wallet:",c);let x="حصل خطأ أثناء الإضافة";c.code?x=p(c.code):c.message&&(x=c.message),T({title:"خطأ",description:x,variant:"destructive"})}finally{v(!1)}};return e.jsx(ue,{open:i,onOpenChange:a,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(fe,{children:e.jsx(xe,{children:t!=null&&t.id?"تعديل المحفظة":"إضافة محفظة جديدة"})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"provider",children:"المزود"}),e.jsxs(ce,{value:r.provider,onValueChange:o=>d({...r,provider:o}),disabled:h,children:[e.jsx(me,{children:e.jsx(le,{placeholder:"اختر المزود"})}),e.jsxs(he,{children:[e.jsx(k,{value:"vodafone_cash",children:"Vodafone Cash"}),e.jsx(k,{value:"etisalat_cash",children:"Etisalat Cash"}),e.jsx(k,{value:"orange_cash",children:"Orange Cash"}),e.jsx(k,{value:"instapay",children:"InstaPay"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"msisdn",children:"رقم الهاتف"}),e.jsx(M,{id:"msisdn",placeholder:"01xxxxxxxxx",value:r.msisdn,onChange:o=>d({...r,msisdn:o.target.value}),disabled:h,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"ownerName",children:"اسم صاحب المحفظة (اختياري)"}),e.jsx(M,{id:"ownerName",type:"text",value:r.ownerName,onChange:o=>d({...r,ownerName:o.target.value}),disabled:h,placeholder:"اكتب اسم صاحب المحفظة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"nationalId",children:"الرقم القومي (اختياري)"}),e.jsx(M,{id:"nationalId",type:"text",value:r.nationalId,onChange:o=>d({...r,nationalId:o.target.value}),disabled:h,placeholder:"الرقم القومي"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"dailyWithdrawLimit",children:"حد السحب اليومي (ج.م)"}),e.jsx(M,{id:"dailyWithdrawLimit",type:"number",min:"0",step:"0.01",value:r.dailyWithdrawLimit,onChange:o=>d({...r,dailyWithdrawLimit:parseFloat(o.target.value)||0}),disabled:h,placeholder:"100000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"dailyTransferLimit",children:"حد التحويل اليومي (ج.م)"}),e.jsx(M,{id:"dailyTransferLimit",type:"number",min:"0",step:"0.01",value:r.dailyTransferLimit,onChange:o=>d({...r,dailyTransferLimit:parseFloat(o.target.value)||0}),disabled:h,placeholder:"60000"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"monthlyWithdrawLimit",children:"حد السحب الشهري (ج.م)"}),e.jsx(M,{id:"monthlyWithdrawLimit",type:"number",min:"0",step:"0.01",value:r.monthlyWithdrawLimit,onChange:o=>d({...r,monthlyWithdrawLimit:parseFloat(o.target.value)||2e5}),disabled:h,placeholder:"200000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"monthlyTransferLimit",children:"حد التحويل الشهري (ج.م)"}),e.jsx(M,{id:"monthlyTransferLimit",type:"number",min:"0",step:"0.01",value:r.monthlyTransferLimit,onChange:o=>d({...r,monthlyTransferLimit:parseFloat(o.target.value)||2e5}),disabled:h,placeholder:"200000"})]})]}),b&&e.jsx("div",{className:"text-red-600 text-sm mt-2",children:b}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:h,children:"إلغاء"}),e.jsx(U,{type:"submit",disabled:h,className:"btn-primary",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"mr-2 h-4 w-4 animate-spin"}),"جارِ الإضافة…"]}):t!=null&&t.id?"تحديث المحفظة":"إضافة المحفظة"})]})]})]})})}const be={getCurrentMonthId(){const i=new Date;return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`},async getWalletUsage(i){try{const a=this.getCurrentMonthId(),t=R(w,"users",i,"limits",a),n=await H(t);if(n.exists()){const d=n.data();return{walletId:i,used_transfer:d.used_transfer||0,used_withdraw:d.used_withdraw||0,monthly_limit:d.monthly_limit||2e5,last_reset:d.last_reset||null,updatedAt:d.updatedAt||Y.now()}}const r={walletId:i,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:Y.now()};return await I(t,{used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:C()}),r}catch(a){return console.error("Error getting wallet usage:",a),null}},shouldResetLimits(i){const a=new Date,t=a.getDate();if(!i)return!0;if(t===1){const n=i.toDate(),r=a.getMonth(),d=a.getFullYear();return n.getMonth()!==r||n.getFullYear()!==d}return!1},async autoResetLimitsIfNeeded(i){try{const a=await this.getWalletUsage(i);return a&&this.shouldResetLimits(a.last_reset)?(console.log(`🔄 تصفير تلقائي للحدود للمحفظة ${i} - اليوم الأول من الشهر`),await this.resetWalletUsage(i)):!1}catch(a){return console.error("خطأ في التصفير التلقائي للحدود:",a),!1}},async resetWalletUsage(i){try{const a=this.getCurrentMonthId(),t=R(w,"users",i,"limits",a);return await I(t,{used_transfer:0,used_withdraw:0,last_reset:C(),updatedAt:C()},{merge:!0}),console.log(`🔄 تم تصفير استخدام المحفظة ${i} بنجاح`),!0}catch(a){return console.error("خطأ في تصفير استخدام المحفظة:",a),!1}},async calculateUsageFromTransactions(i){var a;try{const t=this.getCurrentMonthId(),n=R(w,"users",i,"limits",t),r=await H(n),d=r.exists()?(a=r.data())==null?void 0:a.last_reset:null,h=te(se(w,"tx"),q("uid","==",i),...d?[q("createdAt",">=",d)]:[]),v=await re(h);let b=0,u=0;return v.forEach(f=>{const g=f.data();g.status==="completed"&&(g.type==="transfer"?b+=g.amount:g.type==="withdraw"&&(u+=g.amount))}),{used_transfer:b,used_withdraw:u}}catch(t){return console.error("خطأ في حساب الاستخدام من المعاملات:",t),{used_transfer:0,used_withdraw:0}}},async getWalletUsageWithRefresh(i){try{const a=await this.getWalletUsage(i);if(!a)return null;const t=await this.calculateUsageFromTransactions(i);if(a.used_transfer!==t.used_transfer||a.used_withdraw!==t.used_withdraw){const n=this.getCurrentMonthId(),r=R(w,"users",i,"limits",n);return await I(r,{used_transfer:t.used_transfer,used_withdraw:t.used_withdraw,updatedAt:C()},{merge:!0}),await this.getWalletUsage(i)}return a}catch(a){return console.error("خطأ في الحصول على الاستخدام مع التحديث:",a),null}},calculateRemaining(i){return{remainingTransfer:Math.max(0,i.monthly_limit-i.used_transfer),remainingWithdraw:Math.max(0,i.monthly_limit-i.used_withdraw)}},async canPerformOperation(i,a,t){try{const n=await this.getWalletUsageWithRefresh(i);if(!n)return{canPerform:!1,message:"لا يمكن العثور على بيانات الاستخدام للمحفظة"};const r=this.calculateRemaining(n);return t==="transfer"&&a>r.remainingTransfer?{canPerform:!1,message:`تجاوز حد التحويل المسموح. المتبقي: ${r.remainingTransfer.toLocaleString()} ج.م من أصل ${n.monthly_limit.toLocaleString()} ج.م`,remaining:r.remainingTransfer}:t==="withdraw"&&a>r.remainingWithdraw?{canPerform:!1,message:`تجاوز حد السحب المسموح. المتبقي: ${r.remainingWithdraw.toLocaleString()} ج.م من أصل ${n.monthly_limit.toLocaleString()} ج.م`,remaining:r.remainingWithdraw}:{canPerform:!0}}catch(n){return console.error("Error checking operation limits:",n),{canPerform:!1,message:"خطأ في التحقق من الحدود"}}},async updateUsage(i,a,t){try{const n=await this.getWalletUsageWithRefresh(i);if(!n)throw new Error("لا يمكن العثور على بيانات الاستخدام للمحفظة");const r=await this.canPerformOperation(i,a,t);if(!r.canPerform)throw new Error(r.message||"لا يمكن إجراء العملية");const d=t==="transfer"?n.used_transfer+a:n.used_transfer,h=t==="withdraw"?n.used_withdraw+a:n.used_withdraw,v=this.getCurrentMonthId(),b=R(w,"users",n.walletId,"limits",v);await I(b,{used_transfer:d,used_withdraw:h,updatedAt:C()},{merge:!0});const u=await this.getWalletUsageWithRefresh(i);if(!u)throw new Error("فشل في قراءة البيانات المحدثة");return u}catch(n){throw console.error("Error updating wallet usage:",n),n}},async resetWalletUsageManually(i){try{const a=this.getCurrentMonthId(),t=R(w,"users",i,"limits",a),n={walletId:i,used_transfer:0,used_withdraw:0,monthly_limit:0,last_reset:null,updatedAt:new Date};return I(t,{used_transfer:0,used_withdraw:0,last_reset:C(),updatedAt:C()},{merge:!0}).catch(r=>{console.error("خطأ في حفظ تصفير الاستخدام في Firebase:",r)}),console.log(`✅ تم تصفير استخدام المحفظة ${i} بنجاح`),n}catch(a){throw console.error("Error resetting wallet usage:",a),a}},async getAllWalletsUsage(i){try{const t=(await D.getByMerchantId(i)).map(r=>this.getWalletUsageWithRefresh(r.id));return(await Promise.all(t)).filter(r=>r!==null)}catch(a){return console.error("Error getting all wallets usage:",a),[]}}};function Re({showAddButton:i=!0,showUsageBars:a=!0,showLimitCards:t=!0,showEditButton:n=!0}){const[r,d]=j.useState([]),[h,v]=j.useState(!0),[b,u]=j.useState(!1),[f,g]=j.useState(null),[T,E]=j.useState(i),{user:p}=G(),{toast:S}=K(),o=ie();j.useEffect(()=>{p!=null&&p.uid&&L()},[p==null?void 0:p.uid]);const L=async()=>{try{if(!(p!=null&&p.uid)){d([]),v(!1);return}v(!0);const s=await D.getByMerchantId(p.uid),y=await Promise.all(s.map(async m=>{try{const l=await be.getUsage(m.id);return{...m,dailyUsage:m.dailyUsage||0,monthlyUsage:m.monthlyUsage||0,transferUsage:(l==null?void 0:l.transferUsage)||0,withdrawUsage:(l==null?void 0:l.withdrawUsage)||0}}catch(l){return console.error(`Error loading usage for wallet ${m.id}:`,l),{...m,dailyUsage:m.dailyUsage||0,monthlyUsage:m.monthlyUsage||0,transferUsage:0,withdrawUsage:0}}}));d(y)}catch(s){console.error("Error fetching wallets from Firebase:",s),S({title:"خطأ",description:"فشل في تحميل المحافظ من الخادم. يرجى المحاولة مرة أخرى.",variant:"destructive"}),d([])}finally{v(!1)}},c=async(s,y)=>{try{await D.update(s,{isActive:!y});const m=r.map(l=>l.id===s?{...l,isActive:!l.isActive}:l);d(m),S({title:"تم التحديث",description:`تم ${y?"إلغاء تفعيل":"تفعيل"} المحفظة بنجاح`})}catch(m){console.error("Error toggling wallet status:",m),S({title:"خطأ",description:"فشل في تحديث حالة المحفظة",variant:"destructive"})}},x=async(s,y)=>{if(window.confirm(`هل أنت متأكد من حذف المحفظة ${y}؟

هذا الإجراء لا يمكن التراجع عنه.`))try{await D.delete(s);const l=r.filter(A=>A.id!==s);d(l),S({title:"تم الحذف",description:"تم حذف المحفظة بنجاح"})}catch(l){console.error("Error deleting wallet:",l),S({title:"خطأ",description:"فشل في حذف المحفظة",variant:"destructive"})}},_=(s,y)=>{if(y===0)return"bg-muted";const m=s/y*100;return m>=100?"bg-destructive":m>=80?"bg-warning":"bg-success"},N=s=>{switch(s){case"vodafone_cash":return"bg-red-600";case"etisalat_cash":return"bg-green-600";case"orange_cash":return"bg-orange-600";case"instapay":return"bg-blue-600";default:return"bg-gray-600"}},F=s=>{switch(s){case"vodafone_cash":return"#dc2626";case"etisalat_cash":return"#16a34a";case"orange_cash":return"#ea580c";case"instapay":return"#2563eb";default:return"#6b7280"}},P=s=>{switch(s){case"vodafone_cash":return"فودافون كاش";case"etisalat_cash":return"اتصالات كاش";case"orange_cash":return"أورانج كاش";case"instapay":return"إنستاباي";default:return s.replace("_"," ")}};return h?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"جاري تحميل المحافظ..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"محافظي"}),e.jsxs(U,{variant:"outline",size:"sm",onClick:L,disabled:h,className:"flex items-center gap-2",children:[e.jsx("svg",{className:`w-4 h-4 ${h?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"تحديث"]})]}),i&&T&&e.jsxs(U,{onClick:()=>{u(!0),E(!1)},className:"btn-primary",children:[e.jsx(V,{className:"ml-2 h-4 w-4"}),"إضافة محفظة جديدة"]})]}),e.jsxs("div",{className:"grid gap-6",children:[r.map(s=>{var y,m,l,A,z,B;return e.jsxs(Z,{className:"card-glass hover:shadow-lg transition-all duration-300 border-l-4",style:{borderLeftColor:F(s.provider)},children:[e.jsx(ae,{className:"pb-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:`${N(s.provider)} text-white font-medium px-3 py-1`,children:P(s.provider)}),e.jsx("div",{className:`w-3 h-3 rounded-full ${s.isActive?"bg-green-500":"bg-gray-400"}`,title:s.isActive?"نشط":"غير نشط"})]}),e.jsx(ne,{className:"text-xl font-bold text-primary",children:s.msisdn}),s.label&&e.jsxs("span",{className:"text-sm text-muted-foreground font-medium",children:["(",s.label,")"]})]})}),e.jsxs("div",{className:"flex items-center gap-2 bg-muted/50 rounded-lg p-2",children:[n&&e.jsx(U,{variant:"ghost",size:"sm",onClick:()=>{o(`/user/add-wallet?edit=1&id=${s.id}`)},children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:()=>c(s.id,s.isActive),children:s.isActive?e.jsx(ve,{className:"h-5 w-5 text-success"}):e.jsx(Le,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:()=>x(s.id,s.msisdn),className:"text-destructive hover:text-destructive",children:e.jsx(oe,{className:"h-4 w-4"})})]})]})}),e.jsx(J,{className:"pt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-3 rounded-md border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium mb-2 text-center",children:["الحدود الشهرية: ",s.provider," - ",s.msisdn]}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-2 transition-all duration-200 ease-out",style:{width:`${s.withdrawLimit?Math.min((s.withdrawUsage||0)/s.withdrawLimit*100,100):0}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-2 transition-all duration-200 ease-out",style:{width:`${s.transferLimit?Math.min((s.transferUsage||0)/s.transferLimit*100,100):0}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",Math.max((s.withdrawLimit||0)-(s.withdrawUsage||0),0).toLocaleString()," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",Math.max((s.transferLimit||0)-(s.transferUsage||0),0).toLocaleString()," جنيه"]})]})]}),a&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الاستخدام اليومي"}),e.jsxs("span",{className:"font-bold",children:[(y=s.dailyUsage)==null?void 0:y.toLocaleString()," / ",s.dailyLimit>0?s.dailyLimit.toLocaleString():"∞"," جنيه"]})]}),e.jsx($,{value:s.dailyLimit>0?Math.min((s.dailyUsage||0)/s.dailyLimit*100,100):0,className:`h-3 ${_(s.dailyUsage||0,s.dailyLimit)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-right",children:[s.dailyLimit>0?((s.dailyUsage||0)/s.dailyLimit*100).toFixed(1):0,"% مستخدم"]})]}),a&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الاستخدام الشهري"}),e.jsxs("span",{className:"font-bold",children:[(m=s.monthlyUsage)==null?void 0:m.toLocaleString()," / ",s.monthlyLimit>0?s.monthlyLimit.toLocaleString():"∞"," جنيه"]})]}),e.jsx($,{value:s.monthlyLimit>0?Math.min((s.monthlyUsage||0)/s.monthlyLimit*100,100):0,className:`h-3 ${_(s.monthlyUsage||0,s.monthlyLimit)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-right",children:[s.monthlyLimit>0?((s.monthlyUsage||0)/s.monthlyLimit*100).toFixed(1):0,"% مستخدم"]})]}),t&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"حد التحويل"}),e.jsxs("span",{className:"font-bold text-blue-900",children:[((l=s.transferUsage)==null?void 0:l.toLocaleString())||0," / ",((A=s.transferLimit)==null?void 0:A.toLocaleString())||2e5," جنيه"]})]}),e.jsx($,{value:s.transferLimit?Math.min((s.transferUsage||0)/s.transferLimit*100,100):0,className:"h-3 bg-blue-100"}),e.jsxs("div",{className:"text-xs text-blue-600 mt-1 text-right",children:[s.transferLimit?((s.transferUsage||0)/s.transferLimit*100).toFixed(1):0,"% مستخدم"]}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1 text-right font-medium",children:["المتبقي: ",Math.max((s.transferLimit||0)-(s.transferUsage||0),0).toLocaleString()," جنيه"]})]}),t&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-green-700",children:"حد السحب"}),e.jsxs("span",{className:"font-bold text-green-900",children:[((z=s.withdrawUsage)==null?void 0:z.toLocaleString())||0," / ",((B=s.withdrawLimit)==null?void 0:B.toLocaleString())||2e5," جنيه"]})]}),e.jsx($,{value:s.withdrawLimit?Math.min((s.withdrawUsage||0)/s.withdrawLimit*100,100):0,className:"h-3 bg-green-100"}),e.jsxs("div",{className:"text-xs text-green-600 mt-1 text-right",children:[s.withdrawLimit?((s.withdrawUsage||0)/s.withdrawLimit*100).toFixed(1):0,"% مستخدم"]}),e.jsxs("div",{className:"text-xs text-green-700 mt-1 text-right font-medium",children:["المتبقي: ",Math.max((s.withdrawLimit||0)-(s.withdrawUsage||0),0).toLocaleString()," جنيه"]})]})]})})]},s.id)}),r.length===0&&i&&T&&e.jsx(Z,{className:"card-glass",children:e.jsxs(J,{className:"text-center py-16",children:[e.jsx("div",{className:"bg-muted/30 rounded-full w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx(V,{className:"w-12 h-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"لا توجد محافظ"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"ابدأ بإضافة محفظتك الأولى لتتمكن من استقبال المدفوعات من عملائك"}),i&&T&&e.jsxs(U,{onClick:()=>{u(!0),E(!1)},size:"lg",className:"btn-primary px-8",children:[e.jsx(V,{className:"w-5 h-5 ml-2"}),"إضافة محفظة جديدة"]})]})})]}),e.jsx(je,{open:b,onOpenChange:s=>{u(s),s||(g(null),E(!0))},wallet:f,onSuccess:s=>{console.log("onSuccess called with:",s),console.log("editingWallet:",f),s&&!f?(console.log("Adding new wallet to list"),d(y=>{const m=[...y,s];return console.log("Updated wallets list:",m),m})):(console.log("Refreshing wallets from Firebase"),L()),u(!1),g(null),E(!0)}})]})}export{Re as W,be as w};
