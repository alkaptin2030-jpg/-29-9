const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Drf-Kel-.js","assets/index-CUGoRur3.css"])))=>i.map(i=>d[i]);
var Cs=Object.defineProperty;var ks=(t,s,r)=>s in t?Cs(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var Et=(t,s,r)=>ks(t,typeof s!="symbol"?s+"":s,r);import{c as se,r as b,j as e,v as Ss,d as Ds,M as le,S,a2 as H,k as L,a0 as ee,a1 as Y,aq as oe,X as Te,C as de,aE as Oe,aF as As,Y as Us,aG as Ms,aH as Is,aI as Rt,aJ as Ls,aK as Os,aL as Ps,aM as Ee,aN as Fs,aO as Bs,aP as $s,aQ as Vt,aR as Vs,aS as Hs,aT as qs,J,a3 as Ye,i as W,p as Se,W as ae,aU as ie,al as Ct,o as Je,_ as De,U as zs,ah as Ys,l as Gs,aV as Ws,h as Ks,f as Xs,q as Qs,ao as Zs,a as Js,u as er,g as tr}from"./index-Drf-Kel-.js";import{P as sr}from"./ProfileIcon-Br7HbrJq.js";import{C as Me,a as Ge,b as We,d as Ie,c as rr}from"./card-B-oThBGQ.js";import{B as K}from"./button-BeXYwqdJ.js";import{I as nr}from"./input-BS89kG9l.js";import{L as kt}from"./label-LMuypoA6.js";import{a as ar,S as Ht}from"./switch-BhAE_GVq.js";import{A as ir,a as lr}from"./alert-B54fBivj.js";import{B as Pe}from"./badge-UZez9OVE.js";import{a as or,S as Ke,P as cr}from"./separator-DRqor3jV.js";import{u as dr,c as ur,v as mr}from"./whatsappService-DtyodpOH.js";import{R as Xe}from"./refresh-cw-CTl5kzEl.js";import{C as hr}from"./circle-alert-QaHEPkjm.js";import{P as xr}from"./phone-CCrFfxFB.js";import{E as gr,a as fr}from"./eye-DCMRqakt.js";import{C as pr}from"./copy-mwWONQ1Q.js";import{E as br,p as yr}from"./broadcastService-xL5_ZkOC.js";import{B as pe,A as St}from"./bell-DHsYGnX_.js";import{U as Fe}from"./user-8v5sbkXa.js";import{C as te}from"./calendar-DYQ_aN-h.js";import{S as Nr,a as jr,b as wr,c as vr,d as we}from"./select-D1NXV2xv.js";import{M as _r}from"./mail-CQN18-MA.js";import{L as Dt}from"./lock-D5jTNF9R.js";import{Z as et}from"./zap-CIUdciaY.js";import{G as fe}from"./gift-cQxml-yP.js";import{C as Le}from"./crown-WEz5lrpW.js";import{L as At}from"./dropdown-menu-C--56y90.js";import{U as tt}from"./users-mW31o2fM.js";import{C as st}from"./circle-check-big-Byeak2Hh.js";import{S as Tr}from"./shield-DmIh40Jt.js";import{g as Ut,l as Er,s as Rr}from"./contentService-AbuRzqPI.js";import"./dialog-BnpzTiyj.js";import"./Combination-CwHaGt6n.js";import"./MasterPinDialog-RsfCUjbM.js";import"./avatars-IzZoD8tB.js";import"./key-round-C4s0TQ3W.js";import"./index-D3Q9cnmm.js";import"./index-CexbHjis.js";import"./check-Cq7Xk3YP.js";import"./index-BoPwWMJr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=se("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=se("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=se("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=se("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=se("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=se("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=se("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=se("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=se("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),qt=b.forwardRef(({className:t,...s},r)=>e.jsx("textarea",{className:Ss("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...s}));qt.displayName="Textarea";const Lr=()=>{const{settings:t,loading:s,error:r,updateSettings:n,refreshSettings:i}=dr(),{toast:o}=Ds(),[l,u]=b.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[d,g]=b.useState(!1),[h,j]=b.useState(!1),[m,w]=b.useState(""),[y,f]=b.useState({});b.useEffect(()=>{t&&u({phoneNumber:t.phoneNumber,defaultMessage:t.defaultMessage,isEnabled:t.isEnabled})},[t]);const C=()=>{var I,x;const k={};return(I=l.phoneNumber)!=null&&I.trim()?mr(l.phoneNumber)||(k.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):k.phoneNumber="رقم الواتساب مطلوب",(x=l.defaultMessage)!=null&&x.trim()?l.defaultMessage.length<10&&(k.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):k.defaultMessage="الرسالة الافتراضية مطلوبة",f(k),Object.keys(k).length===0},U=async()=>{if(!C()){o({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}g(!0);try{if(await n(l))o({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{o({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{g(!1)}},v=()=>{if(l.phoneNumber&&l.defaultMessage)try{const k=ur(l.phoneNumber,l.defaultMessage);w(k),j(!0)}catch{o({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},A=async()=>{try{await navigator.clipboard.writeText(m),o({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{o({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},M=k=>{const I=k.replace(/[^\d+]/g,"");u(x=>({...x,phoneNumber:I})),y.phoneNumber&&f(x=>({...x,phoneNumber:""}))};return s?e.jsxs(Me,{children:[e.jsx(Ge,{children:e.jsxs(We,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Ie,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Xe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Me,{children:[e.jsxs(Ge,{children:[e.jsxs(We,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(rr,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Ie,{className:"space-y-6",children:[r&&e.jsxs(ir,{variant:"destructive",children:[e.jsx(hr,{className:"h-4 w-4"}),e.jsx(lr,{children:r})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${l.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(ar,{checked:l.isEnabled,onCheckedChange:k=>u(I=>({...I,isEnabled:k}))})]}),e.jsx(or,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(kt,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(nr,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:l.phoneNumber,onChange:k=>M(k.target.value),className:y.phoneNumber?"border-red-500":"",dir:"ltr"}),y.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:y.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(kt,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(qt,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:l.defaultMessage,onChange:k=>{u(I=>({...I,defaultMessage:k.target.value})),y.defaultMessage&&f(I=>({...I,defaultMessage:""}))},className:y.defaultMessage?"border-red-500":"",rows:4}),y.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:y.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(K,{onClick:U,disabled:d,className:"flex items-center gap-2",children:[d?e.jsx(Xe,{className:"h-4 w-4 animate-spin"}):e.jsx(Ht,{className:"h-4 w-4"}),d?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(K,{variant:"outline",onClick:v,disabled:!l.phoneNumber||!l.defaultMessage,className:"flex items-center gap-2",children:[h?e.jsx(gr,{className:"h-4 w-4"}):e.jsx(fr,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(K,{variant:"outline",onClick:i,className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"تحديث"]})]}),h&&m&&e.jsxs(Me,{className:"bg-muted/50",children:[e.jsx(Ge,{children:e.jsx(We,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Ie,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:m}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{variant:"outline",size:"sm",onClick:A,className:"flex items-center gap-2",children:[e.jsx(pr,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>window.open(m,"_blank"),className:"flex items-center gap-2",children:[e.jsx(br,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),t&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(Pe,{variant:"outline",className:"mr-2",children:[t.lastUpdated.toLocaleDateString("ar-EG")," - ",t.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(Pe,{variant:t.isEnabled?"default":"secondary",className:"mr-2",children:t.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Be={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},Or=t=>{const s=new Date,n=new Date(t).getTime()-s.getTime();return Math.ceil(n/(1e3*60*60*24))},Pr=(t,s=Be)=>t<0?"expired":t<=s.criticalDays?"critical":t<=s.warningDays?"warning":(t<=s.infoDays,"info"),Fr=(t,s,r)=>{const n=Br(r);return s<0?`انتهت صلاحية اشتراك ${n} للمستخدم ${t}`:s===0?`ينتهي اشتراك ${n} للمستخدم ${t} اليوم!`:s===1?`ينتهي اشتراك ${n} للمستخدم ${t} غداً`:`ينتهي اشتراك ${n} للمستخدم ${t} خلال ${s} أيام`},Br=t=>{switch(t){case S.MONTHLY:return"الشهري";case S.YEARLY:return"السنوي";case S.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},$r=async()=>{try{const t=H(L,"users"),s=ee(t,Y("subscription","!=",null)),r=await oe(s),n=[];return r.forEach(i=>{var l,u,d,g;const o=i.data();o.subscription&&(o.subscription.planType||o.subscription.plan)&&n.push({id:i.id,...o,subscription:{...o.subscription,startDate:((u=(l=o.subscription.startDate)==null?void 0:l.toDate)==null?void 0:u.call(l))||new Date(o.subscription.startDate),endDate:((g=(d=o.subscription.endDate)==null?void 0:d.toDate)==null?void 0:g.call(d))||new Date(o.subscription.endDate),planType:o.subscription.planType||o.subscription.plan}})}),n}catch(t){return console.error("خطأ في جلب الاشتراكات النشطة:",t),[]}},Vr=async(t=Be)=>{try{const s=await $r(),r=[];return s.forEach(n=>{if(!n.subscription||!n.subscription.endDate)return;const i=Or(n.subscription.endDate),o=Pr(i,t);if(i<=t.infoDays||i<0){const l={id:`${n.id}_${Date.now()}`,userId:n.id,userName:n.displayName||n.email||"مستخدم غير معروف",userEmail:n.email||"",subscriptionPlan:n.subscription.planType,expiryDate:n.subscription.endDate,daysRemaining:i,type:o,message:Fr(n.displayName||n.email||"مستخدم غير معروف",i,n.subscription.planType),isRead:!1,createdAt:new Date};r.push(l)}}),r.sort((n,i)=>{const o={expired:0,critical:1,warning:2,info:3};return o[n.type]!==o[i.type]?o[n.type]-o[i.type]:n.daysRemaining-i.daysRemaining}),r}catch(s){return console.error("خطأ في إنشاء إشعارات الاشتراك:",s),[]}},Hr=(t,s)=>s?t.filter(r=>r.type===s):t,qr=t=>{localStorage.setItem("notificationSettings",JSON.stringify(t))},zr=()=>{try{const t=localStorage.getItem("notificationSettings");if(t)return{...Be,...JSON.parse(t)}}catch(t){console.error("خطأ في تحميل إعدادات الإشعارات:",t)}return Be},Yr=({isOpen:t,onClose:s})=>{const[r,n]=b.useState([]),[i,o]=b.useState([]),[l,u]=b.useState("all"),[d,g]=b.useState(!0),[h,j]=b.useState(zr());b.useEffect(()=>{t&&m()},[t]),b.useEffect(()=>{o(l==="all"?r:Hr(r,l))},[r,l]);const m=async()=>{g(!0);try{const v=await Vr(h);n(v)}catch(v){console.error("خطأ في تحميل الإشعارات:",v)}finally{g(!1)}},w=v=>{switch(v){case"urgent":return e.jsx(Oe,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(de,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(pe,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(pe,{className:"w-5 h-5 text-gray-500"})}},y=v=>{switch(v){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},f=v=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(v),C=v=>{switch(v){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},U=v=>{const A={...h,[v]:!h[v]};j(A),qr(A)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),r.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:r.length})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kr,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(v=>e.jsx("button",{onClick:()=>u(v),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${l===v?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:C(v)},v))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.visualAlerts,onChange:()=>U("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.soundAlerts,onChange:()=>U("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.autoRefresh,onChange:()=>U("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:d?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):i.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(pe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:l==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${C(l)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:i.map(v=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${y(v.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[w(v.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:v.message}),e.jsx("span",{className:"text-xs text-gray-500",children:f(v.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",v.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",f(v.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",v.daysRemaining]})]})]})]})]})},v.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",f(new Date)]}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},Gr=({notification:t,onClose:s,soundEnabled:r,onToggleSound:n})=>{const[i,o]=b.useState(!1),[l,u]=b.useState(null);b.useEffect(()=>{if(t&&(o(!0),r&&d(t.type),t.type!=="urgent")){const w=setTimeout(()=>{g()},1e4);return()=>clearTimeout(w)}},[t,r]),b.useEffect(()=>{typeof window<"u"&&window.AudioContext&&u(new AudioContext)},[]);const d=w=>{if(!(!l||!r))try{const y=l.createOscillator(),f=l.createGain();switch(y.connect(f),f.connect(l.destination),w){case"urgent":y.frequency.setValueAtTime(800,l.currentTime),y.frequency.setValueAtTime(1e3,l.currentTime+.1),y.frequency.setValueAtTime(800,l.currentTime+.2),f.gain.setValueAtTime(.3,l.currentTime),f.gain.exponentialRampToValueAtTime(.01,l.currentTime+.5),y.start(l.currentTime),y.stop(l.currentTime+.5);break;case"warning":y.frequency.setValueAtTime(600,l.currentTime),y.frequency.setValueAtTime(700,l.currentTime+.15),f.gain.setValueAtTime(.2,l.currentTime),f.gain.exponentialRampToValueAtTime(.01,l.currentTime+.3),y.start(l.currentTime),y.stop(l.currentTime+.3);break;case"info":y.frequency.setValueAtTime(400,l.currentTime),f.gain.setValueAtTime(.1,l.currentTime),f.gain.exponentialRampToValueAtTime(.01,l.currentTime+.2),y.start(l.currentTime),y.stop(l.currentTime+.2);break}}catch(y){console.error("خطأ في تشغيل الصوت:",y)}},g=()=>{o(!1),setTimeout(()=>{s()},300)},h=w=>{switch(w){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Oe,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(de,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(pe,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(pe,{className:"w-6 h-6"}),pulse:""}}},j=w=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(w);if(!t)return null;const m=h(t.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${i?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${m.bg} ${m.border} ${m.text} ${m.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[t.type==="urgent"&&"تنبيه عاجل!",t.type==="warning"&&"تحذير",t.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:n,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:r?"إيقاف الصوت":"تشغيل الصوت",children:r?e.jsx(Mr,{className:"w-4 h-4"}):e.jsx(Ir,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(Te,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:t.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",t.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",j(t.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",t.daysRemaining," يوم"]})]})]}),t.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Wr=({user:t,onActivateSubscription:s,onDeactivateSubscription:r,onDeleteUser:n})=>{const[i,o]=b.useState(S.MONTHLY),[l,u]=b.useState(!1),d=As(),g=m=>{switch(m){case S.LIFETIME:return e.jsx(Le,{className:"w-4 h-4 text-yellow-500"});case S.YEARLY:return e.jsx(fe,{className:"w-4 h-4 text-blue-500"});case S.QUARTERLY:return e.jsx(te,{className:"w-4 h-4 text-purple-500"});case S.MONTHLY:return e.jsx(et,{className:"w-4 h-4 text-green-500"});case S.ZERO:return e.jsx(Dt,{className:"w-4 h-4 text-gray-500"});default:return null}},h=m=>{switch(m){case S.MONTHLY:return"شهرية";case S.QUARTERLY:return"ربع سنوية";case S.YEARLY:return"سنوية";case S.LIFETIME:return"مدى الحياة";case S.ZERO:return"زيرو";default:return"غير محدد"}},j=m=>m?(m.toDate?m.toDate():new Date(m)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(Me,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Ie,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.fullName||"غير محدد"}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(_r,{className:"w-3 h-3 ml-1"}),t.email]})]})]}),e.jsx(Pe,{variant:t.isActive?"default":"secondary",children:t.isActive?"نشط":"غير نشط"})]}),t.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[g(t.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:h(t.subscription.planType)})]}),e.jsx(Pe,{variant:t.subscription.isActive?"default":"destructive",children:t.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(te,{className:"w-3 h-3 ml-1"}),"البداية: ",j(t.subscription.startDate)]}),t.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"w-3 h-3 ml-1"}),"النهاية: ",j(t.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[s&&l&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),d?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:i,onChange:m=>o(m.target.value),children:[e.jsx("option",{value:S.MONTHLY,children:"شهرية"}),e.jsx("option",{value:S.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:S.YEARLY,children:"سنوية"}),e.jsx("option",{value:S.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:S.ZERO,children:"زيرو"})]}):e.jsxs(Nr,{value:i,onValueChange:m=>o(m),children:[e.jsx(jr,{className:"w-full",children:e.jsx(wr,{placeholder:"اختر نوع الباقة"})}),e.jsxs(vr,{children:[e.jsx(we,{value:S.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(we,{value:S.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(we,{value:S.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(we,{value:S.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Sr,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(we,{value:S.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Dt,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(K,{size:"sm",onClick:()=>{s(t.id,i),u(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(K,{size:"sm",variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[s&&!l&&e.jsx(K,{size:"sm",variant:"outline",onClick:()=>u(!0),className:"flex-1",children:"تفعيل الاشتراك"}),r&&e.jsx(K,{size:"sm",variant:"outline",onClick:()=>r(t.id),className:"flex-1",children:"إلغاء الاشتراك"}),n&&e.jsx(K,{size:"sm",variant:"destructive",onClick:()=>n(t.id),children:e.jsx(Us,{className:"w-4 h-4"})})]})]})]})})};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zt="firebasestorage.googleapis.com",Yt="storageBucket",Kr=2*60*1e3,Xr=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P extends Ps{constructor(s,r,n=0){super(Qe(s),`Firebase Storage: ${r} (${Qe(s)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,P.prototype)}get status(){return this.status_}set status(s){this.status_=s}_codeEquals(s){return Qe(s)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(s){this.customData.serverResponse=s,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var O;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(O||(O={}));function Qe(t){return"storage/"+t}function nt(){const t="An unknown error occurred, please check the error payload for server response.";return new P(O.UNKNOWN,t)}function Qr(t){return new P(O.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function Zr(t){return new P(O.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Jr(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new P(O.UNAUTHENTICATED,t)}function en(){return new P(O.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function tn(t){return new P(O.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function sn(){return new P(O.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function rn(){return new P(O.CANCELED,"User canceled the upload/download.")}function nn(t){return new P(O.INVALID_URL,"Invalid URL '"+t+"'.")}function an(t){return new P(O.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function ln(){return new P(O.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Yt+"' property when initializing the app?")}function on(){return new P(O.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function cn(){return new P(O.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function dn(t){return new P(O.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function rt(t){return new P(O.INVALID_ARGUMENT,t)}function Gt(){return new P(O.APP_DELETED,"The Firebase app was deleted.")}function un(t){return new P(O.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _e(t,s){return new P(O.INVALID_FORMAT,"String does not match format '"+t+"': "+s)}function ve(t){throw new P(O.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q{constructor(s,r){this.bucket=s,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const s=encodeURIComponent;return"/b/"+s(this.bucket)+"/o/"+s(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(s,r){let n;try{n=q.makeFromUrl(s,r)}catch{return new q(s,"")}if(n.path==="")return n;throw an(s)}static makeFromUrl(s,r){let n=null;const i="([A-Za-z0-9.\\-_]+)";function o(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const l="(/(.*))?$",u=new RegExp("^gs://"+i+l,"i"),d={bucket:1,path:3};function g(M){M.path_=decodeURIComponent(M.path)}const h="v[A-Za-z0-9_]+",j=r.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",w=new RegExp(`^https?://${j}/${h}/b/${i}/o${m}`,"i"),y={bucket:1,path:3},f=r===zt?"(?:storage.googleapis.com|storage.cloud.google.com)":r,C="([^?#]*)",U=new RegExp(`^https?://${f}/${i}/${C}`,"i"),A=[{regex:u,indices:d,postModify:o},{regex:w,indices:y,postModify:g},{regex:U,indices:{bucket:1,path:2},postModify:g}];for(let M=0;M<A.length;M++){const k=A[M],I=k.regex.exec(s);if(I){const x=I[k.indices.bucket];let R=I[k.indices.path];R||(R=""),n=new q(x,R),k.postModify(n);break}}if(n==null)throw nn(s);return n}}class mn{constructor(s){this.promise_=Promise.reject(s)}getPromise(){return this.promise_}cancel(s=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(t,s,r){let n=1,i=null,o=null,l=!1,u=0;function d(){return u===2}let g=!1;function h(...C){g||(g=!0,s.apply(null,C))}function j(C){i=setTimeout(()=>{i=null,t(w,d())},C)}function m(){o&&clearTimeout(o)}function w(C,...U){if(g){m();return}if(C){m(),h.call(null,C,...U);return}if(d()||l){m(),h.call(null,C,...U);return}n<64&&(n*=2);let A;u===1?(u=2,A=0):A=(n+Math.random())*1e3,j(A)}let y=!1;function f(C){y||(y=!0,m(),!g&&(i!==null?(C||(u=2),clearTimeout(i),j(0)):C||(u=1)))}return j(0),o=setTimeout(()=>{l=!0,f(!0)},r),f}function xn(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gn(t){return t!==void 0}function fn(t){return typeof t=="object"&&!Array.isArray(t)}function at(t){return typeof t=="string"||t instanceof String}function It(t){return it()&&t instanceof Blob}function it(){return typeof Blob<"u"}function Lt(t,s,r,n){if(n<s)throw rt(`Invalid value for '${t}'. Expected ${s} or greater.`);if(n>r)throw rt(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $e(t,s,r){let n=s;return r==null&&(n=`https://${s}`),`${r}://${n}/v0${t}`}function Wt(t){const s=encodeURIComponent;let r="?";for(const n in t)if(t.hasOwnProperty(n)){const i=s(n)+"="+s(t[n]);r=r+i+"&"}return r=r.slice(0,-1),r}var ce;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ce||(ce={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(t,s){const r=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,o=s.indexOf(t)!==-1;return r||i||o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(s,r,n,i,o,l,u,d,g,h,j,m=!0,w=!1){this.url_=s,this.method_=r,this.headers_=n,this.body_=i,this.successCodes_=o,this.additionalRetryCodes_=l,this.callback_=u,this.errorCallback_=d,this.timeout_=g,this.progressCallback_=h,this.connectionFactory_=j,this.retry=m,this.isUsingEmulator=w,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((y,f)=>{this.resolve_=y,this.reject_=f,this.start_()})}start_(){const s=(n,i)=>{if(i){n(!1,new Ae(!1,null,!0));return}const o=this.connectionFactory_();this.pendingConnection_=o;const l=u=>{const d=u.loaded,g=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,g)};this.progressCallback_!==null&&o.addUploadProgressListener(l),o.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(l),this.pendingConnection_=null;const u=o.getErrorCode()===ce.NO_ERROR,d=o.getStatus();if(!u||pn(d,this.additionalRetryCodes_)&&this.retry){const h=o.getErrorCode()===ce.ABORT;n(!1,new Ae(!1,null,h));return}const g=this.successCodes_.indexOf(d)!==-1;n(!0,new Ae(g,o))})},r=(n,i)=>{const o=this.resolve_,l=this.reject_,u=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(u,u.getResponse());gn(d)?o(d):o()}catch(d){l(d)}else if(u!==null){const d=nt();d.serverResponse=u.getErrorText(),this.errorCallback_?l(this.errorCallback_(u,d)):l(d)}else if(i.canceled){const d=this.appDelete_?Gt():rn();l(d)}else{const d=sn();l(d)}};this.canceled_?r(!1,new Ae(!1,null,!0)):this.backoffId_=hn(s,r,this.timeout_)}getPromise(){return this.promise_}cancel(s){this.canceled_=!0,this.appDelete_=s||!1,this.backoffId_!==null&&xn(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ae{constructor(s,r,n){this.wasSuccessCode=s,this.connection=r,this.canceled=!!n}}function yn(t,s){s!==null&&s.length>0&&(t.Authorization="Firebase "+s)}function Nn(t,s){t["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager")}function jn(t,s){s&&(t["X-Firebase-GMPID"]=s)}function wn(t,s){s!==null&&(t["X-Firebase-AppCheck"]=s)}function vn(t,s,r,n,i,o,l=!0,u=!1){const d=Wt(t.urlParams),g=t.url+d,h=Object.assign({},t.headers);return jn(h,s),yn(h,r),Nn(h,o),wn(h,n),new bn(g,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,l,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _n(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Tn(...t){const s=_n();if(s!==void 0){const r=new s;for(let n=0;n<t.length;n++)r.append(t[n]);return r.getBlob()}else{if(it())return new Blob(t);throw new P(O.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function En(t,s,r){return t.webkitSlice?t.webkitSlice(s,r):t.mozSlice?t.mozSlice(s,r):t.slice?t.slice(s,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rn(t){if(typeof atob>"u")throw dn("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Ze{constructor(s,r){this.data=s,this.contentType=r||null}}function Cn(t,s){switch(t){case X.RAW:return new Ze(Kt(s));case X.BASE64:case X.BASE64URL:return new Ze(Xt(t,s));case X.DATA_URL:return new Ze(Sn(s),Dn(s))}throw nt()}function Kt(t){const s=[];for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);if(n<=127)s.push(n);else if(n<=2047)s.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))s.push(239,191,189);else{const o=n,l=t.charCodeAt(++r);n=65536|(o&1023)<<10|l&1023,s.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?s.push(239,191,189):s.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(s)}function kn(t){let s;try{s=decodeURIComponent(t)}catch{throw _e(X.DATA_URL,"Malformed data URL.")}return Kt(s)}function Xt(t,s){switch(t){case X.BASE64:{const i=s.indexOf("-")!==-1,o=s.indexOf("_")!==-1;if(i||o)throw _e(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case X.BASE64URL:{const i=s.indexOf("+")!==-1,o=s.indexOf("/")!==-1;if(i||o)throw _e(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");s=s.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=Rn(s)}catch(i){throw i.message.includes("polyfill")?i:_e(t,"Invalid character found")}const n=new Uint8Array(r.length);for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);return n}class Qt{constructor(s){this.base64=!1,this.contentType=null;const r=s.match(/^data:([^,]+)?,/);if(r===null)throw _e(X.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=r[1]||null;n!=null&&(this.base64=An(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=s.substring(s.indexOf(",")+1)}}function Sn(t){const s=new Qt(t);return s.base64?Xt(X.BASE64,s.rest):kn(s.rest)}function Dn(t){return new Qt(t).contentType}function An(t,s){return t.length>=s.length?t.substring(t.length-s.length)===s:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(s,r){let n=0,i="";It(s)?(this.data_=s,n=s.size,i=s.type):s instanceof ArrayBuffer?(r?this.data_=new Uint8Array(s):(this.data_=new Uint8Array(s.byteLength),this.data_.set(new Uint8Array(s))),n=this.data_.length):s instanceof Uint8Array&&(r?this.data_=s:(this.data_=new Uint8Array(s.length),this.data_.set(s)),n=s.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(s,r){if(It(this.data_)){const n=this.data_,i=En(n,s,r);return i===null?null:new re(i)}else{const n=new Uint8Array(this.data_.buffer,s,r-s);return new re(n,!0)}}static getBlob(...s){if(it()){const r=s.map(n=>n instanceof re?n.data_:n);return new re(Tn.apply(null,r))}else{const r=s.map(l=>at(l)?Cn(X.RAW,l).data:l.data_);let n=0;r.forEach(l=>{n+=l.byteLength});const i=new Uint8Array(n);let o=0;return r.forEach(l=>{for(let u=0;u<l.length;u++)i[o++]=l[u]}),new re(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zt(t){let s;try{s=JSON.parse(t)}catch{return null}return fn(s)?s:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(t){if(t.length===0)return null;const s=t.lastIndexOf("/");return s===-1?"":t.slice(0,s)}function Mn(t,s){const r=s.split("/").filter(n=>n.length>0).join("/");return t.length===0?r:t+"/"+r}function Jt(t){const s=t.lastIndexOf("/",t.length-2);return s===-1?t:t.slice(s+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function In(t,s){return s}class V{constructor(s,r,n,i){this.server=s,this.local=r||s,this.writable=!!n,this.xform=i||In}}let Ue=null;function Ln(t){return!at(t)||t.length<2?t:Jt(t)}function es(){if(Ue)return Ue;const t=[];t.push(new V("bucket")),t.push(new V("generation")),t.push(new V("metageneration")),t.push(new V("name","fullPath",!0));function s(o,l){return Ln(l)}const r=new V("name");r.xform=s,t.push(r);function n(o,l){return l!==void 0?Number(l):l}const i=new V("size");return i.xform=n,t.push(i),t.push(new V("timeCreated")),t.push(new V("updated")),t.push(new V("md5Hash",null,!0)),t.push(new V("cacheControl",null,!0)),t.push(new V("contentDisposition",null,!0)),t.push(new V("contentEncoding",null,!0)),t.push(new V("contentLanguage",null,!0)),t.push(new V("contentType",null,!0)),t.push(new V("metadata","customMetadata",!0)),Ue=t,Ue}function On(t,s){function r(){const n=t.bucket,i=t.fullPath,o=new q(n,i);return s._makeStorageReference(o)}Object.defineProperty(t,"ref",{get:r})}function Pn(t,s,r){const n={};n.type="file";const i=r.length;for(let o=0;o<i;o++){const l=r[o];n[l.local]=l.xform(n,s[l.server])}return On(n,t),n}function ts(t,s,r){const n=Zt(s);return n===null?null:Pn(t,n,r)}function Fn(t,s,r,n){const i=Zt(s);if(i===null||!at(i.downloadTokens))return null;const o=i.downloadTokens;if(o.length===0)return null;const l=encodeURIComponent;return o.split(",").map(g=>{const h=t.bucket,j=t.fullPath,m="/b/"+l(h)+"/o/"+l(j),w=$e(m,r,n),y=Wt({alt:"media",token:g});return w+y})[0]}function Bn(t,s){const r={},n=s.length;for(let i=0;i<n;i++){const o=s[i];o.writable&&(r[o.server]=t[o.local])}return JSON.stringify(r)}class lt{constructor(s,r,n,i){this.url=s,this.method=r,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(t){if(!t)throw nt()}function $n(t,s){function r(n,i){const o=ts(t,i,s);return ss(o!==null),o}return r}function Vn(t,s){function r(n,i){const o=ts(t,i,s);return ss(o!==null),Fn(o,i,t.host,t._protocol)}return r}function rs(t){function s(r,n){let i;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?i=en():i=Jr():r.getStatus()===402?i=Zr(t.bucket):r.getStatus()===403?i=tn(t.path):i=n,i.status=r.getStatus(),i.serverResponse=n.serverResponse,i}return s}function ns(t){const s=rs(t);function r(n,i){let o=s(n,i);return n.getStatus()===404&&(o=Qr(t.path)),o.serverResponse=i.serverResponse,o}return r}function Hn(t,s,r){const n=s.fullServerUrl(),i=$e(n,t.host,t._protocol),o="GET",l=t.maxOperationRetryTime,u=new lt(i,o,Vn(t,r),l);return u.errorHandler=ns(s),u}function qn(t,s){const r=s.fullServerUrl(),n=$e(r,t.host,t._protocol),i="DELETE",o=t.maxOperationRetryTime;function l(d,g){}const u=new lt(n,i,l,o);return u.successCodes=[200,204],u.errorHandler=ns(s),u}function zn(t,s){return t&&t.contentType||s&&s.type()||"application/octet-stream"}function Yn(t,s,r){const n=Object.assign({},r);return n.fullPath=t.path,n.size=s.size(),n.contentType||(n.contentType=zn(null,s)),n}function Gn(t,s,r,n,i){const o=s.bucketOnlyServerUrl(),l={"X-Goog-Upload-Protocol":"multipart"};function u(){let A="";for(let M=0;M<2;M++)A=A+Math.random().toString().slice(2);return A}const d=u();l["Content-Type"]="multipart/related; boundary="+d;const g=Yn(s,n,i),h=Bn(g,r),j="--"+d+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+d+`\r
Content-Type: `+g.contentType+`\r
\r
`,m=`\r
--`+d+"--",w=re.getBlob(j,n,m);if(w===null)throw on();const y={name:g.fullPath},f=$e(o,t.host,t._protocol),C="POST",U=t.maxUploadRetryTime,v=new lt(f,C,$n(t,r),U);return v.urlParams=y,v.headers=l,v.body=w.uploadData(),v.errorHandler=rs(s),v}class Wn{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ce.NO_ERROR,this.sendPromise_=new Promise(s=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ce.ABORT,s()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ce.NETWORK_ERROR,s()}),this.xhr_.addEventListener("load",()=>{s()})})}send(s,r,n,i,o){if(this.sent_)throw ve("cannot .send() more than once");if(Vt(s)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(r,s,!0),o!==void 0)for(const l in o)o.hasOwnProperty(l)&&this.xhr_.setRequestHeader(l,o[l].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ve("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ve("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ve("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ve("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(s){return this.xhr_.getResponseHeader(s)}addUploadProgressListener(s){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",s)}removeUploadProgressListener(s){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",s)}}class Kn extends Wn{initXhr(){this.xhr_.responseType="text"}}function ot(){return new Kn}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(s,r){this._service=s,r instanceof q?this._location=r:this._location=q.makeFromUrl(r,s.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(s,r){return new ue(s,r)}get root(){const s=new q(this._location.bucket,"");return this._newRef(this._service,s)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Jt(this._location.path)}get storage(){return this._service}get parent(){const s=Un(this._location.path);if(s===null)return null;const r=new q(this._location.bucket,s);return new ue(this._service,r)}_throwIfRoot(s){if(this._location.path==="")throw un(s)}}function Xn(t,s,r){t._throwIfRoot("uploadBytes");const n=Gn(t.storage,t._location,es(),new re(s,!0),r);return t.storage.makeRequestWithTokens(n,ot).then(i=>({metadata:i,ref:t}))}function Qn(t){t._throwIfRoot("getDownloadURL");const s=Hn(t.storage,t._location,es());return t.storage.makeRequestWithTokens(s,ot).then(r=>{if(r===null)throw cn();return r})}function Zn(t){t._throwIfRoot("deleteObject");const s=qn(t.storage,t._location);return t.storage.makeRequestWithTokens(s,ot)}function Jn(t,s){const r=Mn(t._location.path,s),n=new q(t._location.bucket,r);return new ue(t.storage,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ea(t){return/^[A-Za-z]+:\/\//.test(t)}function ta(t,s){return new ue(t,s)}function as(t,s){if(t instanceof ct){const r=t;if(r._bucket==null)throw ln();const n=new ue(r,r._bucket);return s!=null?as(n,s):n}else return s!==void 0?Jn(t,s):t}function sa(t,s){if(s&&ea(s)){if(t instanceof ct)return ta(t,s);throw rt("To use ref(service, url), the first argument must be a Storage instance.")}else return as(t,s)}function Ot(t,s){const r=s==null?void 0:s[Yt];return r==null?null:q.makeFromBucketSpec(r,t)}function ra(t,s,r,n={}){t.host=`${s}:${r}`;const i=Vt(s);i&&(Vs(`https://${t.host}/b`),Hs("Storage",!0)),t._isUsingEmulator=!0,t._protocol=i?"https":"http";const{mockUserToken:o}=n;o&&(t._overrideAuthToken=typeof o=="string"?o:qs(o,t.app.options.projectId))}class ct{constructor(s,r,n,i,o,l=!1){this.app=s,this._authProvider=r,this._appCheckProvider=n,this._url=i,this._firebaseVersion=o,this._isUsingEmulator=l,this._bucket=null,this._host=zt,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Kr,this._maxUploadRetryTime=Xr,this._requests=new Set,i!=null?this._bucket=q.makeFromBucketSpec(i,this._host):this._bucket=Ot(this._host,this.app.options)}get host(){return this._host}set host(s){this._host=s,this._url!=null?this._bucket=q.makeFromBucketSpec(this._url,s):this._bucket=Ot(s,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(s){Lt("time",0,Number.POSITIVE_INFINITY,s),this._maxUploadRetryTime=s}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(s){Lt("time",0,Number.POSITIVE_INFINITY,s),this._maxOperationRetryTime=s}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const s=this._authProvider.getImmediate({optional:!0});if(s){const r=await s.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){if(Os(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=this._appCheckProvider.getImmediate({optional:!0});return s?(await s.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(s=>s.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(s){return new ue(this,s)}_makeRequest(s,r,n,i,o=!0){if(this._deleted)return new mn(Gt());{const l=vn(s,this._appId,n,i,r,this._firebaseVersion,o,this._isUsingEmulator);return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}}async makeRequestWithTokens(s,r){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(s,r,n,i).getPromise()}}const Pt="@firebase/storage",Ft="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is="storage";function na(t,s,r){return t=Ee(t),Xn(t,s,r)}function aa(t){return t=Ee(t),Qn(t)}function ia(t){return t=Ee(t),Zn(t)}function Bt(t,s){return t=Ee(t),sa(t,s)}function $t(t=$s(),s){t=Ee(t);const n=Fs(t,is).getImmediate({identifier:s}),i=Bs("storage");return i&&la(n,...i),n}function la(t,s,r,n={}){ra(t,s,r,n)}function oa(t,{instanceIdentifier:s}){const r=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new ct(r,n,i,s,Ls)}function ca(){Ms(new Is(is,oa,"PUBLIC").setMultipleInstances(!0)),Rt(Pt,Ft,""),Rt(Pt,Ft,"esm2020")}ca();class da{constructor(){Et(this,"hooks",[])}registerHooks(s){console.log("📝 Registering hooks:",Object.keys(s)),this.hooks.push(s)}async sendImageMessage(s,r,n,i,o){try{console.log("📤 Uploading image message:",{chatId:s,fileName:r.name,fileSize:r.size,senderType:n,senderId:i});const l=$t(),u=Date.now(),d=`chat-images/${s}/${u}_${r.name}`,g=Bt(l,d),h=await na(g,r);console.log("✅ Image uploaded successfully:",h.metadata.fullPath);const j=await aa(g);console.log("✅ Image URL obtained:",j);const m={chatId:s,message:o||"صورة",content:o||"صورة",senderType:n,senderId:i,timestamp:J(),isRead:!1,type:"image",imageUrl:j,imageFileName:r.name},w=await Ye(H(L,"chatMessages"),m);console.log("✅ Image message added to chatMessages:",w.id);const y=W(L,"chatRooms",s);if(n==="client"){const f=await Se(y);if(f.exists()){const C=f.data().unreadCount||0;await ae(y,{lastMessage:o||"صورة",lastMessageTime:J(),unreadCount:C+1})}}else await ae(y,{lastMessage:o||"صورة",lastMessageTime:J()});console.log("✅ Image message sent successfully")}catch(l){throw console.error("🔥 Error sending image message:",l),l}}async deleteChat(s){try{console.log("🗑️ Deleting chat:",s);const r=ee(H(L,"chatMessages"),Y("chatId","==",s)),n=await oe(r),i=[];for(const l of n.docs){const u=l.data();if(u.type==="image"&&u.imageUrl)try{const d=$t(),g=Bt(d,u.imageUrl);i.push(ia(g))}catch(d){console.warn("⚠️ Could not delete image from storage:",d)}i.push(ie(l.ref))}const o=W(L,"chatRooms",s);i.push(ie(o)),await Promise.all(i),console.log("✅ Chat deleted successfully:",{chatId:s,messagesDeleted:n.size})}catch(r){throw console.error("🔥 Error deleting chat:",r),r}}unregisterHooks(s){console.log("🗑️ Unregistering hooks"),s?this.hooks=this.hooks.filter(r=>r!==s):this.hooks=[]}async createChatRoom(s,r=!1){try{const n=r?"clientEmail":"clientPhone",i=ee(H(L,"chatRooms"),Y(n,"==",s),Y("status","==","active")),o=await oe(i);if(!o.empty)return o.docs[0].id;const l={clientId:`client_${s}`,clientPhone:r?"":s,clientEmail:r?s:void 0,customerName:r?`عميل ${s}`:`عميل ${s}`,status:"active",unreadCount:0,createdAt:J(),lastMessageTime:J()};return(await Ye(H(L,"chatRooms"),l)).id}catch(n){throw console.error("Error creating chat room:",n),n}}async sendMessage(s,r,n,i){try{for(let l=1;l<=3;l++)try{console.log(`📤 Sending message (attempt ${l}):`,{chatId:s,message:r.substring(0,50)+"...",senderType:n,senderId:i});const u={chatId:s,message:r,content:r,senderType:n,senderId:i,timestamp:J(),isRead:!1},d=await Ye(H(L,"chatMessages"),u);console.log("✅ Message added to chatMessages:",d.id);const g=W(L,"chatRooms",s);if(n==="client"){const h=await Se(g),j=h.exists()&&h.data().unreadCount||0;await ae(g,{lastMessage:r,lastMessageTime:J(),unreadCount:j+1}),this.hooks.length>0&&this.hooks.forEach(m=>{if(m.onUnreadCountChange&&typeof m.onUnreadCountChange=="function")try{m.onUnreadCountChange(s,j+1)}catch(w){console.error("Error calling onUnreadCountChange hook:",w)}})}else await ae(g,{lastMessage:r,lastMessageTime:J()});if(this.hooks.length>0)try{const h=await Se(g);if(h.exists()){const j={id:h.id,...h.data()},m={id:d.id,...u,timestamp:new Date};this.hooks.forEach(w=>{if(w.onNewMessage&&typeof w.onNewMessage=="function")try{w.onNewMessage(m,j)}catch(y){console.error("Error calling onNewMessage hook:",y)}})}}catch(h){console.error("Error calling onNewMessage hooks:",h)}console.log("✅ Message sent successfully");return}catch(u){if(console.error(`❌ Attempt ${l} failed:`,u),l===3)throw u;await new Promise(d=>setTimeout(d,1e3*l))}throw new Error("Max retry attempts reached")}catch(l){throw console.error("🔥 Error sending message:",l),l}}subscribeToMessages(s,r){let n=0;const i=5;let o=null,l=null,u=0;const d=()=>{try{console.log("🔔 Starting subscription to messages for room:",s,`(attempt ${n+1})`);const g=ee(H(L,"chatMessages"),Y("chatId","==",s),Ct("timestamp","asc"));l=Je(g,h=>{console.log("📨 Received messages snapshot:",h.docs.length,"messages"),n=0;const j=h.docs.map(m=>{const w=m.data();return{id:m.id,...w,message:w.message||w.content||"",content:w.content||w.message||""}});if(j.length>u&&u>0){const m=j.slice(u);console.log("🆕 New messages detected:",m.length),m.forEach(w=>{this.hooks.forEach(y=>{if(y.onNewMessage&&typeof y.onNewMessage=="function")try{Se(W(L,"chatRooms",s)).then(f=>{if(f.exists()){const C={id:f.id,...f.data()},U=y.onNewMessage;U&&U(w,C)}}).catch(f=>{console.error("Error fetching chat room for hook:",f)})}catch(f){console.error("Error calling onNewMessage hook:",f)}})})}u=j.length,console.log("📨 Processed messages:",j),r(j)},h=>{var j,m,w,y;if(console.error("❌ Error in messages subscription:",h),h.name==="AbortError"||(j=h.message)!=null&&j.includes("AbortError")){console.log("🔄 Request was aborted, will retry..."),n<i&&(n++,o=setTimeout(()=>{d()},1e3));return}(m=h.message)!=null&&m.includes("index is currently building")||(w=h.message)!=null&&w.includes("cannot be used yet")||h.code==="failed-precondition"?(console.log("🔨 Index is still building, will retry in 10 seconds..."),n<i?(n++,o=setTimeout(()=>{console.log("🔄 Retrying subscription after index building delay..."),d()},1e4)):(console.log("⚠️ Max retries reached for index building. Please wait for index to complete."),r([]))):h.code==="unavailable"||(y=h.message)!=null&&y.includes("ERR_ABORTED")?(console.log("🔄 Connection issue detected, will retry automatically..."),n<i&&(n++,o=setTimeout(()=>{d()},2e3))):(console.error("❌ Unhandled error in messages subscription:",h),r([]))})}catch(g){console.error("❌ Error setting up messages subscription:",g),n<i&&(n++,o=setTimeout(()=>{d()},5e3))}};return d(),()=>{o&&clearTimeout(o),l&&l()}}subscribeToAdminChats(s){console.log("🔍 Admin: Starting subscription to admin chats");let r=0,n=0;const i=5;let o=null,l=null;const u=()=>{try{const d=ee(H(L,"chatRooms"),Y("status","==","active"),Ct("lastMessageTime","desc"));l=Je(d,g=>{console.log("📊 Admin: Received chat rooms snapshot:",{size:g.size,empty:g.empty,docs:g.docs.length}),n=0;const h=g.docs.map(j=>{const m=j.data();return console.log("💬 Admin: Chat room data:",{id:j.id,customerName:m.customerName,lastMessage:m.lastMessage,unreadCount:m.unreadCount,status:m.status}),{id:j.id,...m}});h.length!==r&&(console.log("🆕 Chat rooms count changed:",{old:r,new:h.length}),h.forEach(j=>{this.hooks.length>0&&this.hooks.forEach(m=>{if(m.onChatRoomUpdate&&typeof m.onChatRoomUpdate=="function")try{m.onChatRoomUpdate(j)}catch(w){console.error("Error calling onChatRoomUpdate hook:",w)}})})),r=h.length,s(h)},g=>{var h,j;if(console.error("❌ Error in admin chats subscription:",g),g.name==="AbortError"||(h=g.message)!=null&&h.includes("AbortError")){console.log("🔄 Admin chats request was aborted, will retry..."),n<i&&(n++,o=setTimeout(()=>{u()},1e3));return}g.code==="unavailable"||(j=g.message)!=null&&j.includes("ERR_ABORTED")?(console.log("🔄 Admin chats connection issue detected, will retry..."),n<i&&(n++,o=setTimeout(()=>{u()},2e3))):(console.error("❌ Unhandled error in admin chats subscription:",g),s([]))})}catch(d){console.error("❌ Error setting up admin chats subscription:",d),n<i&&(n++,o=setTimeout(()=>{u()},5e3))}};return u(),()=>{o&&clearTimeout(o),l&&l()}}async markMessagesAsRead(s,r){try{const n=ee(H(L,"chatMessages"),Y("chatId","==",s),Y("senderType","!=",r),Y("isRead","==",!1)),o=(await oe(n)).docs.map(l=>ae(W(L,"chatMessages",l.id),{isRead:!0}));if(await Promise.all(o),r==="admin"){const l=W(L,"chatRooms",s);await ae(l,{unreadCount:0})}}catch(n){throw console.error("Error marking messages as read:",n),n}}async closeChatRoom(s){try{const r=W(L,"chatRooms",s);await ae(r,{status:"closed",lastMessageTime:J()})}catch(r){throw console.error("Error closing chat room:",r),r}}}const ge=new da,ua=({isOpen:t,onClose:s})=>{var k,I;const[r,n]=b.useState([]),[i,o]=b.useState(null),[l,u]=b.useState([]),[d,g]=b.useState(""),[h,j]=b.useState(!0),[m,w]=b.useState(!1),[y,f]=b.useState({}),C=b.useRef(null);b.useEffect(()=>{const x={onNewMessage:(R,D)=>{console.log("🔔 New message notification:",R,D),R.senderType==="client"&&R.chatId!==i&&(f(F=>({...F,[R.chatId]:(F[R.chatId]||0)+1})),console.log("🔔 New message from client in chat:",D.customerName||D.clientPhone))},onChatRoomUpdate:R=>{console.log("🔄 Chat room updated:",R),n(D=>{const F=D.findIndex(E=>E.id===R.id);if(F>=0){const E=[...D];return E[F]=R,E.sort((Q,$)=>{var be,ye,G,Re;const ne=((ye=(be=Q.lastMessageTime)==null?void 0:be.toMillis)==null?void 0:ye.call(be))||0;return(((Re=(G=$.lastMessageTime)==null?void 0:G.toMillis)==null?void 0:Re.call(G))||0)-ne})}else return[R,...D]})},onUnreadCountChange:(R,D)=>{console.log("📊 Unread count changed:",R,D),n(F=>F.map(E=>E.id===R?{...E,unreadCount:D}:E))}};return ge.registerHooks(x),()=>{ge.unregisterHooks()}},[i]),b.useEffect(()=>{console.log("🔍 AdminChatPanel: Setting up chat rooms subscription"),j(!0);const x=ge.subscribeToAdminChats(R=>{console.log("📊 AdminChatPanel: Received chats update:",R.length),n(R),j(!1)});return()=>{console.log("🔌 AdminChatPanel: Cleaning up chat rooms subscription"),x()}},[]),b.useEffect(()=>{if(!i){u([]);return}console.log("📨 AdminChatPanel: Setting up messages subscription for chat:",i);const x=ge.subscribeToMessages(i,R=>{console.log("📨 AdminChatPanel: Received messages update:",R.length),u(R),f(D=>{const F={...D};return delete F[i],F})});return ge.markMessagesAsRead(i,"admin").catch(console.error),()=>{console.log("🔌 AdminChatPanel: Cleaning up messages subscription"),x()}},[i]),b.useEffect(()=>{var x;(x=C.current)==null||x.scrollIntoView({behavior:"smooth"})},[l]);const U=async()=>{if(!(!d.trim()||!i||m)){w(!0);try{await ge.sendMessage(i,d.trim(),"admin","admin_user"),g("")}catch(x){console.error("Error sending message:",x),alert("حدث خطأ في إرسال الرسالة")}finally{w(!1)}}},v=x=>{o(x),f(R=>{const D={...R};return delete D[x],D})},A=Object.values(y).reduce((x,R)=>x+R,0),M=r.reduce((x,R)=>x+(R.unreadCount||0),0);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[80vh] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"المحادثات"}),(M>0||A>0)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cr,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold",children:"جديد"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(At,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-2 text-gray-600",children:"جاري التحميل..."})]}):r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[e.jsx(tt,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"لا توجد محادثات نشطة"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"ستظهر المحادثات الجديدة هنا"})]}):r.map(x=>{const R=i===x.id,D=(x.unreadCount||0)>0,F=y[x.id]>0,E=(x.unreadCount||0)+(y[x.id]||0);return e.jsx("div",{onClick:()=>v(x.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-all duration-200 ${R?"bg-blue-50 border-r-4 border-r-blue-500":D||F?"bg-yellow-50 hover:bg-yellow-100 border-r-4 border-r-yellow-400":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${D||F?"bg-yellow-200":"bg-gray-200"}`,children:e.jsx(Fe,{className:`w-5 h-5 ${D||F?"text-yellow-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:x.customerName||x.clientPhone}),R&&e.jsx(st,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]}),x.customerName&&x.customerName!==x.clientPhone&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:x.clientPhone}),x.lastMessage&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:x.lastMessage.length>50?x.lastMessage.substring(0,50)+"...":x.lastMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(de,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:x.lastMessageTime&&x.lastMessageTime.toMillis?new Date(x.lastMessageTime.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${D||F?"bg-red-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:D||F?"رسائل جديدة":"مقروءة"})]})]})]}),E>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[20px] text-center",children:E>99?"99+":E})]})},x.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:((k=r.find(x=>x.id===i))==null?void 0:k.customerName)||((I=r.find(x=>x.id===i))==null?void 0:I.clientPhone)})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[l.map(x=>e.jsx("div",{className:`flex ${x.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${x.senderType==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:x.message||x.content}),e.jsx("p",{className:`text-xs mt-1 ${x.senderType==="admin"?"text-blue-100":"text-gray-500"}`,children:x.timestamp&&x.timestamp.toMillis?new Date(x.timestamp.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"})]})},x.id)),e.jsx("div",{ref:C})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:x=>g(x.target.value),onKeyPress:x=>x.key==="Enter"&&U(),placeholder:"اكتب رسالتك هنا...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m}),e.jsxs("button",{onClick:U,disabled:!d.trim()||m,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[m?e.jsx(At,{className:"w-4 h-4 animate-spin"}):e.jsx(Ar,{className:"w-4 h-4"}),"إرسال"]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(le,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر محادثة للبدء"}),e.jsx("p",{children:"اختر محادثة من القائمة لعرض الرسائل والرد عليها"})]})})})]})}):null},ma={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"true",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.firebasestorage.app",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_USE_EMULATORS:"false"},ha=({navigate:t,auth:s,devMode:r,setDevMode:n,error:i,setError:o,authLoading:l,setAuthLoading:u,activeTab:d,setActiveTab:g,setNotificationCenterOpen:h,setNotificationSettings:j,setNotifications:m,notificationCount:w,setNotificationCount:y,users:f,setUsers:C,filteredUsers:U,setFilteredUsers:v,loading:A,setLoading:M,setEditingPlan:k,isSavingContent:I,setIsSavingContent:x,lastUpdateInfo:R,loadContentFromFirebase:D,saveContentToFirebase:F})=>{var Tt;const[E,Q]=b.useState(!0),[$,ne]=b.useState(""),[me,be]=b.useState(null),[ye,G]=b.useState({});b.useState(!1),b.useState(null),b.useState(!1);const[Re,ls]=b.useState({sound:!0}),[os,xa]=b.useState(!1),[cs,ds]=b.useState(null),Ve=a=>{const c=a==null?void 0:a.displayName;let p="";typeof c=="string"?p=c:c&&typeof c=="object"&&(p=(c.ar||c.en||"").toString()),!p&&typeof(a==null?void 0:a.email)=="string"&&(p=a.email);const _=String(p).trim().charAt(0);return _?_.toUpperCase():"؟"},Ne=a=>{const c=a==null?void 0:a.displayName;if(typeof c=="string"&&c.trim())return c.trim();if(c&&typeof c=="object"){const p=c.full_name||c.name||c.ar||c.en;if(typeof p=="string"&&p.trim())return p.trim()}return typeof(a==null?void 0:a.email)=="string"&&a.email.includes("@")?a.email.split("@")[0]:"غير محدد"},[He,dt]=b.useState(""),[qe,ut]=b.useState(""),[mt,ht]=b.useState(""),[ze,xt]=b.useState(""),[gt,ft]=b.useState(!1),[Ce,pt]=b.useState(""),[z,bt]=b.useState(24),[yt,Nt]=b.useState("24"),[jt,wt]=b.useState(!1),[ga,vt]=b.useState(!1);b.useEffect(()=>{d==="trials"&&(async()=>{try{vt(!0);const{FreeTrialService:a}=await De(async()=>{const{FreeTrialService:p}=await import("./index-Drf-Kel-.js").then(_=>_.b0);return{FreeTrialService:p}},__vite__mapDeps([0,1])),c=await a.getTrialDurationHours();bt(c),Nt(String(c))}catch(a){console.error("Failed to load trial duration",a)}finally{vt(!1)}})()},[d]);const us=async()=>{var a;if(!He.trim()||!qe.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{ft(!0);const c=ze.trim()?`user:${ze.trim()}`:"global";await yr({title:He.trim(),message:qe.trim(),audienceKey:c,createdBy:(a=s==null?void 0:s.currentUser)==null?void 0:a.uid,linkUrl:mt.trim()||void 0}),dt(""),ut(""),ht(""),xt(""),alert("تم إرسال الإشعار بنجاح!")}catch(c){console.error("خطأ في إرسال الإشعار:",c),alert("حدث خطأ أثناء إرسال الإشعار")}finally{ft(!1)}};b.useEffect(()=>{if(!$.trim())v(f);else{const a=f.filter(c=>c.email&&typeof c.email=="string"&&c.email.toLowerCase().includes($.toLowerCase())||c.displayName&&typeof c.displayName=="string"&&c.displayName.toLowerCase().includes($.toLowerCase())||c.name&&typeof c.name=="string"&&c.name.toLowerCase().includes($.toLowerCase()));v(a)}},[f,$,v]);const ms=()=>{s!=null&&s.signOut&&s.signOut(),t("/admin/login")},hs=async(a,c,p=null)=>{var _;try{console.log("Activating subscription for user:",a,"with plan:",c,"and variant:",p);const T=((_=s==null?void 0:s.currentUser)==null?void 0:_.uid)||"admin-user-id";await Gs(a,c,T,p),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(T){console.error("❌ خطأ في تفعيل الاشتراك:",T),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},xs=async a=>{try{console.log("Deactivating subscription for user:",a),await Ws(a),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(c){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",c),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},gs=async a=>{var c;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",a);const _=((c=s==null?void 0:s.currentUser)==null?void 0:c.uid)||"unknown-admin";try{const N=await Ks(Xs,"deleteUserPermanently")({userId:a});console.log("استجابة دالة الحذف النهائي:",N),C(B=>B.filter(Z=>Z.id!==a)),v(B=>B.filter(Z=>Z.id!==a)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(T){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(T==null?void 0:T.message)||T)}{const T=[];try{await ie(W(L,"profiles",a)),console.log("تم حذف الملف الشخصي")}catch(N){console.error("خطأ في حذف الملف الشخصي:",N),T.push(`الملف الشخصي: ${(N==null?void 0:N.message)||N}`)}try{await ie(W(L,"users",a)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(N){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",N),T.push(`users: ${(N==null?void 0:N.message)||N}`)}try{const N=ee(H(L,"transactions"),Y("userId","==",a)),B=await oe(N),Z=B.docs.map(je=>ie(je.ref)),he=await Promise.allSettled(Z),xe=he.filter(je=>je.status==="rejected");xe.length?(console.warn("فشل حذف بعض المعاملات:",xe.length),T.push(`المعاملات: فشل حذف ${xe.length} من أصل ${he.length}`)):console.log(`تم حذف ${B.size} معاملة`)}catch(N){console.error("خطأ في جلب/حذف المعاملات:",N),T.push(`المعاملات: ${(N==null?void 0:N.message)||N}`)}try{const N=ee(H(L,"chatRooms"),Y("participants","array-contains",a)),B=await oe(N),Z=B.docs.map(async he=>{try{const je=(await oe(H(he.ref,"messages"))).docs.map(Rs=>ie(Rs.ref));await Promise.allSettled(je),await ie(he.ref)}catch(xe){console.error("فشل حذف محادثة/رسائل:",xe),T.push(`المحادثات: ${he.id}`)}});await Promise.all(Z),console.log(`تم إنهاء معالجة ${B.size} محادثة`)}catch(N){console.error("خطأ في جلب/حذف المحادثات:",N),T.push(`المحادثات: ${(N==null?void 0:N.message)||N}`)}try{await Qs(W(L,"deletedUsers",a),{deletedAt:new Date,deletedBy:_,reason:"حذف نهائي من لوحة الإدارة"})}catch(N){console.error("خطأ في تسجيل المستخدم كمحذوف:",N),T.push(`deletedUsers: ${(N==null?void 0:N.message)||N}`)}C(N=>N.filter(B=>B.id!==a)),v(N=>N.filter(B=>B.id!==a)),T.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${T.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(p){console.error("❌ خطأ في حذف المستخدم:",p),alert(`حدث خطأ في حذف المستخدم: ${p.message||"خطأ غير معروف"}`)}};b.useEffect(()=>{(async()=>{try{if(typeof D=="function"){const c=await D();c&&(c.monthly||c.yearly||c.lifetime)&&G(c)}}catch(c){console.warn("Failed to load content data:",c)}})()},[]);const fs=async()=>{var a;try{if(typeof F!="function")return;x(!0);const c=((a=s==null?void 0:s.currentUser)==null?void 0:a.uid)||"admin-user-id";await F(ye,c),alert("تم حفظ جميع التغييرات بنجاح")}catch(c){console.error("❌ خطأ في حفظ المحتوى:",c),alert(`فشل في حفظ المحتوى: ${(c==null?void 0:c.message)||"خطأ غير معروف"}`)}finally{x(!1)}},ke=(a,c,p)=>{G(_=>({..._,[a]:{...(_==null?void 0:_[a])||{},[c]:p}}))},ps=a=>{G(c=>{var p;return{...c,[a]:{...(c==null?void 0:c[a])||{},features:[...((p=c==null?void 0:c[a])==null?void 0:p.features)||[],""]}}})},bs=(a,c,p)=>{G(_=>{var N;const T=[...((N=_==null?void 0:_[a])==null?void 0:N.features)||[]];return T[c]=p,{..._,[a]:{...(_==null?void 0:_[a])||{},features:T}}})},ys=(a,c)=>{G(p=>{var T;const _=[...((T=p==null?void 0:p[a])==null?void 0:T.features)||[]];return _.splice(c,1),{...p,[a]:{...(p==null?void 0:p[a])||{},features:_}}})},Ns=()=>{ls(a=>({...a,sound:!a.sound}))},js=()=>{ds(null)},ws=async()=>{try{const a=Number(yt);if(isNaN(a)||a<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}wt(!0);const{FreeTrialService:c}=await De(async()=>{const{FreeTrialService:_}=await import("./index-Drf-Kel-.js").then(T=>T.b0);return{FreeTrialService:_}},__vite__mapDeps([0,1])),p=await c.updateTrialDurationHours(a);p.success?(bt(a),alert(p.message)):alert(p.message||"فشل تحديث مدة التجربة")}catch(a){console.error("Error updating trial duration:",a),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{wt(!1)}},vs=async a=>{try{const{FreeTrialService:c}=await De(async()=>{const{FreeTrialService:_}=await import("./index-Drf-Kel-.js").then(T=>T.b0);return{FreeTrialService:_}},__vite__mapDeps([0,1])),p=await c.startFreeTrialFromAdmin(a);alert(p.message||`تم تفعيل التجربة المجانية لمدة ${z} ${z>=3&&z<=10?"ساعات":z===2?"ساعتين":"ساعة"}`)}catch(c){console.error("Error activating free trial:",c),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},_s=async a=>{try{const{FreeTrialService:c}=await De(async()=>{const{FreeTrialService:_}=await import("./index-Drf-Kel-.js").then(T=>T.b0);return{FreeTrialService:_}},__vite__mapDeps([0,1])),p=await c.resetActiveTrialToCurrentDuration(a);alert(p.message)}catch(c){console.error("Error resetting user trial end:",c),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},Ts=(a,c)=>{console.log("Toggling user status:",a,c)},_t=a=>a?(a.toDate?a.toDate():new Date(a)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",Es=[{id:"users",label:"المستخدمين",icon:tt},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:te},{id:"trials",label:"إدارة التجارب المجانية",icon:fe},{id:"content",label:"إدارة المحتوى",icon:Zs},{id:"chat",label:"الدردشة",icon:le},{id:"whatsapp",label:"إدارة الواتساب",icon:le},{id:"analytics",label:"الإحصائيات",icon:St}];return l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:i})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{o(null),u(!0),window.location.reload()},className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"🔄 إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{o(null),t("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",i),console.log("🔍 Auth state:",s.currentUser),console.log("🔍 Dev mode:",r),console.log("🔍 Environment:",ma)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!r&&!s.currentUser?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>t("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:`${E?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[E&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Tr,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>Q(!E),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:E?e.jsx(Te,{className:"w-5 h-5"}):e.jsx(Dr,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:Es.map(a=>{const c=a.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>g(a.id),className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${d===a.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(c,{className:"w-5 h-5"}),E&&e.jsx("span",{className:"font-medium",children:a.label})]})},a.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:ms,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(zs,{className:"w-5 h-5"}),E&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[d==="users"&&"إدارة المستخدمين",d==="subscriptions"&&"مواعيد الاشتراكات",d==="trials"&&"إدارة التجارب المجانية",d==="chat"&&"إدارة الدردشة",d==="analytics"&&"الإحصائيات"]}),r&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",r?"المطور":"المدير"]}),e.jsx(sr,{})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[d==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:f.length})]}),e.jsx(tt,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:ze,onChange:a=>xt(a.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.filter(a=>a.isActive).length})]}),e.jsx(Mt,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.filter(a=>!a.isActive).length})]}),e.jsx(Ur,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:$,onChange:a=>ne(a.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),$&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",U.length," من أصل ",f.length," مستخدم",$&&e.jsx("button",{onClick:()=>ne(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:A?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):U.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:$?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:U.map(a=>e.jsx(Wr,{user:a,onActivateSubscription:hs,onToggleUserStatus:Ts,onDeactivateSubscription:xs,onDeleteUser:gs},a.id))})})]})]}),d==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.filter(a=>{var c;return(c=a.subscription)==null?void 0:c.isActive}).length})]}),e.jsx(st,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:f.filter(a=>{var N,B;if(!((N=a.subscription)!=null&&N.endDate)||!((B=a.subscription)!=null&&B.isActive))return!1;const c=a.subscription.endDate.toDate?a.subscription.endDate.toDate():new Date(a.subscription.endDate),p=new Date,_=c.getTime()-p.getTime(),T=Math.ceil(_/(1e3*60*60*24));return T<=7&&T>0}).length})]}),e.jsx(Oe,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.filter(a=>{var p;return(p=a.subscription)!=null&&p.endDate?(a.subscription.endDate.toDate?a.subscription.endDate.toDate():new Date(a.subscription.endDate))<new Date:!1}).length})]}),e.jsx(de,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:f.filter(a=>{var c;return((c=a.subscription)==null?void 0:c.planType)===S.LIFETIME}).length})]}),e.jsx(Le,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:A?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.filter(a=>{var c;return(c=a.subscription)==null?void 0:c.planType}).sort((a,c)=>{var T,N;if(!((T=a.subscription)!=null&&T.endDate)||!((N=c.subscription)!=null&&N.endDate))return 0;const p=a.subscription.endDate.toDate?a.subscription.endDate.toDate():new Date(a.subscription.endDate),_=c.subscription.endDate.toDate?c.subscription.endDate.toDate():new Date(c.subscription.endDate);return p.getTime()-_.getTime()}).map(a=>{const c=a.subscription;if(!c)return null;const p=c.startDate?c.startDate.toDate?c.startDate.toDate():new Date(c.startDate):null,_=c.endDate?c.endDate.toDate?c.endDate.toDate():new Date(c.endDate):null;let T=null,N="غير محدد";if(c.planType===S.LIFETIME)N="مدى الحياة";else if(_){const B=new Date,Z=_.getTime()-B.getTime();T=Math.ceil(Z/(1e3*60*60*24)),T<0?N="منتهي":T<=7?N="ينتهي قريباً":N="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:Ve(a)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ne(a)}),e.jsx("div",{className:"text-sm text-gray-500",children:a.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[c.planType===S.LIFETIME&&e.jsx(Le,{className:"w-4 h-4 text-yellow-500 ml-2"}),c.planType===S.YEARLY&&e.jsx(fe,{className:"w-4 h-4 text-blue-500 ml-2"}),c.planType===S.QUARTERLY&&e.jsx(te,{className:"w-4 h-4 text-purple-500 ml-2"}),c.planType===S.MONTHLY&&e.jsx(et,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ys(c.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:p?p.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.planType===S.LIFETIME?"مدى الحياة":_?_.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N==="نشط"?"bg-green-100 text-green-800":N==="ينتهي قريباً"?"bg-orange-100 text-orange-800":N==="منتهي"?"bg-red-100 text-red-800":N==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:N})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.planType===S.LIFETIME?"∞":T!==null?T<0?"منتهي":`${T} يوم`:"غير محدد"})]},a.id)}).filter(Boolean)})]})})]})]}),d==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),R&&R.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(R.lastUpdated).toLocaleString("ar-SA"),R.updatedBy&&` بواسطة: ${R.updatedBy}`]})]}),e.jsxs("button",{onClick:fs,disabled:I,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(Ht,{className:"w-4 h-4"}),I?"جاري الحفظ...":"حفظ جميع التغييرات"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(ye).map(([a,c])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[a==="monthly"&&e.jsx(et,{className:"w-4 h-4 text-green-500"}),a==="quarterly"&&e.jsx(te,{className:"w-4 h-4 text-purple-500"}),a==="yearly"&&e.jsx(fe,{className:"w-4 h-4 text-blue-500"}),a==="lifetime"&&e.jsx(Le,{className:"w-4 h-4 text-yellow-500"}),c.name]}),e.jsx("button",{onClick:()=>k(me===a?null:a),className:"text-purple-600 hover:text-purple-800",children:e.jsx(cr,{className:"w-4 h-4"})})]}),me===a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:c.name,onChange:p=>ke(a,"name",p.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:c.price,onChange:p=>ke(a,"price",p.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:c.period,onChange:p=>ke(a,"period",p.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:c.description,onChange:p=>ke(a,"description",p.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>ps(a),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:c.features.map((p,_)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:T=>bs(a,_,T.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>ys(a,_),className:"text-red-500 hover:text-red-700",children:e.jsx(Te,{className:"w-4 h-4"})})]},_))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.price}),e.jsx("div",{className:"text-sm text-gray-600",children:c.period}),e.jsx("div",{className:"text-sm text-gray-700",children:c.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),c.features.map((p,_)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3 text-green-500"}),p]},_))]})]})]},a))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:He,onChange:a=>dt(a.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:qe,onChange:a=>ut(a.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:mt,onChange:a=>ht(a.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:us,disabled:gt,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:gt?"جاري الإرسال...":"إرسال إشعار"})})]})]})]}),d==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",f),console.log("🔍 Users count:",(f==null?void 0:f.length)||0),console.log("🔍 Users on trial:",((Tt=f==null?void 0:f.filter(a=>a.isOnFreeTrial))==null?void 0:Tt.length)||0),A&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),i&&!A&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Oe,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:i}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!A&&!i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f.filter(a=>a.isOnFreeTrial).length})]}),e.jsx(fe,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.filter(a=>a.hasUsedFreeTrial&&!a.isOnFreeTrial).length})]}),e.jsx(de,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.filter(a=>!a.hasUsedFreeTrial&&!a.isOnFreeTrial&&!a.approved).length})]}),e.jsx(Mt,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:yt,onChange:a=>Nt(a.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",z," ",z>=3&&z<=10?"ساعات":z===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:ws,disabled:jt,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:jt?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ce,onChange:a=>pt(a.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Ke,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[f.filter(a=>!a.hasUsedFreeTrial&&!a.isOnFreeTrial&&!a.approved).filter(a=>{const c=Ce.trim().toLowerCase();if(!c)return!0;const p=Ne(a).toLowerCase(),_=(a.email||"").toLowerCase();return p.includes(c)||_.includes(c)}).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:Ve(a)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:Ne(a)}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",_t(a.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>vs(a.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${z} ${z>=3&&z<=10?"ساعات":z===2?"ساعتين":"ساعة"}`})})]},a.id)),f.filter(a=>!a.hasUsedFreeTrial&&!a.isOnFreeTrial&&!a.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),f.filter(a=>a.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ce,onChange:a=>pt(a.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Ke,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:f.filter(a=>a.isOnFreeTrial).filter(a=>{const c=Ce.trim().toLowerCase();if(!c)return!0;const p=Ne(a).toLowerCase(),_=(a.email||"").toLowerCase();return p.includes(c)||_.includes(c)}).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:Ve(a)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:Ne(a)}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",a.freeTrialEndDate?_t(a.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>_s(a.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"})]})]},a.id))})})]})]})]}),d==="chat"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx(ua,{isOpen:!0,onClose:()=>{}})}),d==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(le,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(Lr,{})]}),d==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(St,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(Yr,{isOpen:os,onClose:()=>h(!1)}),e.jsx(Gr,{notification:cs,onClose:js,soundEnabled:Re.soundAlerts,onToggleSound:Ns})]})},ri=()=>{const t=Js(),{user:s,loading:r}=er(),[n,i]=b.useState(!1),[o,l]=b.useState(null),[u,d]=b.useState(!1),[g,h]=b.useState("users"),[j,m]=b.useState(0),[w,y]=b.useState([]),[f,C]=b.useState([]),[U,v]=b.useState(!1),[A,M]=b.useState(null);b.useEffect(()=>{const E=localStorage.getItem("admin_dev_mode")==="true";i(E)},[]),b.useEffect(()=>{if(!(!n&&!s)){d(!0),l(null);try{const E=ee(H(L,"users")),Q=Je(E,$=>{const ne=$.docs.map(me=>({id:me.id,...me.data()}));y(ne),C(ne),d(!1),l(null)},$=>{console.error("Error loading users:",$),n?(y([]),C([]),d(!1),l(null)):(l("فشل في تحميل بيانات المستخدمين"),d(!1))});return()=>Q()}catch(E){console.error("Error setting up users listener:",E),n?(y([]),C([]),d(!1),l(null)):(l("فشل في إعداد مراقب البيانات"),d(!1))}}},[s,n]);const k=E=>{console.log("Notification center:",E)},I=E=>{console.log("Notification settings:",E)},x=E=>{console.log("Notifications:",E)},R=E=>{console.log("Editing plan:",E)};b.useEffect(()=>{(async()=>{try{const E=await Ut();M(E)}catch(E){console.warn("Failed to load last update info:",E),M(null)}})()},[]);const D=async()=>{try{return await Er()}catch(E){return console.error("Error loading content:",E),{}}},F=async E=>{try{v(!0);try{localStorage.setItem("siteContent_plans_cache",JSON.stringify(E))}catch{}await Rr(E,(s==null?void 0:s.uid)||"admin");const Q=await Ut();return M(Q),!0}catch(Q){return console.error("Error saving content:",Q),!1}finally{v(!1)}};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):e.jsx(ha,{navigate:t,auth:tr,devMode:n,setDevMode:i,error:o,setError:l,authLoading:r,setAuthLoading:()=>{},activeTab:g,setActiveTab:h,setNotificationCenterOpen:k,setNotificationSettings:I,setNotifications:x,notificationCount:j,setNotificationCount:m,users:w,setUsers:y,filteredUsers:f,setFilteredUsers:C,loading:u,setLoading:d,setEditingPlan:R,isSavingContent:U,setIsSavingContent:v,lastUpdateInfo:A,loadContentFromFirebase:D,saveContentToFirebase:F})};export{ri as default};
