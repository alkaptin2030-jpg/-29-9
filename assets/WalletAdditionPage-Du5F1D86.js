import{c as me,a as he,b as ue,d as pe,u as fe,r as l,a4 as y,j as e,a5 as ge,a6 as xe,S as $,a7 as ye}from"./index-DLB6adv0.js";import{C as G,a as ve,b as we,d as K}from"./card-Curo_9Lp.js";import{B as k}from"./button-CaTNqGZH.js";import{I as h}from"./input-9quFkSAk.js";import{L as c}from"./label-Dvr0e7z3.js";import{S as Ne,a as je,b as be,c as We,d as Le}from"./select-PiSG6a24.js";import{A as Ce}from"./arrow-left-DBEVDtS5.js";import{W as Se}from"./wallet-BV2LcfDm.js";import{P as Ie}from"./phone-DZOekXsV.js";import{C as Te}from"./circle-alert-_g7YJ02S.js";import"./index-BkZD9WOn.js";import"./Combination-xeO4bPI6.js";import"./index-BCpOq52w.js";import"./check-DFHsRF1q.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=me("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),qe=()=>{const P=he(),[C]=ue(),{toast:f}=pe(),{user:s,userSubscription:g}=fe(),[x,F]=l.useState(""),[p,D]=l.useState(""),[S,Q]=l.useState(""),[I,X]=l.useState(""),[v,E]=l.useState(""),[w,M]=l.useState("200000"),[N,O]=l.useState("200000"),[W,Y]=l.useState("100000"),[L,ee]=l.useState("60000"),[n,U]=l.useState(""),[o,_]=l.useState(""),[B,te]=l.useState(!1),[R,A]=l.useState(!1),[z,T]=l.useState([]),[j,ae]=l.useState(!1),[J,se]=l.useState(null),[le,ie]=l.useState(""),[re,ne]=l.useState(""),oe=[{id:"vodafone",name:"فودافون كاش",color:"bg-red-500"},{id:"etisalat",name:"اتصالات كاش",color:"bg-green-500"},{id:"orange",name:"أورنج كاش",color:"bg-orange-500"},{id:"we_pay",name:"وي باي",color:"bg-purple-500"},{id:"smart_wallet",name:"سمارت ولت",color:"bg-blue-500"},{id:"access_pay",name:"أكسس باي",color:"bg-teal-500"},{id:"insta_pay",name:"انستا باي",color:"bg-pink-500"}],b=()=>`wallets_${(s==null?void 0:s.uid)||"default"}`;l.useEffect(()=>{de()},[s==null?void 0:s.uid]);const Z=a=>{switch(a){case"vodafone":return"vodafone_cash";case"etisalat":return"etisalat_cash";case"orange":return"orange_cash";case"insta_pay":return"instapay";default:return a}},q=a=>{switch(a){case"vodafone_cash":return"vodafone";case"etisalat_cash":return"etisalat";case"orange_cash":return"orange";case"instapay":return"insta_pay";default:return a}};l.useEffect(()=>{const a=C.get("edit")==="1",r=C.get("id");ae(a),se(r),a&&r&&(async()=>{try{const t=await y.getById(r);t&&(F(t.label||""),D(t.msisdn||""),E(q(t.provider||"")),M(String(t.withdrawLimit||2e5)),O(String(t.transferLimit||2e5)),U((t.defaultTransferCommission??"").toString()),_((t.defaultWithdrawCommission??"").toString()),ie(t.msisdn||""),ne(t.provider||""))}catch(t){console.error("Error loading wallet for edit:",t)}})()},[C]);const de=async()=>{if(s!=null&&s.uid)try{const a=await y.getByMerchantId(s.uid);if(a&&a.length>0){const r=a.map(t=>({id:t.id,name:t.label||"",phone:t.msisdn||"",isDefault:!1,monthlyWithdrawalLimit:typeof t.withdrawLimit=="number"?t.withdrawLimit:0,monthlyTransferLimit:typeof t.transferLimit=="number"?t.transferLimit:0,monthlyWithdrawalUsage:typeof t.withdrawUsage=="number"?t.withdrawUsage:0,monthlyTransferUsage:typeof t.transferUsage=="number"?t.transferUsage:0,lastResetDate:void 0,walletProvider:q(t.provider||""),defaultTransferCommission:t.defaultTransferCommission??null,defaultWithdrawCommission:t.defaultWithdrawCommission??null,dailyWithdrawalLimit:void 0,dailyTransferLimit:void 0}));T(r)}else{const r=localStorage.getItem(b());if(r)try{const t=JSON.parse(r);T(t)}catch(t){console.warn("Failed to parse local wallets backup:",t)}}}catch(a){console.error("Error loading wallets:",a);const r=localStorage.getItem(b());if(r)try{const t=JSON.parse(r);T(t)}catch(t){console.warn("Failed to parse local wallets backup:",t)}}},ce=async a=>{var r;if(a.preventDefault(),!x||!p){f({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!j&&(s!=null&&s.uid))try{if((await y.getByMerchantId(s.uid)).some(u=>(u.msisdn||"").trim()===p.trim())){f({title:"خطأ",description:"رقم الهاتف مستخدم بالفعل",variant:"destructive"});return}}catch(t){console.warn("Duplicate phone check failed:",t)}if(!j&&(s!=null&&s.uid))try{let t=!1;const d=((r=g==null?void 0:g.subscription)==null?void 0:r.planType)??(g==null?void 0:g.planType)??null,u=typeof d=="string"?d.toLowerCase():null;if(d===$.ZERO||u==="zero"||d===0||u==="0")t=!0;else{const m=await ye(s.uid),i=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,V=typeof i=="string"?i.toLowerCase():null;t=i===$.ZERO||V==="zero"||i===0||V==="0"}if(t&&(await y.getByMerchantId(s.uid)).length>=5){f({title:"تحذير",description:"باقة زيرو تسمح بإضافة 5 محافظ فقط. قم بالترقية.",variant:"destructive"});return}}catch(t){console.warn("Zero plan limit check failed:",t)}A(!0);try{const t=new Date().toISOString().split("T")[0];if(j&&J){await y.update(J,{provider:Z(v||re||""),msisdn:p,label:x,transferLimit:parseInt(N),withdrawLimit:parseInt(w),defaultTransferCommission:n!=null&&n.trim()!==""?parseFloat(n):null,defaultWithdrawCommission:o!=null&&o.trim()!==""?parseFloat(o):null});try{const d=localStorage.getItem(b());if(d){const m=JSON.parse(d).map(i=>i.phone===le?{...i,name:x,phone:p,nationalId:I||i.nationalId,ownerName:S||i.ownerName,monthlyWithdrawalLimit:parseInt(w),monthlyTransferLimit:parseInt(N),defaultTransferCommission:n!=null&&n.trim()!==""?parseFloat(n):null,defaultWithdrawCommission:o!=null&&o.trim()!==""?parseFloat(o):null,walletProvider:v||i.walletProvider,dailyWithdrawalLimit:W?parseInt(W):i.dailyWithdrawalLimit,dailyTransferLimit:L?parseInt(L):i.dailyTransferLimit}:i);localStorage.setItem(b(),JSON.stringify(m))}}catch(d){console.warn("Failed to update local wallet backup:",d)}f({title:"تم التحديث",description:"تم تحديث بيانات المحفظة بنجاح"})}else{const d={merchantUserId:(s==null?void 0:s.uid)||"",provider:Z(v),msisdn:p,label:x,isActive:!0,dailyLimit:5e4,monthlyLimit:3e5,transferLimit:parseInt(N),withdrawLimit:parseInt(w),transferUsage:0,withdrawUsage:0,defaultTransferCommission:n!=null&&n.trim()!==""?parseFloat(n):null,defaultWithdrawCommission:o!=null&&o.trim()!==""?parseFloat(o):null};let u;s!=null&&s.uid?u=await y.create(d):u=Date.now().toString();const m={id:u,name:x,phone:p,ownerName:S,nationalId:I,isDefault:B||z.length===0,monthlyWithdrawalLimit:parseInt(w),monthlyTransferLimit:parseInt(N),monthlyWithdrawalUsage:0,monthlyTransferUsage:0,dailyWithdrawalLimit:parseInt(W),dailyTransferLimit:parseInt(L),lastResetDate:t,walletProvider:v,defaultTransferCommission:n!=null&&n.trim()!==""?parseFloat(n):null,defaultWithdrawCommission:o!=null&&o.trim()!==""?parseFloat(o):null},i=[...z,m];localStorage.setItem(b(),JSON.stringify(i)),f({title:"تم الإنشاء",description:"تم إنشاء المحفظة بنجاح"})}P("/user/dashboard")}catch(t){console.error("Error saving wallet:",t),f({title:"خطأ",description:"حدث خطأ أثناء حفظ المحفظة",variant:"destructive"})}finally{A(!1)}},H=()=>{P("/user/dashboard")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:H,className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"العودة"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ge,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:j?"تعديل المحفظة":"إضافة محفظة جديدة"})]})]}),e.jsxs(G,{className:"shadow-lg",children:[e.jsx(ve,{children:e.jsxs(we,{className:"flex items-center gap-2 text-right",children:[e.jsx(Se,{className:"h-5 w-5 text-blue-600"}),"بيانات المحفظة"]})}),e.jsx(K,{children:e.jsxs("form",{onSubmit:ce,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"walletName",className:"text-right block font-medium",children:"اسم المحفظة *"}),e.jsx(h,{id:"walletName",type:"text",placeholder:"مثال: محفظة العمل",value:x,onChange:a=>F(a.target.value),className:"text-right",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"walletPhone",className:"text-right block font-medium",children:"رقم الهاتف *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(h,{id:"walletPhone",type:"tel",placeholder:"01xxxxxxxxx",value:p,onChange:a=>D(a.target.value),className:"text-right pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"walletOwnerName",className:"text-right block font-medium",children:"اسم صاحب المحفظة (اختياري)"}),e.jsx(h,{id:"walletOwnerName",type:"text",placeholder:"اسم صاحب المحفظة",value:S,onChange:a=>Q(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"walletNationalId",className:"text-right block font-medium",children:"الرقم القومي (اختياري)"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(h,{id:"walletNationalId",type:"text",placeholder:"الرقم القومي",value:I,onChange:a=>X(a.target.value),className:"text-right pl-10"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-blue-700 bg-blue-50 border border-blue-100 p-3 rounded",children:[e.jsx(Te,{className:"h-4 w-4 mt-0.5"}),e.jsx("p",{className:"text-sm text-right",children:'يمكن ترك "عمولة التحويل" و"عمولة السحب" فارغتين إذا أردت إدخال العمولة يدويًا أثناء تنفيذ العملية، أو كتابتهما هنا لتكونا قيمًا افتراضية تُستخدم تلقائيًا.'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"defaultTransferCommission",className:"text-right block font-medium",children:"عمولة التحويل (افتراضية - اختياري)"}),e.jsx(h,{id:"defaultTransferCommission",type:"number",step:"0.01",min:"0",placeholder:"أدخل عمولة التحويل الافتراضية (مثال: 5)",value:n,onChange:a=>U(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"defaultWithdrawCommission",className:"text-right block font-medium",children:"عمولة السحب (افتراضية - اختياري)"}),e.jsx(h,{id:"defaultWithdrawCommission",type:"number",step:"0.01",min:"0",placeholder:"أدخل عمولة السحب الافتراضية (مثال: 5)",value:o,onChange:a=>_(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"walletProvider",className:"text-right block font-medium",children:"شركة المحفظة"}),e.jsxs(Ne,{value:v,onValueChange:E,children:[e.jsx(je,{className:"text-right",children:e.jsx(be,{placeholder:"اختر شركة المحفظة"})}),e.jsx(We,{children:oe.map(a=>e.jsx(Le,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.color}`}),a.name]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"monthlyWithdrawalLimit",className:"text-right block font-medium",children:"حد السحب الشهري"}),e.jsx(h,{id:"monthlyWithdrawalLimit",type:"number",value:w,onChange:a=>M(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"monthlyTransferLimit",className:"text-right block font-medium",children:"حد التحويل الشهري"}),e.jsx(h,{id:"monthlyTransferLimit",type:"number",value:N,onChange:a=>O(a.target.value),className:"text-right"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"dailyWithdrawalLimit",className:"text-right block font-medium",children:"حد السحب اليومي"}),e.jsx(h,{id:"dailyWithdrawalLimit",type:"number",value:W,onChange:a=>Y(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"dailyTransferLimit",className:"text-right block font-medium",children:"حد التحويل اليومي"}),e.jsx(h,{id:"dailyTransferLimit",type:"number",value:L,onChange:a=>ee(a.target.value),className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(c,{htmlFor:"isDefault",className:"font-medium",children:"جعل هذه المحفظة افتراضية"}),e.jsx("input",{id:"isDefault",type:"checkbox",checked:B,onChange:a=>te(a.target.checked),className:"rounded"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:H,className:"flex-1",children:"إلغاء"}),e.jsx(k,{type:"submit",disabled:R,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:R?"جاري الحفظ...":j?"حفظ التعديلات":"إضافة المحفظة"})]})]})})]}),e.jsx(G,{className:"mt-6 bg-blue-50 border-blue-200",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ke,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"معلومات مهمة:"}),e.jsxs("ul",{className:"space-y-1 text-blue-700",children:[e.jsx("li",{children:"• تأكد من صحة رقم الهاتف المدخل"}),e.jsx("li",{children:"• يمكنك تعديل الحدود الشهرية لاحقاً"}),e.jsx("li",{children:"• المحفظة الافتراضية ستكون الخيار الأول في المعاملات"})]})]})]})})})]})})};export{qe as default};
