import{v as l,f as o,H as d,s as n,K as y,a0 as h}from"./index-B6U9UJBf.js";const c={getCurrentDayId(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},async setLimits(e,t){try{const i=l(o,"walletLimits",e),r={updatedAt:n()};return t.dailyTransferLimit!==void 0&&(r.dailyTransferLimit=t.dailyTransferLimit),t.dailyWithdrawLimit!==void 0&&(r.dailyWithdrawLimit=t.dailyWithdrawLimit),t.monthlyTransferLimit!==void 0&&(r.monthlyTransferLimit=t.monthlyTransferLimit),t.monthlyWithdrawLimit!==void 0&&(r.monthlyWithdrawLimit=t.monthlyWithdrawLimit),await d(i,r,{merge:!0}),await this.getWalletLimits(e)}catch(i){return console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:",i),null}},getCurrentMonthId(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`},shouldResetDailyLimits(e){if(!e)return!0;const t=new Date,i=e.toDate();return t.getDate()!==i.getDate()||t.getMonth()!==i.getMonth()||t.getFullYear()!==i.getFullYear()},shouldResetMonthlyLimits(e){if(!e)return!0;const t=new Date,i=e.toDate();return t.getMonth()!==i.getMonth()||t.getFullYear()!==i.getFullYear()},async getWalletLimits(e){try{const t=l(o,"walletLimits",e),i=await y(t);if(i.exists()){const a=i.data();return{walletId:e,dailyTransferLimit:a.dailyTransferLimit||6e4,dailyWithdrawLimit:a.dailyWithdrawLimit||1e5,dailyTransferUsed:a.dailyTransferUsed||0,dailyWithdrawUsed:a.dailyWithdrawUsed||0,lastDailyReset:a.lastDailyReset||null,monthlyTransferLimit:a.monthlyTransferLimit||2e5,monthlyWithdrawLimit:a.monthlyWithdrawLimit||2e5,monthlyTransferUsed:a.monthlyTransferUsed||0,monthlyWithdrawUsed:a.monthlyWithdrawUsed||0,lastMonthlyReset:a.lastMonthlyReset||null,updatedAt:a.updatedAt||h.now()}}const r={walletId:e,dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:null,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:null,updatedAt:h.now()};return await d(t,{dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:null,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:null,updatedAt:n()}),r}catch(t){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:",t),null}},async resetDailyLimits(e){try{const t=l(o,"walletLimits",e);return await d(t,{dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:n(),updatedAt:n()},{merge:!0}),console.log(`ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø© ${e}`),!0}catch(t){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:",t),!1}},async resetMonthlyLimits(e){try{const t=l(o,"walletLimits",e);return await d(t,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:n(),updatedAt:n()},{merge:!0}),console.log(`ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø© ${e}`),!0}catch(t){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©:",t),!1}},async autoResetLimitsIfNeeded(e){try{const t=await this.getWalletLimits(e);if(!t)return null;let i=!1;return this.shouldResetDailyLimits(t.lastDailyReset)&&(await this.resetDailyLimits(e),i=!0),this.shouldResetMonthlyLimits(t.lastMonthlyReset)&&(await this.resetMonthlyLimits(e),i=!0),i?await this.getWalletLimits(e):t}catch(t){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯:",t),null}},async canPerformOperation(e,t,i){try{const r=await this.autoResetLimitsIfNeeded(e);if(!r)return{canPerform:!1,message:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©"};if(i==="transfer"){const a=r.dailyTransferLimit-r.dailyTransferUsed;if(t>a)return{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${a.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${r.dailyTransferLimit.toLocaleString()} Ø¬.Ù…`,dailyRemaining:a,limitType:"daily"};const s=r.monthlyTransferLimit-r.monthlyTransferUsed;return t>s?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${s.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${r.monthlyTransferLimit.toLocaleString()} Ø¬.Ù…`,monthlyRemaining:s,limitType:"monthly"}:{canPerform:!0,dailyRemaining:a-t,monthlyRemaining:s-t}}if(i==="withdraw"){const a=r.dailyWithdrawLimit-r.dailyWithdrawUsed;if(t>a)return{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø³Ø­Ø¨. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${a.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${r.dailyWithdrawLimit.toLocaleString()} Ø¬.Ù…`,dailyRemaining:a,limitType:"daily"};const s=r.monthlyWithdrawLimit-r.monthlyWithdrawUsed;return t>s?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ø³Ø­Ø¨. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${s.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${r.monthlyWithdrawLimit.toLocaleString()} Ø¬.Ù…`,monthlyRemaining:s,limitType:"monthly"}:{canPerform:!0,dailyRemaining:a-t,monthlyRemaining:s-t}}return{canPerform:!1,message:"Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­"}}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:",r),{canPerform:!1,message:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯"}}},async updateUsage(e,t,i){try{const r=await this.canPerformOperation(e,t,i);if(!r.canPerform)throw new Error(r.message||"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©");const a=l(o,"walletLimits",e),s=await this.getWalletLimits(e);if(!s)throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©");const m={updatedAt:n()};return i==="transfer"?(m.dailyTransferUsed=s.dailyTransferUsed+t,m.monthlyTransferUsed=s.monthlyTransferUsed+t):i==="withdraw"&&(m.dailyWithdrawUsed=s.dailyWithdrawUsed+t,m.monthlyWithdrawUsed=s.monthlyWithdrawUsed+t),await d(a,m,{merge:!0}),await this.getWalletLimits(e)}catch(r){throw console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©:",r),r}},calculateRemaining(e){return{dailyTransferRemaining:Math.max(0,e.dailyTransferLimit-e.dailyTransferUsed),dailyWithdrawRemaining:Math.max(0,e.dailyWithdrawLimit-e.dailyWithdrawUsed),monthlyTransferRemaining:Math.max(0,e.monthlyTransferLimit-e.monthlyTransferUsed),monthlyWithdrawRemaining:Math.max(0,e.monthlyWithdrawLimit-e.monthlyWithdrawUsed)}},async resetAllLimits(e){try{const t=l(o,"walletLimits",e);return await d(t,{dailyTransferUsed:0,dailyWithdrawUsed:0,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastDailyReset:n(),lastMonthlyReset:n(),updatedAt:n()},{merge:!0}),console.log(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ${e}`),await this.getWalletLimits(e)}catch(t){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¯ÙˆØ¯:",t),null}}};export{c as default,c as walletDailyLimitsService};
