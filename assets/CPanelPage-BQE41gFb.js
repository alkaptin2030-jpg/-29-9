import{u as E,r as t,j as e,z as I,A as $,k as L,g as T,v as H,B as O}from"./index-B05GXhax.js";import{C as R,a as z,b as q,d as G}from"./card-DnZtAmLe.js";import{B as v}from"./button-DNYNxb0H.js";import{I as x}from"./input-DE-9RJ6u.js";import{L as g}from"./label-CVapxVb2.js";import{D as J,a as K,b as Q,c as U,d as V}from"./dialog-CppTfRgl.js";import"./Combination-AlMTIFu-.js";function se(){var F;const{user:l,profile:n,isSubscriptionActive:k,userSubscription:p}=E(),[D,o]=t.useState(!1),[c,f]=t.useState(""),[d,C]=t.useState(""),[m,N]=t.useState(""),[u,w]=t.useState(""),[j,b]=t.useState(!1),[S,r]=t.useState(null),A=((F=p==null?void 0:p.branchPackage)==null?void 0:F.status)==="active",h=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="merchant"||k||A,y=()=>{f(""),C(""),N(""),w("")},M=async()=>{if(r(null),!h){r("هذه العملية تتطلب اشتراكًا مفعلًا أو صلاحية مدير/تاجر.");return}if(!c||!d||!m||!u){r("يرجى ملء جميع الحقول المطلوبة.");return}try{b(!0);try{const s=await I($,"createShopAndManager")({shopName:c,managerName:d,email:m,password:u}),i=s==null?void 0:s.data;if(i!=null&&i.success){r(`تم إنشاء المتجر (${i.shopId}) ومدير الحساب بنجاح.`),y(),o(!1);return}else throw new Error("فشل إنشاء الحساب عبر الدالة السحابية")}catch{const s=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),i=L(T,"managerInvites",s),P=1e3*60*60*24*7;await H(i,{token:s,email:m,managerName:d,shopName:c,createdBy:(l==null?void 0:l.uid)||null,status:"pending",createdAt:O(),expiresAt:Date.now()+P});const B=`${window.location.origin}/invite/${s}`;r(`تعذّر تنفيذ الدالة السحابية. تم إنشاء دعوة للمدير بدلًا من ذلك.
          شارك هذا الرابط مع المدير لإكمال إنشاء الحساب: ${B}`),y(),o(!1)}}catch(a){const s=(a==null?void 0:a.message)||"حدث خطأ غير متوقع أثناء الإنشاء";r(s)}finally{b(!1)}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs(R,{children:[e.jsx(z,{children:e.jsx(q,{children:"لوحة التحكم (CPanel)"})}),e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"إضافة محل جديد مع إنشاء حساب المدير ليتسجل من صفحة الدخول العادية."})}),e.jsx(v,{onClick:()=>o(!0),disabled:!h,children:"إضافة محل"})]}),!l&&e.jsx("p",{className:"mt-3 text-sm text-red-600",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم."}),l&&!h&&e.jsx("p",{className:"mt-3 text-sm text-red-600",children:"حسابك ليس لديه صلاحيات كافية أو اشتراك/باقة فروع مفعّلة لإنشاء المحلات. إذا كنت مشتركًا بباقة مدفوعة أو لديك باقة فروع مفعّلة، ستتمكن من إضافة الحسابات مباشرة."})]})]}),e.jsx(J,{open:D,onOpenChange:o,children:e.jsxs(K,{children:[e.jsx(Q,{children:e.jsx(U,{children:"إضافة محل ومدير"})}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"shopName",children:"اسم المحل"}),e.jsx(x,{id:"shopName",value:c,onChange:a=>f(a.target.value),placeholder:"مثال: متجر أحمد"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"managerName",children:"اسم المدير"}),e.jsx(x,{id:"managerName",value:d,onChange:a=>C(a.target.value),placeholder:"مثال: أحمد علي"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"email",children:"الإيميل"}),e.jsx(x,{id:"email",type:"email",value:m,onChange:a=>N(a.target.value),placeholder:"example@mail.com"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"password",children:"الباسوورد"}),e.jsx(x,{id:"password",type:"password",value:u,onChange:a=>w(a.target.value),placeholder:"••••••••"})]}),S&&e.jsx("p",{className:"text-sm text-muted-foreground",children:S})]}),e.jsxs(V,{children:[e.jsx(v,{variant:"outline",onClick:()=>o(!1),disabled:j,children:"إلغاء"}),e.jsx(v,{onClick:M,disabled:j||!h,children:j?"جاري الإنشاء...":"إنشاء الحساب"})]})]})})]})}export{se as default};
