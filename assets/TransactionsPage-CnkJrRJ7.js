const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/walletDailyLimitsService-BdOys8Z9.js","assets/index-Brx_EIwU.js","assets/index-hBtk-z8N.css","assets/profitService-WOL_cZ8K.js","assets/reportsService-Bp1Io21u.js"])))=>i.map(i=>d[i]);
import{G as ut,r as n,I as pt,j as t,P as Z,K as ne,ac as ht,A as ce,a as xt,u as gt,R as ie,S as vt,ai as ft,Y as bt,q as yt,f as Nt,g as Te,a5 as jt,o as St,p as Ct,ab as J,aj as X,ak as b,al as Tt,am as At,a9 as Dt,C as Ae,a0 as wt,n as _t,_ as k,e as De}from"./index-Brx_EIwU.js";import{C as Ot,a as It,b as Pt,d as kt}from"./card-DcMt7Ygu.js";import{B as N}from"./button-Cav0YM4S.js";import{I as le}from"./input-xv6hsm6A.js";import{D as Et,a as Rt,b as Mt,c as Lt}from"./dialog-KSYS8EzA.js";import{S as $t,a as zt,b as Bt,c as Ft,d as q}from"./select-BUSB9dxR.js";import{B as H}from"./badge-BL-CV2RM.js";import{c as Oe,R as Wt,I as Ut}from"./index-CBQyfufQ.js";import{u as Vt}from"./index-CFDTkUyQ.js";import{u as Gt}from"./Combination-BCYDCa57.js";import{B as we,C as Kt,a as Jt,M as Xt,b as qt,R as Ht}from"./MaintenanceDialog-DoIFs3Yt.js";import{P as Zt}from"./PasswordConfirmDialog-Cqh1S-HO.js";import{M as Yt}from"./MasterPinDialog-C_Oo0Ga9.js";import{A as Qt}from"./arrow-left-C-38ctOq.js";import{S as es}from"./separator-DFUBh5ry.js";import{C as ts}from"./calendar-D5QCA-_h.js";import{T as _e}from"./progress-D9WgYQDK.js";import{C as ss}from"./circle-x-Cd2kng-6.js";import{C as as}from"./circle-check-big-B8nVPUKS.js";import"./index-C4lnpm54.js";import"./lock-Cr2Hihfy.js";import"./eye-CJLnakto.js";import"./label-BN7si8OP.js";import"./circle-alert-fiPZzaVx.js";import"./shield-D9epBb-f.js";var Y="Tabs",[rs,Ls]=ut(Y,[Oe]),Ie=Oe(),[os,de]=rs(Y),Pe=n.forwardRef((p,s)=>{const{__scopeTabs:c,value:m,onValueChange:y,defaultValue:w,orientation:v="horizontal",dir:j,activationMode:I="automatic",..._}=p,C=Vt(j),[S,D]=pt({prop:m,onChange:y,defaultProp:w??"",caller:Y});return t.jsx(os,{scope:c,baseId:Gt(),value:S,onValueChange:D,orientation:v,dir:C,activationMode:I,children:t.jsx(Z.div,{dir:C,"data-orientation":v,..._,ref:s})})});Pe.displayName=Y;var ke="TabsList",Ee=n.forwardRef((p,s)=>{const{__scopeTabs:c,loop:m=!0,...y}=p,w=de(ke,c),v=Ie(c);return t.jsx(Wt,{asChild:!0,...v,orientation:w.orientation,dir:w.dir,loop:m,children:t.jsx(Z.div,{role:"tablist","aria-orientation":w.orientation,...y,ref:s})})});Ee.displayName=ke;var Re="TabsTrigger",Me=n.forwardRef((p,s)=>{const{__scopeTabs:c,value:m,disabled:y=!1,...w}=p,v=de(Re,c),j=Ie(c),I=ze(v.baseId,m),_=Be(v.baseId,m),C=m===v.value;return t.jsx(Ut,{asChild:!0,...j,focusable:!y,active:C,children:t.jsx(Z.button,{type:"button",role:"tab","aria-selected":C,"aria-controls":_,"data-state":C?"active":"inactive","data-disabled":y?"":void 0,disabled:y,id:I,...w,ref:s,onMouseDown:ne(p.onMouseDown,S=>{!y&&S.button===0&&S.ctrlKey===!1?v.onValueChange(m):S.preventDefault()}),onKeyDown:ne(p.onKeyDown,S=>{[" ","Enter"].includes(S.key)&&v.onValueChange(m)}),onFocus:ne(p.onFocus,()=>{const S=v.activationMode!=="manual";!C&&!y&&S&&v.onValueChange(m)})})})});Me.displayName=Re;var Le="TabsContent",$e=n.forwardRef((p,s)=>{const{__scopeTabs:c,value:m,forceMount:y,children:w,...v}=p,j=de(Le,c),I=ze(j.baseId,m),_=Be(j.baseId,m),C=m===j.value,S=n.useRef(C);return n.useEffect(()=>{const D=requestAnimationFrame(()=>S.current=!1);return()=>cancelAnimationFrame(D)},[]),t.jsx(ht,{present:y||C,children:({present:D})=>t.jsx(Z.div,{"data-state":C?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":I,hidden:!D,id:_,tabIndex:0,...v,ref:s,style:{...p.style,animationDuration:S.current?"0s":void 0},children:D&&w})})});$e.displayName=Le;function ze(p,s){return`${p}-trigger-${s}`}function Be(p,s){return`${p}-content-${s}`}var ns=Pe,Fe=Ee,We=Me,Ue=$e;const is=ns,Ve=n.forwardRef(({className:p,...s},c)=>t.jsx(Fe,{ref:c,className:ce("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",p),...s}));Ve.displayName=Fe.displayName;const z=n.forwardRef(({className:p,...s},c)=>t.jsx(We,{ref:c,className:ce("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",p),...s}));z.displayName=We.displayName;const B=n.forwardRef(({className:p,...s},c)=>t.jsx(Ue,{ref:c,className:ce("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",p),...s}));B.displayName=Ue.displayName;const $s=()=>{var Ne,je,Se,Ce;const p=xt(),{user:s,profile:c,userSubscription:m}=gt(),y=ie.useMemo(()=>{var a,r,d,o;const e=((a=m==null?void 0:m.subscription)==null?void 0:a.planType)??((r=m==null?void 0:m.subscription)==null?void 0:r.plan)??((d=c==null?void 0:c.subscription)==null?void 0:d.planType)??((o=c==null?void 0:c.subscription)==null?void 0:o.plan)??null;return e===vt.ZERO||String(e).toLowerCase()==="zero"},[(Ne=m==null?void 0:m.subscription)==null?void 0:Ne.planType,(je=m==null?void 0:m.subscription)==null?void 0:je.plan,(Se=c==null?void 0:c.subscription)==null?void 0:Se.planType,(Ce=c==null?void 0:c.subscription)==null?void 0:Ce.plan]),{shopName:w}=ft();bt();const[v,j]=n.useState([]),[I,_]=n.useState([]),[C,S]=n.useState("all"),[D,me]=n.useState(""),[E,Ge]=n.useState(""),[R,Ke]=n.useState(""),[ls,Je]=n.useState(!1),[cs,Xe]=n.useState(!1),[ds,qe]=n.useState(!1),[ms,He]=n.useState(!1),[Q,ee]=n.useState(!1),[Ze,ue]=n.useState(!1),[Ye,pe]=n.useState(!1),[Qe,te]=n.useState(!1),[et,tt]=n.useState(null),[st,se]=n.useState(!1),[at,F]=n.useState(!1),[W,he]=n.useState(""),[M,xe]=n.useState(""),[U,ge]=n.useState(""),[ve,fe]=n.useState(!1),[be,V]=n.useState(0),P=ie.useCallback(()=>{try{const e=`debts_${(s==null?void 0:s.uid)||"default"}`,a=localStorage.getItem(e)||localStorage.getItem("debts_default");if(!a){V(0);return}const r=JSON.parse(a);if(!Array.isArray(r)){V(0);return}const d=r.filter(o=>(o==null?void 0:o.status)==="pending"&&((o==null?void 0:o.amount)??0)>0).length;V(d)}catch{V(0)}},[s==null?void 0:s.uid]);n.useEffect(()=>{P()},[P]),n.useEffect(()=>{const e=a=>{a.key&&(a.key===`debts_${(s==null?void 0:s.uid)||"default"}`||a.key==="debts_default")&&P()};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[P,s==null?void 0:s.uid]),n.useEffect(()=>{Q||P()},[Q,P]),n.useEffect(()=>{rt(),ot()},[s]),n.useEffect(()=>{if(s!=null&&s.uid)try{const e=yt(Nt(Te,"userTransactions"),jt("userId","==",s.uid),St("createdAt","desc")),a=Ct(e,r=>{const d=r.docs.map(o=>{const u=o.data(),l=u==null?void 0:u.createdAt,i=l!=null&&l.toDate?l.toDate():l instanceof Date?l:new Date(l);return{id:o.id,...u,createdAt:i}}).filter(o=>(o==null?void 0:o.status)!=="cancelled"&&!(o!=null&&o.isDeleted)).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية")));j(d.map(re))},r=>{console.error("خطأ في الاشتراك لمعاملات المستخدم:",r)});return()=>a()}catch(e){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم:",e)}},[s==null?void 0:s.uid]);const rt=async()=>{try{if(!s)return;const a=(await J.getUserTransactions(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)})).filter(r=>!((r==null?void 0:r.type)==="report"||((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية")));j(a.map(re))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e)}},ot=async()=>{try{if(!s)return;const a=(await X.getDeletedTransactionsByUser(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)}));_(a.map(re))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e)}},L=ie.useMemo(()=>{const e=s!=null&&s.uid?`recentTransactionsResetAt:${s.uid}`:null,a=e?localStorage.getItem(e):null;let r=null;if(a){const d=new Date(a);isNaN(d.getTime())||(r=d)}return v.filter(d=>!r||d.createdAt>=r)},[v,s==null?void 0:s.uid]),ye=L.filter(e=>{const a=!D||e.senderPhone.includes(D)||e.receiverPhone.includes(D),r=!E||e.createdAt.toDateString()===new Date(E).toDateString(),d=!R||e.createdAt.toTimeString().startsWith(R);return a&&r&&d}),G=e=>{switch(e){case"completed":return t.jsx(as,{className:"h-4 w-4 text-green-500"});case"pending":return t.jsx(Ae,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(ss,{className:"h-4 w-4 text-red-500"});default:return t.jsx(Ae,{className:"h-4 w-4 text-gray-500"})}},ae=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},re=e=>{const a=((e==null?void 0:e.status)??"").toString().toLowerCase(),r=a==="confirmed"||a==="success"||a==="completed"?"completed":a==="failed"||a==="error"||a==="cancelled"||a==="canceled"?"cancelled":"pending",o=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",u=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",l=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",i=e==null?void 0:e.createdAt,h=i instanceof Date?i:i!=null&&i.toDate?i.toDate():new Date(i);return{id:e==null?void 0:e.id,senderPhone:u||"غير معروف",receiverPhone:l||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:r,type:o,createdAt:h,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1}},nt=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:w??(c==null?void 0:c.shopName)??(s==null?void 0:s.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0}),oe=e=>{const a=nt(e);tt(a),te(!0)},it=async e=>{try{const a=I.find(o=>o.id===e);if(!a||!s)return;const r=await J.saveUserTransaction(s.uid,{...a,userId:s.uid,status:"completed",cashierName:a.cashierName??"الحساب الرئيسي"});await X.permanentlyDeleteTransaction(e,s.uid);const d={...a,id:r};j(o=>[...o,d]),_(o=>o.filter(u=>u.id!==e)),b({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(a){console.error("خطأ في استرجاع المعاملة من Firestore:",a),b({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},lt=async e=>{try{if(!s)return;_(a=>a.filter(r=>r.id!==e)),await X.permanentlyDeleteTransaction(e,s.uid),await J.removeUserTransaction(s.uid,e),b({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(a){console.error("فشل الحذف النهائي للمعاملة:",a),b({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ct=async e=>{try{const a=v.find(i=>i.id===e);if(!a||!s)return;const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,d=`userCashBalance_${(s==null?void 0:s.uid)||"default"}`,o=`walletBalances_${(s==null?void 0:s.uid)||"default"}`;let u=(()=>{const i=localStorage.getItem(r);if(i!=null)return parseFloat(i);const h=localStorage.getItem(d);if(h!=null){const f=parseFloat(h);if(!Number.isNaN(f)){try{localStorage.setItem(r,f.toString()),localStorage.removeItem(d)}catch{}return f}}return 0})(),l=(()=>{const i=localStorage.getItem(o);try{return i?JSON.parse(i):{}}catch{return{}}})();if(a.type==="withdraw"){const i=a.fromWallet||Object.keys(l)[0],h=Number(a.withdrawnAmount??a.amount??0),f=Number(a.commission??0),O=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let x=[];try{const T=localStorage.getItem(O);x=T?JSON.parse(T):[]}catch{x=[]}const g=(a==null?void 0:a.walletEffectAppliedOnCreation)||x.includes(e);if(!g&&i&&h>0){const T=l[i]||0;l[i]=T+h}if(u=u-h+f,localStorage.setItem(r,u.toString()),localStorage.setItem(o,JSON.stringify(l)),g)try{const T=x.filter(K=>K!==e);localStorage.setItem(O,JSON.stringify(T))}catch{}}await wt(_t(Te,"userTransactions",e),{status:"completed",confirmedAt:new Date}),j(i=>i.map(h=>h.id===e?{...h,status:"completed"}:h)),b({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),te(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),b({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},dt=async e=>{try{const a=v.find(r=>r.id===e);if(!a||!s)return;j(r=>r.filter(d=>d.id!==e)),_(r=>[{...a},...r]);try{await J.removeUserTransaction(s.uid,e),await X.saveDeletedTransaction({...a,userId:s.uid,originalTransactionId:e})}catch(r){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",r)}try{const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,d=`userCashBalance_${(s==null?void 0:s.uid)||"default"}`,o=`walletBalances_${(s==null?void 0:s.uid)||"default"}`,u=localStorage.getItem(r);let l;if(u!=null)l=parseFloat(u);else{const A=localStorage.getItem(d);if(A!=null){const $=parseFloat(A);if(Number.isNaN($))l=0;else{l=$;try{localStorage.setItem(r,$.toString()),localStorage.removeItem(d)}catch{}}}else l=0}const i=localStorage.getItem(o);let h=(()=>{try{return i?JSON.parse(i):{}}catch{return{}}})();const f=Number(a.withdrawnAmount??a.amount??0),O=Number(a.commission??0),x=a.fromWallet||Object.keys(h)[0],g=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let T=[];try{const A=localStorage.getItem(g);T=A?JSON.parse(A):[]}catch{T=[]}const K=(a==null?void 0:a.walletEffectAppliedOnCreation)||T.includes(e);if(a.type==="send"){if(l-=O,x&&f>0){const A=h[x]||0;h[x]=A+f}}else if(a.type==="withdraw"){if(a.status==="completed"){if(l=l+f-O,x&&f>0){const A=h[x]||0;h[x]=A-f}}else if(x&&K&&f>0){const A=h[x]||0;h[x]=A-f}}if(localStorage.setItem(r,l.toString()),localStorage.setItem(o,JSON.stringify(h)),K)try{const A=T.filter($=>$!==e);localStorage.setItem(g,JSON.stringify(A))}catch{}}catch(r){console.warn("فشل عكس تأثير الأرصدة محليًا:",r)}try{const r=a.fromWallet;if(r){const{walletDailyLimitsService:d}=await k(async()=>{const{walletDailyLimitsService:u}=await import("./walletDailyLimitsService-BdOys8Z9.js");return{walletDailyLimitsService:u}},__vite__mapDeps([0,1,2])),o=await d.getWalletLimits(r);if(o){const u=a.type==="send",l={updatedAt:(await k(async()=>{const{serverTimestamp:x}=await import("./index-Brx_EIwU.js").then(g=>g.a$);return{serverTimestamp:x}},__vite__mapDeps([1,2]))).serverTimestamp()};u?(l.dailyTransferUsed=Math.max(0,(o.dailyTransferUsed||0)-a.amount),l.monthlyTransferUsed=Math.max(0,(o.monthlyTransferUsed||0)-a.amount)):(l.dailyWithdrawUsed=Math.max(0,(o.dailyWithdrawUsed||0)-a.amount),l.monthlyWithdrawUsed=Math.max(0,(o.monthlyWithdrawUsed||0)-a.amount));const{doc:i,setDoc:h}=await k(async()=>{const{doc:x,setDoc:g}=await import("./index-Brx_EIwU.js").then(T=>T.a$);return{doc:x,setDoc:g}},__vite__mapDeps([1,2])),{db:f}=await k(async()=>{const{db:x}=await import("./index-Brx_EIwU.js").then(g=>g.b0);return{db:x}},__vite__mapDeps([1,2])),O=i(f,"walletLimits",r);await h(O,l,{merge:!0})}}}catch(r){console.warn("فشل استرجاع حدود المحفظة:",r)}try{const{ProfitService:r}=await k(async()=>{const{ProfitService:i}=await import("./profitService-WOL_cZ8K.js");return{ProfitService:i}},__vite__mapDeps([3,4])),{ReportsService:d}=await k(async()=>{const{ReportsService:i}=await import("./reportsService-Bp1Io21u.js");return{ReportsService:i}},[]),u={txnType:a.type==="send"?"send":"receive",amount:a.amount,commission:a.commission||0,createdAt:a.createdAt,status:"confirmed"},l=r.calculateProfitFromTransaction(u);l>0&&r.addProfit(-l,s.uid);try{d.removeTransactionEffects(a,s.uid)}catch{}}catch(r){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",r)}}catch(a){console.error("خطأ أثناء حذف الإيصال:",a)}},mt=async()=>{var r,d,o;const e="alkaptin678678@gmail.com",a=(d=(r=De.currentUser)==null?void 0:r.email)==null?void 0:d.toLowerCase();if(!a||a!==e){b({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!W||!M||!U){b({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}fe(!0);try{const l={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[M]??M,i=new AbortController,h=setTimeout(()=>i.abort(),15e3),f=await((o=De.currentUser)==null?void 0:o.getIdToken()),O=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...f?{Authorization:`Bearer ${f}`}:{}},body:JSON.stringify({phone:W,countryCode:"EG",operator:l,amount:Number(U),useLocalAmount:!0}),signal:i.signal});clearTimeout(h);const x=await O.text();let g;try{g=JSON.parse(x)}catch{g={success:!1,message:x||"فشل قراءة استجابة الخادم"}}O.ok&&(g!=null&&g.success)?(b({title:"تم الشحن",description:(g==null?void 0:g.message)||"تم تنفيذ عملية الشحن بنجاح"}),F(!1),he(""),xe(""),ge("")):b({title:"فشل الشحن",description:(g==null?void 0:g.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(u){console.error("Topup request error:",u),(u==null?void 0:u.name)==="AbortError"?b({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):b({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{fe(!1)}};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>p("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(Qt,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(Ot,{className:"card-modern fade-in-up",children:[t.jsxs(It,{className:"pb-2 px-3 pt-3",children:[t.jsx(Pt,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(es,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(le,{placeholder:"بحث...",value:D,onChange:e=>me(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105",onClick:()=>F(!0),title:"نافذة شحن سريعة",children:t.jsx(we,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شحن"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Je(!0),title:"آلة حاسبة",children:t.jsx(Kt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){b({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}Xe(!0)},title:"بيانات المبيعات",children:t.jsx(Jt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(N,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${E||R?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>qe(!0),title:"اختيار التاريخ",children:[t.jsx(ts,{className:"h-2.5 w-2.5"}),(E||R)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){b({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}ee(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Tt,{className:"h-2.5 w-2.5"}),be>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:be})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){b({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}pe(!0)},title:"الصيانة",children:t.jsx(At,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{p("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(we,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(y){b({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}ue(!0)},title:"الفيز الائتمانية",children:t.jsx(Dt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{se(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(_e,{className:"h-2.5 w-2.5"}),(s==null?void 0:s.uid)&&localStorage.getItem(`recentTransactionsResetAt:${s.uid}`)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(D||E||R)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{me(""),Ge(""),Ke("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(kt,{className:"px-3 pb-3",children:t.jsxs(is,{value:C,onValueChange:S,className:"w-full",children:[t.jsxs(Ve,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(z,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(z,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(B,{value:"all",className:"mt-2",children:ye.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ye.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>oe(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-600",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(H,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.type==="withdraw"?"bg-green-100 text-green-800":""}`,children:e.type==="withdraw"?"سحب":ae(e.status)})]})]},e.id))})}),t.jsx(B,{value:"send",className:"mt-2",children:L.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:L.filter(e=>e.type==="send").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>oe(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(H,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:ae(e.status)})]})]},e.id))})}),t.jsx(B,{value:"withdraw",className:"mt-2",children:L.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:L.filter(e=>e.type==="withdraw").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer",onClick:()=>oe(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),t.jsx(H,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:ae(e.status)})]})]},e.id))})}),t.jsx(B,{value:"deleted",className:"mt-2",children:I.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:I.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[G(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[e.amount," جنيه"]}),t.jsx(H,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(N,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>it(e.id),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(N,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>lt(e.id),children:t.jsx(_e,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Xt,{open:Ye,onOpenChange:pe})]}),t.jsx(qt,{isOpen:Ze,onClose:()=>ue(!1)}),t.jsx(Yt,{open:Q,onOpenChange:ee,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{ee(!1),He(!0)}}),t.jsx(Zt,{open:st,onOpenChange:se,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"لن يتم حذف الإيصالات؛ سنبدأ القائمة من الآن.",onSuccess:()=>{try{s!=null&&s.uid&&(localStorage.setItem(`recentTransactionsResetAt:${s.uid}`,new Date().toISOString()),b({title:"تم التصفير",description:"تم بدء قائمة المعاملات من الآن."}))}catch{}se(!1)}}),t.jsx(Et,{open:at,onOpenChange:F,children:t.jsxs(Rt,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Mt,{children:t.jsx(Lt,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(le,{value:W,onChange:e=>he(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs($t,{value:M,onValueChange:xe,children:[t.jsx(zt,{className:"w-full",children:t.jsx(Bt,{placeholder:"اختر الشركة"})}),t.jsxs(Ft,{children:[t.jsx(q,{value:"vodafone_eg",children:"فودافون"}),t.jsx(q,{value:"orange_eg",children:"أورنج"}),t.jsx(q,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(q,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(le,{type:"number",min:1,value:U,onChange:e=>ge(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(N,{variant:"outline",onClick:()=>F(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{variant:"secondary",onClick:()=>p("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(N,{onClick:mt,disabled:ve||!W||!M||!U,children:ve?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Ht,{isOpen:Qe,onClose:()=>te(!1),transaction:et,onPrint:()=>window.print(),onDelete:dt,onComplete:ct})]})};export{$s as default};
