import{u as U,a as $,r as n,i as H,k as L,o as O,F as p,j as e,C as G,e as c,l as V}from"./index-DBCfkQ6B.js";import{C as B,a as _,b as W,d as q}from"./card-C9sEKIdK.js";import{B as u}from"./button-B6KX4ziW.js";import{a as M}from"./whatsappService-Cs7keNI6.js";import{C as z}from"./circle-alert-D7_EsjrJ.js";import{S as J}from"./shield-zA1KxaRj.js";import{G as j}from"./gift-C37HCUJ9.js";import{C as N}from"./circle-check-big-E2gyd2JE.js";import{R as y}from"./refresh-cw-TG5KYcMq.js";function te(){const{user:s,signOut:w,userSubscription:A,isSubscriptionActive:g,checkSubscriptionStatus:d}=U(),l=$(),[x,h]=n.useState(!1),[b,f]=n.useState(!1),[P,S]=n.useState(!1),[T,C]=n.useState(!1),[i,k]=n.useState(24),E=[{key:"monthly",name:"الباقة الشهرية",price:"199 جنيه",features:["إدارة المحافظ والمعاملات","تقارير يومية مفصلة","دعم فني على مدار الساعة"]},{key:"quarterly",name:"الباقة ربع سنوية",price:"549 جنيه",features:["عدد 2 كاشير","تقارير فصلية","دعم أسرع"]},{key:"yearly",name:"الباقة السنوية",price:"1999 جنيه",features:["كل ميزات الشهرية","خصم سنوي مميز","أولوية في الدعم الفني"]},{key:"lifetime",name:"اشتراك مدى الحياة",price:"4999 جنيه",features:["وصول دائم بدون انتهاء","بدون تجديدات","دعم مميز"]}];n.useEffect(()=>{if(!(s!=null&&s.uid))return;console.log("🔍 PendingApprovalPage: Setting up real-time subscription monitoring for user:",s.uid);const r=H(L,"users",s.uid),a=O(r,o=>{var m;if(o.exists()){const t=o.data();if(console.log("📊 PendingApprovalPage: User data updated:",{userId:s.uid,isApproved:t.isApproved,approved:t.approved,freeTrialActive:t.freeTrialActive,subscription:t.subscription,subscriptionActive:(m=t.subscription)==null?void 0:m.isActive}),t.isApproved||t.freeTrialActive||t.approved){console.log("✅ PendingApprovalPage: User approved or trial active, redirecting..."),c.success("تم تفعيل حسابك! جاري التوجيه..."),setTimeout(()=>{l("/user/dashboard")},1500);return}if(t.subscription&&t.subscription.isActive){const v=V(t.subscription);if(console.log("🔍 PendingApprovalPage: Subscription validation result:",{hasSubscription:!!t.subscription,isActive:t.subscription.isActive,isValid:v,planType:t.subscription.planType}),v){console.log("✅ PendingApprovalPage: Valid subscription found, redirecting to dashboard..."),c.success("تم تفعيل اشتراكك! جاري التوجيه إلى لوحة التحكم..."),setTimeout(()=>{l("/user/dashboard")},1500);return}}}},o=>{console.error("❌ PendingApprovalPage: Error in real-time listener:",o)});return()=>{console.log("🔌 PendingApprovalPage: Cleaning up real-time listener"),a()}},[s==null?void 0:s.uid,l]),n.useEffect(()=>{const r=a=>{const{userId:o,planType:m}=a.detail;console.log("🎉 PendingApprovalPage: Subscription activation event received:",{userId:o,planType:m,currentUserId:s==null?void 0:s.uid}),o===(s==null?void 0:s.uid)&&(console.log("✅ PendingApprovalPage: Subscription activated for current user"),c.success("تم تفعيل اشتراكك! جاري التوجيه إلى لوحة التحكم..."),setTimeout(async()=>{await d(),l("/user/dashboard")},1500))};return console.log("🔔 PendingApprovalPage: Setting up subscription activation listener"),window.addEventListener("subscriptionActivated",r),()=>{console.log("🔌 PendingApprovalPage: Cleaning up subscription activation listener"),window.removeEventListener("subscriptionActivated",r)}},[s==null?void 0:s.uid,l,d]),n.useEffect(()=>{console.log("🔍 PendingApprovalPage: Checking subscription status on load:",{isSubscriptionActive:g,hasUserSubscription:!!A}),g&&(console.log("✅ PendingApprovalPage: Active subscription detected, redirecting..."),l("/user/dashboard"))},[g,l]),n.useEffect(()=>{if(!(s!=null&&s.uid))return;const r=setInterval(async()=>{console.log("🔄 PendingApprovalPage: Periodic subscription status check"),await d()},3e4);return()=>{clearInterval(r)}},[s==null?void 0:s.uid,d]),n.useEffect(()=>{(async()=>{if(s!=null&&s.uid)try{const a=await p.getTrialData(s.uid);S(a.hasUsedFreeTrial),C(a.isOnFreeTrial)}catch(a){console.error("خطأ في تحميل حالة التجربة المجانية:",a)}})()},[s==null?void 0:s.uid]),n.useEffect(()=>{(async()=>{try{const r=await p.getTrialDurationHours();k(r)}catch(r){console.error("خطأ في تحميل مدة التجربة المجانية:",r)}})()},[]);const I=async()=>{await w(),l("/auth")},D=async()=>{if(s!=null&&s.uid){h(!0);try{const r=await p.startFreeTrial(s.uid);r.success?(c.success(r.message||`تم تفعيل التجربة المجانية لمدة ${i} ${i>=3&&i<=10?"ساعات":i===2?"ساعتين":"ساعة"}! جاري التوجيه...`),setTimeout(()=>{l("/user/dashboard")},1500)):c.error(r.message)}catch(r){console.error("Error activating trial:",r),c.error("حدث خطأ في تفعيل التجربة المجانية")}finally{h(!1)}}},F=async()=>{f(!0),console.log("🔄 PendingApprovalPage: Manual refresh triggered");try{await d(),c.success("تم تحديث البيانات")}catch(r){console.error("❌ Error during manual refresh:",r),c.error("حدث خطأ أثناء التحديث")}finally{f(!1)}},R=async r=>{try{const a=await M(r.name,r.price,r.features);window.open(a,"_blank")}catch(a){console.error("❌ خطأ في إنشاء رابط الواتساب:",a),c.error("تعذر فتح واتساب، حاول لاحقًا")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-background to-yellow-50 flex items-center justify-center p-4",children:e.jsxs(B,{className:"w-full max-w-md shadow-lg",children:[e.jsxs(_,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-4",children:e.jsx("div",{className:"h-12 w-12 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"h-6 w-6 text-white"})})}),e.jsx(W,{className:"text-2xl font-bold text-gray-800",children:"في انتظار الموافقة"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"حسابك قيد المراجعة من قبل الإدارة"})]}),e.jsxs(q,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"h-5 w-5 text-orange-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-orange-800 mb-1",children:"حالة الحساب: في انتظار الموافقة"}),e.jsx("p",{className:"text-sm text-orange-700",children:"تم إنشاء حسابك بنجاح ولكنه يحتاج إلى موافقة من الإدارة قبل أن تتمكن من الوصول إلى لوحة التحكم."})]})]})}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(J,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-1",children:"معلومات الحساب"}),e.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["البريد الإلكتروني: ",s==null?void 0:s.email]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["تاريخ التسجيل: ",new Date().toLocaleDateString("ar-EG")]})]})]})}),!P&&!T&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"h-6 w-6 text-green-600 mt-0.5"}),e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsx("h3",{className:"font-medium text-green-800 mb-1",children:`🎉 تجربة مجانية لمدة ${i} ${i>=3&&i<=10?"ساعات":i===2?"ساعتين":"ساعة"}!`}),e.jsx("p",{className:"text-sm text-green-700 leading-relaxed",children:`لا تنتظر الموافقة! ابدأ فوراً بتجربة مجانية لمدة ${i} ${i>=3&&i<=10?"ساعات":i===2?"ساعتين":"ساعة"} كاملة مع الوصول إلى جميع الميزات.`}),e.jsxs("ul",{className:"text-xs text-green-600 space-y-1",children:[e.jsx("li",{children:"• إدارة المحافظ والمعاملات"}),e.jsx("li",{children:"• تقارير مفصلة"}),e.jsx("li",{children:"• دعم فني كامل"}),e.jsx("li",{children:"• جميع الميزات المتقدمة"})]}),e.jsx(u,{onClick:D,disabled:x,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg mt-3",children:x?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"جاري التفعيل..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"ابدأ التجربة المجانية الآن"})]})})]})]})}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-1",children:"أو انتظر الموافقة الكاملة"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• سيتم مراجعة حسابك من قبل فريق الإدارة"}),e.jsx("li",{children:"• ستتلقى إشعاراً عند الموافقة على حسابك"}),e.jsx("li",{children:"• يمكنك تسجيل الدخول مرة أخرى بعد الموافقة"})]})]})]})}),e.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"h-5 w-5 text-emerald-600 mt-0.5"}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"اختر باقة الاشتراك"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:'اضغط على "اشترك الآن" للتواصل عبر واتساب وبدء الاشتراك مباشرة.'}),e.jsx("div",{className:"space-y-3",children:E.map(r=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-700",children:["السعر: ",r.price]}),e.jsx("ul",{className:"mt-1 text-xs text-gray-600 list-disc list-inside",children:r.features.map(a=>e.jsx("li",{children:a},a))})]}),e.jsx(u,{onClick:()=>R(r),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"اشترك الآن"})]},r.key))})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{onClick:F,disabled:b,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700",children:b?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"جاري التحديث..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:"تحديث الصفحة"})]})}),e.jsx(u,{variant:"outline",onClick:I,className:"w-full border-gray-300 text-gray-700 hover:bg-gray-50",children:"تسجيل الخروج"})]}),e.jsxs("div",{className:"text-center pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"حسابك في انتظار التفعيل من قبل المسؤول"}),e.jsx("p",{className:"text-sm font-semibold text-orange-700 mb-3 bg-orange-50 p-3 rounded-lg border border-orange-200",children:"للتفعيل السريع: تواصل مع الإدارة عبر واتساب فقط على الرقم التالي"}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200 mb-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-base font-bold text-green-700",children:"واتساب الإدارة:"}),e.jsx("a",{href:"https://wa.me/201000392539",target:"_blank",rel:"noopener noreferrer",className:"text-lg font-bold text-green-600 hover:text-green-700 underline",children:"01000392539"})]}),e.jsx("p",{className:"text-sm text-green-600 mt-2",children:"اضغط على الرقم للتواصل المباشر عبر واتساب"})]})]})]})]})})}export{te as default};
