import{u as B,r as t,j as e,A as M,B as E}from"./index-Bt1oGT7m.js";import{C as I,a as L,b as H,d as O}from"./card-B_1q8Mnr.js";import{B as j}from"./button-Dt1x5wgm.js";import{I as o}from"./input-DmDAHmW_.js";import{L as d}from"./label-DSN0-Klr.js";import{D as T,a as R,b as $,c as q,d as z}from"./dialog-D0LrLsb9.js";import"./Combination-v3i0QKrk.js";function X(){var w;const{user:v,profile:n,isSubscriptionActive:y,userSubscription:m}=B(),[D,i]=t.useState(!1),[h,f]=t.useState(""),[x,C]=t.useState(""),[g,N]=t.useState(""),[p,b]=t.useState(""),[u,F]=t.useState(!1),[S,r]=t.useState(null),P=((w=m==null?void 0:m.branchPackage)==null?void 0:w.status)==="active",c=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="merchant"||y||P,k=()=>{f(""),C(""),N(""),b("")},A=async()=>{if(r(null),!c){r("هذه العملية تتطلب اشتراكًا مفعلًا أو صلاحية مدير/تاجر.");return}if(!h||!x||!g||!p){r("يرجى ملء جميع الحقول المطلوبة.");return}try{F(!0);const l=await M(E,"createShopAndManager")({shopName:h,managerName:x,email:g,password:p}),a=l==null?void 0:l.data;r(a!=null&&a.success?`تم إنشاء المتجر (${a.shopId}) ومدير الحساب بنجاح.`:"فشل إنشاء الحساب، حاول مرة أخرى."),a!=null&&a.success&&(k(),i(!1))}catch(s){const l=(s==null?void 0:s.message)||"حدث خطأ غير متوقع أثناء الإنشاء";r(l)}finally{F(!1)}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs(I,{children:[e.jsx(L,{children:e.jsx(H,{children:"لوحة التحكم (CPanel)"})}),e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"إضافة محل جديد مع إنشاء حساب المدير ليتسجل من صفحة الدخول العادية."})}),e.jsx(j,{onClick:()=>i(!0),disabled:!c,children:"إضافة محل"})]}),!v&&e.jsx("p",{className:"mt-3 text-sm text-red-600",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم."}),v&&!c&&e.jsx("p",{className:"mt-3 text-sm text-red-600",children:"حسابك ليس لديه صلاحيات كافية أو اشتراك/باقة فروع مفعّلة لإنشاء المحلات. إذا كنت مشتركًا بباقة مدفوعة أو لديك باقة فروع مفعّلة، ستتمكن من إضافة الحسابات مباشرة."})]})]}),e.jsx(T,{open:D,onOpenChange:i,children:e.jsxs(R,{children:[e.jsx($,{children:e.jsx(q,{children:"إضافة محل ومدير"})}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"shopName",children:"اسم المحل"}),e.jsx(o,{id:"shopName",value:h,onChange:s=>f(s.target.value),placeholder:"مثال: متجر أحمد"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"managerName",children:"اسم المدير"}),e.jsx(o,{id:"managerName",value:x,onChange:s=>C(s.target.value),placeholder:"مثال: أحمد علي"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"email",children:"الإيميل"}),e.jsx(o,{id:"email",type:"email",value:g,onChange:s=>N(s.target.value),placeholder:"example@mail.com"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"password",children:"الباسوورد"}),e.jsx(o,{id:"password",type:"password",value:p,onChange:s=>b(s.target.value),placeholder:"••••••••"})]}),S&&e.jsx("p",{className:"text-sm text-muted-foreground",children:S})]}),e.jsxs(z,{children:[e.jsx(j,{variant:"outline",onClick:()=>i(!1),disabled:u,children:"إلغاء"}),e.jsx(j,{onClick:A,disabled:u||!c,children:u?"جاري الإنشاء...":"إنشاء الحساب"})]})]})})]})}export{X as default};
