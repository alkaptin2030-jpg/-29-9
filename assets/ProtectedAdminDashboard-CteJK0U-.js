const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BwRCC2gi.js","assets/index-DHdq-Edv.css"])))=>i.map(i=>d[i]);
var qs=Object.defineProperty;var Qs=(n,a,l)=>a in n?qs(n,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[a]=l;var ds=(n,a,l)=>Qs(n,typeof a!="symbol"?a+"":a,l);import{c as ee,r as c,j as e,x as Gs,d as Zs,M as re,S as D,f as V,g as M,q as Z,a3 as Q,h as ne,$ as fe,C as le,aS as me,aT as Ks,a0 as Xs,J,a4 as Ue,k as G,t as Ne,Z as te,aU as ae,o as ms,m as be,_ as we,X as Js,ah as Ws,aV as et,n as st,aW as tt,Q as at,U as rt,v as nt,an as lt,a as it,u as ct,e as ot}from"./index-BwRCC2gi.js";import{P as dt}from"./ProfileIcon-DzMJNsvV.js";import{C as ve,a as _e,b as Ie,d as Ee,c as mt}from"./card-DJoxVmiJ.js";import{B as K}from"./button-BjF52gZr.js";import{I as xt}from"./input-DgAXW7tJ.js";import{L as xs}from"./label-DTg6W7fr.js";import{a as ut,S as ys}from"./switch-CxPSD6ok.js";import{A as ht,a as gt}from"./alert-VPizPHfJ.js";import{B as Ce}from"./badge-C4O1wMN-.js";import{a as pt,g as us,r as hs,u as ft,b as bt,d as jt,S as Fe,P as yt}from"./index.esm-DUZnqqLS.js";import{u as Nt,c as wt,v as vt}from"./whatsappService-_-jMQLna.js";import{R as Pe}from"./refresh-cw-C4B3jjsw.js";import{C as Et}from"./circle-alert-BpXfYihb.js";import{P as Ns}from"./phone-CWrUOijY.js";import{E as St,a as Ct}from"./eye-BLytke5H.js";import{C as Tt}from"./copy-HMSPmLy8.js";import{E as Dt,p as At}from"./broadcastService-CqHL2m_-.js";import{B as xe,A as gs}from"./bell-4_-RXe2-.js";import{U as Te}from"./user-Cm6FByOS.js";import{C as W}from"./calendar-CzLGJOXa.js";import{S as kt,a as Mt,b as Rt,c as Lt,d as pe}from"./select-BeUcTPbj.js";import{M as Ut}from"./mail-4O6fXC23.js";import{L as ps}from"./lock-DNRhdsJk.js";import{Z as Oe}from"./zap-Cd4VM8j3.js";import{G as de}from"./gift-CwB1TclH.js";import{C as Se}from"./crown-Dfe1LAFY.js";import{L as fs}from"./dropdown-menu-KX6ycyWV.js";import{U as $e}from"./users-Df7_OxpG.js";import{C as Ve}from"./circle-check-big-DaAzfk-j.js";import{S as _t}from"./shield-Du-mfy5m.js";import{g as bs,l as It,s as Ft}from"./contentService-kEV02Izm.js";import"./dialog-DpGDBnRh.js";import"./Combination-DFomfWck.js";import"./MasterPinDialog-BSMDdGhi.js";import"./avatars-CbKz_5Yn.js";import"./index-CSJ34AGp.js";import"./index-Bfl62wF_.js";import"./index-BYIhHjAD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=ee("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=ee("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=ee("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=ee("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=ee("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=ee("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=ee("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=ee("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=ee("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ws=c.forwardRef(({className:n,...a},l)=>e.jsx("textarea",{className:Gs("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:l,...a}));ws.displayName="Textarea";const qt=()=>{const{settings:n,loading:a,error:l,updateSettings:i,refreshSettings:d}=Nt(),{toast:u}=Zs(),[r,v]=c.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[x,w]=c.useState(!1),[y,S]=c.useState(!1),[N,p]=c.useState(""),[j,g]=c.useState({});c.useEffect(()=>{n&&v({phoneNumber:n.phoneNumber,defaultMessage:n.defaultMessage,isEnabled:n.isEnabled})},[n]);const P=()=>{var _,m;const A={};return(_=r.phoneNumber)!=null&&_.trim()?vt(r.phoneNumber)||(A.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):A.phoneNumber="رقم الواتساب مطلوب",(m=r.defaultMessage)!=null&&m.trim()?r.defaultMessage.length<10&&(A.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):A.defaultMessage="الرسالة الافتراضية مطلوبة",g(A),Object.keys(A).length===0},O=async()=>{if(!P()){u({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}w(!0);try{if(await i(r))u({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{u({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{w(!1)}},E=()=>{if(r.phoneNumber&&r.defaultMessage)try{const A=wt(r.phoneNumber,r.defaultMessage);p(A),S(!0)}catch{u({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},B=async()=>{try{await navigator.clipboard.writeText(N),u({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{u({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},se=A=>{const _=A.replace(/[^\d+]/g,"");v(m=>({...m,phoneNumber:_})),j.phoneNumber&&g(m=>({...m,phoneNumber:""}))};return a?e.jsxs(ve,{children:[e.jsx(_e,{children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Ee,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Pe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(ve,{children:[e.jsxs(_e,{children:[e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(mt,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Ee,{className:"space-y-6",children:[l&&e.jsxs(ht,{variant:"destructive",children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(gt,{children:l})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${r.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(ut,{checked:r.isEnabled,onCheckedChange:A=>v(_=>({..._,isEnabled:A}))})]}),e.jsx(pt,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xs,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(xt,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:r.phoneNumber,onChange:A=>se(A.target.value),className:j.phoneNumber?"border-red-500":"",dir:"ltr"}),j.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:j.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xs,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(ws,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:r.defaultMessage,onChange:A=>{v(_=>({..._,defaultMessage:A.target.value})),j.defaultMessage&&g(_=>({..._,defaultMessage:""}))},className:j.defaultMessage?"border-red-500":"",rows:4}),j.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:j.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(K,{onClick:O,disabled:x,className:"flex items-center gap-2",children:[x?e.jsx(Pe,{className:"h-4 w-4 animate-spin"}):e.jsx(ys,{className:"h-4 w-4"}),x?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(K,{variant:"outline",onClick:E,disabled:!r.phoneNumber||!r.defaultMessage,className:"flex items-center gap-2",children:[y?e.jsx(St,{className:"h-4 w-4"}):e.jsx(Ct,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(K,{variant:"outline",onClick:d,className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"تحديث"]})]}),y&&N&&e.jsxs(ve,{className:"bg-muted/50",children:[e.jsx(_e,{children:e.jsx(Ie,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Ee,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:N}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{variant:"outline",size:"sm",onClick:B,className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>window.open(N,"_blank"),className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),n&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(Ce,{variant:"outline",className:"mr-2",children:[n.lastUpdated.toLocaleDateString("ar-EG")," - ",n.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(Ce,{variant:n.isEnabled?"default":"secondary",className:"mr-2",children:n.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},De={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},Qt=n=>{const a=new Date,i=new Date(n).getTime()-a.getTime();return Math.ceil(i/(1e3*60*60*24))},Gt=(n,a=De)=>n<0?"expired":n<=a.criticalDays?"critical":n<=a.warningDays?"warning":(n<=a.infoDays,"info"),Zt=(n,a,l)=>{const i=Kt(l);return a<0?`انتهت صلاحية اشتراك ${i} للمستخدم ${n}`:a===0?`ينتهي اشتراك ${i} للمستخدم ${n} اليوم!`:a===1?`ينتهي اشتراك ${i} للمستخدم ${n} غداً`:`ينتهي اشتراك ${i} للمستخدم ${n} خلال ${a} أيام`},Kt=n=>{switch(n){case D.MONTHLY:return"الشهري";case D.YEARLY:return"السنوي";case D.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},Xt=async()=>{try{const n=V(M,"users"),a=Z(n,Q("subscription","!=",null)),l=await ne(a),i=[];return l.forEach(d=>{var r,v,x,w;const u=d.data();u.subscription&&(u.subscription.planType||u.subscription.plan)&&i.push({id:d.id,...u,subscription:{...u.subscription,startDate:((v=(r=u.subscription.startDate)==null?void 0:r.toDate)==null?void 0:v.call(r))||new Date(u.subscription.startDate),endDate:((w=(x=u.subscription.endDate)==null?void 0:x.toDate)==null?void 0:w.call(x))||new Date(u.subscription.endDate),planType:u.subscription.planType||u.subscription.plan}})}),i}catch(n){return console.error("خطأ في جلب الاشتراكات النشطة:",n),[]}},Jt=async(n=De)=>{try{const a=await Xt(),l=[];return a.forEach(i=>{if(!i.subscription||!i.subscription.endDate)return;const d=Qt(i.subscription.endDate),u=Gt(d,n);if(d<=n.infoDays||d<0){const r={id:`${i.id}_${Date.now()}`,userId:i.id,userName:i.displayName||i.email||"مستخدم غير معروف",userEmail:i.email||"",subscriptionPlan:i.subscription.planType,expiryDate:i.subscription.endDate,daysRemaining:d,type:u,message:Zt(i.displayName||i.email||"مستخدم غير معروف",d,i.subscription.planType),isRead:!1,createdAt:new Date};l.push(r)}}),l.sort((i,d)=>{const u={expired:0,critical:1,warning:2,info:3};return u[i.type]!==u[d.type]?u[i.type]-u[d.type]:i.daysRemaining-d.daysRemaining}),l}catch(a){return console.error("خطأ في إنشاء إشعارات الاشتراك:",a),[]}},Wt=(n,a)=>a?n.filter(l=>l.type===a):n,ea=n=>{localStorage.setItem("notificationSettings",JSON.stringify(n))},sa=()=>{try{const n=localStorage.getItem("notificationSettings");if(n)return{...De,...JSON.parse(n)}}catch(n){console.error("خطأ في تحميل إعدادات الإشعارات:",n)}return De},ta=({isOpen:n,onClose:a})=>{const[l,i]=c.useState([]),[d,u]=c.useState([]),[r,v]=c.useState("all"),[x,w]=c.useState(!0),[y,S]=c.useState(sa());c.useEffect(()=>{n&&N()},[n]),c.useEffect(()=>{u(r==="all"?l:Wt(l,r))},[l,r]);const N=async()=>{w(!0);try{const E=await Jt(y);i(E)}catch(E){console.error("خطأ في تحميل الإشعارات:",E)}finally{w(!1)}},p=E=>{switch(E){case"urgent":return e.jsx(me,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(le,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(xe,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(xe,{className:"w-5 h-5 text-gray-500"})}},j=E=>{switch(E){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},g=E=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(E),P=E=>{switch(E){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},O=E=>{const B={...y,[E]:!y[E]};S(B),ea(B)};return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),l.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:l.length})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(E=>e.jsx("button",{onClick:()=>v(E),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${r===E?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:P(E)},E))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y.visualAlerts,onChange:()=>O("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y.soundAlerts,onChange:()=>O("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y.autoRefresh,onChange:()=>O("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:x?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):d.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:r==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${P(r)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:d.map(E=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${j(E.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[p(E.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:E.message}),e.jsx("span",{className:"text-xs text-gray-500",children:g(E.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",E.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",g(E.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",E.daysRemaining]})]})]})]})]})},E.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",g(new Date)]}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},aa=({notification:n,onClose:a,soundEnabled:l,onToggleSound:i})=>{const[d,u]=c.useState(!1),[r,v]=c.useState(null);c.useEffect(()=>{if(n&&(u(!0),l&&x(n.type),n.type!=="urgent")){const p=setTimeout(()=>{w()},1e4);return()=>clearTimeout(p)}},[n,l]),c.useEffect(()=>{typeof window<"u"&&window.AudioContext&&v(new AudioContext)},[]);const x=p=>{if(!(!r||!l))try{const j=r.createOscillator(),g=r.createGain();switch(j.connect(g),g.connect(r.destination),p){case"urgent":j.frequency.setValueAtTime(800,r.currentTime),j.frequency.setValueAtTime(1e3,r.currentTime+.1),j.frequency.setValueAtTime(800,r.currentTime+.2),g.gain.setValueAtTime(.3,r.currentTime),g.gain.exponentialRampToValueAtTime(.01,r.currentTime+.5),j.start(r.currentTime),j.stop(r.currentTime+.5);break;case"warning":j.frequency.setValueAtTime(600,r.currentTime),j.frequency.setValueAtTime(700,r.currentTime+.15),g.gain.setValueAtTime(.2,r.currentTime),g.gain.exponentialRampToValueAtTime(.01,r.currentTime+.3),j.start(r.currentTime),j.stop(r.currentTime+.3);break;case"info":j.frequency.setValueAtTime(400,r.currentTime),g.gain.setValueAtTime(.1,r.currentTime),g.gain.exponentialRampToValueAtTime(.01,r.currentTime+.2),j.start(r.currentTime),j.stop(r.currentTime+.2);break}}catch(j){console.error("خطأ في تشغيل الصوت:",j)}},w=()=>{u(!1),setTimeout(()=>{a()},300)},y=p=>{switch(p){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(me,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(le,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(xe,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(xe,{className:"w-6 h-6"}),pulse:""}}},S=p=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(p);if(!n)return null;const N=y(n.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${d?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${N.bg} ${N.border} ${N.text} ${N.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[n.type==="urgent"&&"تنبيه عاجل!",n.type==="warning"&&"تحذير",n.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:l?"إيقاف الصوت":"تشغيل الصوت",children:l?e.jsx(zt,{className:"w-4 h-4"}):e.jsx(Yt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:n.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",n.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",S(n.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",n.daysRemaining," يوم"]})]})]}),n.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},ra=({user:n,onActivateSubscription:a,onDeactivateSubscription:l,onDeleteUser:i})=>{const[d,u]=c.useState(D.MONTHLY),[r,v]=c.useState(!1),x=Ks(),w=p=>{const j=p==null?void 0:p.displayName;if(typeof j=="string"&&j.trim())return j.trim();if(j&&typeof j=="object"){const g=j.full_name||j.name||j.ar||j.en;if(typeof g=="string"&&g.trim())return g.trim()}return typeof(p==null?void 0:p.email)=="string"&&p.email.includes("@")?p.email.split("@")[0]:"غير محدد"},y=p=>{switch(p){case D.LIFETIME:return e.jsx(Se,{className:"w-4 h-4 text-yellow-500"});case D.YEARLY:return e.jsx(de,{className:"w-4 h-4 text-blue-500"});case D.QUARTERLY:return e.jsx(W,{className:"w-4 h-4 text-purple-500"});case D.MONTHLY:return e.jsx(Oe,{className:"w-4 h-4 text-green-500"});case D.ZERO:return e.jsx(ps,{className:"w-4 h-4 text-gray-500"});default:return null}},S=p=>{switch(p){case D.MONTHLY:return"شهرية";case D.QUARTERLY:return"ربع سنوية";case D.YEARLY:return"سنوية";case D.LIFETIME:return"مدى الحياة";case D.ZERO:return"زيرو";default:return"غير محدد"}},N=p=>p?(p.toDate?p.toDate():new Date(p)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(ve,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Ee,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w(n)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Ut,{className:"w-3 h-3 ml-1"}),n.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(Ns,{className:"w-3 h-3 ml-1"}),n.phone||"غير محدد"]})]})]}),e.jsx(Ce,{variant:n.isActive?"default":"secondary",children:n.isActive?"نشط":"غير نشط"})]}),n.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[y(n.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:S(n.subscription.planType)})]}),e.jsx(Ce,{variant:n.subscription.isActive?"default":"destructive",children:n.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(W,{className:"w-3 h-3 ml-1"}),"البداية: ",N(n.subscription.startDate)]}),n.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-3 h-3 ml-1"}),"النهاية: ",N(n.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[a&&r&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),x?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:d,onChange:p=>u(p.target.value),children:[e.jsx("option",{value:D.MONTHLY,children:"شهرية"}),e.jsx("option",{value:D.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:D.YEARLY,children:"سنوية"}),e.jsx("option",{value:D.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:D.ZERO,children:"زيرو"})]}):e.jsxs(kt,{value:d,onValueChange:p=>u(p),children:[e.jsx(Mt,{className:"w-full",children:e.jsx(Rt,{placeholder:"اختر نوع الباقة"})}),e.jsxs(Lt,{children:[e.jsx(pe,{value:D.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(pe,{value:D.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(pe,{value:D.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(pe,{value:D.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(pe,{value:D.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(K,{size:"sm",onClick:()=>{a(n.id,d),v(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(K,{size:"sm",variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[a&&!r&&e.jsx(K,{size:"sm",variant:"outline",onClick:()=>v(!0),className:"flex-1",children:"تفعيل الاشتراك"}),l&&e.jsx(K,{size:"sm",variant:"outline",onClick:()=>l(n.id),className:"flex-1",children:"إلغاء الاشتراك"}),i&&e.jsx(K,{size:"sm",variant:"destructive",onClick:()=>i(n.id),children:e.jsx(Xs,{className:"w-4 h-4"})})]})]})]})})};class na{constructor(){ds(this,"hooks",[])}registerHooks(a){console.log("📝 Registering hooks:",Object.keys(a)),this.hooks.push(a)}async sendImageMessage(a,l,i,d,u){try{console.log("📤 Uploading image message:",{chatId:a,fileName:l.name,fileSize:l.size,senderType:i,senderId:d});const r=us(),v=Date.now(),x=`chat-images/${a}/${v}_${l.name}`,w=hs(r,x),y=await ft(w,l);console.log("✅ Image uploaded successfully:",y.metadata.fullPath);const S=await bt(w);console.log("✅ Image URL obtained:",S);const N={chatId:a,message:u||"صورة",content:u||"صورة",senderType:i,senderId:d,timestamp:J(),isRead:!1,type:"image",imageUrl:S,imageFileName:l.name},p=await Ue(V(M,"chatMessages"),N);console.log("✅ Image message added to chatMessages:",p.id);const j=G(M,"chatRooms",a);if(i==="client"){const g=await Ne(j);if(g.exists()){const P=g.data().unreadCount||0;await te(j,{lastMessage:u||"صورة",lastMessageTime:J(),unreadCount:P+1})}}else await te(j,{lastMessage:u||"صورة",lastMessageTime:J()});console.log("✅ Image message sent successfully")}catch(r){throw console.error("🔥 Error sending image message:",r),r}}async deleteChat(a){try{console.log("🗑️ Deleting chat:",a);const l=Z(V(M,"chatMessages"),Q("chatId","==",a)),i=await ne(l),d=[];for(const r of i.docs){const v=r.data();if(v.type==="image"&&v.imageUrl)try{const x=us(),w=hs(x,v.imageUrl);d.push(jt(w))}catch(x){console.warn("⚠️ Could not delete image from storage:",x)}d.push(ae(r.ref))}const u=G(M,"chatRooms",a);d.push(ae(u)),await Promise.all(d),console.log("✅ Chat deleted successfully:",{chatId:a,messagesDeleted:i.size})}catch(l){throw console.error("🔥 Error deleting chat:",l),l}}unregisterHooks(a){console.log("🗑️ Unregistering hooks"),a?this.hooks=this.hooks.filter(l=>l!==a):this.hooks=[]}async createChatRoom(a,l=!1){try{const i=l?"clientEmail":"clientPhone",d=Z(V(M,"chatRooms"),Q(i,"==",a),Q("status","==","active")),u=await ne(d);if(!u.empty)return u.docs[0].id;const r={clientId:`client_${a}`,clientPhone:l?"":a,clientEmail:l?a:void 0,customerName:l?`عميل ${a}`:`عميل ${a}`,status:"active",unreadCount:0,createdAt:J(),lastMessageTime:J()};return(await Ue(V(M,"chatRooms"),r)).id}catch(i){throw console.error("Error creating chat room:",i),i}}async sendMessage(a,l,i,d){try{for(let r=1;r<=3;r++)try{console.log(`📤 Sending message (attempt ${r}):`,{chatId:a,message:l.substring(0,50)+"...",senderType:i,senderId:d});const v={chatId:a,message:l,content:l,senderType:i,senderId:d,timestamp:J(),isRead:!1},x=await Ue(V(M,"chatMessages"),v);console.log("✅ Message added to chatMessages:",x.id);const w=G(M,"chatRooms",a);if(i==="client"){const y=await Ne(w),S=y.exists()&&y.data().unreadCount||0;await te(w,{lastMessage:l,lastMessageTime:J(),unreadCount:S+1}),this.hooks.length>0&&this.hooks.forEach(N=>{if(N.onUnreadCountChange&&typeof N.onUnreadCountChange=="function")try{N.onUnreadCountChange(a,S+1)}catch(p){console.error("Error calling onUnreadCountChange hook:",p)}})}else await te(w,{lastMessage:l,lastMessageTime:J()});if(this.hooks.length>0)try{const y=await Ne(w);if(y.exists()){const S={id:y.id,...y.data()},N={id:x.id,...v,timestamp:new Date};this.hooks.forEach(p=>{if(p.onNewMessage&&typeof p.onNewMessage=="function")try{p.onNewMessage(N,S)}catch(j){console.error("Error calling onNewMessage hook:",j)}})}}catch(y){console.error("Error calling onNewMessage hooks:",y)}console.log("✅ Message sent successfully");return}catch(v){if(console.error(`❌ Attempt ${r} failed:`,v),r===3)throw v;await new Promise(x=>setTimeout(x,1e3*r))}throw new Error("Max retry attempts reached")}catch(r){throw console.error("🔥 Error sending message:",r),r}}subscribeToMessages(a,l){let i=0;const d=5;let u=null,r=null,v=0;const x=()=>{try{console.log("🔔 Starting subscription to messages for room:",a,`(attempt ${i+1})`);const w=Z(V(M,"chatMessages"),Q("chatId","==",a),ms("timestamp","asc"));r=be(w,y=>{console.log("📨 Received messages snapshot:",y.docs.length,"messages"),i=0;const S=y.docs.map(N=>{const p=N.data();return{id:N.id,...p,message:p.message||p.content||"",content:p.content||p.message||""}});if(S.length>v&&v>0){const N=S.slice(v);console.log("🆕 New messages detected:",N.length),N.forEach(p=>{this.hooks.forEach(j=>{if(j.onNewMessage&&typeof j.onNewMessage=="function")try{Ne(G(M,"chatRooms",a)).then(g=>{if(g.exists()){const P={id:g.id,...g.data()},O=j.onNewMessage;O&&O(p,P)}}).catch(g=>{console.error("Error fetching chat room for hook:",g)})}catch(g){console.error("Error calling onNewMessage hook:",g)}})})}v=S.length,console.log("📨 Processed messages:",S),l(S)},y=>{var S,N,p,j;if(console.error("❌ Error in messages subscription:",y),y.name==="AbortError"||(S=y.message)!=null&&S.includes("AbortError")){console.log("🔄 Request was aborted, will retry..."),i<d&&(i++,u=setTimeout(()=>{x()},1e3));return}(N=y.message)!=null&&N.includes("index is currently building")||(p=y.message)!=null&&p.includes("cannot be used yet")||y.code==="failed-precondition"?(console.log("🔨 Index is still building, will retry in 10 seconds..."),i<d?(i++,u=setTimeout(()=>{console.log("🔄 Retrying subscription after index building delay..."),x()},1e4)):(console.log("⚠️ Max retries reached for index building. Please wait for index to complete."),l([]))):y.code==="unavailable"||(j=y.message)!=null&&j.includes("ERR_ABORTED")?(console.log("🔄 Connection issue detected, will retry automatically..."),i<d&&(i++,u=setTimeout(()=>{x()},2e3))):(console.error("❌ Unhandled error in messages subscription:",y),l([]))})}catch(w){console.error("❌ Error setting up messages subscription:",w),i<d&&(i++,u=setTimeout(()=>{x()},5e3))}};return x(),()=>{u&&clearTimeout(u),r&&r()}}subscribeToAdminChats(a){console.log("🔍 Admin: Starting subscription to admin chats");let l=0,i=0;const d=5;let u=null,r=null;const v=()=>{try{const x=Z(V(M,"chatRooms"),Q("status","==","active"),ms("lastMessageTime","desc"));r=be(x,w=>{console.log("📊 Admin: Received chat rooms snapshot:",{size:w.size,empty:w.empty,docs:w.docs.length}),i=0;const y=w.docs.map(S=>{const N=S.data();return console.log("💬 Admin: Chat room data:",{id:S.id,customerName:N.customerName,lastMessage:N.lastMessage,unreadCount:N.unreadCount,status:N.status}),{id:S.id,...N}});y.length!==l&&(console.log("🆕 Chat rooms count changed:",{old:l,new:y.length}),y.forEach(S=>{this.hooks.length>0&&this.hooks.forEach(N=>{if(N.onChatRoomUpdate&&typeof N.onChatRoomUpdate=="function")try{N.onChatRoomUpdate(S)}catch(p){console.error("Error calling onChatRoomUpdate hook:",p)}})})),l=y.length,a(y)},w=>{var y,S;if(console.error("❌ Error in admin chats subscription:",w),w.name==="AbortError"||(y=w.message)!=null&&y.includes("AbortError")){console.log("🔄 Admin chats request was aborted, will retry..."),i<d&&(i++,u=setTimeout(()=>{v()},1e3));return}w.code==="unavailable"||(S=w.message)!=null&&S.includes("ERR_ABORTED")?(console.log("🔄 Admin chats connection issue detected, will retry..."),i<d&&(i++,u=setTimeout(()=>{v()},2e3))):(console.error("❌ Unhandled error in admin chats subscription:",w),a([]))})}catch(x){console.error("❌ Error setting up admin chats subscription:",x),i<d&&(i++,u=setTimeout(()=>{v()},5e3))}};return v(),()=>{u&&clearTimeout(u),r&&r()}}async markMessagesAsRead(a,l){try{const i=Z(V(M,"chatMessages"),Q("chatId","==",a),Q("senderType","!=",l),Q("isRead","==",!1)),u=(await ne(i)).docs.map(r=>te(G(M,"chatMessages",r.id),{isRead:!0}));if(await Promise.all(u),l==="admin"){const r=G(M,"chatRooms",a);await te(r,{unreadCount:0})}}catch(i){throw console.error("Error marking messages as read:",i),i}}async closeChatRoom(a){try{const l=G(M,"chatRooms",a);await te(l,{status:"closed",lastMessageTime:J()})}catch(l){throw console.error("Error closing chat room:",l),l}}}const oe=new na,la=({isOpen:n,onClose:a})=>{var A,_;const[l,i]=c.useState([]),[d,u]=c.useState(null),[r,v]=c.useState([]),[x,w]=c.useState(""),[y,S]=c.useState(!0),[N,p]=c.useState(!1),[j,g]=c.useState({}),P=c.useRef(null);c.useEffect(()=>{const m={onNewMessage:(C,k)=>{console.log("🔔 New message notification:",C,k),C.senderType==="client"&&C.chatId!==d&&(g(R=>({...R,[C.chatId]:(R[C.chatId]||0)+1})),console.log("🔔 New message from client in chat:",k.customerName||k.clientPhone))},onChatRoomUpdate:C=>{console.log("🔄 Chat room updated:",C),i(k=>{const R=k.findIndex(L=>L.id===C.id);if(R>=0){const L=[...k];return L[R]=C,L.sort((ue,H)=>{var U,F,$,z;const ie=((F=(U=ue.lastMessageTime)==null?void 0:U.toMillis)==null?void 0:F.call(U))||0;return(((z=($=H.lastMessageTime)==null?void 0:$.toMillis)==null?void 0:z.call($))||0)-ie})}else return[C,...k]})},onUnreadCountChange:(C,k)=>{console.log("📊 Unread count changed:",C,k),i(R=>R.map(L=>L.id===C?{...L,unreadCount:k}:L))}};return oe.registerHooks(m),()=>{oe.unregisterHooks()}},[d]),c.useEffect(()=>{console.log("🔍 AdminChatPanel: Setting up chat rooms subscription"),S(!0);const m=oe.subscribeToAdminChats(C=>{console.log("📊 AdminChatPanel: Received chats update:",C.length),i(C),S(!1)});return()=>{console.log("🔌 AdminChatPanel: Cleaning up chat rooms subscription"),m()}},[]),c.useEffect(()=>{if(!d){v([]);return}console.log("📨 AdminChatPanel: Setting up messages subscription for chat:",d);const m=oe.subscribeToMessages(d,C=>{console.log("📨 AdminChatPanel: Received messages update:",C.length),v(C),g(k=>{const R={...k};return delete R[d],R})});return oe.markMessagesAsRead(d,"admin").catch(console.error),()=>{console.log("🔌 AdminChatPanel: Cleaning up messages subscription"),m()}},[d]),c.useEffect(()=>{var m;(m=P.current)==null||m.scrollIntoView({behavior:"smooth"})},[r]);const O=async()=>{if(!(!x.trim()||!d||N)){p(!0);try{await oe.sendMessage(d,x.trim(),"admin","admin_user"),w("")}catch(m){console.error("Error sending message:",m),alert("حدث خطأ في إرسال الرسالة")}finally{p(!1)}}},E=m=>{u(m),g(C=>{const k={...C};return delete k[m],k})},B=Object.values(j).reduce((m,C)=>m+C,0),se=l.reduce((m,C)=>m+(C.unreadCount||0),0);return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[80vh] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"المحادثات"}),(se>0||B>0)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pt,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold",children:"جديد"})]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:y?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(fs,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-2 text-gray-600",children:"جاري التحميل..."})]}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[e.jsx($e,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"لا توجد محادثات نشطة"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"ستظهر المحادثات الجديدة هنا"})]}):l.map(m=>{const C=d===m.id,k=(m.unreadCount||0)>0,R=j[m.id]>0,L=(m.unreadCount||0)+(j[m.id]||0);return e.jsx("div",{onClick:()=>E(m.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-all duration-200 ${C?"bg-blue-50 border-r-4 border-r-blue-500":k||R?"bg-yellow-50 hover:bg-yellow-100 border-r-4 border-r-yellow-400":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${k||R?"bg-yellow-200":"bg-gray-200"}`,children:e.jsx(Te,{className:`w-5 h-5 ${k||R?"text-yellow-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:m.customerName||m.clientPhone}),C&&e.jsx(Ve,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]}),m.customerName&&m.customerName!==m.clientPhone&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:m.clientPhone}),m.lastMessage&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:m.lastMessage.length>50?m.lastMessage.substring(0,50)+"...":m.lastMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(le,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:m.lastMessageTime&&m.lastMessageTime.toMillis?new Date(m.lastMessageTime.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${k||R?"bg-red-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:k||R?"رسائل جديدة":"مقروءة"})]})]})]}),L>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[20px] text-center",children:L>99?"99+":L})]})},m.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:((A=l.find(m=>m.id===d))==null?void 0:A.customerName)||((_=l.find(m=>m.id===d))==null?void 0:_.clientPhone)})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.map(m=>e.jsx("div",{className:`flex ${m.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${m.senderType==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:m.message||m.content}),e.jsx("p",{className:`text-xs mt-1 ${m.senderType==="admin"?"text-blue-100":"text-gray-500"}`,children:m.timestamp&&m.timestamp.toMillis?new Date(m.timestamp.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"})]})},m.id)),e.jsx("div",{ref:P})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:m=>w(m.target.value),onKeyPress:m=>m.key==="Enter"&&O(),placeholder:"اكتب رسالتك هنا...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:N}),e.jsxs("button",{onClick:O,disabled:!x.trim()||N,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[N?e.jsx(fs,{className:"w-4 h-4 animate-spin"}):e.jsx(Bt,{className:"w-4 h-4"}),"إرسال"]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر محادثة للبدء"}),e.jsx("p",{children:"اختر محادثة من القائمة لعرض الرسائل والرد عليها"})]})})})]})}):null},ia={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.firebasestorage.app",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},ca=({navigate:n,auth:a,devMode:l,setDevMode:i,error:d,setError:u,authLoading:r,setAuthLoading:v,activeTab:x,setActiveTab:w,setNotificationCenterOpen:y,setNotificationSettings:S,setNotifications:N,notificationCount:p,setNotificationCount:j,users:g,setUsers:P,filteredUsers:O,setFilteredUsers:E,loading:B,setLoading:se,setEditingPlan:A,isSavingContent:_,setIsSavingContent:m,lastUpdateInfo:C,loadContentFromFirebase:k,saveContentToFirebase:R})=>{var os;const[L,ue]=c.useState(!0),[H,ie]=c.useState(""),[T,U]=c.useState(null),[F,$]=c.useState({});c.useState(!1),c.useState(null),c.useState(!1);const[z,Ae]=c.useState({sound:!0}),[vs,oa]=c.useState(!1),[Es,Ss]=c.useState(null),[Be,Cs]=c.useState([]),[Ts,He]=c.useState(!1),[ze,Ye]=c.useState({}),[qe,Qe]=c.useState(null),Ds=async s=>{var o;const t=(ze[s]||"").trim();if(t)try{Qe(s),await et.reply(s,t,((o=a==null?void 0:a.currentUser)==null?void 0:o.uid)||void 0),Ye(b=>({...b,[s]:""}))}catch(b){console.error("Failed to reply to report",b)}finally{Qe(null)}},ke=s=>{const t=s==null?void 0:s.displayName;let o="";typeof t=="string"?o=t:t&&typeof t=="object"&&(o=(t.ar||t.en||"").toString()),!o&&typeof(s==null?void 0:s.email)=="string"&&(o=s.email);const b=String(o).trim().charAt(0);return b?b.toUpperCase():"؟"},he=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const o=t.full_name||t.name||t.ar||t.en;if(typeof o=="string"&&o.trim())return o.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[Me,Ge]=c.useState(""),[Re,Ze]=c.useState(""),[Ke,Xe]=c.useState(""),[Le,Je]=c.useState(""),[We,es]=c.useState(!1),[je,ss]=c.useState(""),[Y,ts]=c.useState(24),[as,rs]=c.useState("24"),[ns,ls]=c.useState(!1),[da,is]=c.useState(!1);c.useEffect(()=>{x==="trials"&&(async()=>{try{is(!0);const{FreeTrialService:s}=await we(async()=>{const{FreeTrialService:o}=await import("./index-BwRCC2gi.js").then(b=>b.b1);return{FreeTrialService:o}},__vite__mapDeps([0,1])),t=await s.getTrialDurationHours();ts(t),rs(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{is(!1)}})()},[x]),c.useEffect(()=>{if(x!=="reports")return;He(!0);const s=be(V(M,"user_reports"),t=>{const o=t.docs.map(b=>{var q,X;const h=b.data(),f=(q=h==null?void 0:h.createdAt)!=null&&q.toDate?h.createdAt.toDate().getTime():Date.now(),I=(X=h==null?void 0:h.repliedAt)!=null&&X.toDate?h.repliedAt.toDate().getTime():void 0;return{id:b.id,userId:String(h.userId),shopId:h.shopId??null,userName:String(h.userName||""),phone:h.phone??null,email:h.email??null,message:String(h.message||""),status:h.status||"sent",adminReply:h.adminReply??null,repliedBy:h.repliedBy??null,isReadByUser:!!h.isReadByUser,createdAt:f,repliedAt:I}});o.sort((b,h)=>b.createdAt<h.createdAt?1:-1),Cs(o),He(!1)});return()=>s()},[x]);const As=async()=>{var s;if(!Me.trim()||!Re.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{es(!0);const t=Le.trim()?`user:${Le.trim()}`:"global";await At({title:Me.trim(),message:Re.trim(),audienceKey:t,createdBy:(s=a==null?void 0:a.currentUser)==null?void 0:s.uid,linkUrl:Ke.trim()||void 0}),Ge(""),Ze(""),Xe(""),Je(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{es(!1)}};c.useEffect(()=>{if(!H.trim())E(g);else{const s=g.filter(t=>t.email&&typeof t.email=="string"&&t.email.toLowerCase().includes(H.toLowerCase())||t.displayName&&typeof t.displayName=="string"&&t.displayName.toLowerCase().includes(H.toLowerCase())||t.name&&typeof t.name=="string"&&t.name.toLowerCase().includes(H.toLowerCase()));E(s)}},[g,H,E]);const ks=()=>{a!=null&&a.signOut&&a.signOut(),n("/admin/login")},Ms=async(s,t,o=null)=>{var b;try{console.log("Activating subscription for user:",s,"with plan:",t,"and variant:",o);const h=((b=a==null?void 0:a.currentUser)==null?void 0:b.uid)||"admin-user-id";await st(s,t,h,o),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(h){console.error("❌ خطأ في تفعيل الاشتراك:",h),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Rs=async s=>{try{console.log("Deactivating subscription for user:",s),await tt(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Ls=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const b=((t=a==null?void 0:a.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const f=await at(rt,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",f),P(I=>I.filter(q=>q.id!==s)),E(I=>I.filter(q=>q.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(h){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(h==null?void 0:h.message)||h)}{const h=[];try{await ae(G(M,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(f){console.error("خطأ في حذف الملف الشخصي:",f),h.push(`الملف الشخصي: ${(f==null?void 0:f.message)||f}`)}try{await ae(G(M,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(f){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",f),h.push(`users: ${(f==null?void 0:f.message)||f}`)}try{const f=Z(V(M,"transactions"),Q("userId","==",s)),I=await ne(f),q=I.docs.map(ge=>ae(ge.ref)),X=await Promise.allSettled(q),ce=X.filter(ge=>ge.status==="rejected");ce.length?(console.warn("فشل حذف بعض المعاملات:",ce.length),h.push(`المعاملات: فشل حذف ${ce.length} من أصل ${X.length}`)):console.log(`تم حذف ${I.size} معاملة`)}catch(f){console.error("خطأ في جلب/حذف المعاملات:",f),h.push(`المعاملات: ${(f==null?void 0:f.message)||f}`)}try{const f=Z(V(M,"chatRooms"),Q("participants","array-contains",s)),I=await ne(f),q=I.docs.map(async X=>{try{const ge=(await ne(V(X.ref,"messages"))).docs.map(Ys=>ae(Ys.ref));await Promise.allSettled(ge),await ae(X.ref)}catch(ce){console.error("فشل حذف محادثة/رسائل:",ce),h.push(`المحادثات: ${X.id}`)}});await Promise.all(q),console.log(`تم إنهاء معالجة ${I.size} محادثة`)}catch(f){console.error("خطأ في جلب/حذف المحادثات:",f),h.push(`المحادثات: ${(f==null?void 0:f.message)||f}`)}try{await nt(G(M,"deletedUsers",s),{deletedAt:new Date,deletedBy:b,reason:"حذف نهائي من لوحة الإدارة"})}catch(f){console.error("خطأ في تسجيل المستخدم كمحذوف:",f),h.push(`deletedUsers: ${(f==null?void 0:f.message)||f}`)}P(f=>f.filter(I=>I.id!==s)),E(f=>f.filter(I=>I.id!==s)),h.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${h.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(o){console.error("❌ خطأ في حذف المستخدم:",o),alert(`حدث خطأ في حذف المستخدم: ${o.message||"خطأ غير معروف"}`)}};c.useEffect(()=>{(async()=>{try{if(typeof k=="function"){const t=await k();t&&(t.monthly||t.yearly||t.lifetime)&&$(t)}}catch(t){console.warn("Failed to load content data:",t)}})()},[]);const Us=async()=>{var s;try{if(typeof R!="function")return;m(!0);const t=((s=a==null?void 0:a.currentUser)==null?void 0:s.uid)||"admin-user-id";await R(F,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{m(!1)}},ye=(s,t,o)=>{$(b=>({...b,[s]:{...(b==null?void 0:b[s])||{},[t]:o}}))},_s=s=>{$(t=>{var o;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((o=t==null?void 0:t[s])==null?void 0:o.features)||[],""]}}})},Is=(s,t,o)=>{$(b=>{var f;const h=[...((f=b==null?void 0:b[s])==null?void 0:f.features)||[]];return h[t]=o,{...b,[s]:{...(b==null?void 0:b[s])||{},features:h}}})},Fs=(s,t)=>{$(o=>{var h;const b=[...((h=o==null?void 0:o[s])==null?void 0:h.features)||[]];return b.splice(t,1),{...o,[s]:{...(o==null?void 0:o[s])||{},features:b}}})},Ps=()=>{Ae(s=>({...s,sound:!s.sound}))},Os=()=>{Ss(null)},$s=async()=>{try{const s=Number(as);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}ls(!0);const{FreeTrialService:t}=await we(async()=>{const{FreeTrialService:b}=await import("./index-BwRCC2gi.js").then(h=>h.b1);return{FreeTrialService:b}},__vite__mapDeps([0,1])),o=await t.updateTrialDurationHours(s);o.success?(ts(s),alert(o.message)):alert(o.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{ls(!1)}},Vs=async s=>{try{const{FreeTrialService:t}=await we(async()=>{const{FreeTrialService:b}=await import("./index-BwRCC2gi.js").then(h=>h.b1);return{FreeTrialService:b}},__vite__mapDeps([0,1])),o=await t.startFreeTrialFromAdmin(s);alert(o.message||`تم تفعيل التجربة المجانية لمدة ${Y} ${Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"}`)}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},Bs=async s=>{try{const{FreeTrialService:t}=await we(async()=>{const{FreeTrialService:b}=await import("./index-BwRCC2gi.js").then(h=>h.b1);return{FreeTrialService:b}},__vite__mapDeps([0,1])),o=await t.resetActiveTrialToCurrentDuration(s);alert(o.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},Hs=(s,t)=>{console.log("Toggling user status:",s,t)},cs=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",zs=[{id:"users",label:"المستخدمين",icon:$e},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:W},{id:"trials",label:"إدارة التجارب المجانية",icon:de},{id:"content",label:"إدارة المحتوى",icon:lt},{id:"chat",label:"الدردشة",icon:re},{id:"reports",label:"بلاغات المستخدمين",icon:me},{id:"whatsapp",label:"إدارة الواتساب",icon:re},{id:"analytics",label:"الإحصائيات",icon:gs}];return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:d})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{u(null),v(!0),window.location.reload()},className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"🔄 إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{u(null),n("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",d),console.log("🔍 Auth state:",a.currentUser),console.log("🔍 Dev mode:",l),console.log("🔍 Environment:",ia)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!l&&!a.currentUser?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>n("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:`${L?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[L&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(_t,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>ue(!L),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:L?e.jsx(fe,{className:"w-5 h-5"}):e.jsx(Vt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:zs.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>w(s.id),className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${x===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:ks,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Js,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[x==="users"&&"إدارة المستخدمين",x==="subscriptions"&&"مواعيد الاشتراكات",x==="trials"&&"إدارة التجارب المجانية",x==="chat"&&"إدارة الدردشة",x==="reports"&&"بلاغات المستخدمين",x==="analytics"&&"الإحصائيات"]}),l&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",l?"المطور":"المدير"]}),e.jsx(dt,{})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[x==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:g.length})]}),e.jsx($e,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Le,onChange:s=>Je(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:g.filter(s=>s.isActive).length})]}),e.jsx(js,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:g.filter(s=>!s.isActive).length})]}),e.jsx(Ht,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:H,onChange:s=>ie(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),H&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",O.length," من أصل ",g.length," مستخدم",H&&e.jsx("button",{onClick:()=>ie(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):O.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:H?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(s=>e.jsx(ra,{user:s,onActivateSubscription:Ms,onToggleUserStatus:Hs,onDeactivateSubscription:Rs,onDeleteUser:Ls},s.id))})})]})]}),x==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:g.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(Ve,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:g.filter(s=>{var f,I;if(!((f=s.subscription)!=null&&f.endDate)||!((I=s.subscription)!=null&&I.isActive))return!1;const t=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),o=new Date,b=t.getTime()-o.getTime(),h=Math.ceil(b/(1e3*60*60*24));return h<=7&&h>0}).length})]}),e.jsx(me,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:g.filter(s=>{var o;return(o=s.subscription)!=null&&o.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(le,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:g.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===D.LIFETIME}).length})]}),e.jsx(Se,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.planType}).sort((s,t)=>{var h,f;if(!((h=s.subscription)!=null&&h.endDate)||!((f=t.subscription)!=null&&f.endDate))return 0;const o=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),b=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return o.getTime()-b.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const o=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,b=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let h=null,f="غير محدد";if(t.planType===D.LIFETIME)f="مدى الحياة";else if(b){const I=new Date,q=b.getTime()-I.getTime();h=Math.ceil(q/(1e3*60*60*24)),h<0?f="منتهي":h<=7?f="ينتهي قريباً":f="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:ke(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:he(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===D.LIFETIME&&e.jsx(Se,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===D.YEARLY&&e.jsx(de,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===D.QUARTERLY&&e.jsx(W,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===D.MONTHLY&&e.jsx(Oe,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ws(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o?o.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===D.LIFETIME?"مدى الحياة":b?b.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${f==="نشط"?"bg-green-100 text-green-800":f==="ينتهي قريباً"?"bg-orange-100 text-orange-800":f==="منتهي"?"bg-red-100 text-red-800":f==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:f})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===D.LIFETIME?"∞":h!==null?h<0?"منتهي":`${h} يوم`:"غير محدد"})]},s.id)}).filter(Boolean)})]})})]})]}),x==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),C&&C.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(C.lastUpdated).toLocaleString("ar-SA"),C.updatedBy&&` بواسطة: ${C.updatedBy}`]})]}),e.jsxs("button",{onClick:Us,disabled:_,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(ys,{className:"w-4 h-4"}),_?"جاري الحفظ...":"حفظ جميع التغييرات"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(F).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(Oe,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(W,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(de,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(Se,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>A(T===s?null:s),className:"text-purple-600 hover:text-purple-800",children:e.jsx(yt,{className:"w-4 h-4"})})]}),T===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:o=>ye(s,"name",o.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:o=>ye(s,"price",o.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:o=>ye(s,"period",o.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:o=>ye(s,"description",o.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>_s(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((o,b)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:h=>Is(s,b,h.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>Fs(s,b),className:"text-red-500 hover:text-red-700",children:e.jsx(fe,{className:"w-4 h-4"})})]},b))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((o,b)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3 text-green-500"}),o]},b))]})]})]},s))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:Me,onChange:s=>Ge(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:Re,onChange:s=>Ze(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:Ke,onChange:s=>Xe(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:As,disabled:We,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:We?"جاري الإرسال...":"إرسال إشعار"})})]})]})]}),x==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",g),console.log("🔍 Users count:",(g==null?void 0:g.length)||0),console.log("🔍 Users on trial:",((os=g==null?void 0:g.filter(s=>s.isOnFreeTrial))==null?void 0:os.length)||0),B&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),d&&!B&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(me,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:d}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!B&&!d&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:g.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(de,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:g.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(le,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:g.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(js,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:as,onChange:s=>rs(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",Y," ",Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:$s,disabled:ns,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:ns?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:je,onChange:s=>ss(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Fe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[g.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=je.trim().toLowerCase();if(!t)return!0;const o=he(s).toLowerCase(),b=(s.email||"").toLowerCase();return o.includes(t)||b.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ke(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:he(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",cs(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>Vs(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${Y} ${Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"}`})})]},s.id)),g.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),g.filter(s=>s.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:je,onChange:s=>ss(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Fe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:g.filter(s=>s.isOnFreeTrial).filter(s=>{const t=je.trim().toLowerCase();if(!t)return!0;const o=he(s).toLowerCase(),b=(s.email||"").toLowerCase();return o.includes(t)||b.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ke(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:he(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?cs(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>Bs(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"})]})]},s.id))})})]})]})]}),x==="chat"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx(la,{isOpen:!0,onClose:()=>{}})}),x==="reports"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(me,{className:"w-6 h-6 text-red-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"بلاغات المستخدمين"})]}),Ts?e.jsx("div",{className:"text-gray-500 text-sm",children:"جاري تحميل البلاغات..."}):e.jsxs("div",{className:"space-y-4",children:[Be.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"لا توجد بلاغات حالياً."}),Be.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:s.userName||s.email||s.phone||s.userId}),e.jsxs("p",{className:"text-xs text-gray-500",children:["المعرف: ",s.userId]}),e.jsx("p",{className:"mt-2 text-gray-700",children:s.message}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["أُرسلت: ",new Date(s.createdAt).toLocaleString("ar-EG")]}),s.repliedAt&&e.jsxs("span",{className:"ml-2",children:[" | رُدّ: ",new Date(s.repliedAt).toLocaleString("ar-EG")]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.status==="sent"?"bg-yellow-100 text-yellow-800":s.status==="replied"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:s.status==="sent"?"بانتظار الرد":s.status==="replied"?"تم الرد":"مقروء"})})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[s.email&&e.jsx("div",{children:s.email}),s.phone&&e.jsx("div",{children:s.phone}),s.shopId&&e.jsxs("div",{children:["المتجر: ",s.shopId]})]})]}),e.jsx("div",{className:"mt-4",children:s.adminReply?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3",children:[e.jsx("div",{className:"text-xs text-green-700 mb-1",children:"رد الإدارة:"}),e.jsx("div",{className:"text-sm text-gray-800",children:s.adminReply})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:ze[s.id]||"",onChange:t=>Ye(o=>({...o,[s.id]:t.target.value})),placeholder:"اكتب رد الإدارة...",className:"flex-1 border rounded-md px-3 py-2 text-sm"}),e.jsx("button",{onClick:()=>Ds(s.id),disabled:qe===s.id,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm disabled:opacity-50",children:qe===s.id?"جاري الإرسال...":"إرسال"})]})})]},s.id))]})]}),x==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(re,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(qt,{})]}),x==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(gs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(ta,{isOpen:vs,onClose:()=>y(!1)}),e.jsx(aa,{notification:Es,onClose:Os,soundEnabled:z.soundAlerts,onToggleSound:Ps})]})},Ka=()=>{const n=it(),{user:a,loading:l}=ct(),[i,d]=c.useState(!1),[u,r]=c.useState(null),[v,x]=c.useState(!1),[w,y]=c.useState("users"),[S,N]=c.useState(0),[p,j]=c.useState([]),[g,P]=c.useState([]),[O,E]=c.useState(!1),[B,se]=c.useState(null),[A,_]=c.useState([]),[m,C]=c.useState({});c.useEffect(()=>{const T=localStorage.getItem("admin_dev_mode")==="true";d(T)},[]),c.useEffect(()=>{if(!(!i&&!a)){x(!0),r(null);try{const T=Z(V(M,"users")),U=be(T,F=>{const $=F.docs.map(z=>({id:z.id,...z.data()}));_($),x(!1),r(null)},F=>{console.error("Error loading users:",F),i?(_([]),x(!1),r(null)):(r("فشل في تحميل بيانات المستخدمين"),x(!1))});return()=>U()}catch(T){console.error("Error setting up users listener:",T),i?(_([]),x(!1),r(null)):(r("فشل في إعداد مراقب البيانات"),x(!1))}}},[a,i]),c.useEffect(()=>{if(!(!i&&!a))try{const T=Z(V(M,"profiles")),U=be(T,F=>{const $={};F.forEach(z=>{$[z.id]=z.data()}),C($)},F=>{console.error("Error loading profiles:",F)});return()=>U()}catch(T){console.error("Error setting up profiles listener:",T)}},[a,i]),c.useEffect(()=>{const T=A.map(U=>{const F=m[U.id]||{},$=typeof F.fullName=="string"?F.fullName:void 0,z=typeof F.phone=="string"?F.phone:void 0,Ae=typeof U.displayName=="string"&&U.displayName.trim()?U.displayName:$||U.displayName||void 0;return{...U,displayName:Ae,phone:U.phone??z??null}});j(T),P(T)},[A,m]);const k=T=>{console.log("Notification center:",T)},R=T=>{console.log("Notification settings:",T)},L=T=>{console.log("Notifications:",T)},ue=T=>{console.log("Editing plan:",T)};c.useEffect(()=>{(async()=>{try{const T=await bs();se(T)}catch(T){console.warn("Failed to load last update info:",T),se(null)}})()},[]);const H=async()=>{try{return await It()}catch(T){return console.error("Error loading content:",T),{}}},ie=async T=>{try{E(!0);try{localStorage.setItem("siteContent_plans_cache",JSON.stringify(T))}catch{}await Ft(T,(a==null?void 0:a.uid)||"admin");const U=await bs();return se(U),!0}catch(U){return console.error("Error saving content:",U),!1}finally{E(!1)}};return l?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):e.jsx(ca,{navigate:n,auth:ot,devMode:i,setDevMode:d,error:u,setError:r,authLoading:l,setAuthLoading:()=>{},activeTab:w,setActiveTab:y,setNotificationCenterOpen:k,setNotificationSettings:R,setNotifications:L,notificationCount:S,setNotificationCount:N,users:p,setUsers:j,filteredUsers:g,setFilteredUsers:P,loading:v,setLoading:x,setEditingPlan:ue,isSavingContent:O,setIsSavingContent:E,lastUpdateInfo:B,loadContentFromFirebase:H,saveContentToFirebase:ie})};export{Ka as default};
