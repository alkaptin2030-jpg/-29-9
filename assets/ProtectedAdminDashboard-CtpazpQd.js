const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bc0KmgLq.js","assets/index-BnIBmMzz.css","assets/appDownloadService-C_-4y2bO.js","assets/index.esm-C-8jssIf.js"])))=>i.map(i=>d[i]);
var ht=Object.defineProperty;var ut=(l,a,c)=>a in l?ht(l,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[a]=c;var vs=(l,a,c)=>ut(l,typeof a!="symbol"?a+"":a,c);import{c as K,d as gt,r as o,j as e,M as xe,S as T,f as z,g as R,q as X,a3 as W,h as he,$ as ye,C as ce,aT as Re,aU as pt,a0 as ft,v as re,a4 as Xe,k as ee,w as Ce,Z as de,aV as me,o as ss,m as Ne,_ as Z,X as bt,aw as jt,n as yt,aW as Nt,A as wt,B as vt,t as Et,aC as Ct,a as St,u as Dt,e as Tt}from"./index-Bc0KmgLq.js";import{P as kt}from"./ProfileIcon-C63vUq31.js";import{C as De,a as Ke,b as Je,d as Te,c as At}from"./card-DCvwPkwF.js";import{B as se}from"./button-C9dJa-5M.js";import{I as Mt}from"./input-Bjc_Nieb.js";import{L as Es}from"./label-TPVQqp1H.js";import{T as Rt,B as fe,A as Cs}from"./textarea-CtfMbrHD.js";import{a as _t,S as Us}from"./switch-lMIGjrwm.js";import{A as Lt,a as Pt}from"./alert-CY6R-rnm.js";import{B as _e}from"./badge-BHrwvl14.js";import{a as Ut,S as Se,P as It}from"./separator-CW4lrfX_.js";import{u as Ft,c as Is,v as Fs}from"./whatsappService-Ctls2BhH.js";import{R as es}from"./refresh-cw-DB9P_Ko3.js";import{C as $t}from"./circle-alert-BxB0O43n.js";import{P as $s}from"./phone-DLKytyD3.js";import{E as Ot,a as Vt}from"./eye-DLo0H5EI.js";import{C as Bt}from"./copy-D-aO-lBT.js";import{E as qt,p as Ht}from"./broadcastService-D0fgSqOb.js";import{U as Le}from"./user-9Jc2reFZ.js";import{C as ne}from"./calendar-Cyt6QFbl.js";import{S as zt,a as Yt,b as Gt,c as Qt,d as je}from"./select-BiUzrBdR.js";import{M as Zt}from"./mail-CHrPle5p.js";import{L as Ss}from"./lock-CXY8Ww2V.js";import{Z as ts,M as Wt}from"./zap-L-MapDQu.js";import{G as pe}from"./gift-U5fH9Cp2.js";import{C as ke}from"./crown-DPOTAD4_.js";import{g as Ds,r as Ts,b as Xt,a as Kt,d as Jt,D as ks}from"./index.esm-C-8jssIf.js";import{L as As}from"./dropdown-menu-CxsXzXTq.js";import{U as Ae}from"./users-CAMcgeWe.js";import{C as Me}from"./circle-check-big-DAuL8CCJ.js";import{S as ea}from"./shield-QXyUSGcS.js";import{S as Ms}from"./smartphone-DiiiHdZt.js";import{C as sa}from"./circle-x-E4Q2gbYg.js";import{g as Rs,l as ta,s as aa}from"./contentService-D_w863m-.js";import"./dialog-CFDYDZsR.js";import"./Combination-3SXkyoBR.js";import"./MasterPinDialog-D2IqG1VJ.js";import"./avatars-DjRrutoh.js";import"./index-CailvHQC.js";import"./index-GaIHoRb_.js";import"./index-DCgbwvVD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=K("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=K("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=K("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=K("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=K("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=K("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=K("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=K("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=K("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=K("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=K("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),xa=()=>{const{settings:l,loading:a,error:c,updateSettings:i,refreshSettings:x}=Ft(),{toast:g}=gt(),[r,v]=o.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[d,w]=o.useState(!1),[y,C]=o.useState(!1),[N,f]=o.useState(""),[b,h]=o.useState({});o.useEffect(()=>{l&&v({phoneNumber:l.phoneNumber,defaultMessage:l.defaultMessage,isEnabled:l.isEnabled})},[l]);const O=()=>{var U,u;const A={};return(U=r.phoneNumber)!=null&&U.trim()?Fs(r.phoneNumber)||(A.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):A.phoneNumber="رقم الواتساب مطلوب",(u=r.defaultMessage)!=null&&u.trim()?r.defaultMessage.length<10&&(A.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):A.defaultMessage="الرسالة الافتراضية مطلوبة",h(A),Object.keys(A).length===0},F=async()=>{if(!O()){g({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}w(!0);try{if(await i(r))g({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{g({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{w(!1)}},E=()=>{if(r.phoneNumber&&r.defaultMessage)try{const A=Is(r.phoneNumber,r.defaultMessage);f(A),C(!0)}catch{g({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},q=async()=>{try{await navigator.clipboard.writeText(N),g({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{g({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},le=A=>{const U=A.replace(/[^\d+]/g,"");v(u=>({...u,phoneNumber:U})),b.phoneNumber&&h(u=>({...u,phoneNumber:""}))};return a?e.jsxs(De,{children:[e.jsx(Ke,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Te,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(es,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(De,{children:[e.jsxs(Ke,{children:[e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(At,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Te,{className:"space-y-6",children:[c&&e.jsxs(Lt,{variant:"destructive",children:[e.jsx($t,{className:"h-4 w-4"}),e.jsx(Pt,{children:c})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${r.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(_t,{checked:r.isEnabled,onCheckedChange:A=>v(U=>({...U,isEnabled:A}))})]}),e.jsx(Ut,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Es,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx($s,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(Mt,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:r.phoneNumber,onChange:A=>le(A.target.value),className:b.phoneNumber?"border-red-500":"",dir:"ltr"}),b.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:b.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Es,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(Rt,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:r.defaultMessage,onChange:A=>{v(U=>({...U,defaultMessage:A.target.value})),b.defaultMessage&&h(U=>({...U,defaultMessage:""}))},className:b.defaultMessage?"border-red-500":"",rows:4}),b.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:b.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(se,{onClick:F,disabled:d,className:"flex items-center gap-2",children:[d?e.jsx(es,{className:"h-4 w-4 animate-spin"}):e.jsx(Us,{className:"h-4 w-4"}),d?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(se,{variant:"outline",onClick:E,disabled:!r.phoneNumber||!r.defaultMessage,className:"flex items-center gap-2",children:[y?e.jsx(Ot,{className:"h-4 w-4"}):e.jsx(Vt,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(se,{variant:"outline",onClick:x,className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"تحديث"]})]}),y&&N&&e.jsxs(De,{className:"bg-muted/50",children:[e.jsx(Ke,{children:e.jsx(Je,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Te,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:N}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(se,{variant:"outline",size:"sm",onClick:q,className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(se,{variant:"outline",size:"sm",onClick:()=>window.open(N,"_blank"),className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),l&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(_e,{variant:"outline",className:"mr-2",children:[l.lastUpdated.toLocaleDateString("ar-EG")," - ",l.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(_e,{variant:l.isEnabled?"default":"secondary",className:"mr-2",children:l.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Pe={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},ha=l=>{const a=new Date,i=new Date(l).getTime()-a.getTime();return Math.ceil(i/(1e3*60*60*24))},ua=(l,a=Pe)=>l<0?"expired":l<=a.criticalDays?"critical":l<=a.warningDays?"warning":(l<=a.infoDays,"info"),ga=(l,a,c)=>{const i=pa(c);return a<0?`انتهت صلاحية اشتراك ${i} للمستخدم ${l}`:a===0?`ينتهي اشتراك ${i} للمستخدم ${l} اليوم!`:a===1?`ينتهي اشتراك ${i} للمستخدم ${l} غداً`:`ينتهي اشتراك ${i} للمستخدم ${l} خلال ${a} أيام`},pa=l=>{switch(l){case T.MONTHLY:return"الشهري";case T.YEARLY:return"السنوي";case T.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},fa=async()=>{try{const l=z(R,"users"),a=X(l,W("subscription","!=",null)),c=await he(a),i=[];return c.forEach(x=>{var r,v,d,w;const g=x.data();g.subscription&&(g.subscription.planType||g.subscription.plan)&&i.push({id:x.id,...g,subscription:{...g.subscription,startDate:((v=(r=g.subscription.startDate)==null?void 0:r.toDate)==null?void 0:v.call(r))||new Date(g.subscription.startDate),endDate:((w=(d=g.subscription.endDate)==null?void 0:d.toDate)==null?void 0:w.call(d))||new Date(g.subscription.endDate),planType:g.subscription.planType||g.subscription.plan}})}),i}catch(l){return console.error("خطأ في جلب الاشتراكات النشطة:",l),[]}},ba=async(l=Pe)=>{try{const a=await fa(),c=[];return a.forEach(i=>{if(!i.subscription||!i.subscription.endDate)return;const x=ha(i.subscription.endDate),g=ua(x,l);if(x<=l.infoDays||x<0){const r={id:`${i.id}_${Date.now()}`,userId:i.id,userName:i.displayName||i.email||"مستخدم غير معروف",userEmail:i.email||"",subscriptionPlan:i.subscription.planType,expiryDate:i.subscription.endDate,daysRemaining:x,type:g,message:ga(i.displayName||i.email||"مستخدم غير معروف",x,i.subscription.planType),isRead:!1,createdAt:new Date};c.push(r)}}),c.sort((i,x)=>{const g={expired:0,critical:1,warning:2,info:3};return g[i.type]!==g[x.type]?g[i.type]-g[x.type]:i.daysRemaining-x.daysRemaining}),c}catch(a){return console.error("خطأ في إنشاء إشعارات الاشتراك:",a),[]}},ja=(l,a)=>a?l.filter(c=>c.type===a):l,ya=l=>{localStorage.setItem("notificationSettings",JSON.stringify(l))},Na=()=>{try{const l=localStorage.getItem("notificationSettings");if(l)return{...Pe,...JSON.parse(l)}}catch(l){console.error("خطأ في تحميل إعدادات الإشعارات:",l)}return Pe},wa=({isOpen:l,onClose:a})=>{const[c,i]=o.useState([]),[x,g]=o.useState([]),[r,v]=o.useState("all"),[d,w]=o.useState(!0),[y,C]=o.useState(Na());o.useEffect(()=>{l&&N()},[l]),o.useEffect(()=>{g(r==="all"?c:ja(c,r))},[c,r]);const N=async()=>{w(!0);try{const E=await ba(y);i(E)}catch(E){console.error("خطأ في تحميل الإشعارات:",E)}finally{w(!1)}},f=E=>{switch(E){case"urgent":return e.jsx(Re,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(ce,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(fe,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(fe,{className:"w-5 h-5 text-gray-500"})}},b=E=>{switch(E){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},h=E=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(E),O=E=>{switch(E){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},F=E=>{const q={...y,[E]:!y[E]};C(q),ya(q)};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),c.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:c.length})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ye,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(E=>e.jsx("button",{onClick:()=>v(E),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${r===E?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:O(E)},E))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y.visualAlerts,onChange:()=>F("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y.soundAlerts,onChange:()=>F("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y.autoRefresh,onChange:()=>F("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:d?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):x.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(fe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:r==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${O(r)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:x.map(E=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${b(E.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[f(E.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:E.message}),e.jsx("span",{className:"text-xs text-gray-500",children:h(E.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",E.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",h(E.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",E.daysRemaining]})]})]})]})]})},E.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",h(new Date)]}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},va=({notification:l,onClose:a,soundEnabled:c,onToggleSound:i})=>{const[x,g]=o.useState(!1),[r,v]=o.useState(null);o.useEffect(()=>{if(l&&(g(!0),c&&d(l.type),l.type!=="urgent")){const f=setTimeout(()=>{w()},1e4);return()=>clearTimeout(f)}},[l,c]),o.useEffect(()=>{typeof window<"u"&&window.AudioContext&&v(new AudioContext)},[]);const d=f=>{if(!(!r||!c))try{const b=r.createOscillator(),h=r.createGain();switch(b.connect(h),h.connect(r.destination),f){case"urgent":b.frequency.setValueAtTime(800,r.currentTime),b.frequency.setValueAtTime(1e3,r.currentTime+.1),b.frequency.setValueAtTime(800,r.currentTime+.2),h.gain.setValueAtTime(.3,r.currentTime),h.gain.exponentialRampToValueAtTime(.01,r.currentTime+.5),b.start(r.currentTime),b.stop(r.currentTime+.5);break;case"warning":b.frequency.setValueAtTime(600,r.currentTime),b.frequency.setValueAtTime(700,r.currentTime+.15),h.gain.setValueAtTime(.2,r.currentTime),h.gain.exponentialRampToValueAtTime(.01,r.currentTime+.3),b.start(r.currentTime),b.stop(r.currentTime+.3);break;case"info":b.frequency.setValueAtTime(400,r.currentTime),h.gain.setValueAtTime(.1,r.currentTime),h.gain.exponentialRampToValueAtTime(.01,r.currentTime+.2),b.start(r.currentTime),b.stop(r.currentTime+.2);break}}catch(b){console.error("خطأ في تشغيل الصوت:",b)}},w=()=>{g(!1),setTimeout(()=>{a()},300)},y=f=>{switch(f){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Re,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(ce,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(fe,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(fe,{className:"w-6 h-6"}),pulse:""}}},C=f=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(f);if(!l)return null;const N=y(l.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${x?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${N.bg} ${N.border} ${N.text} ${N.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[l.type==="urgent"&&"تنبيه عاجل!",l.type==="warning"&&"تحذير",l.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:c?"إيقاف الصوت":"تشغيل الصوت",children:c?e.jsx(da,{className:"w-4 h-4"}):e.jsx(ma,{className:"w-4 h-4"})}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:l.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",l.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",C(l.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",l.daysRemaining," يوم"]})]})]}),l.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Ea=({user:l,onActivateSubscription:a,onDeactivateSubscription:c,onDeleteUser:i})=>{const[x,g]=o.useState(T.MONTHLY),[r,v]=o.useState(!1),d=pt(),w=f=>{const b=f==null?void 0:f.displayName;if(typeof b=="string"&&b.trim())return b.trim();if(b&&typeof b=="object"){const h=b.full_name||b.name||b.ar||b.en;if(typeof h=="string"&&h.trim())return h.trim()}return typeof(f==null?void 0:f.email)=="string"&&f.email.includes("@")?f.email.split("@")[0]:"غير محدد"},y=f=>{switch(f){case T.LIFETIME:return e.jsx(ke,{className:"w-4 h-4 text-yellow-500"});case T.YEARLY:return e.jsx(pe,{className:"w-4 h-4 text-blue-500"});case T.QUARTERLY:return e.jsx(ne,{className:"w-4 h-4 text-purple-500"});case T.MONTHLY:return e.jsx(ts,{className:"w-4 h-4 text-green-500"});case T.ZERO:return e.jsx(Ss,{className:"w-4 h-4 text-gray-500"});default:return null}},C=f=>{switch(f){case T.MONTHLY:return"شهرية";case T.QUARTERLY:return"ربع سنوية";case T.YEARLY:return"سنوية";case T.LIFETIME:return"مدى الحياة";case T.ZERO:return"زيرو";default:return"غير محدد"}},N=f=>f?(f.toDate?f.toDate():new Date(f)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(De,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Te,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w(l)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Zt,{className:"w-3 h-3 ml-1"}),l.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx($s,{className:"w-3 h-3 ml-1"}),l.phone||"غير محدد"]})]})]}),e.jsx(_e,{variant:l.isActive?"default":"secondary",children:l.isActive?"نشط":"غير نشط"})]}),l.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[y(l.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:C(l.subscription.planType)})]}),e.jsx(_e,{variant:l.subscription.isActive?"default":"destructive",children:l.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ne,{className:"w-3 h-3 ml-1"}),"البداية: ",N(l.subscription.startDate)]}),l.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"w-3 h-3 ml-1"}),"النهاية: ",N(l.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[a&&r&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),d?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:x,onChange:f=>g(f.target.value),children:[e.jsx("option",{value:T.MONTHLY,children:"شهرية"}),e.jsx("option",{value:T.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:T.YEARLY,children:"سنوية"}),e.jsx("option",{value:T.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:T.ZERO,children:"زيرو"})]}):e.jsxs(zt,{value:x,onValueChange:f=>g(f),children:[e.jsx(Yt,{className:"w-full",children:e.jsx(Gt,{placeholder:"اختر نوع الباقة"})}),e.jsxs(Qt,{children:[e.jsx(je,{value:T.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(je,{value:T.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(je,{value:T.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(je,{value:T.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(la,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(je,{value:T.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(se,{size:"sm",onClick:()=>{a(l.id,x),v(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(se,{size:"sm",variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[a&&!r&&e.jsx(se,{size:"sm",variant:"outline",onClick:()=>v(!0),className:"flex-1",children:"تفعيل الاشتراك"}),c&&e.jsx(se,{size:"sm",variant:"outline",onClick:()=>c(l.id),className:"flex-1",children:"إلغاء الاشتراك"}),i&&e.jsx(se,{size:"sm",variant:"destructive",onClick:()=>i(l.id),children:e.jsx(ft,{className:"w-4 h-4"})})]})]})]})})};class Ca{constructor(){vs(this,"hooks",[])}registerHooks(a){console.log("📝 Registering hooks:",Object.keys(a)),this.hooks.push(a)}async sendImageMessage(a,c,i,x,g){try{console.log("📤 Uploading image message:",{chatId:a,fileName:c.name,fileSize:c.size,senderType:i,senderId:x});const r=Ds(),v=Date.now(),d=`chat-images/${a}/${v}_${c.name}`,w=Ts(r,d),y=await Xt(w,c);console.log("✅ Image uploaded successfully:",y.metadata.fullPath);const C=await Kt(w);console.log("✅ Image URL obtained:",C);const N={chatId:a,message:g||"صورة",content:g||"صورة",senderType:i,senderId:x,timestamp:re(),isRead:!1,type:"image",imageUrl:C,imageFileName:c.name},f=await Xe(z(R,"chatMessages"),N);console.log("✅ Image message added to chatMessages:",f.id);const b=ee(R,"chatRooms",a);if(i==="client"){const h=await Ce(b);if(h.exists()){const O=h.data().unreadCount||0;await de(b,{lastMessage:g||"صورة",lastMessageTime:re(),unreadCount:O+1})}}else await de(b,{lastMessage:g||"صورة",lastMessageTime:re()});console.log("✅ Image message sent successfully")}catch(r){throw console.error("🔥 Error sending image message:",r),r}}async deleteChat(a){try{console.log("🗑️ Deleting chat:",a);const c=X(z(R,"chatMessages"),W("chatId","==",a)),i=await he(c),x=[];for(const r of i.docs){const v=r.data();if(v.type==="image"&&v.imageUrl)try{const d=Ds(),w=Ts(d,v.imageUrl);x.push(Jt(w))}catch(d){console.warn("⚠️ Could not delete image from storage:",d)}x.push(me(r.ref))}const g=ee(R,"chatRooms",a);x.push(me(g)),await Promise.all(x),console.log("✅ Chat deleted successfully:",{chatId:a,messagesDeleted:i.size})}catch(c){throw console.error("🔥 Error deleting chat:",c),c}}unregisterHooks(a){console.log("🗑️ Unregistering hooks"),a?this.hooks=this.hooks.filter(c=>c!==a):this.hooks=[]}async createChatRoom(a,c=!1){try{const i=c?"clientEmail":"clientPhone",x=X(z(R,"chatRooms"),W(i,"==",a),W("status","==","active")),g=await he(x);if(!g.empty)return g.docs[0].id;const r={clientId:`client_${a}`,clientPhone:c?"":a,clientEmail:c?a:void 0,customerName:c?`عميل ${a}`:`عميل ${a}`,status:"active",unreadCount:0,createdAt:re(),lastMessageTime:re()};return(await Xe(z(R,"chatRooms"),r)).id}catch(i){throw console.error("Error creating chat room:",i),i}}async sendMessage(a,c,i,x){try{for(let r=1;r<=3;r++)try{console.log(`📤 Sending message (attempt ${r}):`,{chatId:a,message:c.substring(0,50)+"...",senderType:i,senderId:x});const v={chatId:a,message:c,content:c,senderType:i,senderId:x,timestamp:re(),isRead:!1},d=await Xe(z(R,"chatMessages"),v);console.log("✅ Message added to chatMessages:",d.id);const w=ee(R,"chatRooms",a);if(i==="client"){const y=await Ce(w),C=y.exists()&&y.data().unreadCount||0;await de(w,{lastMessage:c,lastMessageTime:re(),unreadCount:C+1}),this.hooks.length>0&&this.hooks.forEach(N=>{if(N.onUnreadCountChange&&typeof N.onUnreadCountChange=="function")try{N.onUnreadCountChange(a,C+1)}catch(f){console.error("Error calling onUnreadCountChange hook:",f)}})}else await de(w,{lastMessage:c,lastMessageTime:re()});if(this.hooks.length>0)try{const y=await Ce(w);if(y.exists()){const C={id:y.id,...y.data()},N={id:d.id,...v,timestamp:new Date};this.hooks.forEach(f=>{if(f.onNewMessage&&typeof f.onNewMessage=="function")try{f.onNewMessage(N,C)}catch(b){console.error("Error calling onNewMessage hook:",b)}})}}catch(y){console.error("Error calling onNewMessage hooks:",y)}console.log("✅ Message sent successfully");return}catch(v){if(console.error(`❌ Attempt ${r} failed:`,v),r===3)throw v;await new Promise(d=>setTimeout(d,1e3*r))}throw new Error("Max retry attempts reached")}catch(r){throw console.error("🔥 Error sending message:",r),r}}subscribeToMessages(a,c){let i=0;const x=5;let g=null,r=null,v=0;const d=()=>{try{console.log("🔔 Starting subscription to messages for room:",a,`(attempt ${i+1})`);const w=X(z(R,"chatMessages"),W("chatId","==",a),ss("timestamp","asc"));r=Ne(w,y=>{console.log("📨 Received messages snapshot:",y.docs.length,"messages"),i=0;const C=y.docs.map(N=>{const f=N.data();return{id:N.id,...f,message:f.message||f.content||"",content:f.content||f.message||""}});if(C.length>v&&v>0){const N=C.slice(v);console.log("🆕 New messages detected:",N.length),N.forEach(f=>{this.hooks.forEach(b=>{if(b.onNewMessage&&typeof b.onNewMessage=="function")try{Ce(ee(R,"chatRooms",a)).then(h=>{if(h.exists()){const O={id:h.id,...h.data()},F=b.onNewMessage;F&&F(f,O)}}).catch(h=>{console.error("Error fetching chat room for hook:",h)})}catch(h){console.error("Error calling onNewMessage hook:",h)}})})}v=C.length,console.log("📨 Processed messages:",C),c(C)},y=>{var C,N,f,b;if(console.error("❌ Error in messages subscription:",y),y.name==="AbortError"||(C=y.message)!=null&&C.includes("AbortError")){console.log("🔄 Request was aborted, will retry..."),i<x&&(i++,g=setTimeout(()=>{d()},1e3));return}(N=y.message)!=null&&N.includes("index is currently building")||(f=y.message)!=null&&f.includes("cannot be used yet")||y.code==="failed-precondition"?(console.log("🔨 Index is still building, will retry in 10 seconds..."),i<x?(i++,g=setTimeout(()=>{console.log("🔄 Retrying subscription after index building delay..."),d()},1e4)):(console.log("⚠️ Max retries reached for index building. Please wait for index to complete."),c([]))):y.code==="unavailable"||(b=y.message)!=null&&b.includes("ERR_ABORTED")?(console.log("🔄 Connection issue detected, will retry automatically..."),i<x&&(i++,g=setTimeout(()=>{d()},2e3))):(console.error("❌ Unhandled error in messages subscription:",y),c([]))})}catch(w){console.error("❌ Error setting up messages subscription:",w),i<x&&(i++,g=setTimeout(()=>{d()},5e3))}};return d(),()=>{g&&clearTimeout(g),r&&r()}}subscribeToAdminChats(a){console.log("🔍 Admin: Starting subscription to admin chats");let c=0,i=0;const x=5;let g=null,r=null;const v=()=>{try{const d=X(z(R,"chatRooms"),W("status","==","active"),ss("lastMessageTime","desc"));r=Ne(d,w=>{console.log("📊 Admin: Received chat rooms snapshot:",{size:w.size,empty:w.empty,docs:w.docs.length}),i=0;const y=w.docs.map(C=>{const N=C.data();return console.log("💬 Admin: Chat room data:",{id:C.id,customerName:N.customerName,lastMessage:N.lastMessage,unreadCount:N.unreadCount,status:N.status}),{id:C.id,...N}});y.length!==c&&(console.log("🆕 Chat rooms count changed:",{old:c,new:y.length}),y.forEach(C=>{this.hooks.length>0&&this.hooks.forEach(N=>{if(N.onChatRoomUpdate&&typeof N.onChatRoomUpdate=="function")try{N.onChatRoomUpdate(C)}catch(f){console.error("Error calling onChatRoomUpdate hook:",f)}})})),c=y.length,a(y)},w=>{var y,C;if(console.error("❌ Error in admin chats subscription:",w),w.name==="AbortError"||(y=w.message)!=null&&y.includes("AbortError")){console.log("🔄 Admin chats request was aborted, will retry..."),i<x&&(i++,g=setTimeout(()=>{v()},1e3));return}w.code==="unavailable"||(C=w.message)!=null&&C.includes("ERR_ABORTED")?(console.log("🔄 Admin chats connection issue detected, will retry..."),i<x&&(i++,g=setTimeout(()=>{v()},2e3))):(console.error("❌ Unhandled error in admin chats subscription:",w),a([]))})}catch(d){console.error("❌ Error setting up admin chats subscription:",d),i<x&&(i++,g=setTimeout(()=>{v()},5e3))}};return v(),()=>{g&&clearTimeout(g),r&&r()}}async markMessagesAsRead(a,c){try{const i=X(z(R,"chatMessages"),W("chatId","==",a),W("senderType","!=",c),W("isRead","==",!1)),g=(await he(i)).docs.map(r=>de(ee(R,"chatMessages",r.id),{isRead:!0}));if(await Promise.all(g),c==="admin"){const r=ee(R,"chatRooms",a);await de(r,{unreadCount:0})}}catch(i){throw console.error("Error marking messages as read:",i),i}}async closeChatRoom(a){try{const c=ee(R,"chatRooms",a);await de(c,{status:"closed",lastMessageTime:re()})}catch(c){throw console.error("Error closing chat room:",c),c}}}const ge=new Ca,Sa=({isOpen:l,onClose:a})=>{var A,U;const[c,i]=o.useState([]),[x,g]=o.useState(null),[r,v]=o.useState([]),[d,w]=o.useState(""),[y,C]=o.useState(!0),[N,f]=o.useState(!1),[b,h]=o.useState({}),O=o.useRef(null);o.useEffect(()=>{const u={onNewMessage:(S,M)=>{console.log("🔔 New message notification:",S,M),S.senderType==="client"&&S.chatId!==x&&(h(_=>({..._,[S.chatId]:(_[S.chatId]||0)+1})),console.log("🔔 New message from client in chat:",M.customerName||M.clientPhone))},onChatRoomUpdate:S=>{console.log("🔄 Chat room updated:",S),i(M=>{const _=M.findIndex(L=>L.id===S.id);if(_>=0){const L=[...M];return L[_]=S,L.sort((be,V)=>{var P,$,B,Y;const ie=(($=(P=be.lastMessageTime)==null?void 0:P.toMillis)==null?void 0:$.call(P))||0;return(((Y=(B=V.lastMessageTime)==null?void 0:B.toMillis)==null?void 0:Y.call(B))||0)-ie})}else return[S,...M]})},onUnreadCountChange:(S,M)=>{console.log("📊 Unread count changed:",S,M),i(_=>_.map(L=>L.id===S?{...L,unreadCount:M}:L))}};return ge.registerHooks(u),()=>{ge.unregisterHooks()}},[x]),o.useEffect(()=>{console.log("🔍 AdminChatPanel: Setting up chat rooms subscription"),C(!0);const u=ge.subscribeToAdminChats(S=>{console.log("📊 AdminChatPanel: Received chats update:",S.length),i(S),C(!1)});return()=>{console.log("🔌 AdminChatPanel: Cleaning up chat rooms subscription"),u()}},[]),o.useEffect(()=>{if(!x){v([]);return}console.log("📨 AdminChatPanel: Setting up messages subscription for chat:",x);const u=ge.subscribeToMessages(x,S=>{console.log("📨 AdminChatPanel: Received messages update:",S.length),v(S),h(M=>{const _={...M};return delete _[x],_})});return ge.markMessagesAsRead(x,"admin").catch(console.error),()=>{console.log("🔌 AdminChatPanel: Cleaning up messages subscription"),u()}},[x]),o.useEffect(()=>{var u;(u=O.current)==null||u.scrollIntoView({behavior:"smooth"})},[r]);const F=async()=>{if(!(!d.trim()||!x||N)){f(!0);try{await ge.sendMessage(x,d.trim(),"admin","admin_user"),w("")}catch(u){console.error("Error sending message:",u),alert("حدث خطأ في إرسال الرسالة")}finally{f(!1)}}},E=u=>{g(u),h(S=>{const M={...S};return delete M[u],M})},q=Object.values(b).reduce((u,S)=>u+S,0),le=c.reduce((u,S)=>u+(S.unreadCount||0),0);return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[80vh] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"المحادثات"}),(le>0||q>0)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ra,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold",children:"جديد"})]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(ye,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:y?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(As,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-2 text-gray-600",children:"جاري التحميل..."})]}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[e.jsx(Ae,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"لا توجد محادثات نشطة"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"ستظهر المحادثات الجديدة هنا"})]}):c.map(u=>{const S=x===u.id,M=(u.unreadCount||0)>0,_=b[u.id]>0,L=(u.unreadCount||0)+(b[u.id]||0);return e.jsx("div",{onClick:()=>E(u.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-all duration-200 ${S?"bg-blue-50 border-r-4 border-r-blue-500":M||_?"bg-yellow-50 hover:bg-yellow-100 border-r-4 border-r-yellow-400":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${M||_?"bg-yellow-200":"bg-gray-200"}`,children:e.jsx(Le,{className:`w-5 h-5 ${M||_?"text-yellow-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:u.customerName||u.clientPhone}),S&&e.jsx(Me,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]}),u.customerName&&u.customerName!==u.clientPhone&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:u.clientPhone}),u.lastMessage&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:u.lastMessage.length>50?u.lastMessage.substring(0,50)+"...":u.lastMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(ce,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:u.lastMessageTime&&u.lastMessageTime.toMillis?new Date(u.lastMessageTime.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${M||_?"bg-red-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:M||_?"رسائل جديدة":"مقروءة"})]})]})]}),L>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[20px] text-center",children:L>99?"99+":L})]})},u.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:((A=c.find(u=>u.id===x))==null?void 0:A.customerName)||((U=c.find(u=>u.id===x))==null?void 0:U.clientPhone)})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.map(u=>e.jsx("div",{className:`flex ${u.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${u.senderType==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:u.message||u.content}),e.jsx("p",{className:`text-xs mt-1 ${u.senderType==="admin"?"text-blue-100":"text-gray-500"}`,children:u.timestamp&&u.timestamp.toMillis?new Date(u.timestamp.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"})]})},u.id)),e.jsx("div",{ref:O})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:u=>w(u.target.value),onKeyPress:u=>u.key==="Enter"&&F(),placeholder:"اكتب رسالتك هنا...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:N}),e.jsxs("button",{onClick:F,disabled:!d.trim()||N,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[N?e.jsx(As,{className:"w-4 h-4 animate-spin"}):e.jsx(ca,{className:"w-4 h-4"}),"إرسال"]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(xe,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر محادثة للبدء"}),e.jsx("p",{children:"اختر محادثة من القائمة لعرض الرسائل والرد عليها"})]})})})]})}):null},Da={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Ta=({navigate:l,auth:a,devMode:c,setDevMode:i,error:x,setError:g,authLoading:r,setAuthLoading:v,activeTab:d,setActiveTab:w,setNotificationCenterOpen:y,setNotificationSettings:C,setNotifications:N,notificationCount:f,setNotificationCount:b,users:h,setUsers:O,filteredUsers:F,setFilteredUsers:E,loading:q,setLoading:le,setEditingPlan:A,isSavingContent:U,setIsSavingContent:u,lastUpdateInfo:S,loadContentFromFirebase:M,saveContentToFirebase:_})=>{var ws;const[L,be]=o.useState(!0),[V,ie]=o.useState(""),[D,P]=o.useState(null),[$,B]=o.useState({});o.useState(!1),o.useState(null),o.useState(!1);const[Y,Ue]=o.useState({sound:!0}),[Os,ka]=o.useState(!1),[Vs,Bs]=o.useState(null),[Ie,qs]=o.useState([]),[as,Fe]=o.useState(!1),[I,$e]=o.useState({}),[Oe,Hs]=o.useState(null),[Ve,zs]=o.useState(null),[rs,ns]=o.useState(!1),[ls,is]=o.useState(!1),[Be,Ys]=o.useState(""),[qe,Gs]=o.useState(""),[Qs,He]=o.useState(0),[Zs,ze]=o.useState(0),we=s=>{const t=s==null?void 0:s.displayName;let n="";typeof t=="string"?n=t:t&&typeof t=="object"&&(n=(t.ar||t.en||"").toString()),!n&&typeof(s==null?void 0:s.email)=="string"&&(n=s.email);const m=String(n).trim().charAt(0);return m?m.toUpperCase():"؟"},ue=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const n=t.full_name||t.name||t.ar||t.en;if(typeof n=="string"&&n.trim())return n.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[Ye,cs]=o.useState(""),[Ge,os]=o.useState(""),[ds,ms]=o.useState(""),[Qe,xs]=o.useState(""),[hs,us]=o.useState(!1),[ve,gs]=o.useState(""),[G,ps]=o.useState(24),[fs,bs]=o.useState("24"),[js,ys]=o.useState(!1),[Aa,Ns]=o.useState(!1);o.useEffect(()=>{d==="trials"&&(async()=>{try{Ns(!0);const{FreeTrialService:s}=await Z(async()=>{const{FreeTrialService:n}=await import("./index-Bc0KmgLq.js").then(m=>m.b1);return{FreeTrialService:n}},__vite__mapDeps([0,1])),t=await s.getTrialDurationHours();ps(t),bs(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{Ns(!1)}})()},[d]),o.useEffect(()=>{d==="application"&&(async()=>{try{const{getAppDownloads:s}=await Z(async()=>{const{getAppDownloads:n}=await import("./appDownloadService-C_-4y2bO.js");return{getAppDownloads:n}},__vite__mapDeps([2,0,1,3])),t=await s();$e(t||{})}catch(s){console.error("Failed to load app downloads",s)}})()},[d]),o.useEffect(()=>{if(d==="waitingList"){Fe(!0);try{const s=X(z(R,"waiting_list"),ss("createdAt","desc")),t=Ne(s,n=>{const m=n.docs.map(j=>({id:j.id,...j.data()}));qs(m),Fe(!1)});return()=>t()}catch(s){console.error("Failed to subscribe to waiting_list:",s),Fe(!1)}}},[d]);const Ws=async()=>{var s;if(!Ye.trim()||!Ge.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{us(!0);const t=Qe.trim()?`user:${Qe.trim()}`:"global";await Ht({title:Ye.trim(),message:Ge.trim(),audienceKey:t,createdBy:(s=a==null?void 0:a.currentUser)==null?void 0:s.uid,linkUrl:ds.trim()||void 0}),cs(""),os(""),ms(""),xs(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{us(!1)}};o.useEffect(()=>{if(!V.trim())E(h);else{const s=h.filter(t=>t.email&&typeof t.email=="string"&&t.email.toLowerCase().includes(V.toLowerCase())||t.displayName&&typeof t.displayName=="string"&&t.displayName.toLowerCase().includes(V.toLowerCase())||t.name&&typeof t.name=="string"&&t.name.toLowerCase().includes(V.toLowerCase()));E(s)}},[h,V,E]);const Xs=()=>{a!=null&&a.signOut&&a.signOut(),l("/admin/login")},Ks=async(s,t,n=null)=>{var m;try{console.log("Activating subscription for user:",s,"with plan:",t,"and variant:",n);const j=((m=a==null?void 0:a.currentUser)==null?void 0:m.uid)||"admin-user-id";await yt(s,t,j,n),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(j){console.error("❌ خطأ في تفعيل الاشتراك:",j),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Js=async s=>{try{console.log("Deactivating subscription for user:",s),await Nt(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},et=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const m=((t=a==null?void 0:a.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const p=await wt(vt,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",p),O(k=>k.filter(H=>H.id!==s)),E(k=>k.filter(H=>H.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(j){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(j==null?void 0:j.message)||j)}{const j=[];try{await me(ee(R,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(p){console.error("خطأ في حذف الملف الشخصي:",p),j.push(`الملف الشخصي: ${(p==null?void 0:p.message)||p}`)}try{await me(ee(R,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(p){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",p),j.push(`users: ${(p==null?void 0:p.message)||p}`)}try{const p=X(z(R,"transactions"),W("userId","==",s)),k=await he(p),H=k.docs.map(te=>me(te.ref)),J=await Promise.allSettled(H),Q=J.filter(te=>te.status==="rejected");Q.length?(console.warn("فشل حذف بعض المعاملات:",Q.length),j.push(`المعاملات: فشل حذف ${Q.length} من أصل ${J.length}`)):console.log(`تم حذف ${k.size} معاملة`)}catch(p){console.error("خطأ في جلب/حذف المعاملات:",p),j.push(`المعاملات: ${(p==null?void 0:p.message)||p}`)}try{const p=X(z(R,"chatRooms"),W("participants","array-contains",s)),k=await he(p),H=k.docs.map(async J=>{try{const te=(await he(z(J.ref,"messages"))).docs.map(ae=>me(ae.ref));await Promise.allSettled(te),await me(J.ref)}catch(Q){console.error("فشل حذف محادثة/رسائل:",Q),j.push(`المحادثات: ${J.id}`)}});await Promise.all(H),console.log(`تم إنهاء معالجة ${k.size} محادثة`)}catch(p){console.error("خطأ في جلب/حذف المحادثات:",p),j.push(`المحادثات: ${(p==null?void 0:p.message)||p}`)}try{await Et(ee(R,"deletedUsers",s),{deletedAt:new Date,deletedBy:m,reason:"حذف نهائي من لوحة الإدارة"})}catch(p){console.error("خطأ في تسجيل المستخدم كمحذوف:",p),j.push(`deletedUsers: ${(p==null?void 0:p.message)||p}`)}O(p=>p.filter(k=>k.id!==s)),E(p=>p.filter(k=>k.id!==s)),j.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${j.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(n){console.error("❌ خطأ في حذف المستخدم:",n),alert(`حدث خطأ في حذف المستخدم: ${n.message||"خطأ غير معروف"}`)}};o.useEffect(()=>{(async()=>{try{if(typeof M=="function"){const t=await M();t&&(t.monthly||t.yearly||t.lifetime)&&B(t)}}catch(t){console.warn("Failed to load content data:",t)}})()},[]);const st=async()=>{var s;try{if(typeof _!="function")return;u(!0);const t=((s=a==null?void 0:a.currentUser)==null?void 0:s.uid)||"admin-user-id";await _($,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{u(!1)}},Ee=(s,t,n)=>{B(m=>({...m,[s]:{...(m==null?void 0:m[s])||{},[t]:n}}))},tt=s=>{B(t=>{var n;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((n=t==null?void 0:t[s])==null?void 0:n.features)||[],""]}}})},at=(s,t,n)=>{B(m=>{var p;const j=[...((p=m==null?void 0:m[s])==null?void 0:p.features)||[]];return j[t]=n,{...m,[s]:{...(m==null?void 0:m[s])||{},features:j}}})},rt=(s,t)=>{B(n=>{var j;const m=[...((j=n==null?void 0:n[s])==null?void 0:j.features)||[]];return m.splice(t,1),{...n,[s]:{...(n==null?void 0:n[s])||{},features:m}}})},nt=()=>{Ue(s=>({...s,sound:!s.sound}))},lt=()=>{Bs(null)},it=async()=>{try{const s=Number(fs);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}ys(!0);const{FreeTrialService:t}=await Z(async()=>{const{FreeTrialService:m}=await import("./index-Bc0KmgLq.js").then(j=>j.b1);return{FreeTrialService:m}},__vite__mapDeps([0,1])),n=await t.updateTrialDurationHours(s);n.success?(ps(s),alert(n.message)):alert(n.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{ys(!1)}},ct=async s=>{try{const{FreeTrialService:t}=await Z(async()=>{const{FreeTrialService:m}=await import("./index-Bc0KmgLq.js").then(j=>j.b1);return{FreeTrialService:m}},__vite__mapDeps([0,1])),n=await t.startFreeTrialFromAdmin(s);alert(n.message||`تم تفعيل التجربة المجانية لمدة ${G} ${G>=3&&G<=10?"ساعات":G===2?"ساعتين":"ساعة"}`)}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},ot=async s=>{try{const{FreeTrialService:t}=await Z(async()=>{const{FreeTrialService:m}=await import("./index-Bc0KmgLq.js").then(j=>j.b1);return{FreeTrialService:m}},__vite__mapDeps([0,1])),n=await t.resetActiveTrialToCurrentDuration(s);alert(n.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},dt=(s,t)=>{console.log("Toggling user status:",s,t)},Ze=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",mt=[{id:"users",label:"المستخدمين",icon:Ae},{id:"waitingList",label:"قائمة الانتظار",icon:ce},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:ne},{id:"trials",label:"إدارة التجارب المجانية",icon:pe},{id:"content",label:"إدارة المحتوى",icon:Ct},{id:"application",label:"التطبيق",icon:Ms},{id:"chat",label:"الدردشة",icon:xe},{id:"whatsapp",label:"إدارة الواتساب",icon:xe},{id:"branches",label:"باقات الفروع",icon:_s},{id:"analytics",label:"الإحصائيات",icon:Cs}];return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:x})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{g(null),v(!0),window.location.reload()},className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"🔄 إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{g(null),l("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",x),console.log("🔍 Auth state:",a.currentUser),console.log("🔍 Dev mode:",c),console.log("🔍 Environment:",Da)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!c&&!a.currentUser?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>l("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:`${L?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[L&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ea,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>be(!L),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:L?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(ia,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:mt.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>w(s.id),className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${d===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:Xs,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(bt,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[d==="users"&&"إدارة المستخدمين",d==="waitingList"&&"قائمة الانتظار",d==="subscriptions"&&"مواعيد الاشتراكات",d==="trials"&&"إدارة التجارب المجانية",d==="application"&&"إدارة التطبيق",d==="chat"&&"إدارة الدردشة",d==="analytics"&&"الإحصائيات",d==="branches"&&"باقات الفروع"]}),c&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",c?"المطور":"المدير"]}),e.jsx(kt,{})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[d==="waitingList"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"طلبات قائمة الانتظار"}),e.jsx("div",{className:"text-sm text-gray-500",children:as?"جاري التحميل...":`إجمالي: ${Ie.length}`})]}),e.jsx("div",{className:"overflow-x-auto",children:as?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل الطلبات..."})]}):Ie.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا توجد طلبات في قائمة الانتظار حالياً"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الإجراء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الإنشاء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ie.map(s=>{var k;const t=(s.phone||"").toString(),n=t.replace(/\D/g,"");let m=null;const j="مرحباً، طلبت التحدث معنا. كيف نساعدك؟";try{Fs(t)&&(m=Is(t,j))}catch{m=null}const p=(k=s.createdAt)!=null&&k.toDate?s.createdAt.toDate():s.createdAt?new Date(s.createdAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:n||"—"}),e.jsx("td",{className:"px-4 py-3",children:m?e.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",children:e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-green-600 text-white text-sm hover:bg-green-700",children:"واتساب"})}):e.jsx("span",{className:"text-xs text-gray-400",children:"لا يوجد رقم"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:p?p.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]})}),d==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.length})]}),e.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Qe,onChange:s=>xs(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>s.isActive).length})]}),e.jsx(Ps,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(s=>!s.isActive).length})]}),e.jsx(oa,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:V,onChange:s=>ie(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),V&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",F.length," من أصل ",h.length," مستخدم",V&&e.jsx("button",{onClick:()=>ie(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:q?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):F.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:V?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(s=>e.jsx(Ea,{user:s,onActivateSubscription:Ks,onToggleUserStatus:dt,onDeactivateSubscription:Js,onDeleteUser:et},s.id))})})]})]}),d==="application"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-green-600"})," إدارة تطبيق الأندرويد"]}),(I==null?void 0:I.androidUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:I.androidUrl,className:"text-blue-600 underline",target:"_blank",rel:"noreferrer",children:"تنزيل"}),I.androidVersion?` | الإصدار: ${I.androidVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف APK"}),e.jsx("input",{type:"file",accept:".apk",onChange:s=>{var t;return Hs(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Be,onChange:s=>Ys(s.target.value),placeholder:"مثال: 1.0.3",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Oe)try{ns(!0),He(0);const{uploadAppBinaryResumable:t}=await Z(async()=>{const{uploadAppBinaryResumable:m}=await import("./appDownloadService-C_-4y2bO.js");return{uploadAppBinaryResumable:m}},__vite__mapDeps([2,0,1,3])),n=await t(Oe,"android",((s=a==null?void 0:a.currentUser)==null?void 0:s.uid)||"admin",Be||void 0,m=>He(m),3e5);$e(m=>({...m,androidUrl:n,androidVersion:Be||m.androidVersion}))}catch(t){console.error("Android upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الأندرويد: ${t.message}`:"فشل رفع تطبيق الأندرويد")}finally{ns(!1),He(0)}},disabled:rs||!Oe,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(Ls,{className:"w-4 h-4"}),rs?`جاري الرفع... ${Qs}%`:"رفع تطبيق الأندرويد"]}),(I==null?void 0:I.androidUrl)&&e.jsxs("a",{href:I.androidUrl,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noreferrer",children:[e.jsx(ks,{className:"w-4 h-4"})," تنزيل الحالي"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Wt,{className:"w-5 h-5 text-indigo-600"})," إدارة تطبيق الكمبيوتر (Windows)"]}),(I==null?void 0:I.pcUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:I.pcUrl,className:"text-blue-600 underline",target:"_blank",rel:"noreferrer",children:"تنزيل"}),I.pcVersion?` | الإصدار: ${I.pcVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return zs(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:qe,onChange:s=>Gs(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Ve)try{is(!0),ze(0);const{uploadAppBinaryResumable:t}=await Z(async()=>{const{uploadAppBinaryResumable:m}=await import("./appDownloadService-C_-4y2bO.js");return{uploadAppBinaryResumable:m}},__vite__mapDeps([2,0,1,3])),n=await t(Ve,"pc",((s=a==null?void 0:a.currentUser)==null?void 0:s.uid)||"admin",qe||void 0,m=>ze(m),3e5);$e(m=>({...m,pcUrl:n,pcVersion:qe||m.pcVersion}))}catch(t){console.error("PC upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الكمبيوتر: ${t.message}`:"فشل رفع تطبيق الكمبيوتر")}finally{is(!1),ze(0)}},disabled:ls||!Ve,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[e.jsx(Ls,{className:"w-4 h-4"}),ls?`جاري الرفع... ${Zs}%`:"رفع تطبيق الكمبيوتر"]}),(I==null?void 0:I.pcUrl)&&e.jsxs("a",{href:I.pcUrl,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noreferrer",children:[e.jsx(ks,{className:"w-4 h-4"})," تنزيل الحالي"]})]})]})]})]}),d==="branches"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"طلبات باقات الفروع (بانتظار التفعيل)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.filter(s=>{var t,n;return((t=s.branchPackage)==null?void 0:t.status)==="pending"||((n=s.branchPackage)==null?void 0:n.requested)}).length})]}),e.jsx(_s,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"باقات الفروع المفعّلة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>{var t;return((t=s.branchPackage)==null?void 0:t.status)==="active"}).length})]}),e.jsx(Me,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي حسابات باقات الفروع"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.filter(s=>{var t,n;return((t=s.branchPackage)==null?void 0:t.requested)||((n=s.branchPackage)==null?void 0:n.status)}).length})]}),e.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قسم باقات الفروع"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن حساب باقات الفروع...",value:V,onChange:s=>ie(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),V&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",F.filter(s=>{var t,n;return((t=s.branchPackage)==null?void 0:t.requested)||((n=s.branchPackage)==null?void 0:n.status)}).length," من أصل ",h.filter(s=>{var t,n;return((t=s.branchPackage)==null?void 0:t.requested)||((n=s.branchPackage)==null?void 0:n.status)}).length," حساب",V&&e.jsx("button",{onClick:()=>ie(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:q?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:(V?F:h).filter(s=>{var t,n;return((t=s.branchPackage)==null?void 0:t.requested)||((n=s.branchPackage)==null?void 0:n.status)}).map(s=>{var n,m,j;const t=((n=s.branchPackage)==null?void 0:n.status)||((m=s.branchPackage)!=null&&m.requested?"pending":"none");return e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold",children:we(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),((j=s.branchPackage)==null?void 0:j.requestedAt)&&e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ الطلب: ",Ze(s.branchPackage.requestedAt)]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t==="active"?"bg-green-100 text-green-700":t==="pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:t==="active"?"مفعّل":t==="pending"?"بانتظار التفعيل":"غير محدد"}),t==="active"&&e.jsx("button",{title:"إلغاء باقة الفروع",onClick:async()=>{var k;if(window.confirm("هل تريد إلغاء تفعيل باقة الفروع لهذا الحساب؟"))try{const{doc:H,updateDoc:J}=await Z(async()=>{const{doc:ae,updateDoc:oe}=await import("./index-Bc0KmgLq.js").then(We=>We.a$);return{doc:ae,updateDoc:oe}},__vite__mapDeps([0,1])),{db:Q}=await Z(async()=>{const{db:ae}=await import("./index-Bc0KmgLq.js").then(oe=>oe.b0);return{db:ae}},__vite__mapDeps([0,1])),te=((k=a==null?void 0:a.currentUser)==null?void 0:k.uid)||"admin-user-id";await J(H(Q,"users",s.id),{branchPackage:{requested:!0,status:"canceled",canceledAt:new Date,canceledBy:te},updatedAt:new Date}),alert("تم إلغاء باقة الفروع لهذا الحساب")}catch(H){console.error("فشل في إلغاء باقة الفروع:",H),alert("حدث خطأ أثناء الإلغاء، حاول مرة أخرى")}},className:"p-1 rounded-md text-red-600 hover:bg-red-50",children:e.jsx(sa,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:t!=="active"&&e.jsx("button",{onClick:async()=>{var p;try{const{doc:k,updateDoc:H,setDoc:J}=await Z(async()=>{const{doc:ae,updateDoc:oe,setDoc:We}=await import("./index-Bc0KmgLq.js").then(xt=>xt.a$);return{doc:ae,updateDoc:oe,setDoc:We}},__vite__mapDeps([0,1])),{db:Q}=await Z(async()=>{const{db:ae}=await import("./index-Bc0KmgLq.js").then(oe=>oe.b0);return{db:ae}},__vite__mapDeps([0,1])),te=((p=a==null?void 0:a.currentUser)==null?void 0:p.uid)||"admin-user-id";await H(k(Q,"users",s.id),{branchPackage:{requested:!0,status:"active",activatedAt:new Date,activatedBy:te},isActive:!0,approved:!0,role:"merchant",updatedAt:new Date}),await J(k(Q,"profiles",s.id),{role:"merchant",approved:!0,updatedAt:new Date},{merge:!0}),alert("تم تفعيل باقة الفروع لهذا الحساب")}catch(k){console.error("فشل في تفعيل باقة الفروع:",k),alert("حدث خطأ أثناء التفعيل، حاول مرة أخرى")}},className:"px-3 py-1 text-sm rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"تفعيل باقة الفروع"})})]})]},s.id)})})})]})]}),d==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(Me,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:h.filter(s=>{var p,k;if(!((p=s.subscription)!=null&&p.endDate)||!((k=s.subscription)!=null&&k.isActive))return!1;const t=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),n=new Date,m=t.getTime()-n.getTime(),j=Math.ceil(m/(1e3*60*60*24));return j<=7&&j>0}).length})]}),e.jsx(Re,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(s=>{var n;return(n=s.subscription)!=null&&n.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(ce,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:h.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===T.LIFETIME}).length})]}),e.jsx(ke,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:q?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.planType}).sort((s,t)=>{var j,p;if(!((j=s.subscription)!=null&&j.endDate)||!((p=t.subscription)!=null&&p.endDate))return 0;const n=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),m=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return n.getTime()-m.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const n=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,m=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let j=null,p="غير محدد";if(t.planType===T.LIFETIME)p="مدى الحياة";else if(m){const k=new Date,H=m.getTime()-k.getTime();j=Math.ceil(H/(1e3*60*60*24)),j<0?p="منتهي":j<=7?p="ينتهي قريباً":p="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:we(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ue(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===T.LIFETIME&&e.jsx(ke,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===T.YEARLY&&e.jsx(pe,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===T.QUARTERLY&&e.jsx(ne,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===T.MONTHLY&&e.jsx(ts,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:jt(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:n?n.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===T.LIFETIME?"مدى الحياة":m?m.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${p==="نشط"?"bg-green-100 text-green-800":p==="ينتهي قريباً"?"bg-orange-100 text-orange-800":p==="منتهي"?"bg-red-100 text-red-800":p==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:p})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===T.LIFETIME?"∞":j!==null?j<0?"منتهي":`${j} يوم`:"غير محدد"})]},s.id)}).filter(Boolean)})]})})]})]}),d==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),S&&S.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(S.lastUpdated).toLocaleString("ar-SA"),S.updatedBy&&` بواسطة: ${S.updatedBy}`]})]}),e.jsxs("button",{onClick:st,disabled:U,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(Us,{className:"w-4 h-4"}),U?"جاري الحفظ...":"حفظ جميع التغييرات"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries($).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(ts,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(ne,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(pe,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(ke,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>A(D===s?null:s),className:"text-purple-600 hover:text-purple-800",children:e.jsx(It,{className:"w-4 h-4"})})]}),D===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:n=>Ee(s,"name",n.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:n=>Ee(s,"price",n.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:n=>Ee(s,"period",n.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:n=>Ee(s,"description",n.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>tt(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((n,m)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:j=>at(s,m,j.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>rt(s,m),className:"text-red-500 hover:text-red-700",children:e.jsx(ye,{className:"w-4 h-4"})})]},m))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((n,m)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Me,{className:"w-3 h-3 text-green-500"}),n]},m))]})]})]},s))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:Ye,onChange:s=>cs(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:Ge,onChange:s=>os(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:ds,onChange:s=>ms(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:Ws,disabled:hs,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:hs?"جاري الإرسال...":"إرسال إشعار"})})]})]})]}),d==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",h),console.log("🔍 Users count:",(h==null?void 0:h.length)||0),console.log("🔍 Users on trial:",((ws=h==null?void 0:h.filter(s=>s.isOnFreeTrial))==null?void 0:ws.length)||0),q&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),x&&!q&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Re,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:x}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!q&&!x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(pe,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(ce,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(Ps,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:fs,onChange:s=>bs(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",G," ",G>=3&&G<=10?"ساعات":G===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:it,disabled:js,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:js?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ve,onChange:s=>gs(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Se,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[h.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=ve.trim().toLowerCase();if(!t)return!0;const n=ue(s).toLowerCase(),m=(s.email||"").toLowerCase();return n.includes(t)||m.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:we(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",Ze(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>ct(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${G} ${G>=3&&G<=10?"ساعات":G===2?"ساعتين":"ساعة"}`})})]},s.id)),h.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),h.filter(s=>s.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ve,onChange:s=>gs(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Se,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:h.filter(s=>s.isOnFreeTrial).filter(s=>{const t=ve.trim().toLowerCase();if(!t)return!0;const n=ue(s).toLowerCase(),m=(s.email||"").toLowerCase();return n.includes(t)||m.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:we(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?Ze(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>ot(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"})]})]},s.id))})})]})]})]}),d==="chat"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx(Sa,{isOpen:!0,onClose:()=>{}})}),d==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(xe,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(xa,{})]}),d==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(Cs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(wa,{isOpen:Os,onClose:()=>y(!1)}),e.jsx(va,{notification:Vs,onClose:lt,soundEnabled:Y.soundAlerts,onToggleSound:nt})]})},jr=()=>{const l=St(),{user:a,loading:c}=Dt(),[i,x]=o.useState(!1),[g,r]=o.useState(null),[v,d]=o.useState(!1),[w,y]=o.useState("users"),[C,N]=o.useState(0),[f,b]=o.useState([]),[h,O]=o.useState([]),[F,E]=o.useState(!1),[q,le]=o.useState(null),[A,U]=o.useState([]),[u,S]=o.useState({});o.useEffect(()=>{const D=localStorage.getItem("admin_dev_mode")==="true";x(D)},[]),o.useEffect(()=>{if(!(!i&&!a)){d(!0),r(null);try{const D=X(z(R,"users")),P=Ne(D,$=>{const B=$.docs.map(Y=>({id:Y.id,...Y.data()}));U(B),d(!1),r(null)},$=>{console.error("Error loading users:",$),i?(U([]),d(!1),r(null)):(r("فشل في تحميل بيانات المستخدمين"),d(!1))});return()=>P()}catch(D){console.error("Error setting up users listener:",D),i?(U([]),d(!1),r(null)):(r("فشل في إعداد مراقب البيانات"),d(!1))}}},[a,i]),o.useEffect(()=>{if(!(!i&&!a))try{const D=X(z(R,"profiles")),P=Ne(D,$=>{const B={};$.forEach(Y=>{B[Y.id]=Y.data()}),S(B)},$=>{console.error("Error loading profiles:",$)});return()=>P()}catch(D){console.error("Error setting up profiles listener:",D)}},[a,i]),o.useEffect(()=>{const D=A.map(P=>{const $=u[P.id]||{},B=typeof $.fullName=="string"?$.fullName:void 0,Y=typeof $.phone=="string"?$.phone:void 0,Ue=typeof P.displayName=="string"&&P.displayName.trim()?P.displayName:B||P.displayName||void 0;return{...P,displayName:Ue,phone:P.phone??Y??null}});b(D),O(D)},[A,u]);const M=D=>{console.log("Notification center:",D)},_=D=>{console.log("Notification settings:",D)},L=D=>{console.log("Notifications:",D)},be=D=>{console.log("Editing plan:",D)};o.useEffect(()=>{(async()=>{try{const D=await Rs();le(D)}catch(D){console.warn("Failed to load last update info:",D),le(null)}})()},[]);const V=async()=>{try{return await ta()}catch(D){return console.error("Error loading content:",D),{}}},ie=async D=>{try{E(!0);try{localStorage.setItem("siteContent_plans_cache",JSON.stringify(D))}catch{}await aa(D,(a==null?void 0:a.uid)||"admin");const P=await Rs();return le(P),!0}catch(P){return console.error("Error saving content:",P),!1}finally{E(!1)}};return c?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):e.jsx(Ta,{navigate:l,auth:Tt,devMode:i,setDevMode:x,error:g,setError:r,authLoading:c,setAuthLoading:()=>{},activeTab:w,setActiveTab:y,setNotificationCenterOpen:M,setNotificationSettings:_,setNotifications:L,notificationCount:C,setNotificationCount:N,users:f,setUsers:b,filteredUsers:h,setFilteredUsers:O,loading:v,setLoading:d,setEditingPlan:be,isSavingContent:F,setIsSavingContent:E,lastUpdateInfo:q,loadContentFromFirebase:V,saveContentToFirebase:ie})};export{jr as default};
