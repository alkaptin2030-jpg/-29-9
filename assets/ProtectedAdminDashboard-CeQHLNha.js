const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index--8DkHjcr.js","assets/index-Dt56XLIi.css"])))=>i.map(i=>d[i]);
var Fs=Object.defineProperty;var Ps=(n,a,l)=>a in n?Fs(n,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[a]=l;var rs=(n,a,l)=>Ps(n,typeof a!="symbol"?a+"":a,l);import{c as J,r as o,j as e,A as Os,d as $s,M as ae,S as D,f as B,g as A,q as G,a5 as q,h as re,a1 as pe,C as ne,aT as Ee,aU as Vs,a2 as Bs,U as W,a6 as _e,n as Q,x as je,a0 as se,aV as te,o as ns,p as Ce,_ as ye,Z as Hs,ak as zs,t as Ys,aW as qs,k as Qs,m as Gs,y as Zs,aq as Ks,a as Ws,u as Xs,e as Js}from"./index--8DkHjcr.js";import{P as et}from"./ProfileIcon-BBX7w_bU.js";import{C as Ne,a as Ue,b as Ie,d as we,c as st}from"./card-VLa8dR5P.js";import{B as Z}from"./button-BjxghIgB.js";import{I as tt}from"./input-qTLVQ8M2.js";import{L as ls}from"./label-Dob5Oim0.js";import{a as at,S as hs}from"./switch-_D-WfwqT.js";import{A as rt,a as nt}from"./alert-CtmvkK8r.js";import{B as Se}from"./badge-ConfIHjT.js";import{a as lt,g as is,r as cs,u as it,b as ct,d as ot,S as Fe,P as dt}from"./index.esm-JGoV6Erb.js";import{u as mt,c as xt,v as ut}from"./whatsappService-X64tZCjo.js";import{R as Pe}from"./refresh-cw-DNNYQjfB.js";import{C as ht}from"./circle-alert-DwkWxtCl.js";import{P as gs}from"./phone-BH8b1SMN.js";import{E as gt,a as pt}from"./eye-D8y9P79I.js";import{C as ft}from"./copy-BlxJzO9E.js";import{E as bt,p as jt}from"./broadcastService-Do2mxFY5.js";import{B as me,A as os}from"./bell-B4e0Amor.js";import{U as Te}from"./user-EpGVG49l.js";import{C as X}from"./calendar-BHDC_Xcv.js";import{S as yt,a as Nt,b as wt,c as vt,d as ge}from"./select-CYUd4o2f.js";import{M as Et}from"./mail-B3Z0UqoF.js";import{L as ds}from"./lock-CqbJrQAS.js";import{Z as Oe}from"./zap-CmhQk96K.js";import{G as de}from"./gift-CsO2mvIq.js";import{C as ve}from"./crown-C_aB6TGe.js";import{L as ms}from"./dropdown-menu-zb4fE_Sk.js";import{U as $e}from"./users-KhunznCX.js";import{C as Ve}from"./circle-check-big-CQPOLEMF.js";import{S as Ct}from"./shield-wuCumScR.js";import{g as xs,l as St,s as Tt}from"./contentService-B4Mf2Dj0.js";import"./dialog-CduiP_68.js";import"./Combination-BiWEP70k.js";import"./MasterPinDialog-BNPqzigc.js";import"./avatars-BvOjq6eG.js";import"./key-round-Dk69Gzyt.js";import"./index-DC1WzNxI.js";import"./index-CbSHQR2p.js";import"./index-CSrBDoGQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=J("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=J("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=J("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=J("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=J("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=J("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=J("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=J("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=J("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ps=o.forwardRef(({className:n,...a},l)=>e.jsx("textarea",{className:Os("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:l,...a}));ps.displayName="Textarea";const It=()=>{const{settings:n,loading:a,error:l,updateSettings:i,refreshSettings:c}=mt(),{toast:m}=$s(),[r,v]=o.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[u,N]=o.useState(!1),[b,C]=o.useState(!1),[j,g]=o.useState(""),[p,h]=o.useState({});o.useEffect(()=>{n&&v({phoneNumber:n.phoneNumber,defaultMessage:n.defaultMessage,isEnabled:n.isEnabled})},[n]);const P=()=>{var U,d;const k={};return(U=r.phoneNumber)!=null&&U.trim()?ut(r.phoneNumber)||(k.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):k.phoneNumber="رقم الواتساب مطلوب",(d=r.defaultMessage)!=null&&d.trim()?r.defaultMessage.length<10&&(k.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):k.defaultMessage="الرسالة الافتراضية مطلوبة",h(k),Object.keys(k).length===0},O=async()=>{if(!P()){m({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}N(!0);try{if(await i(r))m({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{m({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{N(!1)}},E=()=>{if(r.phoneNumber&&r.defaultMessage)try{const k=xt(r.phoneNumber,r.defaultMessage);g(k),C(!0)}catch{m({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},V=async()=>{try{await navigator.clipboard.writeText(j),m({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{m({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},ee=k=>{const U=k.replace(/[^\d+]/g,"");v(d=>({...d,phoneNumber:U})),p.phoneNumber&&h(d=>({...d,phoneNumber:""}))};return a?e.jsxs(Ne,{children:[e.jsx(Ue,{children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(we,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Pe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Ne,{children:[e.jsxs(Ue,{children:[e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(st,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(we,{className:"space-y-6",children:[l&&e.jsxs(rt,{variant:"destructive",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx(nt,{children:l})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${r.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(at,{checked:r.isEnabled,onCheckedChange:k=>v(U=>({...U,isEnabled:k}))})]}),e.jsx(lt,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ls,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(tt,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:r.phoneNumber,onChange:k=>ee(k.target.value),className:p.phoneNumber?"border-red-500":"",dir:"ltr"}),p.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:p.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ls,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(ps,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:r.defaultMessage,onChange:k=>{v(U=>({...U,defaultMessage:k.target.value})),p.defaultMessage&&h(U=>({...U,defaultMessage:""}))},className:p.defaultMessage?"border-red-500":"",rows:4}),p.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:p.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(Z,{onClick:O,disabled:u,className:"flex items-center gap-2",children:[u?e.jsx(Pe,{className:"h-4 w-4 animate-spin"}):e.jsx(hs,{className:"h-4 w-4"}),u?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(Z,{variant:"outline",onClick:E,disabled:!r.phoneNumber||!r.defaultMessage,className:"flex items-center gap-2",children:[b?e.jsx(gt,{className:"h-4 w-4"}):e.jsx(pt,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(Z,{variant:"outline",onClick:c,className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"تحديث"]})]}),b&&j&&e.jsxs(Ne,{className:"bg-muted/50",children:[e.jsx(Ue,{children:e.jsx(Ie,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(we,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:j}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Z,{variant:"outline",size:"sm",onClick:V,className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>window.open(j,"_blank"),className:"flex items-center gap-2",children:[e.jsx(bt,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),n&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(Se,{variant:"outline",className:"mr-2",children:[n.lastUpdated.toLocaleDateString("ar-EG")," - ",n.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(Se,{variant:n.isEnabled?"default":"secondary",className:"mr-2",children:n.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},De={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},Ft=n=>{const a=new Date,i=new Date(n).getTime()-a.getTime();return Math.ceil(i/(1e3*60*60*24))},Pt=(n,a=De)=>n<0?"expired":n<=a.criticalDays?"critical":n<=a.warningDays?"warning":(n<=a.infoDays,"info"),Ot=(n,a,l)=>{const i=$t(l);return a<0?`انتهت صلاحية اشتراك ${i} للمستخدم ${n}`:a===0?`ينتهي اشتراك ${i} للمستخدم ${n} اليوم!`:a===1?`ينتهي اشتراك ${i} للمستخدم ${n} غداً`:`ينتهي اشتراك ${i} للمستخدم ${n} خلال ${a} أيام`},$t=n=>{switch(n){case D.MONTHLY:return"الشهري";case D.YEARLY:return"السنوي";case D.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},Vt=async()=>{try{const n=B(A,"users"),a=G(n,q("subscription","!=",null)),l=await re(a),i=[];return l.forEach(c=>{var r,v,u,N;const m=c.data();m.subscription&&(m.subscription.planType||m.subscription.plan)&&i.push({id:c.id,...m,subscription:{...m.subscription,startDate:((v=(r=m.subscription.startDate)==null?void 0:r.toDate)==null?void 0:v.call(r))||new Date(m.subscription.startDate),endDate:((N=(u=m.subscription.endDate)==null?void 0:u.toDate)==null?void 0:N.call(u))||new Date(m.subscription.endDate),planType:m.subscription.planType||m.subscription.plan}})}),i}catch(n){return console.error("خطأ في جلب الاشتراكات النشطة:",n),[]}},Bt=async(n=De)=>{try{const a=await Vt(),l=[];return a.forEach(i=>{if(!i.subscription||!i.subscription.endDate)return;const c=Ft(i.subscription.endDate),m=Pt(c,n);if(c<=n.infoDays||c<0){const r={id:`${i.id}_${Date.now()}`,userId:i.id,userName:i.displayName||i.email||"مستخدم غير معروف",userEmail:i.email||"",subscriptionPlan:i.subscription.planType,expiryDate:i.subscription.endDate,daysRemaining:c,type:m,message:Ot(i.displayName||i.email||"مستخدم غير معروف",c,i.subscription.planType),isRead:!1,createdAt:new Date};l.push(r)}}),l.sort((i,c)=>{const m={expired:0,critical:1,warning:2,info:3};return m[i.type]!==m[c.type]?m[i.type]-m[c.type]:i.daysRemaining-c.daysRemaining}),l}catch(a){return console.error("خطأ في إنشاء إشعارات الاشتراك:",a),[]}},Ht=(n,a)=>a?n.filter(l=>l.type===a):n,zt=n=>{localStorage.setItem("notificationSettings",JSON.stringify(n))},Yt=()=>{try{const n=localStorage.getItem("notificationSettings");if(n)return{...De,...JSON.parse(n)}}catch(n){console.error("خطأ في تحميل إعدادات الإشعارات:",n)}return De},qt=({isOpen:n,onClose:a})=>{const[l,i]=o.useState([]),[c,m]=o.useState([]),[r,v]=o.useState("all"),[u,N]=o.useState(!0),[b,C]=o.useState(Yt());o.useEffect(()=>{n&&j()},[n]),o.useEffect(()=>{m(r==="all"?l:Ht(l,r))},[l,r]);const j=async()=>{N(!0);try{const E=await Bt(b);i(E)}catch(E){console.error("خطأ في تحميل الإشعارات:",E)}finally{N(!1)}},g=E=>{switch(E){case"urgent":return e.jsx(Ee,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(ne,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(me,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(me,{className:"w-5 h-5 text-gray-500"})}},p=E=>{switch(E){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},h=E=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(E),P=E=>{switch(E){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},O=E=>{const V={...b,[E]:!b[E]};C(V),zt(V)};return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),l.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:l.length})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(pe,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(E=>e.jsx("button",{onClick:()=>v(E),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${r===E?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:P(E)},E))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.visualAlerts,onChange:()=>O("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.soundAlerts,onChange:()=>O("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.autoRefresh,onChange:()=>O("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:u?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):c.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:r==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${P(r)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:c.map(E=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${p(E.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[g(E.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:E.message}),e.jsx("span",{className:"text-xs text-gray-500",children:h(E.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",E.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",h(E.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",E.daysRemaining]})]})]})]})]})},E.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",h(new Date)]}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},Qt=({notification:n,onClose:a,soundEnabled:l,onToggleSound:i})=>{const[c,m]=o.useState(!1),[r,v]=o.useState(null);o.useEffect(()=>{if(n&&(m(!0),l&&u(n.type),n.type!=="urgent")){const g=setTimeout(()=>{N()},1e4);return()=>clearTimeout(g)}},[n,l]),o.useEffect(()=>{typeof window<"u"&&window.AudioContext&&v(new AudioContext)},[]);const u=g=>{if(!(!r||!l))try{const p=r.createOscillator(),h=r.createGain();switch(p.connect(h),h.connect(r.destination),g){case"urgent":p.frequency.setValueAtTime(800,r.currentTime),p.frequency.setValueAtTime(1e3,r.currentTime+.1),p.frequency.setValueAtTime(800,r.currentTime+.2),h.gain.setValueAtTime(.3,r.currentTime),h.gain.exponentialRampToValueAtTime(.01,r.currentTime+.5),p.start(r.currentTime),p.stop(r.currentTime+.5);break;case"warning":p.frequency.setValueAtTime(600,r.currentTime),p.frequency.setValueAtTime(700,r.currentTime+.15),h.gain.setValueAtTime(.2,r.currentTime),h.gain.exponentialRampToValueAtTime(.01,r.currentTime+.3),p.start(r.currentTime),p.stop(r.currentTime+.3);break;case"info":p.frequency.setValueAtTime(400,r.currentTime),h.gain.setValueAtTime(.1,r.currentTime),h.gain.exponentialRampToValueAtTime(.01,r.currentTime+.2),p.start(r.currentTime),p.stop(r.currentTime+.2);break}}catch(p){console.error("خطأ في تشغيل الصوت:",p)}},N=()=>{m(!1),setTimeout(()=>{a()},300)},b=g=>{switch(g){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Ee,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(ne,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(me,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(me,{className:"w-6 h-6"}),pulse:""}}},C=g=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(g);if(!n)return null;const j=b(n.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${c?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${j.bg} ${j.border} ${j.text} ${j.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[j.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[n.type==="urgent"&&"تنبيه عاجل!",n.type==="warning"&&"تحذير",n.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:l?"إيقاف الصوت":"تشغيل الصوت",children:l?e.jsx(_t,{className:"w-4 h-4"}):e.jsx(Ut,{className:"w-4 h-4"})}),e.jsx("button",{onClick:N,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(pe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:n.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",n.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",C(n.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",n.daysRemaining," يوم"]})]})]}),n.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Gt=({user:n,onActivateSubscription:a,onDeactivateSubscription:l,onDeleteUser:i})=>{const[c,m]=o.useState(D.MONTHLY),[r,v]=o.useState(!1),u=Vs(),N=g=>{const p=g==null?void 0:g.displayName;if(typeof p=="string"&&p.trim())return p.trim();if(p&&typeof p=="object"){const h=p.full_name||p.name||p.ar||p.en;if(typeof h=="string"&&h.trim())return h.trim()}return typeof(g==null?void 0:g.email)=="string"&&g.email.includes("@")?g.email.split("@")[0]:"غير محدد"},b=g=>{switch(g){case D.LIFETIME:return e.jsx(ve,{className:"w-4 h-4 text-yellow-500"});case D.YEARLY:return e.jsx(de,{className:"w-4 h-4 text-blue-500"});case D.QUARTERLY:return e.jsx(X,{className:"w-4 h-4 text-purple-500"});case D.MONTHLY:return e.jsx(Oe,{className:"w-4 h-4 text-green-500"});case D.ZERO:return e.jsx(ds,{className:"w-4 h-4 text-gray-500"});default:return null}},C=g=>{switch(g){case D.MONTHLY:return"شهرية";case D.QUARTERLY:return"ربع سنوية";case D.YEARLY:return"سنوية";case D.LIFETIME:return"مدى الحياة";case D.ZERO:return"زيرو";default:return"غير محدد"}},j=g=>g?(g.toDate?g.toDate():new Date(g)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(Ne,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(we,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:N(n)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Et,{className:"w-3 h-3 ml-1"}),n.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(gs,{className:"w-3 h-3 ml-1"}),n.phone||"غير محدد"]})]})]}),e.jsx(Se,{variant:n.isActive?"default":"secondary",children:n.isActive?"نشط":"غير نشط"})]}),n.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[b(n.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:C(n.subscription.planType)})]}),e.jsx(Se,{variant:n.subscription.isActive?"default":"destructive",children:n.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(X,{className:"w-3 h-3 ml-1"}),"البداية: ",j(n.subscription.startDate)]}),n.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"w-3 h-3 ml-1"}),"النهاية: ",j(n.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[a&&r&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),u?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:c,onChange:g=>m(g.target.value),children:[e.jsx("option",{value:D.MONTHLY,children:"شهرية"}),e.jsx("option",{value:D.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:D.YEARLY,children:"سنوية"}),e.jsx("option",{value:D.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:D.ZERO,children:"زيرو"})]}):e.jsxs(yt,{value:c,onValueChange:g=>m(g),children:[e.jsx(Nt,{className:"w-full",children:e.jsx(wt,{placeholder:"اختر نوع الباقة"})}),e.jsxs(vt,{children:[e.jsx(ge,{value:D.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(ge,{value:D.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(ge,{value:D.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(ge,{value:D.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Mt,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(ge,{value:D.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ds,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(Z,{size:"sm",onClick:()=>{a(n.id,c),v(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(Z,{size:"sm",variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[a&&!r&&e.jsx(Z,{size:"sm",variant:"outline",onClick:()=>v(!0),className:"flex-1",children:"تفعيل الاشتراك"}),l&&e.jsx(Z,{size:"sm",variant:"outline",onClick:()=>l(n.id),className:"flex-1",children:"إلغاء الاشتراك"}),i&&e.jsx(Z,{size:"sm",variant:"destructive",onClick:()=>i(n.id),children:e.jsx(Bs,{className:"w-4 h-4"})})]})]})]})})};class Zt{constructor(){rs(this,"hooks",[])}registerHooks(a){console.log("📝 Registering hooks:",Object.keys(a)),this.hooks.push(a)}async sendImageMessage(a,l,i,c,m){try{console.log("📤 Uploading image message:",{chatId:a,fileName:l.name,fileSize:l.size,senderType:i,senderId:c});const r=is(),v=Date.now(),u=`chat-images/${a}/${v}_${l.name}`,N=cs(r,u),b=await it(N,l);console.log("✅ Image uploaded successfully:",b.metadata.fullPath);const C=await ct(N);console.log("✅ Image URL obtained:",C);const j={chatId:a,message:m||"صورة",content:m||"صورة",senderType:i,senderId:c,timestamp:W(),isRead:!1,type:"image",imageUrl:C,imageFileName:l.name},g=await _e(B(A,"chatMessages"),j);console.log("✅ Image message added to chatMessages:",g.id);const p=Q(A,"chatRooms",a);if(i==="client"){const h=await je(p);if(h.exists()){const P=h.data().unreadCount||0;await se(p,{lastMessage:m||"صورة",lastMessageTime:W(),unreadCount:P+1})}}else await se(p,{lastMessage:m||"صورة",lastMessageTime:W()});console.log("✅ Image message sent successfully")}catch(r){throw console.error("🔥 Error sending image message:",r),r}}async deleteChat(a){try{console.log("🗑️ Deleting chat:",a);const l=G(B(A,"chatMessages"),q("chatId","==",a)),i=await re(l),c=[];for(const r of i.docs){const v=r.data();if(v.type==="image"&&v.imageUrl)try{const u=is(),N=cs(u,v.imageUrl);c.push(ot(N))}catch(u){console.warn("⚠️ Could not delete image from storage:",u)}c.push(te(r.ref))}const m=Q(A,"chatRooms",a);c.push(te(m)),await Promise.all(c),console.log("✅ Chat deleted successfully:",{chatId:a,messagesDeleted:i.size})}catch(l){throw console.error("🔥 Error deleting chat:",l),l}}unregisterHooks(a){console.log("🗑️ Unregistering hooks"),a?this.hooks=this.hooks.filter(l=>l!==a):this.hooks=[]}async createChatRoom(a,l=!1){try{const i=l?"clientEmail":"clientPhone",c=G(B(A,"chatRooms"),q(i,"==",a),q("status","==","active")),m=await re(c);if(!m.empty)return m.docs[0].id;const r={clientId:`client_${a}`,clientPhone:l?"":a,clientEmail:l?a:void 0,customerName:l?`عميل ${a}`:`عميل ${a}`,status:"active",unreadCount:0,createdAt:W(),lastMessageTime:W()};return(await _e(B(A,"chatRooms"),r)).id}catch(i){throw console.error("Error creating chat room:",i),i}}async sendMessage(a,l,i,c){try{for(let r=1;r<=3;r++)try{console.log(`📤 Sending message (attempt ${r}):`,{chatId:a,message:l.substring(0,50)+"...",senderType:i,senderId:c});const v={chatId:a,message:l,content:l,senderType:i,senderId:c,timestamp:W(),isRead:!1},u=await _e(B(A,"chatMessages"),v);console.log("✅ Message added to chatMessages:",u.id);const N=Q(A,"chatRooms",a);if(i==="client"){const b=await je(N),C=b.exists()&&b.data().unreadCount||0;await se(N,{lastMessage:l,lastMessageTime:W(),unreadCount:C+1}),this.hooks.length>0&&this.hooks.forEach(j=>{if(j.onUnreadCountChange&&typeof j.onUnreadCountChange=="function")try{j.onUnreadCountChange(a,C+1)}catch(g){console.error("Error calling onUnreadCountChange hook:",g)}})}else await se(N,{lastMessage:l,lastMessageTime:W()});if(this.hooks.length>0)try{const b=await je(N);if(b.exists()){const C={id:b.id,...b.data()},j={id:u.id,...v,timestamp:new Date};this.hooks.forEach(g=>{if(g.onNewMessage&&typeof g.onNewMessage=="function")try{g.onNewMessage(j,C)}catch(p){console.error("Error calling onNewMessage hook:",p)}})}}catch(b){console.error("Error calling onNewMessage hooks:",b)}console.log("✅ Message sent successfully");return}catch(v){if(console.error(`❌ Attempt ${r} failed:`,v),r===3)throw v;await new Promise(u=>setTimeout(u,1e3*r))}throw new Error("Max retry attempts reached")}catch(r){throw console.error("🔥 Error sending message:",r),r}}subscribeToMessages(a,l){let i=0;const c=5;let m=null,r=null,v=0;const u=()=>{try{console.log("🔔 Starting subscription to messages for room:",a,`(attempt ${i+1})`);const N=G(B(A,"chatMessages"),q("chatId","==",a),ns("timestamp","asc"));r=Ce(N,b=>{console.log("📨 Received messages snapshot:",b.docs.length,"messages"),i=0;const C=b.docs.map(j=>{const g=j.data();return{id:j.id,...g,message:g.message||g.content||"",content:g.content||g.message||""}});if(C.length>v&&v>0){const j=C.slice(v);console.log("🆕 New messages detected:",j.length),j.forEach(g=>{this.hooks.forEach(p=>{if(p.onNewMessage&&typeof p.onNewMessage=="function")try{je(Q(A,"chatRooms",a)).then(h=>{if(h.exists()){const P={id:h.id,...h.data()},O=p.onNewMessage;O&&O(g,P)}}).catch(h=>{console.error("Error fetching chat room for hook:",h)})}catch(h){console.error("Error calling onNewMessage hook:",h)}})})}v=C.length,console.log("📨 Processed messages:",C),l(C)},b=>{var C,j,g,p;if(console.error("❌ Error in messages subscription:",b),b.name==="AbortError"||(C=b.message)!=null&&C.includes("AbortError")){console.log("🔄 Request was aborted, will retry..."),i<c&&(i++,m=setTimeout(()=>{u()},1e3));return}(j=b.message)!=null&&j.includes("index is currently building")||(g=b.message)!=null&&g.includes("cannot be used yet")||b.code==="failed-precondition"?(console.log("🔨 Index is still building, will retry in 10 seconds..."),i<c?(i++,m=setTimeout(()=>{console.log("🔄 Retrying subscription after index building delay..."),u()},1e4)):(console.log("⚠️ Max retries reached for index building. Please wait for index to complete."),l([]))):b.code==="unavailable"||(p=b.message)!=null&&p.includes("ERR_ABORTED")?(console.log("🔄 Connection issue detected, will retry automatically..."),i<c&&(i++,m=setTimeout(()=>{u()},2e3))):(console.error("❌ Unhandled error in messages subscription:",b),l([]))})}catch(N){console.error("❌ Error setting up messages subscription:",N),i<c&&(i++,m=setTimeout(()=>{u()},5e3))}};return u(),()=>{m&&clearTimeout(m),r&&r()}}subscribeToAdminChats(a){console.log("🔍 Admin: Starting subscription to admin chats");let l=0,i=0;const c=5;let m=null,r=null;const v=()=>{try{const u=G(B(A,"chatRooms"),q("status","==","active"),ns("lastMessageTime","desc"));r=Ce(u,N=>{console.log("📊 Admin: Received chat rooms snapshot:",{size:N.size,empty:N.empty,docs:N.docs.length}),i=0;const b=N.docs.map(C=>{const j=C.data();return console.log("💬 Admin: Chat room data:",{id:C.id,customerName:j.customerName,lastMessage:j.lastMessage,unreadCount:j.unreadCount,status:j.status}),{id:C.id,...j}});b.length!==l&&(console.log("🆕 Chat rooms count changed:",{old:l,new:b.length}),b.forEach(C=>{this.hooks.length>0&&this.hooks.forEach(j=>{if(j.onChatRoomUpdate&&typeof j.onChatRoomUpdate=="function")try{j.onChatRoomUpdate(C)}catch(g){console.error("Error calling onChatRoomUpdate hook:",g)}})})),l=b.length,a(b)},N=>{var b,C;if(console.error("❌ Error in admin chats subscription:",N),N.name==="AbortError"||(b=N.message)!=null&&b.includes("AbortError")){console.log("🔄 Admin chats request was aborted, will retry..."),i<c&&(i++,m=setTimeout(()=>{v()},1e3));return}N.code==="unavailable"||(C=N.message)!=null&&C.includes("ERR_ABORTED")?(console.log("🔄 Admin chats connection issue detected, will retry..."),i<c&&(i++,m=setTimeout(()=>{v()},2e3))):(console.error("❌ Unhandled error in admin chats subscription:",N),a([]))})}catch(u){console.error("❌ Error setting up admin chats subscription:",u),i<c&&(i++,m=setTimeout(()=>{v()},5e3))}};return v(),()=>{m&&clearTimeout(m),r&&r()}}async markMessagesAsRead(a,l){try{const i=G(B(A,"chatMessages"),q("chatId","==",a),q("senderType","!=",l),q("isRead","==",!1)),m=(await re(i)).docs.map(r=>se(Q(A,"chatMessages",r.id),{isRead:!0}));if(await Promise.all(m),l==="admin"){const r=Q(A,"chatRooms",a);await se(r,{unreadCount:0})}}catch(i){throw console.error("Error marking messages as read:",i),i}}async closeChatRoom(a){try{const l=Q(A,"chatRooms",a);await se(l,{status:"closed",lastMessageTime:W()})}catch(l){throw console.error("Error closing chat room:",l),l}}}const oe=new Zt,Kt=({isOpen:n,onClose:a})=>{var k,U;const[l,i]=o.useState([]),[c,m]=o.useState(null),[r,v]=o.useState([]),[u,N]=o.useState(""),[b,C]=o.useState(!0),[j,g]=o.useState(!1),[p,h]=o.useState({}),P=o.useRef(null);o.useEffect(()=>{const d={onNewMessage:(S,M)=>{console.log("🔔 New message notification:",S,M),S.senderType==="client"&&S.chatId!==c&&(h(R=>({...R,[S.chatId]:(R[S.chatId]||0)+1})),console.log("🔔 New message from client in chat:",M.customerName||M.clientPhone))},onChatRoomUpdate:S=>{console.log("🔄 Chat room updated:",S),i(M=>{const R=M.findIndex(L=>L.id===S.id);if(R>=0){const L=[...M];return L[R]=S,L.sort((xe,H)=>{var _,I,$,z;const le=((I=(_=xe.lastMessageTime)==null?void 0:_.toMillis)==null?void 0:I.call(_))||0;return(((z=($=H.lastMessageTime)==null?void 0:$.toMillis)==null?void 0:z.call($))||0)-le})}else return[S,...M]})},onUnreadCountChange:(S,M)=>{console.log("📊 Unread count changed:",S,M),i(R=>R.map(L=>L.id===S?{...L,unreadCount:M}:L))}};return oe.registerHooks(d),()=>{oe.unregisterHooks()}},[c]),o.useEffect(()=>{console.log("🔍 AdminChatPanel: Setting up chat rooms subscription"),C(!0);const d=oe.subscribeToAdminChats(S=>{console.log("📊 AdminChatPanel: Received chats update:",S.length),i(S),C(!1)});return()=>{console.log("🔌 AdminChatPanel: Cleaning up chat rooms subscription"),d()}},[]),o.useEffect(()=>{if(!c){v([]);return}console.log("📨 AdminChatPanel: Setting up messages subscription for chat:",c);const d=oe.subscribeToMessages(c,S=>{console.log("📨 AdminChatPanel: Received messages update:",S.length),v(S),h(M=>{const R={...M};return delete R[c],R})});return oe.markMessagesAsRead(c,"admin").catch(console.error),()=>{console.log("🔌 AdminChatPanel: Cleaning up messages subscription"),d()}},[c]),o.useEffect(()=>{var d;(d=P.current)==null||d.scrollIntoView({behavior:"smooth"})},[r]);const O=async()=>{if(!(!u.trim()||!c||j)){g(!0);try{await oe.sendMessage(c,u.trim(),"admin","admin_user"),N("")}catch(d){console.error("Error sending message:",d),alert("حدث خطأ في إرسال الرسالة")}finally{g(!1)}}},E=d=>{m(d),h(S=>{const M={...S};return delete M[d],M})},V=Object.values(p).reduce((d,S)=>d+S,0),ee=l.reduce((d,S)=>d+(S.unreadCount||0),0);return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[80vh] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"المحادثات"}),(ee>0||V>0)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Dt,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold",children:"جديد"})]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(pe,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:b?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(ms,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-2 text-gray-600",children:"جاري التحميل..."})]}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[e.jsx($e,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"لا توجد محادثات نشطة"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"ستظهر المحادثات الجديدة هنا"})]}):l.map(d=>{const S=c===d.id,M=(d.unreadCount||0)>0,R=p[d.id]>0,L=(d.unreadCount||0)+(p[d.id]||0);return e.jsx("div",{onClick:()=>E(d.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-all duration-200 ${S?"bg-blue-50 border-r-4 border-r-blue-500":M||R?"bg-yellow-50 hover:bg-yellow-100 border-r-4 border-r-yellow-400":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${M||R?"bg-yellow-200":"bg-gray-200"}`,children:e.jsx(Te,{className:`w-5 h-5 ${M||R?"text-yellow-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:d.customerName||d.clientPhone}),S&&e.jsx(Ve,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]}),d.customerName&&d.customerName!==d.clientPhone&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:d.clientPhone}),d.lastMessage&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:d.lastMessage.length>50?d.lastMessage.substring(0,50)+"...":d.lastMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(ne,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:d.lastMessageTime&&d.lastMessageTime.toMillis?new Date(d.lastMessageTime.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${M||R?"bg-red-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:M||R?"رسائل جديدة":"مقروءة"})]})]})]}),L>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[20px] text-center",children:L>99?"99+":L})]})},d.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:((k=l.find(d=>d.id===c))==null?void 0:k.customerName)||((U=l.find(d=>d.id===c))==null?void 0:U.clientPhone)})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.map(d=>e.jsx("div",{className:`flex ${d.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${d.senderType==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:d.message||d.content}),e.jsx("p",{className:`text-xs mt-1 ${d.senderType==="admin"?"text-blue-100":"text-gray-500"}`,children:d.timestamp&&d.timestamp.toMillis?new Date(d.timestamp.toMillis()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"الآن"})]})},d.id)),e.jsx("div",{ref:P})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:d=>N(d.target.value),onKeyPress:d=>d.key==="Enter"&&O(),placeholder:"اكتب رسالتك هنا...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:j}),e.jsxs("button",{onClick:O,disabled:!u.trim()||j,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[j?e.jsx(ms,{className:"w-4 h-4 animate-spin"}):e.jsx(Rt,{className:"w-4 h-4"}),"إرسال"]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(ae,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر محادثة للبدء"}),e.jsx("p",{children:"اختر محادثة من القائمة لعرض الرسائل والرد عليها"})]})})})]})}):null},Wt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.firebasestorage.app",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Xt=({navigate:n,auth:a,devMode:l,setDevMode:i,error:c,setError:m,authLoading:r,setAuthLoading:v,activeTab:u,setActiveTab:N,setNotificationCenterOpen:b,setNotificationSettings:C,setNotifications:j,notificationCount:g,setNotificationCount:p,users:h,setUsers:P,filteredUsers:O,setFilteredUsers:E,loading:V,setLoading:ee,setEditingPlan:k,isSavingContent:U,setIsSavingContent:d,lastUpdateInfo:S,loadContentFromFirebase:M,saveContentToFirebase:R})=>{var as;const[L,xe]=o.useState(!0),[H,le]=o.useState(""),[T,_]=o.useState(null),[I,$]=o.useState({});o.useState(!1),o.useState(null),o.useState(!1);const[z,ke]=o.useState({sound:!0}),[fs,Jt]=o.useState(!1),[bs,js]=o.useState(null),Me=s=>{const t=s==null?void 0:s.displayName;let x="";typeof t=="string"?x=t:t&&typeof t=="object"&&(x=(t.ar||t.en||"").toString()),!x&&typeof(s==null?void 0:s.email)=="string"&&(x=s.email);const y=String(x).trim().charAt(0);return y?y.toUpperCase():"؟"},ue=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const x=t.full_name||t.name||t.ar||t.en;if(typeof x=="string"&&x.trim())return x.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[Ae,Be]=o.useState(""),[Re,He]=o.useState(""),[ze,Ye]=o.useState(""),[Le,qe]=o.useState(""),[Qe,Ge]=o.useState(!1),[fe,Ze]=o.useState(""),[Y,Ke]=o.useState(24),[We,Xe]=o.useState("24"),[Je,es]=o.useState(!1),[ea,ss]=o.useState(!1);o.useEffect(()=>{u==="trials"&&(async()=>{try{ss(!0);const{FreeTrialService:s}=await ye(async()=>{const{FreeTrialService:x}=await import("./index--8DkHjcr.js").then(y=>y.b1);return{FreeTrialService:x}},__vite__mapDeps([0,1])),t=await s.getTrialDurationHours();Ke(t),Xe(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{ss(!1)}})()},[u]);const ys=async()=>{var s;if(!Ae.trim()||!Re.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{Ge(!0);const t=Le.trim()?`user:${Le.trim()}`:"global";await jt({title:Ae.trim(),message:Re.trim(),audienceKey:t,createdBy:(s=a==null?void 0:a.currentUser)==null?void 0:s.uid,linkUrl:ze.trim()||void 0}),Be(""),He(""),Ye(""),qe(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{Ge(!1)}};o.useEffect(()=>{if(!H.trim())E(h);else{const s=h.filter(t=>t.email&&typeof t.email=="string"&&t.email.toLowerCase().includes(H.toLowerCase())||t.displayName&&typeof t.displayName=="string"&&t.displayName.toLowerCase().includes(H.toLowerCase())||t.name&&typeof t.name=="string"&&t.name.toLowerCase().includes(H.toLowerCase()));E(s)}},[h,H,E]);const Ns=()=>{a!=null&&a.signOut&&a.signOut(),n("/admin/login")},ws=async(s,t,x=null)=>{var y;try{console.log("Activating subscription for user:",s,"with plan:",t,"and variant:",x);const w=((y=a==null?void 0:a.currentUser)==null?void 0:y.uid)||"admin-user-id";await Ys(s,t,w,x),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(w){console.error("❌ خطأ في تفعيل الاشتراك:",w),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},vs=async s=>{try{console.log("Deactivating subscription for user:",s),await qs(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},Es=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const y=((t=a==null?void 0:a.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const f=await Qs(Gs,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",f),P(F=>F.filter(K=>K.id!==s)),E(F=>F.filter(K=>K.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(w){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(w==null?void 0:w.message)||w)}{const w=[];try{await te(Q(A,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(f){console.error("خطأ في حذف الملف الشخصي:",f),w.push(`الملف الشخصي: ${(f==null?void 0:f.message)||f}`)}try{await te(Q(A,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(f){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",f),w.push(`users: ${(f==null?void 0:f.message)||f}`)}try{const f=G(B(A,"transactions"),q("userId","==",s)),F=await re(f),K=F.docs.map(he=>te(he.ref)),ie=await Promise.allSettled(K),ce=ie.filter(he=>he.status==="rejected");ce.length?(console.warn("فشل حذف بعض المعاملات:",ce.length),w.push(`المعاملات: فشل حذف ${ce.length} من أصل ${ie.length}`)):console.log(`تم حذف ${F.size} معاملة`)}catch(f){console.error("خطأ في جلب/حذف المعاملات:",f),w.push(`المعاملات: ${(f==null?void 0:f.message)||f}`)}try{const f=G(B(A,"chatRooms"),q("participants","array-contains",s)),F=await re(f),K=F.docs.map(async ie=>{try{const he=(await re(B(ie.ref,"messages"))).docs.map(Is=>te(Is.ref));await Promise.allSettled(he),await te(ie.ref)}catch(ce){console.error("فشل حذف محادثة/رسائل:",ce),w.push(`المحادثات: ${ie.id}`)}});await Promise.all(K),console.log(`تم إنهاء معالجة ${F.size} محادثة`)}catch(f){console.error("خطأ في جلب/حذف المحادثات:",f),w.push(`المحادثات: ${(f==null?void 0:f.message)||f}`)}try{await Zs(Q(A,"deletedUsers",s),{deletedAt:new Date,deletedBy:y,reason:"حذف نهائي من لوحة الإدارة"})}catch(f){console.error("خطأ في تسجيل المستخدم كمحذوف:",f),w.push(`deletedUsers: ${(f==null?void 0:f.message)||f}`)}P(f=>f.filter(F=>F.id!==s)),E(f=>f.filter(F=>F.id!==s)),w.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${w.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(x){console.error("❌ خطأ في حذف المستخدم:",x),alert(`حدث خطأ في حذف المستخدم: ${x.message||"خطأ غير معروف"}`)}};o.useEffect(()=>{(async()=>{try{if(typeof M=="function"){const t=await M();t&&(t.monthly||t.yearly||t.lifetime)&&$(t)}}catch(t){console.warn("Failed to load content data:",t)}})()},[]);const Cs=async()=>{var s;try{if(typeof R!="function")return;d(!0);const t=((s=a==null?void 0:a.currentUser)==null?void 0:s.uid)||"admin-user-id";await R(I,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{d(!1)}},be=(s,t,x)=>{$(y=>({...y,[s]:{...(y==null?void 0:y[s])||{},[t]:x}}))},Ss=s=>{$(t=>{var x;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((x=t==null?void 0:t[s])==null?void 0:x.features)||[],""]}}})},Ts=(s,t,x)=>{$(y=>{var f;const w=[...((f=y==null?void 0:y[s])==null?void 0:f.features)||[]];return w[t]=x,{...y,[s]:{...(y==null?void 0:y[s])||{},features:w}}})},Ds=(s,t)=>{$(x=>{var w;const y=[...((w=x==null?void 0:x[s])==null?void 0:w.features)||[]];return y.splice(t,1),{...x,[s]:{...(x==null?void 0:x[s])||{},features:y}}})},ks=()=>{ke(s=>({...s,sound:!s.sound}))},Ms=()=>{js(null)},As=async()=>{try{const s=Number(We);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}es(!0);const{FreeTrialService:t}=await ye(async()=>{const{FreeTrialService:y}=await import("./index--8DkHjcr.js").then(w=>w.b1);return{FreeTrialService:y}},__vite__mapDeps([0,1])),x=await t.updateTrialDurationHours(s);x.success?(Ke(s),alert(x.message)):alert(x.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{es(!1)}},Rs=async s=>{try{const{FreeTrialService:t}=await ye(async()=>{const{FreeTrialService:y}=await import("./index--8DkHjcr.js").then(w=>w.b1);return{FreeTrialService:y}},__vite__mapDeps([0,1])),x=await t.startFreeTrialFromAdmin(s);alert(x.message||`تم تفعيل التجربة المجانية لمدة ${Y} ${Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"}`)}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},Ls=async s=>{try{const{FreeTrialService:t}=await ye(async()=>{const{FreeTrialService:y}=await import("./index--8DkHjcr.js").then(w=>w.b1);return{FreeTrialService:y}},__vite__mapDeps([0,1])),x=await t.resetActiveTrialToCurrentDuration(s);alert(x.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},_s=(s,t)=>{console.log("Toggling user status:",s,t)},ts=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",Us=[{id:"users",label:"المستخدمين",icon:$e},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:X},{id:"trials",label:"إدارة التجارب المجانية",icon:de},{id:"content",label:"إدارة المحتوى",icon:Ks},{id:"chat",label:"الدردشة",icon:ae},{id:"whatsapp",label:"إدارة الواتساب",icon:ae},{id:"analytics",label:"الإحصائيات",icon:os}];return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):c?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:c})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{m(null),v(!0),window.location.reload()},className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"🔄 إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{m(null),n("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",c),console.log("🔍 Auth state:",a.currentUser),console.log("🔍 Dev mode:",l),console.log("🔍 Environment:",Wt)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!l&&!a.currentUser?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>n("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:`${L?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[L&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Ct,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>xe(!L),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:L?e.jsx(pe,{className:"w-5 h-5"}):e.jsx(At,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:Us.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>N(s.id),className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${u===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:Ns,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Hs,{className:"w-5 h-5"}),L&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[u==="users"&&"إدارة المستخدمين",u==="subscriptions"&&"مواعيد الاشتراكات",u==="trials"&&"إدارة التجارب المجانية",u==="chat"&&"إدارة الدردشة",u==="analytics"&&"الإحصائيات"]}),l&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",l?"المطور":"المدير"]}),e.jsx(et,{})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[u==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.length})]}),e.jsx($e,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Le,onChange:s=>qe(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>s.isActive).length})]}),e.jsx(us,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(s=>!s.isActive).length})]}),e.jsx(Lt,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:H,onChange:s=>le(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),H&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",O.length," من أصل ",h.length," مستخدم",H&&e.jsx("button",{onClick:()=>le(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:V?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):O.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:H?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(s=>e.jsx(Gt,{user:s,onActivateSubscription:ws,onToggleUserStatus:_s,onDeactivateSubscription:vs,onDeleteUser:Es},s.id))})})]})]}),u==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(Ve,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:h.filter(s=>{var f,F;if(!((f=s.subscription)!=null&&f.endDate)||!((F=s.subscription)!=null&&F.isActive))return!1;const t=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),x=new Date,y=t.getTime()-x.getTime(),w=Math.ceil(y/(1e3*60*60*24));return w<=7&&w>0}).length})]}),e.jsx(Ee,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(s=>{var x;return(x=s.subscription)!=null&&x.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(ne,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:h.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===D.LIFETIME}).length})]}),e.jsx(ve,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:V?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.planType}).sort((s,t)=>{var w,f;if(!((w=s.subscription)!=null&&w.endDate)||!((f=t.subscription)!=null&&f.endDate))return 0;const x=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),y=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return x.getTime()-y.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const x=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,y=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let w=null,f="غير محدد";if(t.planType===D.LIFETIME)f="مدى الحياة";else if(y){const F=new Date,K=y.getTime()-F.getTime();w=Math.ceil(K/(1e3*60*60*24)),w<0?f="منتهي":w<=7?f="ينتهي قريباً":f="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:Me(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ue(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===D.LIFETIME&&e.jsx(ve,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===D.YEARLY&&e.jsx(de,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===D.QUARTERLY&&e.jsx(X,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===D.MONTHLY&&e.jsx(Oe,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:zs(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x?x.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===D.LIFETIME?"مدى الحياة":y?y.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${f==="نشط"?"bg-green-100 text-green-800":f==="ينتهي قريباً"?"bg-orange-100 text-orange-800":f==="منتهي"?"bg-red-100 text-red-800":f==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:f})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===D.LIFETIME?"∞":w!==null?w<0?"منتهي":`${w} يوم`:"غير محدد"})]},s.id)}).filter(Boolean)})]})})]})]}),u==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),S&&S.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(S.lastUpdated).toLocaleString("ar-SA"),S.updatedBy&&` بواسطة: ${S.updatedBy}`]})]}),e.jsxs("button",{onClick:Cs,disabled:U,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(hs,{className:"w-4 h-4"}),U?"جاري الحفظ...":"حفظ جميع التغييرات"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(I).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(Oe,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(X,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(de,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(ve,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>k(T===s?null:s),className:"text-purple-600 hover:text-purple-800",children:e.jsx(dt,{className:"w-4 h-4"})})]}),T===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:x=>be(s,"name",x.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:x=>be(s,"price",x.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:x=>be(s,"period",x.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:x=>be(s,"description",x.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>Ss(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((x,y)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:w=>Ts(s,y,w.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>Ds(s,y),className:"text-red-500 hover:text-red-700",children:e.jsx(pe,{className:"w-4 h-4"})})]},y))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((x,y)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3 text-green-500"}),x]},y))]})]})]},s))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:Ae,onChange:s=>Be(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:Re,onChange:s=>He(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:ze,onChange:s=>Ye(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:ys,disabled:Qe,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:Qe?"جاري الإرسال...":"إرسال إشعار"})})]})]})]}),u==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",h),console.log("🔍 Users count:",(h==null?void 0:h.length)||0),console.log("🔍 Users on trial:",((as=h==null?void 0:h.filter(s=>s.isOnFreeTrial))==null?void 0:as.length)||0),V&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),c&&!V&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Ee,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:c}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!V&&!c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(de,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(ne,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(us,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:We,onChange:s=>Xe(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",Y," ",Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:As,disabled:Je,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:Je?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:fe,onChange:s=>Ze(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Fe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[h.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=fe.trim().toLowerCase();if(!t)return!0;const x=ue(s).toLowerCase(),y=(s.email||"").toLowerCase();return x.includes(t)||y.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:Me(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",ts(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>Rs(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${Y} ${Y>=3&&Y<=10?"ساعات":Y===2?"ساعتين":"ساعة"}`})})]},s.id)),h.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),h.filter(s=>s.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:fe,onChange:s=>Ze(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Fe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:h.filter(s=>s.isOnFreeTrial).filter(s=>{const t=fe.trim().toLowerCase();if(!t)return!0;const x=ue(s).toLowerCase(),y=(s.email||"").toLowerCase();return x.includes(t)||y.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:Me(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?ts(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>Ls(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"})]})]},s.id))})})]})]})]}),u==="chat"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx(Kt,{isOpen:!0,onClose:()=>{}})}),u==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ae,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(It,{})]}),u==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(os,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(qt,{isOpen:fs,onClose:()=>b(!1)}),e.jsx(Qt,{notification:bs,onClose:Ms,soundEnabled:z.soundAlerts,onToggleSound:ks})]})},Va=()=>{const n=Ws(),{user:a,loading:l}=Xs(),[i,c]=o.useState(!1),[m,r]=o.useState(null),[v,u]=o.useState(!1),[N,b]=o.useState("users"),[C,j]=o.useState(0),[g,p]=o.useState([]),[h,P]=o.useState([]),[O,E]=o.useState(!1),[V,ee]=o.useState(null),[k,U]=o.useState([]),[d,S]=o.useState({});o.useEffect(()=>{const T=localStorage.getItem("admin_dev_mode")==="true";c(T)},[]),o.useEffect(()=>{if(!(!i&&!a)){u(!0),r(null);try{const T=G(B(A,"users")),_=Ce(T,I=>{const $=I.docs.map(z=>({id:z.id,...z.data()}));U($),u(!1),r(null)},I=>{console.error("Error loading users:",I),i?(U([]),u(!1),r(null)):(r("فشل في تحميل بيانات المستخدمين"),u(!1))});return()=>_()}catch(T){console.error("Error setting up users listener:",T),i?(U([]),u(!1),r(null)):(r("فشل في إعداد مراقب البيانات"),u(!1))}}},[a,i]),o.useEffect(()=>{if(!(!i&&!a))try{const T=G(B(A,"profiles")),_=Ce(T,I=>{const $={};I.forEach(z=>{$[z.id]=z.data()}),S($)},I=>{console.error("Error loading profiles:",I)});return()=>_()}catch(T){console.error("Error setting up profiles listener:",T)}},[a,i]),o.useEffect(()=>{const T=k.map(_=>{const I=d[_.id]||{},$=typeof I.fullName=="string"?I.fullName:void 0,z=typeof I.phone=="string"?I.phone:void 0,ke=typeof _.displayName=="string"&&_.displayName.trim()?_.displayName:$||_.displayName||void 0;return{..._,displayName:ke,phone:_.phone??z??null}});p(T),P(T)},[k,d]);const M=T=>{console.log("Notification center:",T)},R=T=>{console.log("Notification settings:",T)},L=T=>{console.log("Notifications:",T)},xe=T=>{console.log("Editing plan:",T)};o.useEffect(()=>{(async()=>{try{const T=await xs();ee(T)}catch(T){console.warn("Failed to load last update info:",T),ee(null)}})()},[]);const H=async()=>{try{return await St()}catch(T){return console.error("Error loading content:",T),{}}},le=async T=>{try{E(!0);try{localStorage.setItem("siteContent_plans_cache",JSON.stringify(T))}catch{}await Tt(T,(a==null?void 0:a.uid)||"admin");const _=await xs();return ee(_),!0}catch(_){return console.error("Error saving content:",_),!1}finally{E(!1)}};return l?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):e.jsx(Xt,{navigate:n,auth:Js,devMode:i,setDevMode:c,error:m,setError:r,authLoading:l,setAuthLoading:()=>{},activeTab:N,setActiveTab:b,setNotificationCenterOpen:M,setNotificationSettings:R,setNotifications:L,notificationCount:C,setNotificationCount:j,users:g,setUsers:p,filteredUsers:h,setFilteredUsers:P,loading:v,setLoading:u,setEditingPlan:xe,isSavingContent:O,setIsSavingContent:E,lastUpdateInfo:V,loadContentFromFirebase:H,saveContentToFirebase:le})};export{Va as default};
