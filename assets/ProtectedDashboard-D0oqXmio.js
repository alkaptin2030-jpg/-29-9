import{d as X,u as q,I as G,r as s,j as e,J as M,K as Q,C as Y,H as W,i as J,k as R,n as Z,p as ee,O as te,a as se}from"./index-DBCfkQ6B.js";import{C as d,a as m,b as u,d as x}from"./card-C9sEKIdK.js";import{B as _}from"./button-B6KX4ziW.js";import{I as E}from"./input-ujcKxSfi.js";import{B as ae}from"./badge-CweJyfao.js";import{S as ne,a as le,b as ce,c as re,d as $}from"./select-mEa3gIFz.js";import{D as U}from"./dollar-sign-CO5AEh_T.js";import{W as oe}from"./wallet-DvCtsCgP.js";import{C as ie}from"./circle-check-big-E2gyd2JE.js";import{C as de}from"./circle-x-Df7mIiIp.js";import"./index-CpxectR0.js";import"./Combination-DiR0Pm5F.js";import"./check-DQAs4oR-.js";const me=()=>{const{toast:o}=X(),{signOut:B,user:n,profile:h}=q();G();const[f,I]=s.useState("01030302038"),[g,p]=s.useState(""),[r,y]=s.useState(""),[j,F]=s.useState("transfer"),[b,A]=s.useState([]);s.useState("all"),s.useState(!1);const[H,ue]=s.useState(""),[L,xe]=s.useState([]);s.useState(null),s.useState(!1),s.useState([]),s.useState([]),s.useState(!1),s.useState("daily");const[he,K]=s.useState([]),[w,N]=s.useState(0),[T,S]=s.useState({});s.useState(!1),s.useState(!1),s.useState(!1),s.useState(!1),s.useState(!1),s.useState(""),s.useState(!1);const[V,P]=s.useState(!1),C=async t=>{if(n)try{const a=await W.getById(n.uid);if(a!=null&&a.shopId){const l=J(R,"dashboardData",a.shopId);await te(l,t)}}catch(a){console.error("Error saving to Firebase:",a),o({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ البيانات في Firebase",variant:"destructive"})}};s.useEffect(()=>{if(!n)return;(async()=>{P(!0);try{const a=await W.getById(n.uid);if(a!=null&&a.shopId){const l=J(R,"dashboardData",a.shopId),i=await Z(l);if(i.exists()){const c=i.data();N(c.cashBalance||0),S(c.walletBalances||{"wallet-1":5e3,"wallet-2":3e3}),K(c.deletedTransactions||[])}else{const c={cashBalance:0,walletBalances:{"wallet-1":5e3,"wallet-2":3e3},deletedTransactions:[]};await ee(l,c),N(c.cashBalance),S(c.walletBalances),K(c.deletedTransactions)}}}catch(a){console.error("Error loading data from Firebase:",a);const l=`cashBalance_${(n==null?void 0:n.uid)||"default"}`,i=`walletBalances_${(n==null?void 0:n.uid)||"default"}`,c=localStorage.getItem(l);c&&N(parseFloat(c));const v=localStorage.getItem(i);S(v?JSON.parse(v):{"wallet-1":5e3,"wallet-2":3e3})}finally{P(!1)}})()},[n]),s.useEffect(()=>{try{const t=`cashBalance_${(n==null?void 0:n.uid)||"default"}`;localStorage.setItem(t,String(w||0))}catch{}},[w,n==null?void 0:n.uid]),s.useEffect(()=>{try{const t=`walletBalances_${(n==null?void 0:n.uid)||"default"}`;localStorage.setItem(t,JSON.stringify(T||{}))}catch{}},[T,n==null?void 0:n.uid]);const z=async t=>{if(t.preventDefault(),j==="transfer"){if(!f||!g||!r){o({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const a=(h==null?void 0:h.shopName)||(n==null?void 0:n.displayName)||"محل كاشي لينك",l=L.find(D=>D.id===H)||L.find(D=>D.isDefault),i={id:Date.now().toString(),type:"send",senderPhone:f,receiverPhone:g,amount:parseFloat(r),status:"pending",createdAt:new Date,withdrawnAmount:0,sentAmount:parseFloat(r),merchantShopName:a,shopName:(l==null?void 0:l.name)||"المحفظة الرئيسية"},c=[i,...b];A(c),await C({transactions:c});const v=parseFloat(r)*.02,k=w-v;N(k),await C({cashBalance:k}),o({title:"تم إرسال التحويل",description:"جاري معالجة التحويل..."}),setTimeout(async()=>{const O=[{...i,status:"completed"},...b];A(O),await C({transactions:O})},2e3),I("01030302038"),p(""),y("")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-center",children:"جاري تحميل البيانات..."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"لوحة تحكم الإدارة"}),e.jsxs(_,{onClick:B,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"تسجيل الخروج"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"الرصيد النقدي"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[w.toLocaleString()," جنيه"]})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"الأرصدة علي المحافظ"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[Object.values(T).reduce((t,a)=>t+a,0).toLocaleString()," جنيه"]})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"المعاملات اليوم"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:b.length})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"إجمالي اليوم"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[b.reduce((t,a)=>t+a.amount,0).toLocaleString()," جنيه"]})})]})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(u,{children:"إجراء معاملة جديدة"})}),e.jsx(x,{children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نوع المعاملة"}),e.jsxs(ne,{value:j,onValueChange:t=>F(t),children:[e.jsx(le,{children:e.jsx(ce,{})}),e.jsxs(re,{children:[e.jsx($,{value:"transfer",children:"تحويل"}),e.jsx($,{value:"withdraw",children:"سحب"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المرسل"}),e.jsx(E,{type:"tel",value:f,onChange:t=>I(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const a=document.getElementById("receiverPhoneInput");if(a)a.focus();else{const l=document.getElementById("amountInput");l==null||l.focus()}}},placeholder:"01xxxxxxxxx"})]}),j==="transfer"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المستقبل"}),e.jsx(E,{id:"receiverPhoneInput",type:"tel",value:g,onChange:t=>p(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const a=document.getElementById("amountInput");a==null||a.focus()}},placeholder:"01xxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"المبلغ"}),e.jsx(E,{id:"amountInput",type:"number",value:r,onChange:t=>y(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const a=document.getElementById("txSubmitButton");a==null||a.focus()}},placeholder:"0.00"})]})]}),e.jsx(_,{id:"txSubmitButton",type:"submit",className:"w-full",children:j==="transfer"?"إرسال التحويل":"تنفيذ السحب"})]})})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(u,{children:"المعاملات الأخيرة"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4 max-h-[320px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:b.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="completed"&&e.jsx(ie,{className:"h-5 w-5 text-green-500"}),t.status==="pending"&&e.jsx(Y,{className:"h-5 w-5 text-yellow-500"}),t.status==="failed"&&e.jsx(de,{className:"h-5 w-5 text-red-500"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[t.type==="send"?"تحويل":"سحب"," - ",t.amount.toLocaleString()," جنيه"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["من ",t.senderPhone," إلى ",t.receiverPhone]})]})]}),e.jsx(ae,{variant:t.status==="completed"?"default":t.status==="pending"?"secondary":"destructive",children:t.status==="completed"?"مكتمل":t.status==="pending"?"قيد المعالجة":"فشل"})]},t.id))})})]})]})]})},Te=()=>{const o=se(),[B,n]=s.useState(!1),[h,f]=s.useState(!0);return s.useEffect(()=>{(()=>{const g=localStorage.getItem("dashboardAuth"),p=localStorage.getItem("dashboardUser");if(g==="true"&&p)try{const r=JSON.parse(p),y=new Date(r.loginTime);(new Date().getTime()-y.getTime())/(1e3*60*60)<24?n(!0):(localStorage.removeItem("dashboardAuth"),localStorage.removeItem("dashboardUser"),o("/dashboard/login"))}catch(r){console.error("Error parsing user data:",r),o("/dashboard/login")}else o("/dashboard/login");f(!1)})()},[o]),h?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):B?e.jsx(me,{}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})})};export{Te as default};
