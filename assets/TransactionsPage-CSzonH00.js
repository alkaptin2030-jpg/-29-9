const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-Bn7ZiDM3.js","./index-CMr4Oi63.js","./index-BOMJnd04.css","./walletDailyLimitsService-0xjNslf8.js","./profitService-DZQLszRg.js"])))=>i.map(i=>d[i]);
import{O as Et,r as m,a3 as Ps,j as t,_ as ks,a0 as Ee,a1 as $e,aq as Os,W as Ze,u as It,B as D,w as Dt,C as Xe,S as U,ap as Ge,aP as j,a as Es,R as de,aQ as Is,aa as Ls,y as H,i as k,z as ee,q as z,h as $,al as M,k as te,aR as _s,o as Ms,aw as G,aS as me,Y as Ws,a9 as Ve,P as se,I as qe,aT as Bs,ao as At,aU as Fs,aV as Us,f as He,aW as St,a8 as X,Q as De}from"./index-CMr4Oi63.js";import{C as zs,a as $s,b as Gs,d as Vs}from"./card-OPazuP08.js";import{D as Re,a as Pe,b as ke,c as Oe,e as qs}from"./dialog-BqmsXYmq.js";import{u as Hs,S as Xs,a as Ys,b as Zs,c as Js,d as Ae}from"./select-BNThciT7.js";import{B as Se}from"./badge-BE93kY55.js";import{c as Lt,R as Ks,I as Qs}from"./index-CeFZWSbA.js";import{u as ea}from"./Combination-TjOtKNsl.js";import{A as Rt,a as Pt,C as ta,b as sa,f as W,M as aa,c as ra,R as na,I as oa}from"./MaintenanceDialog-BUgYt8vg.js";import{M as Ye,P as ia}from"./MasterPinDialog-D1NM4cce.js";import{r as kt,P as pe}from"./profitService-DZQLszRg.js";import{D as la}from"./dollar-sign-H3syPBeb.js";import{C as _t}from"./calendar-BYCE6wLZ.js";import{A as ca}from"./arrow-left-Bz3Pvwao.js";import{S as da}from"./separator-DckENC5w.js";import{T as Ot}from"./progress-BgUXyrzN.js";import{C as ma}from"./circle-x-CWSqtEpz.js";import{C as pa}from"./circle-check-big-CFmkrR2f.js";import"./index-DoNR_1Mu.js";import"./whatsappService-xAazA0rf.js";import"./download-BD1sYLif.js";import"./label-B7SL5F9X.js";import"./circle-alert-3uX3buCB.js";import"./shield-DFDtw70V.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=Et("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=Et("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);var Ie="Tabs",[xa]=ks(Ie,[Lt]),Mt=Lt(),[fa,Je]=xa(Ie),Wt=m.forwardRef((g,s)=>{const{__scopeTabs:f,value:p,onValueChange:P,defaultValue:O,orientation:S="horizontal",dir:B,activationMode:I="automatic",...R}=g,N=Hs(B),[T,_]=Ps({prop:p,onChange:P,defaultProp:O??"",caller:Ie});return t.jsx(fa,{scope:f,baseId:ea(),value:T,onValueChange:_,orientation:S,dir:N,activationMode:I,children:t.jsx(Ee.div,{dir:N,"data-orientation":S,...R,ref:s})})});Wt.displayName=Ie;var Bt="TabsList",Ft=m.forwardRef((g,s)=>{const{__scopeTabs:f,loop:p=!0,...P}=g,O=Je(Bt,f),S=Mt(f);return t.jsx(Ks,{asChild:!0,...S,orientation:O.orientation,dir:O.dir,loop:p,children:t.jsx(Ee.div,{role:"tablist","aria-orientation":O.orientation,...P,ref:s})})});Ft.displayName=Bt;var Ut="TabsTrigger",zt=m.forwardRef((g,s)=>{const{__scopeTabs:f,value:p,disabled:P=!1,...O}=g,S=Je(Ut,f),B=Mt(f),I=Vt(S.baseId,p),R=qt(S.baseId,p),N=p===S.value;return t.jsx(Qs,{asChild:!0,...B,focusable:!P,active:N,children:t.jsx(Ee.button,{type:"button",role:"tab","aria-selected":N,"aria-controls":R,"data-state":N?"active":"inactive","data-disabled":P?"":void 0,disabled:P,id:I,...O,ref:s,onMouseDown:$e(g.onMouseDown,T=>{!P&&T.button===0&&T.ctrlKey===!1?S.onValueChange(p):T.preventDefault()}),onKeyDown:$e(g.onKeyDown,T=>{[" ","Enter"].includes(T.key)&&S.onValueChange(p)}),onFocus:$e(g.onFocus,()=>{const T=S.activationMode!=="manual";!N&&!P&&T&&S.onValueChange(p)})})})});zt.displayName=Ut;var $t="TabsContent",Gt=m.forwardRef((g,s)=>{const{__scopeTabs:f,value:p,forceMount:P,children:O,...S}=g,B=Je($t,f),I=Vt(B.baseId,p),R=qt(B.baseId,p),N=p===B.value,T=m.useRef(N);return m.useEffect(()=>{const _=requestAnimationFrame(()=>T.current=!1);return()=>cancelAnimationFrame(_)},[]),t.jsx(Os,{present:P||N,children:({present:_})=>t.jsx(Ee.div,{"data-state":N?"active":"inactive","data-orientation":B.orientation,role:"tabpanel","aria-labelledby":I,hidden:!_,id:R,tabIndex:0,...S,ref:s,style:{...g.style,animationDuration:T.current?"0s":void 0},children:_&&O})})});Gt.displayName=$t;function Vt(g,s){return`${g}-trigger-${s}`}function qt(g,s){return`${g}-content-${s}`}var ga=Wt,Ht=Ft,Xt=zt,Yt=Gt;const ba=ga,Zt=m.forwardRef(({className:g,...s},f)=>t.jsx(Ht,{ref:f,className:Ze("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",g),...s}));Zt.displayName=Ht.displayName;const ue=m.forwardRef(({className:g,...s},f)=>t.jsx(Xt,{ref:f,className:Ze("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",g),...s}));ue.displayName=Xt.displayName;const he=m.forwardRef(({className:g,...s},f)=>t.jsx(Yt,{ref:f,className:Ze("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",g),...s}));he.displayName=Yt.displayName;const ya=({userId:g,transactions:s=[]})=>{const[f,p]=m.useState(!1),[P,O]=m.useState(!1),[S,B]=m.useState(!1),[I,R]=m.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:N}=It();m.useEffect(()=>{g&&f&&S&&Le()},[g,f,S]);const T=v=>`${v.toFixed(2)} ج.م`,_=async()=>{try{const v=(N==null?void 0:N.subscription)||null,u=(v==null?void 0:v.planType)??(v==null?void 0:v.plan)??null,w=typeof u=="string"?u.toLowerCase():null;if(u===U.ZERO||w==="zero"||w==="0"||u===0)return!0}catch{}try{if(g){const v=await Ge(g),u=(v==null?void 0:v.planType)??(v==null?void 0:v.plan)??null,w=typeof u=="string"?u.toLowerCase():null;if(u===U.ZERO||w==="zero"||w==="0"||u===0)return!0}}catch{}return!1},ae=async()=>{try{const v=await(async()=>{try{const u=(N==null?void 0:N.subscription)||null,w=(u==null?void 0:u.planType)??(u==null?void 0:u.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===U.TAHWEELA||F==="tahweela")return!0}catch{}try{if(g){const u=await Ge(g),w=(u==null?void 0:u.planType)??(u==null?void 0:u.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===U.TAHWEELA||F==="tahweela")return!0}}catch{}return!1})();if(await _()||v){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}O(!0)},re=async()=>{try{const v=await(async()=>{try{const u=(N==null?void 0:N.subscription)||null,w=(u==null?void 0:u.planType)??(u==null?void 0:u.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===U.TAHWEELA||F==="tahweela")return!0}catch{}try{if(g){const u=await Ge(g),w=(u==null?void 0:u.planType)??(u==null?void 0:u.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===U.TAHWEELA||F==="tahweela")return!0}}catch{}return!1})();if(await _()||v){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),O(!1);return}}catch{}B(!0),p(!0),O(!1)},Le=async()=>{if(g)try{if(Array.isArray(s)&&s.length>0){const u=new Date,w=u.getMonth(),F=u.getFullYear(),_e=kt.filterVisibleTransactions(s,"daily",g),Y=kt.filterVisibleTransactions(s,"monthly",g);let ne=0,V=0,xe=0,q=0;_e.forEach(L=>{const oe=new Date(L.createdAt),Z=String(L.status||"confirmed").toLowerCase();if(oe.toDateString()!==u.toDateString()||Z!=="completed"&&Z!=="confirmed")return;const J=(L.type||L.txnType||"").toLowerCase(),E={type:J==="withdrawal"?"withdraw":J,amount:Number(L.amount||0),commission:L.commission};E.type==="withdraw"?ne+=pe.calculateProfitFromTransaction(E):(E.type==="send"||E.type==="receive"||E.type==="transfer")&&(V+=pe.calculateProfitFromTransaction(E))}),Y.forEach(L=>{const oe=new Date(L.createdAt),Z=String(L.status||"confirmed").toLowerCase();if(oe.getMonth()!==w||oe.getFullYear()!==F||Z!=="completed"&&Z!=="confirmed")return;const J=(L.type||L.txnType||"").toLowerCase(),E={type:J==="withdrawal"?"withdraw":J,amount:Number(L.amount||0),commission:L.commission};E.type==="withdraw"?xe+=pe.calculateProfitFromTransaction(E):(E.type==="send"||E.type==="receive"||E.type==="transfer")&&(q+=pe.calculateProfitFromTransaction(E))}),R({dailyWithdraw:Math.round(ne*100)/100,dailyTransfer:Math.round(V*100)/100,monthlyWithdraw:Math.round(xe*100)/100,monthlyTransfer:Math.round(q*100)/100,lastUpdated:new Date});return}const v=pe.getWithdrawTransferProfits(g);R({dailyWithdraw:v.dailyWithdrawProfit||0,dailyTransfer:v.dailyTransferProfit||0,monthlyWithdraw:v.monthlyWithdrawProfit||0,monthlyTransfer:v.monthlyTransferProfit||0,lastUpdated:new Date})}catch(v){console.error("Error loading total profits:",v)}};return t.jsxs(t.Fragment,{children:[t.jsx(D,{size:"sm",variant:"ghost",onClick:ae,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(Dt,{className:"h-1.5 w-1.5"})}),t.jsx(Re,{open:f,onOpenChange:p,children:t.jsxs(Pe,{className:"max-w-[240px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(ke,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200",children:t.jsxs(Oe,{className:"text-xs font-bold text-purple-800 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(la,{className:"h-2 w-2 text-purple-600 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 p-1 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Xe,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900",children:T((I.dailyWithdraw??0)+(I.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:T(I.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-0.5 rounded border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Pt,{className:"h-2 w-2 text-green-600"}),t.jsx("span",{className:"text-[10px] text-green-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700",children:T(I.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-1 rounded border border-purple-200 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(_t,{className:"h-2 w-2 text-purple-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900",children:T((I.monthlyWithdraw??0)+(I.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:T(I.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-0.5 rounded border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Pt,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] text-blue-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700",children:T(I.monthlyTransfer)})]})]})]})]}),!S&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>O(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(Dt,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(D,{onClick:()=>p(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(Ye,{open:P,onOpenChange:O,onSuccess:re,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},va=g=>t.jsx(ya,{...g}),Xa=()=>{var gt,bt,yt,vt,jt,Nt,wt,Tt,Ct;const g=Es(),{user:s,profile:f,userSubscription:p}=It(),P=de.useMemo(()=>{var r,o,n,a;const e=((r=p==null?void 0:p.subscription)==null?void 0:r.planType)??((o=p==null?void 0:p.subscription)==null?void 0:o.plan)??((n=f==null?void 0:f.subscription)==null?void 0:n.planType)??((a=f==null?void 0:f.subscription)==null?void 0:a.plan)??null;return e===U.ZERO||String(e).toLowerCase()==="zero"},[(gt=p==null?void 0:p.subscription)==null?void 0:gt.planType,(bt=p==null?void 0:p.subscription)==null?void 0:bt.plan,(yt=f==null?void 0:f.subscription)==null?void 0:yt.planType,(vt=f==null?void 0:f.subscription)==null?void 0:vt.plan]),O=de.useMemo(()=>{var r,o,n,a;const e=((r=p==null?void 0:p.subscription)==null?void 0:r.planType)??((o=p==null?void 0:p.subscription)==null?void 0:o.plan)??((n=f==null?void 0:f.subscription)==null?void 0:n.planType)??((a=f==null?void 0:f.subscription)==null?void 0:a.plan)??null;return e===U.TAHWEELA||String(e).toLowerCase()==="tahweela"},[(jt=p==null?void 0:p.subscription)==null?void 0:jt.planType,(Nt=p==null?void 0:p.subscription)==null?void 0:Nt.plan,(wt=f==null?void 0:f.subscription)==null?void 0:wt.planType,(Tt=f==null?void 0:f.subscription)==null?void 0:Tt.plan]),{shopName:S}=Is(),{isShiftActive:B,shiftUser:I}=Ls(),[R,N]=m.useState([]),[T,_]=m.useState([]),[ae,re]=m.useState(new Set),[Le,v]=m.useState(!1),[u,w]=m.useState(null),[F,_e]=m.useState("all"),[Y,ne]=m.useState(""),[V,xe]=m.useState(""),[q,L]=m.useState(""),[oe,Z]=m.useState(!1),[J,E]=m.useState(!1),[Jt,Ke]=m.useState(!1),[Kt,Qe]=m.useState(!1),[et,tt]=m.useState(""),[Qt,st]=m.useState("شرح التطبيق"),[ja,at]=m.useState(null),[ie,es]=m.useState(null),[ts,fe]=m.useState(!1);de.useEffect(()=>{var r;((r=p==null?void 0:p.subscription)==null?void 0:r.planType)===U.TAHWEELA&&(j({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),g("/user/dashboard"))},[(Ct=p==null?void 0:p.subscription)==null?void 0:Ct.planType]);const[Na,ss]=m.useState(!1),[wa,as]=m.useState(!1),[Ta,rs]=m.useState(!1),[ns,Me]=m.useState(!1),[os,rt]=m.useState(!1),[is,nt]=m.useState(!1),[ls,We]=m.useState(!1),[cs,ds]=m.useState(null),[ms,ge]=m.useState(!1),[Q,be]=m.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});m.useEffect(()=>{(async()=>{if(s!=null&&s.uid)try{const r=await G.getUserData(s.uid),o=(r==null?void 0:r.recentReset)||{},n=Number(o==null?void 0:o.keepLastCount)>0?Number(o.keepLastCount):30,a=Number(o==null?void 0:o.intervalDays)>0?Number(o.intervalDays):7,d=c=>c instanceof Date?c:typeof(c==null?void 0:c.toDate)=="function"?c.toDate():c?new Date(String(c)):null,h=o!=null&&o.lastResetAt?d(o.lastResetAt):null,l=new Date;!h||l.getTime()-h.getTime()>=a*24*60*60*1e3?(await G.updateUserData(s.uid,{recentReset:{keepLastCount:n,intervalDays:a,lastResetAt:l}}),be({keepLastCount:n,intervalDays:a,lastResetAt:l})):be({keepLastCount:n,intervalDays:a,lastResetAt:h})}catch{be({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[s==null?void 0:s.uid]),m.useEffect(()=>{if(!(s!=null&&s.uid))return;const e=H(k,"users",s.uid),r=ee(e,o=>{try{const n=o.exists()?o.data():{},a=n==null?void 0:n.tutorialSeenAt,d=a!=null&&a.toDate?a.toDate():a?new Date(a):null;es(d)}catch{}});return()=>r()},[s==null?void 0:s.uid]),m.useEffect(()=>{const e=ee(H(k,"app_guides","latest"),r=>{try{const o=r.exists()?r.data():null;if(!o){tt(""),st(""),at(null),fe(!1);return}const n=String(o.url||""),a=String(o.title||"شرح التطبيق"),d=o.publishedAt,h=d!=null&&d.toDate?d.toDate():d?new Date(d):new Date;tt(n),st(a),at(h),fe(h?!ie||h.getTime()>((ie==null?void 0:ie.getTime())||0):!1)}catch{fe(!1)}},r=>{console.warn("فشل الاشتراك في دليل التطبيق:",r)});return()=>e()},[ie]);const ps=e=>{try{const r=new URL(e);let o="";return r.hostname.includes("youtube.com")?r.pathname==="/watch"?o=r.searchParams.get("v")||"":(r.pathname.startsWith("/embed/")||r.pathname.startsWith("/shorts/"))&&(o=r.pathname.split("/").pop()||""):r.hostname==="youtu.be"&&(o=r.pathname.replace(/^\//,"")),o?`https://www.youtube.com/embed/${o}?autoplay=1&rel=0`:e}catch{return e}},us=async()=>{Qe(!0);try{s!=null&&s.uid&&await G.updateUserData(s.uid,{tutorialSeenAt:new Date}),fe(!1)}catch{}},[hs,ye]=m.useState(!1),[ve,ot]=m.useState(""),[le,it]=m.useState(""),[je,lt]=m.useState(""),[ct,dt]=m.useState(!1),[mt,Ne]=m.useState(0);m.useEffect(()=>{if(!(s!=null&&s.uid)){Ne(0);return}const e=H(k,"users",s.uid),r=ee(e,o=>{try{const n=o.exists()?o.data():{},d=(Array.isArray(n==null?void 0:n.debts)?n.debts:[]).filter(h=>(h==null?void 0:h.status)==="pending"&&(Number(h==null?void 0:h.amount)||0)>0).length;Ne(d)}catch{Ne(0)}},o=>{console.warn("فشل الاشتراك في ديون المستخدم من Firestore:",o),Ne(0)});return()=>r()},[s==null?void 0:s.uid]),m.useEffect(()=>{xs(),fs()},[s]),m.useEffect(()=>{(async()=>{try{if(!(s!=null&&s.uid)){re(new Set);return}const e=z($(k,"deletedTransactions"),M("userId","==",s.uid),M("permanent","==",!0)),o=(await te(e)).docs.flatMap(n=>{const a=n.data();return[a.originalTransactionId,a.transactionId,a.reference,n.id].filter(Boolean).map(String)});re(new Set(o))}catch{re(new Set)}})()},[s==null?void 0:s.uid]),m.useEffect(()=>{(async()=>{try{if(!(s!=null&&s.uid))return;const r=new Date;if(r.getDate()!==1)return;const o=`${r.getFullYear()}-${r.getMonth()+1}`,n=`lastMonthlyDbCleanup:${s.uid}`;if(localStorage.getItem(n)===o)return;const d=new Date(r.getFullYear(),r.getMonth(),1,0,0,0,0),h=c=>c instanceof Date?c:typeof(c==null?void 0:c.toDate)=="function"?c.toDate():new Date(String(c));let l=[];try{const c=z($(k,"userTransactions"),M("userId","==",s.uid),M("createdAt","<",d));l=(await te(c)).docs}catch{const c=z($(k,"userTransactions"),M("userId","==",s.uid));l=(await te(c)).docs.filter(b=>{var y;return h((y=b.data())==null?void 0:y.createdAt)<d})}await Promise.allSettled(l.map(c=>St(c.ref)));let i=[];try{const c=z($(k,"transactions"),M("userId","==",s.uid),M("createdAt","<",d));i=(await te(c)).docs}catch{const c=z($(k,"transactions"),M("userId","==",s.uid));i=(await te(c)).docs.filter(b=>{var y;return h((y=b.data())==null?void 0:y.createdAt)<d})}await Promise.allSettled(i.map(c=>St(c.ref)));try{localStorage.setItem(n,o)}catch{}console.log("✅ تنظيف شهري (TransactionsPage):",{userTransactionsDeleted:l.length,globalTransactionsDeleted:i.length,monthStart:d})}catch(r){console.error("فشل التنظيف الشهري التلقائي (TransactionsPage):",r)}})()},[s==null?void 0:s.uid]),m.useEffect(()=>{if(!(s!=null&&s.uid))return;let e=null,r=!1;const o=a=>{const h=a.map(l=>{const i=l.data(),c=i==null?void 0:i.createdAt,x=c!=null&&c.toDate?c.toDate():c instanceof Date?c:new Date(c);return{id:l.id,...i,createdAt:x}}).filter(l=>(l==null?void 0:l.status)!=="cancelled"&&!(l!=null&&l.isDeleted)).filter(l=>!((l==null?void 0:l.type)==="report"||((l==null?void 0:l.title)||"").includes("إيصال تسليم وردية"))).sort((l,i)=>{const c=l.createdAt?new Date(l.createdAt).getTime():0;return(i.createdAt?new Date(i.createdAt).getTime():0)-c}).filter(l=>{const i=String(l.id||""),c=String(l.transactionId||""),x=String(l.reference||l.transactionReference||"");return!ae.has(i)&&(!c||!ae.has(c))&&(!x||!ae.has(x))});N(h.map(Fe))},n=()=>{const a=z($(k,"userTransactions"),M("userId","==",s.uid));e=ee(a,d=>{try{o(d.docs)}catch(h){console.error("خطأ في معالجة بيانات الاشتراك الاحتياطي:",h)}},d=>{console.error("خطأ في الاشتراك الاحتياطي لمعاملات المستخدم:",d)})};(async()=>{try{const a=z($(k,"userTransactions"),M("userId","==",s.uid)),d=await _s(a);if(d&&d.docs&&d.docs.length>0)try{o(d.docs)}catch{}}catch{}})();try{let a=z($(k,"userTransactions"),M("userId","==",s.uid),Ms("createdAt","desc"),limit(200));try{e=ee(a,{includeMetadataChanges:!0},d=>{try{o(d.docs)}catch(h){console.error("خطأ في معالجة بيانات الاشتراك:",h)}},d=>{if(console.error("خطأ في الاشتراك لمعاملات المستخدم:",d),!r){r=!0;try{e&&e()}catch{}n()}})}catch{const h=z($(k,"userTransactions"),M("userId","==",s.uid));e=ee(h,l=>{try{o(l.docs)}catch{}},l=>{console.error("خطأ في الاشتراك البسيط لمعاملات المستخدم:",l),r||(r=!0,n())})}}catch(a){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم، بدء السقوط الاحتياطي:",a),n()}return()=>{try{e&&e()}catch{}}},[s==null?void 0:s.uid]);const xs=async()=>{try{if(!s)return;const e=z($(k,"deletedTransactions"),M("userId","==",s.uid),M("permanent","==",!0)),[r,o,n]=await Promise.all([G.getUserTransactions(s.uid).catch(()=>[]),G.getByUserId(s.uid).catch(()=>[]),te(e).then(i=>i.docs.flatMap(c=>{const x=c.data();return[x.originalTransactionId,x.transactionId,x.reference,c.id].filter(Boolean).map(String)})).catch(()=>[])]),a=Array.isArray(r)&&r.length>0?r:Array.isArray(o)?o:[],d=new Set(n),l=(a||[]).map(i=>({...i,createdAt:i.createdAt instanceof Date?i.createdAt:new Date(i.createdAt)})).filter(i=>!((i==null?void 0:i.type)==="report"||((i==null?void 0:i.title)||"").includes("إيصال تسليم وردية"))).filter(i=>{const c=String(i.id||""),x=String(i.transactionId||""),b=String(i.reference||i.transactionReference||"");return!d.has(c)&&(!x||!d.has(x))&&(!b||!d.has(b))});N(l.map(Fe))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),j({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},fs=async()=>{try{if(!s)return;const r=(await me.getDeletedTransactionsByUser(s.uid)).map(o=>({...o,createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)}));_(r.map(Fe))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),j({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},ce=de.useMemo(()=>{const e=Q.keepLastCount??30;return[...R].sort((o,n)=>n.createdAt.getTime()-o.createdAt.getTime()).slice(0,e)},[R,Q.keepLastCount]),gs=de.useMemo(()=>Math.max(0,((R==null?void 0:R.length)||0)-(Q.keepLastCount||30)),[R==null?void 0:R.length,Q.keepLastCount]),pt=ce.filter(e=>{const r=!Y||e.senderPhone.includes(Y)||e.receiverPhone.includes(Y),o=!V||e.createdAt.toDateString()===new Date(V).toDateString(),n=!q||e.createdAt.toTimeString().startsWith(q);return r&&o&&n}),we=(e,r)=>{switch(e){case"completed":return t.jsx(pa,{className:`h-4 w-4 ${r==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(Xe,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(ma,{className:"h-4 w-4 text-red-500"});default:return t.jsx(Xe,{className:"h-4 w-4 text-gray-500"})}},Be=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},Fe=e=>{const r=((e==null?void 0:e.status)??"").toString().toLowerCase(),o=r==="confirmed"||r==="success"||r==="completed"?"completed":r==="failed"||r==="error"||r==="cancelled"||r==="canceled"?"cancelled":"pending",a=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",d=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",h=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",l=e==null?void 0:e.createdAt,i=l instanceof Date?l:l!=null&&l.toDate?l.toDate():new Date(l);return{id:e==null?void 0:e.id,senderPhone:d||"غير معروف",receiverPhone:h||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:o,type:a,createdAt:i,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0}},bs=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:S??(f==null?void 0:f.shopName)??(s==null?void 0:s.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0}),Ue=e=>{const r=bs(e);ds(r),We(!0)},ys=e=>{w(e),v(!0)},vs=async()=>{u&&(await js(u.id),v(!1),w(null))},js=async e=>{try{const r=T.find(a=>a.id===e);if(!r||!s)return;const o=await G.saveUserTransaction(s.uid,{...r,userId:s.uid,status:"completed",cashierName:r.cashierName??"الحساب الرئيسي"});await me.permanentlyDeleteTransaction(e,s.uid);const n={...r,id:o};N(a=>[...a,n]),_(a=>a.filter(d=>d.id!==e)),j({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(r){console.error("خطأ في استرجاع المعاملة من Firestore:",r),j({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},Ns=async e=>{try{if(!s)return;_(r=>r.filter(o=>o.id!==e)),await me.permanentlyDeleteTransaction(e,s.uid),await G.removeUserTransaction(s.uid,e),j({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(r){console.error("فشل الحذف النهائي للمعاملة:",r),j({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ut=async e=>{var r,o,n;try{const a=R.find(x=>x.id===e);if(!a||!s)return;try{const x=(r=p==null?void 0:p.subscription)==null?void 0:r.planType;if(x===U.ZERO){const{dailyOperationCountService:b}=await X(async()=>{const{dailyOperationCountService:A}=await import("./dailyOperationCountService-Bn7ZiDM3.js");return{dailyOperationCountService:A}},__vite__mapDeps([0,1,2]),import.meta.url),y=a.type==="send"?"transfer":"withdraw";if(!(await b.checkAndIncrement(s.uid,y,5)).allowed){j({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(x===U.TAHWEELA){const{dailyOperationCountService:b}=await X(async()=>{const{dailyOperationCountService:A}=await import("./dailyOperationCountService-Bn7ZiDM3.js");return{dailyOperationCountService:A}},__vite__mapDeps([0,1,2]),import.meta.url),y=a.type==="send"?"transfer":"withdraw";if(!(await b.checkAndIncrementCombined(s.uid,y,40)).allowed){j({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(x){console.warn("تعذر التحقق من حد التأكيد اليومي:",x)}const d=await Ve.getById(s.uid);if(!(d!=null&&d.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const h=H(k,"dashboardData",d.shopId),l=await se(h);let i=l.exists()?Number(((o=l.data())==null?void 0:o.cashBalance)||0):0,c=l.exists()?((n=l.data())==null?void 0:n.walletBalances)||{}:{};if(a.type==="withdraw"){const x=a.fromWallet||Object.keys(c)[0],b=Number(a.withdrawnAmount??a.amount??0),y=Number(a.commission??0);if(!!!(a!=null&&a.walletEffectAppliedOnCreation)&&x&&b>0){const A=c[x]||0;c[x]=A+b}i=i-b+y,await De(h,{cashBalance:i,walletBalances:c})}else if(a.type==="send"){const x=Number(a.commission??0),b=Number((a==null?void 0:a.fee)??0),y=Math.max(0,x)+Math.max(0,b);y>0&&(i=i+y,await De(h,{cashBalance:i}))}await De(H(k,"userTransactions",e),{status:"completed",confirmedAt:new Date}),N(x=>x.map(b=>b.id===e?{...b,status:"completed"}:b)),j({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),We(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),j({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ht=async e=>{var r,o;try{const n=R.find(a=>a.id===e);if(!n||!s)return;N(a=>a.filter(d=>d.id!==e)),_(a=>[{...n},...a]);try{let a={};try{const i=await se(H(k,"userTransactions",e));a=i.exists()?i.data():{}}catch{}const d=e,h=String((a==null?void 0:a.transactionId)||(n==null?void 0:n.transactionId)||d),l=String((a==null?void 0:a.reference)||(a==null?void 0:a.transactionReference)||(n==null?void 0:n.reference)||(n==null?void 0:n.transactionReference)||"");await G.removeUserTransaction(s.uid,e),await me.saveDeletedTransaction({...n,userId:s.uid,originalTransactionId:e,transactionId:h,reference:l||void 0,permanent:!0});try{await me.permanentlyDeleteTransaction(e,s.uid)}catch{}}catch(a){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",a)}try{const a=await Ve.getById(s.uid);if(!(a!=null&&a.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const d=H(k,"dashboardData",a.shopId),h=await se(d);let l=h.exists()?Number(((r=h.data())==null?void 0:r.cashBalance)||0):0,i=h.exists()?((o=h.data())==null?void 0:o.walletBalances)||{}:{};const c=Number(n.withdrawnAmount??n.amount??0),x=Number(n.commission??0),b=n.fromWallet||Object.keys(i)[0],y=!!(n!=null&&n.walletEffectAppliedOnCreation);if(n.type==="send"){const C=Number(n.fee??0),A=Number((n==null?void 0:n.sentAmount)??(n==null?void 0:n.transferredAmount)??n.amount??0);if(n.status==="completed"&&(l=l-(A+x+C)),b&&A>0){const K=i[b]||0;i[b]=K+A}}else if(n.type==="withdraw"){if(n.status==="completed"){if(l=l+c-x,b&&c>0){const C=i[b]||0;i[b]=C-c}}else if(b&&y&&c>0){const C=i[b]||0;i[b]=C-c}}await De(d,{cashBalance:l,walletBalances:i})}catch(a){console.warn("فشل عكس تأثير الأرصدة محليًا:",a)}try{const a=n.fromWallet;if(a){const{walletDailyLimitsService:d}=await X(async()=>{const{walletDailyLimitsService:l}=await import("./walletDailyLimitsService-0xjNslf8.js");return{walletDailyLimitsService:l}},__vite__mapDeps([3,1,2]),import.meta.url),h=await d.getWalletLimits(a);if(h){const l=n.type==="send",i={updatedAt:(await X(async()=>{const{serverTimestamp:C}=await import("./index-CMr4Oi63.js").then(A=>A.bo);return{serverTimestamp:C}},__vite__mapDeps([1,2]),import.meta.url)).serverTimestamp()};l?(i.dailyTransferUsed=Math.max(0,(h.dailyTransferUsed||0)-n.amount),i.monthlyTransferUsed=Math.max(0,(h.monthlyTransferUsed||0)-n.amount)):(i.dailyWithdrawUsed=Math.max(0,(h.dailyWithdrawUsed||0)-n.amount),i.monthlyWithdrawUsed=Math.max(0,(h.monthlyWithdrawUsed||0)-n.amount));const{doc:c,setDoc:x}=await X(async()=>{const{doc:C,setDoc:A}=await import("./index-CMr4Oi63.js").then(K=>K.bo);return{doc:C,setDoc:A}},__vite__mapDeps([1,2]),import.meta.url),{db:b}=await X(async()=>{const{db:C}=await import("./index-CMr4Oi63.js").then(A=>A.bp);return{db:C}},__vite__mapDeps([1,2]),import.meta.url),y=c(b,"walletLimits",a);await x(y,i,{merge:!0})}}}catch(a){console.warn("فشل استرجاع حدود المحفظة:",a)}try{const{ProfitService:a}=await X(async()=>{const{ProfitService:c}=await import("./profitService-DZQLszRg.js").then(x=>x.p);return{ProfitService:c}},__vite__mapDeps([4,1,2]),import.meta.url),{ReportsService:d}=await X(async()=>{const{ReportsService:c}=await import("./profitService-DZQLszRg.js").then(x=>x.a);return{ReportsService:c}},__vite__mapDeps([4,1,2]),import.meta.url),l={txnType:n.type==="send"?"send":"receive",amount:n.amount,commission:n.commission||0,createdAt:n.createdAt,status:"confirmed"},i=a.calculateProfitFromTransaction(l);i>0&&a.addProfit(-i,s.uid);try{d.removeTransactionEffects(n,s.uid)}catch{}}catch(a){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",a)}}catch(n){console.error("خطأ أثناء حذف الإيصال:",n)}},xt=m.useRef(!1),ft=Ws();m.useEffect(()=>{!(new URLSearchParams(ft.search).get("autoTestBalances")==="1")||xt.current||(xt.current=!0,(async()=>{var o,n,a,d,h,l;try{if(!s)return;const i=await Ve.getById(s.uid);if(!(i!=null&&i.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const c=H(k,"dashboardData",i.shopId),x=await se(c),b=x.exists()?Number(((o=x.data())==null?void 0:o.cashBalance)||0):0,y=x.exists()?((n=x.data())==null?void 0:n.walletBalances)||{}:{},C=Object.keys(y)[0]||void 0,A=100,K=5,ze=await G.saveUserTransaction(s.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:A,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:K,withdrawnAmount:A,fromWallet:C,cashierName:"AutoTest",commissionMode:"add",totalCharged:A+K,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",ze),await ut(ze);const Te=await se(c),Ts=Te.exists()?Number(((a=Te.data())==null?void 0:a.cashBalance)||0):0,Cs=Te.exists()?((d=Te.data())==null?void 0:d.walletBalances)||{}:{},Ds=b-A+K,As=C?Number(y[C]||0)+A:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",Ds,"فعلي:",Ts),C&&console.log("autoTest: توقع المحفظة بعد الإكمال:",As,"فعلي:",Cs[C]),await ht(ze);const Ce=await se(c),Ss=Ce.exists()?Number(((h=Ce.data())==null?void 0:h.cashBalance)||0):0,Rs=Ce.exists()?((l=Ce.data())==null?void 0:l.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",b,Ss),C&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",y[C]||0,Rs[C]||0),j({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(i){console.error("autoTest: فشل اختبار الأرصدة:",i),j({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[ft.search,s]);const ws=async()=>{var o,n,a;const e="alkaptin678678@gmail.com",r=(n=(o=He.currentUser)==null?void 0:o.email)==null?void 0:n.toLowerCase();if(!r||r!==e){j({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!ve||!le||!je){j({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}dt(!0);try{const h={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[le]??le,l=new AbortController,i=setTimeout(()=>l.abort(),15e3),c=await((a=He.currentUser)==null?void 0:a.getIdToken()),x=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({phone:ve,countryCode:"EG",operator:h,amount:Number(je),useLocalAmount:!0}),signal:l.signal});clearTimeout(i);const b=await x.text();let y;try{y=JSON.parse(b)}catch{y={success:!1,message:b||"فشل قراءة استجابة الخادم"}}x.ok&&(y!=null&&y.success)?(j({title:"تم الشحن",description:(y==null?void 0:y.message)||"تم تنفيذ عملية الشحن بنجاح"}),ye(!1),ot(""),it(""),lt("")):j({title:"فشل الشحن",description:(y==null?void 0:y.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(d){console.error("Topup request error:",d),(d==null?void 0:d.name)==="AbortError"?j({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):j({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{dt(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>g("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(ca,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(zs,{className:"card-modern fade-in-up",children:[t.jsxs($s,{className:"pb-2 px-3 pt-3",children:[t.jsx(Gs,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(da,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(qe,{placeholder:"بحث...",value:Y,onChange:e=>ne(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:us,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(ha,{className:"h-2.5 w-2.5"}),ts&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(P||O){j({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}E(!0)},title:"إدارة التقسيط",children:t.jsx(Bs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(va,{userId:s==null?void 0:s.uid,transactions:R}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105",onClick:()=>{j({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."})},title:"نافذة شحن سريعة",children:t.jsx(At,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شحن"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Z(!0),title:"آلة حاسبة",children:t.jsx(ta,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(P){j({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}ss(!0)},title:"بيانات المبيعات",children:t.jsx(sa,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(D,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${V||q?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>as(!0),title:"اختيار التاريخ",children:[t.jsx(_t,{className:"h-2.5 w-2.5"}),(V||q)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(P){j({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}Me(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Fs,{className:"h-2.5 w-2.5"}),mt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:mt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(P){j({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}nt(!0)},title:"الصيانة",children:t.jsx(Us,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{g("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(ua,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(P){j({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}rt(!0)},title:"الفيز الائتمانية",children:t.jsx(At,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{ge(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(Ot,{className:"h-2.5 w-2.5"}),gs>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(Y||V||q)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{ne(""),xe(""),L("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(Vs,{className:"px-3 pb-3",children:t.jsxs(ba,{value:F,onValueChange:_e,className:"w-full",children:[t.jsxs(Zt,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(ue,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(ue,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(ue,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(ue,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(he,{value:"all",className:"mt-2 receipts-list",children:pt.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:pt.map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>Ue(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[we(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[W(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",W(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[W(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",W(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",W(e.sentAmount)," جنيه"]}),t.jsx(Se,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":Be(e.status)})]})]},e.id))})}),t.jsx(he,{value:"send",className:"mt-2 receipts-list",children:ce.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ce.filter(e=>e.type==="send").map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all duration-200",onClick:()=>Ue(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[we(e.status,e.type),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm text-green-700",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-green-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-green-600",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[W(e.amount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",W(e.sentAmount)," جنيه"]}),t.jsx(Se,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-green-100 text-green-800 border-green-300":""}`,children:Be(e.status)})]})]},e.id))})}),t.jsx(he,{value:"withdraw",className:"mt-2 receipts-list",children:ce.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ce.filter(e=>e.type==="withdraw").map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer",onClick:()=>Ue(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[we(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[W(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",W(e.withdrawnAmount)," جنيه"]}),t.jsx(Se,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-red-100 text-red-800 border-red-300":"bg-red-100 text-red-800"}`,children:Be(e.status)})]})]},e.id))})}),t.jsx(he,{value:"deleted",className:"mt-2",children:T.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:T.map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[we(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[W(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",W(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[W(e.amount)," جنيه"]}),t.jsx(Se,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(D,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>ys(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(D,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>Ns(e.id),children:t.jsx(Ot,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Re,{open:Kt,onOpenChange:Qe,children:t.jsxs(Pe,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(ke,{className:"px-4 pt-4",children:t.jsx(Oe,{className:"text-lg font-bold",children:Qt||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:et?t.jsx("iframe",{src:ps(et),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(aa,{open:is,onOpenChange:nt})]}),t.jsx(ra,{isOpen:os,onClose:()=>rt(!1)}),t.jsx(Ye,{open:ns,onOpenChange:Me,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{Me(!1),rs(!0)}}),t.jsx(ia,{open:ms,onOpenChange:ge,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"سيتم حذف كل المعاملات السابقة نهائيًا من حسابك وFirebase.",onSuccess:async()=>{try{if(!(s!=null&&s.uid)){ge(!1);return}const e=new Date,r=o=>o instanceof Date?o:typeof(o==null?void 0:o.toDate)=="function"?o.toDate():new Date(String(o));await G.updateUserData(s.uid,{recentReset:{keepLastCount:Q.keepLastCount??30,intervalDays:Q.intervalDays??7,lastResetAt:e}}),be(o=>({...o,lastResetAt:e})),j({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),j({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{ge(!1)}}}),t.jsx(Re,{open:hs,onOpenChange:e=>{var r,o;if(e){const n="alkaptin678678@gmail.com",a=(o=(r=He.currentUser)==null?void 0:r.email)==null?void 0:o.toLowerCase();if(!a||a!==n){j({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}ye(!0)}else ye(!1)},children:t.jsxs(Pe,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(ke,{children:t.jsx(Oe,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(qe,{value:ve,onChange:e=>ot(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(Xs,{value:le,onValueChange:it,children:[t.jsx(Ys,{className:"w-full",children:t.jsx(Zs,{placeholder:"اختر الشركة"})}),t.jsxs(Js,{children:[t.jsx(Ae,{value:"vodafone_eg",children:"فودافون"}),t.jsx(Ae,{value:"orange_eg",children:"أورنج"}),t.jsx(Ae,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(Ae,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(qe,{type:"number",min:1,value:je,onChange:e=>lt(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(D,{variant:"outline",onClick:()=>ye(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{variant:"secondary",onClick:()=>g("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(D,{onClick:ws,disabled:ct||!ve||!le||!je,children:ct?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Re,{open:Le,onOpenChange:v,children:t.jsxs(Pe,{className:"sm:max-w-[460px]",children:[t.jsxs(ke,{children:[t.jsx(Oe,{children:"تأكيد استرجاع الإيصال"}),t.jsx(qs,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),u&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[u.amount," جنيه"]})]}),u.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:u.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[u.senderPhone," → ",u.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:u.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:u.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(D,{variant:"outline",onClick:()=>{v(!1),w(null)},children:"إلغاء"}),t.jsx(D,{onClick:vs,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(na,{isOpen:ls,onClose:()=>We(!1),transaction:cs,onPrint:()=>window.print(),onDelete:ht,onComplete:ut}),t.jsx(Ye,{open:J,onOpenChange:E,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{E(!1),Ke(!0)}}),t.jsx(oa,{open:Jt,onOpenChange:Ke})]})};export{Xa as default};
