const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/walletDailyLimitsService-Jkrf1-Kn.js","assets/index-DBCfkQ6B.js","assets/index-K2uZ2--K.css","assets/profitService-Un0hQgrk.js","assets/reportsService-Bp1Io21u.js","assets/masterPinService-B5aWu8_y.js"])))=>i.map(i=>d[i]);
import{c as Ye,y as Xe,r as c,A as Qe,j as t,P as V,D as Q,a6 as et,t as te,a as tt,u as st,R as ee,a4 as at,ag as rt,I as nt,W as it,Z as ot,k as ue,Y as lt,ah as ct,o as dt,a1 as W,ai as F,aj as A,ak as mt,al as ut,a3 as ht,C as he,O as pt,i as xt,_ as R}from"./index-DBCfkQ6B.js";import{C as gt,a as ft,b as vt,d as bt}from"./card-C9sEKIdK.js";import{B as C}from"./button-B6KX4ziW.js";import{I as yt}from"./input-ujcKxSfi.js";import{B as U}from"./badge-CweJyfao.js";import{c as ge,R as Nt,I as jt}from"./index-JfnnBi4s.js";import{u as Ct}from"./index-CpxectR0.js";import{u as St}from"./Combination-DiR0Pm5F.js";import{C as Tt,a as At,M as Dt,b as wt,P as pe,R as _t}from"./PasswordConfirmDialog-CiyA9vt2.js";import{A as Ot}from"./arrow-left-DQO0v74O.js";import{S as It}from"./separator-Ba3yAqRn.js";import{C as Pt}from"./calendar-D8QTMloS.js";import{T as xe}from"./progress-waoXq8CC.js";import{C as Rt}from"./circle-x-Df7mIiIp.js";import{C as kt}from"./circle-check-big-E2gyd2JE.js";import"./dialog-DeBpi9Zt.js";import"./masterPinService-B5aWu8_y.js";import"./lock-CAqwcQlV.js";import"./eye-CbSpxorS.js";import"./label-BoQu3Lif.js";import"./circle-alert-D7_EsjrJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=Ye("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);var G="Tabs",[Mt,ms]=Xe(G,[ge]),fe=ge(),[Lt,se]=Mt(G),ve=c.forwardRef((u,s)=>{const{__scopeTabs:l,value:m,onValueChange:g,defaultValue:S,orientation:p="horizontal",dir:v,activationMode:_="automatic",...D}=u,y=Ct(v),[b,j]=Qe({prop:m,onChange:g,defaultProp:S??"",caller:G});return t.jsx(Lt,{scope:l,baseId:St(),value:b,onValueChange:j,orientation:p,dir:y,activationMode:_,children:t.jsx(V.div,{dir:y,"data-orientation":p,...D,ref:s})})});ve.displayName=G;var be="TabsList",ye=c.forwardRef((u,s)=>{const{__scopeTabs:l,loop:m=!0,...g}=u,S=se(be,l),p=fe(l);return t.jsx(Nt,{asChild:!0,...p,orientation:S.orientation,dir:S.dir,loop:m,children:t.jsx(V.div,{role:"tablist","aria-orientation":S.orientation,...g,ref:s})})});ye.displayName=be;var Ne="TabsTrigger",je=c.forwardRef((u,s)=>{const{__scopeTabs:l,value:m,disabled:g=!1,...S}=u,p=se(Ne,l),v=fe(l),_=Te(p.baseId,m),D=Ae(p.baseId,m),y=m===p.value;return t.jsx(jt,{asChild:!0,...v,focusable:!g,active:y,children:t.jsx(V.button,{type:"button",role:"tab","aria-selected":y,"aria-controls":D,"data-state":y?"active":"inactive","data-disabled":g?"":void 0,disabled:g,id:_,...S,ref:s,onMouseDown:Q(u.onMouseDown,b=>{!g&&b.button===0&&b.ctrlKey===!1?p.onValueChange(m):b.preventDefault()}),onKeyDown:Q(u.onKeyDown,b=>{[" ","Enter"].includes(b.key)&&p.onValueChange(m)}),onFocus:Q(u.onFocus,()=>{const b=p.activationMode!=="manual";!y&&!g&&b&&p.onValueChange(m)})})})});je.displayName=Ne;var Ce="TabsContent",Se=c.forwardRef((u,s)=>{const{__scopeTabs:l,value:m,forceMount:g,children:S,...p}=u,v=se(Ce,l),_=Te(v.baseId,m),D=Ae(v.baseId,m),y=m===v.value,b=c.useRef(y);return c.useEffect(()=>{const j=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(j)},[]),t.jsx(et,{present:g||y,children:({present:j})=>t.jsx(V.div,{"data-state":y?"active":"inactive","data-orientation":v.orientation,role:"tabpanel","aria-labelledby":_,hidden:!j,id:D,tabIndex:0,...p,ref:s,style:{...u.style,animationDuration:b.current?"0s":void 0},children:j&&S})})});Se.displayName=Ce;function Te(u,s){return`${u}-trigger-${s}`}function Ae(u,s){return`${u}-content-${s}`}var zt=ve,De=ye,we=je,_e=Se;const $t=zt,Oe=c.forwardRef(({className:u,...s},l)=>t.jsx(De,{ref:l,className:te("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",u),...s}));Oe.displayName=De.displayName;const L=c.forwardRef(({className:u,...s},l)=>t.jsx(we,{ref:l,className:te("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",u),...s}));L.displayName=we.displayName;const z=c.forwardRef(({className:u,...s},l)=>t.jsx(_e,{ref:l,className:te("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",u),...s}));z.displayName=_e.displayName;const us=()=>{var le,ce,de,me;const u=tt(),{user:s,profile:l,userSubscription:m}=st(),g=ee.useMemo(()=>{var a,r,d,n;const e=((a=m==null?void 0:m.subscription)==null?void 0:a.planType)??((r=m==null?void 0:m.subscription)==null?void 0:r.plan)??((d=l==null?void 0:l.subscription)==null?void 0:d.planType)??((n=l==null?void 0:l.subscription)==null?void 0:n.plan)??null;return e===at.ZERO||String(e).toLowerCase()==="zero"},[(le=m==null?void 0:m.subscription)==null?void 0:le.planType,(ce=m==null?void 0:m.subscription)==null?void 0:ce.plan,(de=l==null?void 0:l.subscription)==null?void 0:de.planType,(me=l==null?void 0:l.subscription)==null?void 0:me.plan]),{shopName:S}=rt();nt();const[p,v]=c.useState([]),[_,D]=c.useState([]),[y,b]=c.useState("all"),[j,ae]=c.useState(""),[k,Ie]=c.useState(""),[E,Pe]=c.useState(""),[Bt,Re]=c.useState(!1),[Wt,ke]=c.useState(!1),[Ft,Ee]=c.useState(!1),[Ut,Me]=c.useState(!1),[J,K]=c.useState(!1),[Le,re]=c.useState(!1),[ze,ne]=c.useState(!1),[$e,Z]=c.useState(!1),[Be,We]=c.useState(null),[Fe,q]=c.useState(!1),[ie,$]=c.useState(0),I=ee.useCallback(()=>{try{const e=`debts_${(s==null?void 0:s.uid)||"default"}`,a=localStorage.getItem(e)||localStorage.getItem("debts_default");if(!a){$(0);return}const r=JSON.parse(a);if(!Array.isArray(r)){$(0);return}const d=r.filter(n=>(n==null?void 0:n.status)==="pending"&&((n==null?void 0:n.amount)??0)>0).length;$(d)}catch{$(0)}},[s==null?void 0:s.uid]);c.useEffect(()=>{I()},[I]),c.useEffect(()=>{const e=a=>{a.key&&(a.key===`debts_${(s==null?void 0:s.uid)||"default"}`||a.key==="debts_default")&&I()};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[I,s==null?void 0:s.uid]),c.useEffect(()=>{J||I()},[J,I]),c.useEffect(()=>{Ue(),Ve()},[s]),c.useEffect(()=>{if(s!=null&&s.uid)try{const e=it(ot(ue,"userTransactions"),lt("userId","==",s.uid),ct("createdAt","desc")),a=dt(e,r=>{const d=r.docs.map(n=>{const h=n.data(),i=h==null?void 0:h.createdAt,o=i!=null&&i.toDate?i.toDate():i instanceof Date?i:new Date(i);return{id:n.id,...h,createdAt:o}}).filter(n=>(n==null?void 0:n.status)!=="cancelled"&&!(n!=null&&n.isDeleted)).filter(n=>!((n==null?void 0:n.type)==="report"||((n==null?void 0:n.title)||"").includes("إيصال تسليم وردية")));v(d.map(Y))},r=>{console.error("خطأ في الاشتراك لمعاملات المستخدم:",r)});return()=>a()}catch(e){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم:",e)}},[s==null?void 0:s.uid]);const Ue=async()=>{try{if(!s)return;const a=(await W.getUserTransactions(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)})).filter(r=>!((r==null?void 0:r.type)==="report"||((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية")));v(a.map(Y))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e)}},Ve=async()=>{try{if(!s)return;const a=(await F.getDeletedTransactionsByUser(s.uid)).map(r=>({...r,createdAt:r.createdAt instanceof Date?r.createdAt:new Date(r.createdAt)}));D(a.map(Y))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e)}},M=ee.useMemo(()=>{const e=s!=null&&s.uid?`recentTransactionsResetAt:${s.uid}`:null,a=e?localStorage.getItem(e):null;let r=null;if(a){const d=new Date(a);isNaN(d.getTime())||(r=d)}return p.filter(d=>!r||d.createdAt>=r)},[p,s==null?void 0:s.uid]),oe=M.filter(e=>{const a=!j||e.senderPhone.includes(j)||e.receiverPhone.includes(j),r=!k||e.createdAt.toDateString()===new Date(k).toDateString(),d=!E||e.createdAt.toTimeString().startsWith(E);return a&&r&&d}),B=e=>{switch(e){case"completed":return t.jsx(kt,{className:"h-4 w-4 text-green-500"});case"pending":return t.jsx(he,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(Rt,{className:"h-4 w-4 text-red-500"});default:return t.jsx(he,{className:"h-4 w-4 text-gray-500"})}},H=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},Y=e=>{const a=((e==null?void 0:e.status)??"").toString().toLowerCase(),r=a==="confirmed"||a==="success"||a==="completed"?"completed":a==="failed"||a==="error"||a==="cancelled"||a==="canceled"?"cancelled":"pending",n=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",h=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",i=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",o=e==null?void 0:e.createdAt,N=o instanceof Date?o:o!=null&&o.toDate?o.toDate():new Date(o);return{id:e==null?void 0:e.id,senderPhone:h||"غير معروف",receiverPhone:i||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:r,type:n,createdAt:N,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1}},Ge=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:S??(l==null?void 0:l.shopName)??(s==null?void 0:s.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0}),X=e=>{const a=Ge(e);We(a),Z(!0)},Je=async e=>{try{const a=_.find(n=>n.id===e);if(!a||!s)return;const r=await W.saveUserTransaction(s.uid,{...a,userId:s.uid,status:"completed",cashierName:a.cashierName??"الحساب الرئيسي"});await F.permanentlyDeleteTransaction(e,s.uid);const d={...a,id:r};v(n=>[...n,d]),D(n=>n.filter(h=>h.id!==e)),A({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(a){console.error("خطأ في استرجاع المعاملة من Firestore:",a),A({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},Ke=async e=>{try{if(!s)return;D(a=>a.filter(r=>r.id!==e)),await F.permanentlyDeleteTransaction(e,s.uid),await W.removeUserTransaction(s.uid,e),A({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(a){console.error("فشل الحذف النهائي للمعاملة:",a),A({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},Ze=async e=>{try{const a=p.find(i=>i.id===e);if(!a||!s)return;const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,d=`walletBalances_${(s==null?void 0:s.uid)||"default"}`;let n=(()=>{const i=localStorage.getItem(r);return i?parseFloat(i):0})(),h=(()=>{const i=localStorage.getItem(d);try{return i?JSON.parse(i):{}}catch{return{}}})();if(a.type==="withdraw"){const i=a.fromWallet||Object.keys(h)[0],o=Number(a.withdrawnAmount??a.amount??0),N=Number(a.commission??0),O=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let f=[];try{const x=localStorage.getItem(O);f=x?JSON.parse(x):[]}catch{f=[]}const T=(a==null?void 0:a.walletEffectAppliedOnCreation)||f.includes(e);if(!T&&i&&o>0){const x=h[i]||0;h[i]=x+o}if(n=n-o+N,localStorage.setItem(r,n.toString()),localStorage.setItem(d,JSON.stringify(h)),T)try{const x=f.filter(P=>P!==e);localStorage.setItem(O,JSON.stringify(x))}catch{}}await pt(xt(ue,"userTransactions",e),{status:"completed",confirmedAt:new Date}),v(i=>i.map(o=>o.id===e?{...o,status:"completed"}:o)),A({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),Z(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),A({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},qe=async e=>{try{const a=p.find(r=>r.id===e);if(!a||!s)return;v(r=>r.filter(d=>d.id!==e)),D(r=>[{...a},...r]);try{await W.removeUserTransaction(s.uid,e),await F.saveDeletedTransaction({...a,userId:s.uid,originalTransactionId:e})}catch(r){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",r)}try{const r=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,d=`walletBalances_${(s==null?void 0:s.uid)||"default"}`,n=localStorage.getItem(r),h=localStorage.getItem(d);let i=n?parseFloat(n):0,o=(()=>{try{return h?JSON.parse(h):{}}catch{return{}}})();const N=Number(a.withdrawnAmount??a.amount??0),O=Number(a.commission??0),f=a.fromWallet||Object.keys(o)[0],T=`walletEffectsAppliedOnCreation_${(s==null?void 0:s.uid)||"default"}`;let x=[];try{const w=localStorage.getItem(T);x=w?JSON.parse(w):[]}catch{x=[]}const P=(a==null?void 0:a.walletEffectAppliedOnCreation)||x.includes(e);if(a.type==="send"){if(i-=O,f&&N>0){const w=o[f]||0;o[f]=w+N}}else if(a.type==="withdraw"){if(a.status==="completed"){if(i=i+N-O,f&&N>0){const w=o[f]||0;o[f]=w-N}}else if(f&&P&&N>0){const w=o[f]||0;o[f]=w-N}}if(localStorage.setItem(r,i.toString()),localStorage.setItem(d,JSON.stringify(o)),P)try{const w=x.filter(He=>He!==e);localStorage.setItem(T,JSON.stringify(w))}catch{}}catch(r){console.warn("فشل عكس تأثير الأرصدة محليًا:",r)}try{const r=a.fromWallet;if(r){const{walletDailyLimitsService:d}=await R(async()=>{const{walletDailyLimitsService:h}=await import("./walletDailyLimitsService-Jkrf1-Kn.js");return{walletDailyLimitsService:h}},__vite__mapDeps([0,1,2])),n=await d.getWalletLimits(r);if(n){const h=a.type==="send",i={updatedAt:(await R(async()=>{const{serverTimestamp:T}=await import("./index-DBCfkQ6B.js").then(x=>x.aY);return{serverTimestamp:T}},__vite__mapDeps([1,2]))).serverTimestamp()};h?(i.dailyTransferUsed=Math.max(0,(n.dailyTransferUsed||0)-a.amount),i.monthlyTransferUsed=Math.max(0,(n.monthlyTransferUsed||0)-a.amount)):(i.dailyWithdrawUsed=Math.max(0,(n.dailyWithdrawUsed||0)-a.amount),i.monthlyWithdrawUsed=Math.max(0,(n.monthlyWithdrawUsed||0)-a.amount));const{doc:o,setDoc:N}=await R(async()=>{const{doc:T,setDoc:x}=await import("./index-DBCfkQ6B.js").then(P=>P.aY);return{doc:T,setDoc:x}},__vite__mapDeps([1,2])),{db:O}=await R(async()=>{const{db:T}=await import("./index-DBCfkQ6B.js").then(x=>x.aZ);return{db:T}},__vite__mapDeps([1,2])),f=o(O,"walletLimits",r);await N(f,i,{merge:!0})}}}catch(r){console.warn("فشل استرجاع حدود المحفظة:",r)}try{const{ProfitService:r}=await R(async()=>{const{ProfitService:o}=await import("./profitService-Un0hQgrk.js");return{ProfitService:o}},__vite__mapDeps([3,4,5])),{ReportsService:d}=await R(async()=>{const{ReportsService:o}=await import("./reportsService-Bp1Io21u.js");return{ReportsService:o}},[]),h={txnType:a.type==="send"?"send":"receive",amount:a.amount,commission:a.commission||0,createdAt:a.createdAt,status:"confirmed"},i=r.calculateProfitFromTransaction(h);i>0&&r.addProfit(-i,s.uid);try{d.removeTransactionEffects(a,s.uid)}catch{}}catch(r){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",r)}}catch(a){console.error("خطأ أثناء حذف الإيصال:",a)}};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(C,{variant:"ghost",size:"sm",onClick:()=>u("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(Ot,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(gt,{className:"card-modern fade-in-up",children:[t.jsxs(ft,{className:"pb-2 px-3 pt-3",children:[t.jsx(vt,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(It,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(yt,{placeholder:"بحث...",value:j,onChange:e=>ae(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Re(!0),title:"آلة حاسبة",children:t.jsx(Tt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(g){A({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}ke(!0)},title:"بيانات المبيعات",children:t.jsx(At,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(C,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${k||E?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>Ee(!0),title:"اختيار التاريخ",children:[t.jsx(Pt,{className:"h-2.5 w-2.5"}),(k||E)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(g){A({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}K(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(mt,{className:"h-2.5 w-2.5"}),ie>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:ie})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(g){A({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}ne(!0)},title:"الصيانة",children:t.jsx(ut,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{u("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(Et,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(C,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(g){A({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}re(!0)},title:"الفيز الائتمانية",children:t.jsx(ht,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(C,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{q(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(xe,{className:"h-2.5 w-2.5"}),(s==null?void 0:s.uid)&&localStorage.getItem(`recentTransactionsResetAt:${s.uid}`)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(j||k||E)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{ae(""),Ie(""),Pe("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(bt,{className:"px-3 pb-3",children:t.jsxs($t,{value:y,onValueChange:b,className:"w-full",children:[t.jsxs(Oe,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(L,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(L,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(L,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(L,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(z,{value:"all",className:"mt-2",children:oe.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:oe.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>X(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[B(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-600",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(U,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.type==="withdraw"?"bg-green-100 text-green-800":""}`,children:e.type==="withdraw"?"سحب":H(e.status)})]})]},e.id))})}),t.jsx(z,{value:"send",className:"mt-2",children:M.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:M.filter(e=>e.type==="send").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>X(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[B(e.status),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",e.sentAmount," جنيه"]}),t.jsx(U,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:H(e.status)})]})]},e.id))})}),t.jsx(z,{value:"withdraw",className:"mt-2",children:M.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:M.filter(e=>e.type==="withdraw").map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer",onClick:()=>X(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[B(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm",children:[e.amount," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",e.withdrawnAmount," جنيه"]}),t.jsx(U,{variant:e.status==="completed"?"default":"secondary",className:"text-sm",children:H(e.status)})]})]},e.id))})}),t.jsx(z,{value:"deleted",className:"mt-2",children:_.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:_.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[B(e.status),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[e.amount," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",e.commission||0," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[e.amount," جنيه"]}),t.jsx(U,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(C,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>Je(e.id),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(C,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>Ke(e.id),children:t.jsx(xe,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Dt,{open:ze,onOpenChange:ne})]}),t.jsx(wt,{isOpen:Le,onClose:()=>re(!1)}),t.jsx(pe,{open:J,onOpenChange:K,title:"تأكيد كلمة المرور لفتح الديون",description:"أدخل كلمة مرور تسجيل الدخول لفتح صفحة الديون",onSuccess:()=>{K(!1),Me(!0)}}),t.jsx(pe,{open:Fe,onOpenChange:q,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"لن يتم حذف الإيصالات؛ سنبدأ القائمة من الآن.",onSuccess:()=>{try{s!=null&&s.uid&&(localStorage.setItem(`recentTransactionsResetAt:${s.uid}`,new Date().toISOString()),A({title:"تم التصفير",description:"تم بدء قائمة المعاملات من الآن."}))}catch{}q(!1)}}),t.jsx(_t,{isOpen:$e,onClose:()=>Z(!1),transaction:Be,onPrint:()=>window.print(),onDelete:qe,onComplete:Ze})]})};export{us as default};
