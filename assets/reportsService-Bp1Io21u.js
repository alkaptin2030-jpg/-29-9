const i={shouldResetDailyReports:e=>{if(!e)return!0;const l=new Date,o=new Date(e);return l.toDateString()!==o.toDateString()},shouldResetMonthlyReports:e=>{if(!e)return!0;const l=new Date,o=new Date(e),t=l.getDate()===1,r=l.getMonth()!==o.getMonth()||l.getFullYear()!==o.getFullYear();return t&&r},autoResetReportsIfNeeded:e=>{try{const l=e?`reportsData_${e}`:"reportsData",o=localStorage.getItem(l);let t={lastDailyResetDate:null,lastMonthlyResetDate:null,hiddenDailyTransactionIds:[],hiddenMonthlyTransactionIds:[],dailyProfit:0,monthlyProfit:0,lastDailyProfitResetDate:null,lastMonthlyProfitResetDate:null};if(o){const s=JSON.parse(o);t={lastDailyResetDate:s.lastDailyResetDate?new Date(s.lastDailyResetDate):null,lastMonthlyResetDate:s.lastMonthlyResetDate?new Date(s.lastMonthlyResetDate):null,hiddenDailyTransactionIds:s.hiddenDailyTransactionIds||[],hiddenMonthlyTransactionIds:s.hiddenMonthlyTransactionIds||[],dailyProfit:s.dailyProfit||0,monthlyProfit:s.monthlyProfit||0,lastDailyProfitResetDate:s.lastDailyProfitResetDate?new Date(s.lastDailyProfitResetDate):null,lastMonthlyProfitResetDate:s.lastMonthlyProfitResetDate?new Date(s.lastMonthlyProfitResetDate):null}}else if(e){const s=localStorage.getItem("reportsData");if(s)try{const a=JSON.parse(s);t={lastDailyResetDate:a.lastDailyResetDate?new Date(a.lastDailyResetDate):null,lastMonthlyResetDate:a.lastMonthlyResetDate?new Date(a.lastMonthlyResetDate):null,hiddenDailyTransactionIds:a.hiddenDailyTransactionIds||[],hiddenMonthlyTransactionIds:a.hiddenMonthlyTransactionIds||[],dailyProfit:a.dailyProfit||0,monthlyProfit:a.monthlyProfit||0,lastDailyProfitResetDate:a.lastDailyProfitResetDate?new Date(a.lastDailyProfitResetDate):null,lastMonthlyProfitResetDate:a.lastMonthlyProfitResetDate?new Date(a.lastMonthlyProfitResetDate):null},localStorage.setItem(l,JSON.stringify(t))}catch(a){console.error("خطأ في مهاجرة بيانات التقارير القديمة:",a)}}let r=!1,n=!1;return t.lastDailyResetDate?i.shouldResetDailyReports(t.lastDailyResetDate)&&(t.hiddenDailyTransactionIds=[],t.lastDailyResetDate=new Date,r=!0,console.log("تم تصفير التقارير اليومية تلقائياً")):t.lastDailyResetDate=new Date,t.lastDailyProfitResetDate?i.shouldResetDailyReports(t.lastDailyProfitResetDate)&&(t.dailyProfit=0,t.lastDailyProfitResetDate=new Date,console.log("تم تصفير الأرباح اليومية تلقائياً")):t.lastDailyProfitResetDate=new Date,t.lastMonthlyResetDate?i.shouldResetMonthlyReports(t.lastMonthlyResetDate)&&(t.hiddenMonthlyTransactionIds=[],t.lastMonthlyResetDate=new Date,n=!0,console.log("تم تصفير التقارير الشهرية تلقائياً")):t.lastMonthlyResetDate=new Date,t.lastMonthlyProfitResetDate?i.shouldResetMonthlyReports(t.lastMonthlyProfitResetDate)&&(t.monthlyProfit=0,t.lastMonthlyProfitResetDate=new Date,console.log("تم تصفير الأرباح الشهرية تلقائياً")):t.lastMonthlyProfitResetDate=new Date,localStorage.setItem(l,JSON.stringify(t)),{dailyReset:r,monthlyReset:n}}catch(l){return console.error("خطأ في التصفير التلقائي للتقارير:",l),{dailyReset:!1,monthlyReset:!1}}},resetReportsManually:(e,l,o)=>{try{const t=o?`reportsData_${o}`:"reportsData",r=localStorage.getItem(t);let n={lastDailyResetDate:null,lastMonthlyResetDate:null,hiddenDailyTransactionIds:[],hiddenMonthlyTransactionIds:[],dailyProfit:0,monthlyProfit:0,lastDailyProfitResetDate:null,lastMonthlyProfitResetDate:null};if(r){const a=JSON.parse(r);n={lastDailyResetDate:a.lastDailyResetDate?new Date(a.lastDailyResetDate):null,lastMonthlyResetDate:a.lastMonthlyResetDate?new Date(a.lastMonthlyResetDate):null,hiddenDailyTransactionIds:a.hiddenDailyTransactionIds||[],hiddenMonthlyTransactionIds:a.hiddenMonthlyTransactionIds||[],dailyProfit:a.dailyProfit||0,monthlyProfit:a.monthlyProfit||0,lastDailyProfitResetDate:a.lastDailyProfitResetDate?new Date(a.lastDailyProfitResetDate):null,lastMonthlyProfitResetDate:a.lastMonthlyProfitResetDate?new Date(a.lastMonthlyProfitResetDate):null}}let s=[];if(e==="daily"){const a=new Date().toDateString();s=l.filter(D=>new Date(D.createdAt).toDateString()===a).map(D=>D.id),n.hiddenDailyTransactionIds=[...new Set([...n.hiddenDailyTransactionIds,...s])],n.lastDailyResetDate=new Date,n.dailyProfit=0,n.lastDailyProfitResetDate=new Date}else{const a=new Date().getMonth(),D=new Date().getFullYear();s=l.filter(y=>{const d=new Date(y.createdAt);return d.getMonth()===a&&d.getFullYear()===D}).map(y=>y.id),n.hiddenMonthlyTransactionIds=[...new Set([...n.hiddenMonthlyTransactionIds,...s])],n.lastMonthlyResetDate=new Date,n.monthlyProfit=0,n.lastMonthlyProfitResetDate=new Date}return localStorage.setItem(t,JSON.stringify(n)),console.log(`تم تصفير التقارير ${e==="daily"?"اليومية":"الشهرية"} يدوياً`),s}catch(t){return console.error("خطأ في التصفير اليدوي للتقارير:",t),[]}},getReportsData:e=>{try{const l=e?`reportsData_${e}`:"reportsData",o=localStorage.getItem(l);if(!o)return{lastDailyResetDate:null,lastMonthlyResetDate:null,hiddenDailyTransactionIds:[],hiddenMonthlyTransactionIds:[],dailyProfit:0,monthlyProfit:0,lastDailyProfitResetDate:null,lastMonthlyProfitResetDate:null};const t=JSON.parse(o);return{lastDailyResetDate:t.lastDailyResetDate?new Date(t.lastDailyResetDate):null,lastMonthlyResetDate:t.lastMonthlyResetDate?new Date(t.lastMonthlyResetDate):null,hiddenDailyTransactionIds:t.hiddenDailyTransactionIds||[],hiddenMonthlyTransactionIds:t.hiddenMonthlyTransactionIds||[],dailyProfit:t.dailyProfit||0,monthlyProfit:t.monthlyProfit||0,lastDailyProfitResetDate:t.lastDailyProfitResetDate?new Date(t.lastDailyProfitResetDate):null,lastMonthlyProfitResetDate:t.lastMonthlyProfitResetDate?new Date(t.lastMonthlyProfitResetDate):null}}catch(l){return console.error("خطأ في قراءة بيانات التقارير:",l),{lastDailyResetDate:null,lastMonthlyResetDate:null,hiddenDailyTransactionIds:[],hiddenMonthlyTransactionIds:[],dailyProfit:0,monthlyProfit:0,lastDailyProfitResetDate:null,lastMonthlyProfitResetDate:null}}},filterVisibleTransactions:(e,l,o)=>{try{const t=i.getReportsData(o),r=l==="daily"?t.hiddenDailyTransactionIds:t.hiddenMonthlyTransactionIds;return e.filter(n=>!r.includes(n.id))}catch(t){return console.error("خطأ في تصفية المعاملات:",t),e}},addProfit:(e,l,o)=>{try{const t=o?`reportsData_${o}`:"reportsData",r=i.getReportsData(o);l==="daily"?r.dailyProfit+=e:r.monthlyProfit+=e,localStorage.setItem(t,JSON.stringify(r))}catch(t){console.error("خطأ في إضافة الربح:",t)}},getProfits:e=>{try{const l=i.getReportsData(e);return{dailyProfit:l.dailyProfit,monthlyProfit:l.monthlyProfit}}catch(l){return console.error("خطأ في قراءة الأرباح:",l),{dailyProfit:0,monthlyProfit:0}}},removeTransactionEffects:(e,l)=>{try{const o=l?`reportsData_${l}`:"reportsData",t=i.getReportsData(l),r=new Date(e.createdAt),n=new Date,s=n.getMonth(),a=n.getFullYear(),D=i.calculateTransactionProfit(e);r.toDateString()===n.toDateString()&&((t.hiddenDailyTransactionIds||[]).includes(e.id)||(t.dailyProfit=Math.round((t.dailyProfit-D)*100)/100,t.dailyProfit<0&&(t.dailyProfit=0))),r.getMonth()===s&&r.getFullYear()===a&&((t.hiddenMonthlyTransactionIds||[]).includes(e.id)||(t.monthlyProfit=Math.round((t.monthlyProfit-D)*100)/100,t.monthlyProfit<0&&(t.monthlyProfit=0))),localStorage.setItem(o,JSON.stringify(t))}catch(o){console.error("خطأ في خصم تأثيرات المعاملة من التقارير:",o)}},calculateTransactionProfit:e=>e.commission!==void 0?e.commission:e.type==="withdraw"||e.type==="receive"||e.type==="send"?Math.round(e.amount*.01*100)/100:0},h=i;export{h as ReportsService,i as reportsService};
