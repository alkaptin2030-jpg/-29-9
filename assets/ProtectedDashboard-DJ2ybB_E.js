import{d as ye,u as Ne,W as Se,r as a,j as e,X as we,Y as De,C as Ie,O as de,k as me,g as ue,t as Be,v as We,Z as Ce,a as ke}from"./index-CZ0oxFIo.js";import{C as b,a as v,b as y,d as N}from"./card-DKvmXwRm.js";import{B as P}from"./button-U8RvFTZR.js";import{I as F}from"./input-CiSM3wny.js";import{B as Ee}from"./badge-D41M-Wim.js";import{S as K,a as z,b as V,c as J,d as h}from"./select-Dkyd_T8K.js";import{M as Te}from"./MasterPinDialog-nKmHPQ7L.js";import{D as he}from"./dollar-sign-BAFf5x8l.js";import{W as _e}from"./wallet-BBV7bk-x.js";import{a as xe}from"./eye-BaPXTd2P.js";import{C as Le}from"./circle-check-big-C-nHYjaF.js";import{C as Pe}from"./circle-x-SPrWMGkk.js";import"./index-CyA9ex8o.js";import"./Combination-SHVcp4AD.js";import"./index-CgUBhpSf.js";import"./label-UNym12wa.js";import"./dialog-BGFXfRHl.js";import"./shield-1fUGk4U9.js";import"./circle-alert-DTcLCWWf.js";import"./lock-DWZj7jaf.js";const Fe=()=>{const{toast:m}=ye(),{signOut:A,user:s,profile:S}=Ne();Se();const[d,R]=a.useState("01030302038"),[i,w]=a.useState(""),[f,C]=a.useState(""),[j,U]=a.useState("transfer"),[O,M]=a.useState("vodafone_cash"),[$,X]=a.useState("vodafone_cash"),[H,Y]=a.useState(""),[D,Z]=a.useState([]);a.useState("all"),a.useState(!1);const[fe,Ae]=a.useState(""),[q,Re]=a.useState([]);a.useState(null),a.useState(!1),a.useState([]),a.useState([]),a.useState(!1),a.useState("daily");const[Oe,G]=a.useState([]),[k,I]=a.useState(0),[g,B]=a.useState({});a.useState(!1),a.useState(!1),a.useState(!1),a.useState(!1),a.useState(!1),a.useState(""),a.useState(!1);const[ge,Q]=a.useState(!1),[E,ee]=a.useState(()=>{try{const t=s!=null&&s.uid?`dailyReportsLockEnabled_${s==null?void 0:s.uid}`:"dailyReportsLockEnabled";return(localStorage.getItem(t)??localStorage.getItem("dailyReportsLockEnabled"))==="true"}catch{return!1}}),[pe,T]=a.useState(!1),o=t=>{const l="٠١٢٣٤٥٦٧٨٩",n="۰۱۲۳۴۵۶۷۸۹";return(t||"").split("").map(c=>{const r=l.indexOf(c);if(r>-1)return String(r);const p=n.indexOf(c);return p>-1?String(p):c}).join("")},te=t=>{const l=o(t).replace(/\D/g,"");return l.startsWith("010")?"vodafone_cash":l.startsWith("011")?"etisalat_cash":l.startsWith("012")?"orange_cash":null};a.useEffect(()=>{const t=te(d);t&&t!==O&&M(t)},[d]),a.useEffect(()=>{const t=te(i);t&&t!==$&&X(t)},[i]),a.useEffect(()=>{try{const t=s!=null&&s.uid?`dailyReportsLockEnabled_${s==null?void 0:s.uid}`:"dailyReportsLockEnabled",l=localStorage.getItem(t)??localStorage.getItem("dailyReportsLockEnabled");ee(l==="true")}catch{}},[s==null?void 0:s.uid]);const se=async t=>{if(s)try{const l=await de.getById(s.uid);if(l!=null&&l.shopId){const n=me(ue,"dashboardData",l.shopId);await Ce(n,t)}}catch(l){console.error("Error saving to Firebase:",l),m({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ البيانات في Firebase",variant:"destructive"})}};a.useEffect(()=>{if(!s)return;(async()=>{Q(!0);try{const l=await de.getById(s.uid);if(l!=null&&l.shopId){const n=me(ue,"dashboardData",l.shopId),c=await Be(n);if(c.exists()){const r=c.data();I(r.cashBalance||0),B(r.walletBalances||{}),G(r.deletedTransactions||[])}else{const r={cashBalance:0,walletBalances:{},deletedTransactions:[]};await We(n,r),I(r.cashBalance),B(r.walletBalances),G(r.deletedTransactions)}}}catch(l){console.error("Error loading data from Firebase:",l);const n=`cashBalance_${(s==null?void 0:s.uid)||"default"}`,c=`userCashBalance_${(s==null?void 0:s.uid)||"default"}`,r=`walletBalances_${(s==null?void 0:s.uid)||"default"}`,p=localStorage.getItem(n);if(p!=null)I(parseFloat(p));else{const u=localStorage.getItem(c);if(u!=null){const x=parseFloat(u);if(!Number.isNaN(x)){I(x);try{localStorage.setItem(n,x.toString()),localStorage.removeItem(c)}catch{}}}}const W=localStorage.getItem(r);B(W?JSON.parse(W):{})}finally{Q(!1)}})()},[s]),a.useEffect(()=>{try{const t=`cashBalance_${(s==null?void 0:s.uid)||"default"}`;localStorage.setItem(t,String(k||0))}catch{}},[k,s==null?void 0:s.uid]),a.useEffect(()=>{try{const t=`walletBalances_${(s==null?void 0:s.uid)||"default"}`;localStorage.setItem(t,JSON.stringify(g||{}))}catch{}},[g,s==null?void 0:s.uid]);const je=async t=>{if(t.preventDefault(),j==="transfer"){if(!d||!i||!f){m({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const l=(S==null?void 0:S.shopName)||(s==null?void 0:s.displayName)||"محل كاشي لينك",n=q.find(L=>L.id===fe)||q.find(L=>L.isDefault),c=o(d||"").replace(/\D/g,""),r=o(i||"").replace(/\D/g,""),p=O===$,W=c.startsWith("010")&&(r.startsWith("011")||r.startsWith("012")||r.startsWith("015"))||c.startsWith("012")&&r.startsWith("010")||c.startsWith("011")&&r.startsWith("010")||c.startsWith("015")&&r.startsWith("010"),u=p?1:W?parseFloat(H||"0"):0;if(W&&(Number.isNaN(u)||u<=0)){m({title:"خطأ",description:"أدخل رسوم التحويل لعمليات 010 → 011/012/015 أو 012 → 010 أو 011 → 010 أو 015 → 010",variant:"destructive"});return}if(!n){m({title:"لا توجد محفظة",description:"يرجى اختيار محفظة لإتمام التحويل",variant:"destructive"});return}const x=parseFloat(f),ae=x+u,le=g[n.id]||0;if(le<ae){m({title:"رصيد المحفظة غير كافٍ",description:`الرصيد الحالي ${le} لا يكفي لخصم ${ae}`,variant:"destructive"});return}const ne={id:Date.now().toString(),type:"send",senderPhone:d,receiverPhone:i,amount:x,status:"pending",createdAt:new Date,withdrawnAmount:0,sentAmount:x,merchantShopName:l,shopName:(n==null?void 0:n.name)||"المحفظة الرئيسية",commission:0,fee:u,fromWallet:n.id},re=[ne,...D];Z(re);const be=x+u,_=n==null?void 0:n.id,ve=_&&g[_]||0,ie=_?{...g,[_]:ve-be}:g;B(ie);const ce=k+u;I(ce),await se({transactions:re,walletBalances:ie,cashBalance:ce}),m({title:"تم إرسال التحويل",description:"جاري معالجة التحويل..."}),setTimeout(async()=>{const oe=[{...ne,status:"completed"},...D];Z(oe),await se({transactions:oe})},2e3),R("01030302038"),w(""),C(""),Y("")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[ge&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-center",children:"جاري تحميل البيانات..."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"لوحة تحكم الإدارة"}),e.jsxs(P,{onClick:A,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"تسجيل الخروج"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(b,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"الرصيد النقدي"}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[k.toLocaleString()," جنيه"]})})]}),e.jsxs(b,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"الأرصدة علي المحافظ"}),e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[Object.values(g).reduce((t,l)=>t+l,0).toLocaleString()," جنيه"]})})]}),e.jsxs(b,{className:"relative",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"المعاملات اليوم"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{className:E?"filter blur-sm pointer-events-none":"",children:e.jsx("div",{className:"text-2xl font-bold",children:D.length})}),E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60",children:e.jsxs(P,{size:"sm",variant:"ghost",onClick:()=>T(!0),className:"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all",title:"عرض تقارير اليوم",children:[e.jsx(xe,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"عرض تقارير اليوم"})]})})]}),e.jsxs(b,{className:"relative",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"إجمالي اليوم"}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{className:E?"filter blur-sm pointer-events-none":"",children:e.jsxs("div",{className:"text-2xl font-bold",children:[D.reduce((t,l)=>t+l.amount,0).toLocaleString()," جنيه"]})}),E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60",children:e.jsxs(P,{size:"sm",variant:"ghost",onClick:()=>T(!0),className:"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all",title:"عرض تقارير اليوم",children:[e.jsx(xe,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"عرض تقارير اليوم"})]})})]}),e.jsx(Te,{open:pe,onOpenChange:T,mode:"verify",title:"قفل تقارير اليوم",description:"لا يمكن الاطلاع على تقارير اليوم إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{ee(!1),T(!1)}})]}),e.jsxs(b,{children:[e.jsx(v,{children:e.jsx(y,{children:"إجراء معاملة جديدة"})}),e.jsx(N,{children:e.jsxs("form",{onSubmit:je,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نوع المعاملة"}),e.jsxs(K,{value:j,onValueChange:t=>U(t),children:[e.jsx(z,{children:e.jsx(V,{})}),e.jsxs(J,{children:[e.jsx(h,{value:"transfer",children:"تحويل"}),e.jsx(h,{value:"withdraw",children:"سحب"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المرسل"}),e.jsx(F,{type:"tel",value:d,onChange:t=>R(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const l=document.getElementById("receiverPhoneInput");if(l)l.focus();else{const n=document.getElementById("amountInput");n==null||n.focus()}}},placeholder:"01xxxxxxxxx"})]}),j==="transfer"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المستقبل"}),e.jsx(F,{id:"receiverPhoneInput",type:"tel",value:i,onChange:t=>w(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const l=document.getElementById("amountInput");l==null||l.focus()}},placeholder:"01xxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"شركة المرسل"}),e.jsxs(K,{value:O,onValueChange:t=>M(t),children:[e.jsx(z,{children:e.jsx(V,{})}),e.jsxs(J,{children:[e.jsx(h,{value:"vodafone_cash",children:"فودافون"}),e.jsx(h,{value:"etisalat_cash",children:"اتصالات"}),e.jsx(h,{value:"orange_cash",children:"أورانج"}),e.jsx(h,{value:"instapay",children:"إنستاباي"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"شركة المستقبل"}),e.jsxs(K,{value:$,onValueChange:t=>X(t),children:[e.jsx(z,{children:e.jsx(V,{})}),e.jsxs(J,{children:[e.jsx(h,{value:"vodafone_cash",children:"فودافون"}),e.jsx(h,{value:"etisalat_cash",children:"اتصالات"}),e.jsx(h,{value:"orange_cash",children:"أورانج"}),e.jsx(h,{value:"instapay",children:"إنستاباي"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"المبلغ"}),e.jsx(F,{id:"amountInput",type:"number",value:f,onChange:t=>C(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const l=document.getElementById("txSubmitButton");l==null||l.focus()}},placeholder:"0.00"})]}),j==="transfer"&&(o(d||"").replace(/\D/g,"").startsWith("010")&&(o(i||"").replace(/\D/g,"").startsWith("011")||o(i||"").replace(/\D/g,"").startsWith("012")||o(i||"").replace(/\D/g,"").startsWith("015"))||o(d||"").replace(/\D/g,"").startsWith("012")&&o(i||"").replace(/\D/g,"").startsWith("010")||o(d||"").replace(/\D/g,"").startsWith("011")&&o(i||"").replace(/\D/g,"").startsWith("010")||o(d||"").replace(/\D/g,"").startsWith("015")&&o(i||"").replace(/\D/g,"").startsWith("010"))&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رسوم التحويل"}),e.jsx(F,{type:"number",value:H,onChange:t=>Y(t.target.value),placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"تُخصم من المحفظة وتضاف للدرج"})]})]}),e.jsx(P,{id:"txSubmitButton",type:"submit",className:"w-full",children:j==="transfer"?"إرسال التحويل":"تنفيذ السحب"})]})})]}),e.jsxs(b,{children:[e.jsx(v,{children:e.jsx(y,{children:"المعاملات الأخيرة"})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4 max-h-[210px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:D.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="completed"&&e.jsx(Le,{className:"h-5 w-5 text-green-500"}),t.status==="pending"&&e.jsx(Ie,{className:"h-5 w-5 text-yellow-500"}),t.status==="failed"&&e.jsx(Pe,{className:"h-5 w-5 text-red-500"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[t.type==="send"?"تحويل":"سحب"," - ",t.amount.toLocaleString()," جنيه"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["من ",t.senderPhone," إلى ",t.receiverPhone]})]})]}),e.jsx(Ee,{variant:t.status==="completed"?"default":t.status==="pending"?"secondary":"destructive",children:t.status==="completed"?"مكتمل":t.status==="pending"?"قيد المعالجة":"فشل"})]},t.id))})})]})]})]})},rt=()=>{const m=ke(),[A,s]=a.useState(!1),[S,d]=a.useState(!0);return a.useEffect(()=>{(()=>{const i=localStorage.getItem("dashboardAuth"),w=localStorage.getItem("dashboardUser");if(i==="true"&&w)try{const f=JSON.parse(w),C=new Date(f.loginTime);(new Date().getTime()-C.getTime())/(1e3*60*60)<24?s(!0):(localStorage.removeItem("dashboardAuth"),localStorage.removeItem("dashboardUser"),m("/dashboard/login"))}catch(f){console.error("Error parsing user data:",f),m("/dashboard/login")}else m("/dashboard/login");d(!1)})()},[m]),S?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):A?e.jsx(Fe,{}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})})};export{rt as default};
