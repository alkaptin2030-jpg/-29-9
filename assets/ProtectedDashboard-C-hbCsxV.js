import{d as Y,u as Z,Q as ee,r as a,j as e,U as te,V as se,C as ae,O as U,i as z,k as J,p as le,q as ne,W as oe,a as ce}from"./index-Drf-Kel-.js";import{C as u,a as x,b as h,d as f}from"./card-B-oThBGQ.js";import{B as E}from"./button-BeXYwqdJ.js";import{I as P}from"./input-BS89kG9l.js";import{B as re}from"./badge-UZez9OVE.js";import{S as ie,a as de,b as me,c as ue,d as V}from"./select-D1NXV2xv.js";import{M as xe}from"./MasterPinDialog-RsfCUjbM.js";import{D as M}from"./dollar-sign-Cd9rZkui.js";import{W as he}from"./wallet-CAoLqm49.js";import{a as q}from"./eye-DCMRqakt.js";import{C as fe}from"./circle-check-big-Byeak2Hh.js";import{C as ge}from"./circle-x-C9dwYXo5.js";import"./index-CexbHjis.js";import"./Combination-CwHaGt6n.js";import"./index-D3Q9cnmm.js";import"./check-Cq7Xk3YP.js";import"./label-LMuypoA6.js";import"./dialog-BnpzTiyj.js";import"./shield-DmIh40Jt.js";import"./circle-alert-QaHEPkjm.js";import"./lock-D5jTNF9R.js";const pe=()=>{const{toast:r}=Y(),{signOut:T,user:t,profile:g}=Z();ee();const[p,L]=a.useState("01030302038"),[j,y]=a.useState(""),[c,S]=a.useState(""),[b,R]=a.useState("transfer"),[v,O]=a.useState([]);a.useState("all"),a.useState(!1);const[H,je]=a.useState(""),[K,ye]=a.useState([]);a.useState(null),a.useState(!1),a.useState([]),a.useState([]),a.useState(!1),a.useState("daily");const[be,W]=a.useState([]),[D,w]=a.useState(0),[F,I]=a.useState({});a.useState(!1),a.useState(!1),a.useState(!1),a.useState(!1),a.useState(!1),a.useState(""),a.useState(!1);const[Q,_]=a.useState(!1),[B,$]=a.useState(()=>{try{const s=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled";return(localStorage.getItem(s)??localStorage.getItem("dailyReportsLockEnabled"))==="true"}catch{return!1}}),[X,k]=a.useState(!1);a.useEffect(()=>{try{const s=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled",l=localStorage.getItem(s)??localStorage.getItem("dailyReportsLockEnabled");$(l==="true")}catch{}},[t==null?void 0:t.uid]);const A=async s=>{if(t)try{const l=await U.getById(t.uid);if(l!=null&&l.shopId){const n=z(J,"dashboardData",l.shopId);await oe(n,s)}}catch(l){console.error("Error saving to Firebase:",l),r({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ البيانات في Firebase",variant:"destructive"})}};a.useEffect(()=>{if(!t)return;(async()=>{_(!0);try{const l=await U.getById(t.uid);if(l!=null&&l.shopId){const n=z(J,"dashboardData",l.shopId),i=await le(n);if(i.exists()){const o=i.data();w(o.cashBalance||0),I(o.walletBalances||{}),W(o.deletedTransactions||[])}else{const o={cashBalance:0,walletBalances:{},deletedTransactions:[]};await ne(n,o),w(o.cashBalance),I(o.walletBalances),W(o.deletedTransactions)}}}catch(l){console.error("Error loading data from Firebase:",l);const n=`cashBalance_${(t==null?void 0:t.uid)||"default"}`,i=`userCashBalance_${(t==null?void 0:t.uid)||"default"}`,o=`walletBalances_${(t==null?void 0:t.uid)||"default"}`,C=localStorage.getItem(n);if(C!=null)w(parseFloat(C));else{const d=localStorage.getItem(i);if(d!=null){const m=parseFloat(d);if(!Number.isNaN(m)){w(m);try{localStorage.setItem(n,m.toString()),localStorage.removeItem(i)}catch{}}}}const N=localStorage.getItem(o);I(N?JSON.parse(N):{})}finally{_(!1)}})()},[t]),a.useEffect(()=>{try{const s=`cashBalance_${(t==null?void 0:t.uid)||"default"}`;localStorage.setItem(s,String(D||0))}catch{}},[D,t==null?void 0:t.uid]),a.useEffect(()=>{try{const s=`walletBalances_${(t==null?void 0:t.uid)||"default"}`;localStorage.setItem(s,JSON.stringify(F||{}))}catch{}},[F,t==null?void 0:t.uid]);const G=async s=>{if(s.preventDefault(),b==="transfer"){if(!p||!j||!c){r({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const l=(g==null?void 0:g.shopName)||(t==null?void 0:t.displayName)||"محل كاشي لينك",n=K.find(d=>d.id===H)||K.find(d=>d.isDefault),i={id:Date.now().toString(),type:"send",senderPhone:p,receiverPhone:j,amount:parseFloat(c),status:"pending",createdAt:new Date,withdrawnAmount:0,sentAmount:parseFloat(c),merchantShopName:l,shopName:(n==null?void 0:n.name)||"المحفظة الرئيسية"},o=[i,...v];O(o),await A({transactions:o});const C=parseFloat(c)*.02,N=D-C;w(N),await A({cashBalance:N}),r({title:"تم إرسال التحويل",description:"جاري معالجة التحويل..."}),setTimeout(async()=>{const m=[{...i,status:"completed"},...v];O(m),await A({transactions:m})},2e3),L("01030302038"),y(""),S("")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-center",children:"جاري تحميل البيانات..."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"لوحة تحكم الإدارة"}),e.jsxs(E,{onClick:T,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"تسجيل الخروج"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(u,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"الرصيد النقدي"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[D.toLocaleString()," جنيه"]})})]}),e.jsxs(u,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"الأرصدة علي المحافظ"}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[Object.values(F).reduce((s,l)=>s+l,0).toLocaleString()," جنيه"]})})]}),e.jsxs(u,{className:"relative",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"المعاملات اليوم"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{className:B?"filter blur-sm pointer-events-none":"",children:e.jsx("div",{className:"text-2xl font-bold",children:v.length})}),B&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60",children:e.jsxs(E,{size:"sm",variant:"ghost",onClick:()=>k(!0),className:"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all",title:"عرض تقارير اليوم",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"عرض تقارير اليوم"})]})})]}),e.jsxs(u,{className:"relative",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"إجمالي اليوم"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{className:B?"filter blur-sm pointer-events-none":"",children:e.jsxs("div",{className:"text-2xl font-bold",children:[v.reduce((s,l)=>s+l.amount,0).toLocaleString()," جنيه"]})}),B&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60",children:e.jsxs(E,{size:"sm",variant:"ghost",onClick:()=>k(!0),className:"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all",title:"عرض تقارير اليوم",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"عرض تقارير اليوم"})]})})]}),e.jsx(xe,{open:X,onOpenChange:k,mode:"verify",title:"قفل تقارير اليوم",description:"لا يمكن الاطلاع على تقارير اليوم إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{$(!1),k(!1)}})]}),e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(h,{children:"إجراء معاملة جديدة"})}),e.jsx(f,{children:e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نوع المعاملة"}),e.jsxs(ie,{value:b,onValueChange:s=>R(s),children:[e.jsx(de,{children:e.jsx(me,{})}),e.jsxs(ue,{children:[e.jsx(V,{value:"transfer",children:"تحويل"}),e.jsx(V,{value:"withdraw",children:"سحب"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المرسل"}),e.jsx(P,{type:"tel",value:p,onChange:s=>L(s.target.value),onKeyDown:s=>{if(s.key==="Enter"){const l=document.getElementById("receiverPhoneInput");if(l)l.focus();else{const n=document.getElementById("amountInput");n==null||n.focus()}}},placeholder:"01xxxxxxxxx"})]}),b==="transfer"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المستقبل"}),e.jsx(P,{id:"receiverPhoneInput",type:"tel",value:j,onChange:s=>y(s.target.value),onKeyDown:s=>{if(s.key==="Enter"){const l=document.getElementById("amountInput");l==null||l.focus()}},placeholder:"01xxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"المبلغ"}),e.jsx(P,{id:"amountInput",type:"number",value:c,onChange:s=>S(s.target.value),onKeyDown:s=>{if(s.key==="Enter"){const l=document.getElementById("txSubmitButton");l==null||l.focus()}},placeholder:"0.00"})]})]}),e.jsx(E,{id:"txSubmitButton",type:"submit",className:"w-full",children:b==="transfer"?"إرسال التحويل":"تنفيذ السحب"})]})})]}),e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(h,{children:"المعاملات الأخيرة"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4 max-h-[210px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:v.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="completed"&&e.jsx(fe,{className:"h-5 w-5 text-green-500"}),s.status==="pending"&&e.jsx(ae,{className:"h-5 w-5 text-yellow-500"}),s.status==="failed"&&e.jsx(ge,{className:"h-5 w-5 text-red-500"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.type==="send"?"تحويل":"سحب"," - ",s.amount.toLocaleString()," جنيه"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["من ",s.senderPhone," إلى ",s.receiverPhone]})]})]}),e.jsx(re,{variant:s.status==="completed"?"default":s.status==="pending"?"secondary":"destructive",children:s.status==="completed"?"مكتمل":s.status==="pending"?"قيد المعالجة":"فشل"})]},s.id))})})]})]})]})},Ue=()=>{const r=ce(),[T,t]=a.useState(!1),[g,p]=a.useState(!0);return a.useEffect(()=>{(()=>{const j=localStorage.getItem("dashboardAuth"),y=localStorage.getItem("dashboardUser");if(j==="true"&&y)try{const c=JSON.parse(y),S=new Date(c.loginTime);(new Date().getTime()-S.getTime())/(1e3*60*60)<24?t(!0):(localStorage.removeItem("dashboardAuth"),localStorage.removeItem("dashboardUser"),r("/dashboard/login"))}catch(c){console.error("Error parsing user data:",c),r("/dashboard/login")}else r("/dashboard/login");p(!1)})()},[r]),g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):T?e.jsx(pe,{}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})})};export{Ue as default};
