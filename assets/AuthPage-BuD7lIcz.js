import{b as E,a as L,r as l,u as P,c as I,j as t,N as $,I as d,B as h,L as z,S as A}from"./index-Bp5r4OnK.js";import{C as q,a as B,b as F,d as _}from"./card-CJtgt22j.js";import{getCachedOrEnvAppDownloads as M,getAppDownloads as R,resolveDownloadUrl as x}from"./appDownloadService-BdMq41zN.js";import{B as T}from"./BrandLogo-D_YGEepM.js";import{D as p}from"./download-CMHEMId1.js";import{M as j}from"./brandingService-C8X_E8ms.js";const H=m=>{const u=m.replace(/\D/g,"");return/^01(0|1|2|5)\d{8}$/.test(u)};function W(){const[m]=E(),u=L(),y=m.get("mode")||"signin",[n,N]=l.useState(y==="signup"),[f,v]=l.useState(!1),[e,w]=l.useState(M()),[a,o]=l.useState({email:"",password:"",fullName:"",phone:""}),{signIn:b,signUp:C,user:U}=P();l.useEffect(()=>{try{const r=typeof window<"u"?window.localStorage.getItem("cashy:lastEmail"):null;r&&o(s=>({...s,email:r,password:""}))}catch{}},[]);const{toast:i}=I();if(U)return t.jsx($,{to:"/dashboard-redirect",replace:!0});l.useEffect(()=>{(async()=>{try{const r=await R();w(r||{})}catch(r){console.error("Failed to load app downloads",r)}})()},[]);const S=async r=>{if(r.preventDefault(),f){i({title:"جارٍ التنفيذ",description:"يرجى الانتظار حتى تكتمل العملية"});return}if(typeof navigator<"u"&&navigator.onLine===!1){i({title:"لا يوجد اتصال",description:"تحقق من اتصال الإنترنت ثم أعد المحاولة",variant:"destructive"});return}v(!0);try{if(n){const s=(a.email||"").trim().toLowerCase(),g=(a.password||"").trim();if(!H(a.phone))throw i({title:"رقم غير صالح",description:"يجب أن يكون رقم مصري 11 رقم ويبدأ بـ 010/011/012/015",variant:"destructive"}),new Error("رقم الهاتف غير صالح");const{error:c}=await C(s,g,a.fullName,a.phone);if(c)throw c;i({title:"تم إنشاء الحساب بنجاح!",description:"تحقق من بريدك الإلكتروني لتفعيل الحساب"});const k=a.fullName||"التاجر الجديد";u(`/user/account-setup?user_name=${encodeURIComponent(k)}`)}else{const s=(a.email||"").trim().toLowerCase(),g=(a.password||"").trim();if(!/^\S+@\S+\.\S+$/.test(s))throw new Error("صيغة البريد الإلكتروني غير صحيحة");const{error:c}=await b(s,g);if(c)throw c;i({title:"مرحباً بك!",description:"تم تسجيل الدخول بنجاح، جاري إعداد حسابك..."})}}catch(s){i({title:"خطأ",description:s.message||"حدث خطأ أثناء المعالجة",variant:"destructive"})}finally{v(!1)}};return t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:t.jsxs(q,{className:"w-full max-w-md",children:[t.jsxs(B,{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[t.jsx(T,{size:32}),t.jsx("span",{className:"text-xl font-bold",children:"CashyLink"})]}),t.jsx(F,{children:n?"إنشاء حساب جديد":"تسجيل الدخول"})]}),t.jsxs(_,{children:[t.jsxs("form",{onSubmit:S,className:"space-y-4",children:[n&&t.jsxs(t.Fragment,{children:[t.jsx(d,{placeholder:"الاسم الكامل",value:a.fullName,onChange:r=>o({...a,fullName:r.target.value}),required:!0}),t.jsx(d,{placeholder:"رقم مصري (11 رقم يبدأ بـ 010/011/012/015)",value:a.phone,onChange:r=>o({...a,phone:r.target.value}),dir:"ltr",inputMode:"numeric",required:!0})]}),t.jsx(d,{type:"email",placeholder:"البريد الإلكتروني",value:a.email,onChange:r=>{const s=r.target.value;o({...a,email:s});try{window.localStorage.setItem("cashy:lastEmail",s)}catch{}},required:!0}),t.jsx(d,{type:"password",placeholder:"كلمة المرور",value:a.password,onChange:r=>o({...a,password:r.target.value}),autoComplete:n?"new-password":"off",required:!0}),t.jsx(h,{type:"submit",className:"w-full btn-primary",onClick:r=>{if(f){r.preventDefault(),r.stopPropagation(),i({title:"جارٍ التنفيذ",description:"يرجى الانتظار حتى تكتمل العملية"});return}typeof navigator<"u"&&navigator.onLine===!1&&(r.preventDefault(),r.stopPropagation(),i({title:"لا يوجد اتصال",description:"تحقق من اتصال الإنترنت ثم أعد المحاولة",variant:"destructive"}))},children:f?"جاري المعالجة...":n?"إنشاء الحساب":"تسجيل الدخول"})]}),t.jsxs("div",{className:"text-center mt-6",children:[t.jsx("span",{className:"text-muted-foreground",children:n?"لديك حساب؟":"ليس لديك حساب؟"}),t.jsx(h,{variant:"link",onClick:()=>N(!n),className:"text-primary",children:n?"تسجيل الدخول":"إنشاء حساب"})]}),t.jsx("div",{className:"text-center mt-4",children:t.jsx(z,{to:"/",children:t.jsx(h,{variant:"ghost",className:"text-muted-foreground",children:"العودة للصفحة الرئيسية"})})}),t.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 justify-center items-center",children:[t.jsxs("a",{href:x(e==null?void 0:e.androidUrl)||"#",onClick:r=>{e!=null&&e.androidUrl||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${e!=null&&e.androidUrl?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(e!=null&&e.androidUrl),target:"_blank",rel:"noopener noreferrer",children:[t.jsx(A,{className:"h-5 w-5"}),"تحميل للأندرويد",t.jsx(p,{className:"h-4 w-4"})]}),t.jsxs("a",{href:x(e==null?void 0:e.pcUrl)||"#",onClick:r=>{e!=null&&e.pcUrl||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${e!=null&&e.pcUrl?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(e!=null&&e.pcUrl),target:"_blank",rel:"noopener noreferrer",children:[t.jsx(j,{className:"h-5 w-5"}),"تحميل تطبيق الكمبيوتر نسخة 64 بت",t.jsx(p,{className:"h-4 w-4"})]}),t.jsxs("a",{href:x(e==null?void 0:e.pc32Url)||"#",onClick:r=>{e!=null&&e.pc32Url||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${e!=null&&e.pc32Url?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(e!=null&&e.pc32Url),target:"_blank",rel:"noopener noreferrer",children:[t.jsx(j,{className:"h-5 w-5"}),"تحميل تطبيق الكمبيوتر نسخة 32 بت",t.jsx(p,{className:"h-4 w-4"})]})]})]})]})})}export{W as default};
