import{u as L,a as O,r as i,k as H,g as G,m as V,F as h,j as e,C as $,i as n,n as B,S as _,p as z}from"./index-B05GXhax.js";import{C as W,a as Z,b as q,d as M}from"./card-DnZtAmLe.js";import{B as m}from"./button-DNYNxb0H.js";import{a as J}from"./whatsappService-VfK5XhOP.js";import{C as K}from"./circle-alert-BXSlfsUr.js";import{S as Q}from"./shield-Cr4chWJ5.js";import{L as j}from"./lock-BshQ53fM.js";import{G as X}from"./gift-CCjdLa8p.js";import{C as N}from"./circle-check-big-dbSAJ0fm.js";import{R as y}from"./refresh-cw-C6Cq1ycK.js";function oe(){const{user:s,signOut:w,userSubscription:A,isSubscriptionActive:p,checkSubscriptionStatus:d}=L(),l=O(),[u,x]=i.useState(!1),[b,f]=i.useState(!1),[P,S]=i.useState(!1),[T,k]=i.useState(!1),[c,C]=i.useState(24),E=[{key:"monthly",name:"الباقة الشهرية",price:"199 جنيه",features:["إدارة المحافظ والمعاملات","تقارير يومية مفصلة","دعم فني على مدار الساعة"]},{key:"quarterly",name:"الباقة ربع سنوية",price:"549 جنيه",features:["عدد 2 كاشير","تقارير فصلية","دعم أسرع"]},{key:"yearly",name:"الباقة السنوية",price:"1999 جنيه",features:["كل ميزات الشهرية","خصم سنوي مميز","أولوية في الدعم الفني"]},{key:"lifetime",name:"اشتراك مدى الحياة",price:"4999 جنيه",features:["وصول دائم بدون انتهاء","بدون تجديدات","دعم مميز"]}];i.useEffect(()=>{if(!(s!=null&&s.uid))return;console.log("🔍 PendingApprovalPage: Setting up real-time subscription monitoring for user:",s.uid);const r=H(G,"users",s.uid),t=V(r,o=>{var g;if(o.exists()){const a=o.data();if(console.log("📊 PendingApprovalPage: User data updated:",{userId:s.uid,isApproved:a.isApproved,approved:a.approved,freeTrialActive:a.freeTrialActive,subscription:a.subscription,subscriptionActive:(g=a.subscription)==null?void 0:g.isActive}),a.isApproved||a.freeTrialActive||a.approved){console.log("✅ PendingApprovalPage: User approved or trial active, redirecting..."),n.success("تم تفعيل حسابك! جاري التوجيه..."),setTimeout(()=>{l("/user/dashboard")},1500);return}if(a.subscription&&a.subscription.isActive){const v=z(a.subscription);if(console.log("🔍 PendingApprovalPage: Subscription validation result:",{hasSubscription:!!a.subscription,isActive:a.subscription.isActive,isValid:v,planType:a.subscription.planType}),v){console.log("✅ PendingApprovalPage: Valid subscription found, redirecting to dashboard..."),n.success("تم تفعيل اشتراكك! جاري التوجيه إلى لوحة التحكم..."),setTimeout(()=>{l("/user/dashboard")},1500);return}}}},o=>{console.error("❌ PendingApprovalPage: Error in real-time listener:",o)});return()=>{console.log("🔌 PendingApprovalPage: Cleaning up real-time listener"),t()}},[s==null?void 0:s.uid,l]),i.useEffect(()=>{const r=t=>{const{userId:o,planType:g}=t.detail;console.log("🎉 PendingApprovalPage: Subscription activation event received:",{userId:o,planType:g,currentUserId:s==null?void 0:s.uid}),o===(s==null?void 0:s.uid)&&(console.log("✅ PendingApprovalPage: Subscription activated for current user"),n.success("تم تفعيل اشتراكك! جاري التوجيه إلى لوحة التحكم..."),setTimeout(async()=>{await d(),l("/user/dashboard")},1500))};return console.log("🔔 PendingApprovalPage: Setting up subscription activation listener"),window.addEventListener("subscriptionActivated",r),()=>{console.log("🔌 PendingApprovalPage: Cleaning up subscription activation listener"),window.removeEventListener("subscriptionActivated",r)}},[s==null?void 0:s.uid,l,d]),i.useEffect(()=>{console.log("🔍 PendingApprovalPage: Checking subscription status on load:",{isSubscriptionActive:p,hasUserSubscription:!!A}),p&&(console.log("✅ PendingApprovalPage: Active subscription detected, redirecting..."),l("/user/dashboard"))},[p,l]),i.useEffect(()=>{if(!(s!=null&&s.uid))return;const r=setInterval(async()=>{console.log("🔄 PendingApprovalPage: Periodic subscription status check"),await d()},3e4);return()=>{clearInterval(r)}},[s==null?void 0:s.uid,d]),i.useEffect(()=>{(async()=>{if(s!=null&&s.uid)try{const t=await h.getTrialData(s.uid);S(t.hasUsedFreeTrial),k(t.isOnFreeTrial)}catch(t){console.error("خطأ في تحميل حالة التجربة المجانية:",t)}})()},[s==null?void 0:s.uid]),i.useEffect(()=>{(async()=>{try{const r=await h.getTrialDurationHours();C(r)}catch(r){console.error("خطأ في تحميل مدة التجربة المجانية:",r)}})()},[]);const I=async()=>{await w(),l("/auth")},R=async()=>{if(s!=null&&s.uid){x(!0);try{await B(s.uid,_.ZERO,s.uid),n.success("تم تفعيل باقة الزيرو! جاري التوجيه..."),setTimeout(()=>{l("/user/dashboard")},1500)}catch(r){console.error("Error activating zero plan:",r),n.error("حدث خطأ في تفعيل باقة الزيرو")}finally{x(!1)}}},D=async()=>{if(s!=null&&s.uid){x(!0);try{const r=await h.startFreeTrial(s.uid);r.success?(n.success(r.message||`تم تفعيل التجربة المجانية لمدة ${c} ${c>=3&&c<=10?"ساعات":c===2?"ساعتين":"ساعة"}! جاري التوجيه...`),setTimeout(()=>{l("/user/dashboard")},1500)):n.error(r.message)}catch(r){console.error("Error activating trial:",r),n.error("حدث خطأ في تفعيل التجربة المجانية")}finally{x(!1)}}},F=async()=>{f(!0),console.log("🔄 PendingApprovalPage: Manual refresh triggered");try{await d(),n.success("تم تحديث البيانات")}catch(r){console.error("❌ Error during manual refresh:",r),n.error("حدث خطأ أثناء التحديث")}finally{f(!1)}},U=async r=>{try{const t=await J(r.name,r.price,r.features);window.open(t,"_blank")}catch(t){console.error("❌ خطأ في إنشاء رابط الواتساب:",t),n.error("تعذر فتح واتساب، حاول لاحقًا")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-background to-yellow-50 flex items-center justify-center p-4",children:e.jsxs(W,{className:"w-full max-w-md shadow-lg",children:[e.jsxs(Z,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-4",children:e.jsx("div",{className:"h-12 w-12 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-full flex items-center justify-center",children:e.jsx($,{className:"h-6 w-6 text-white"})})}),e.jsx(q,{className:"text-2xl font-bold text-gray-800",children:"في انتظار الموافقة"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"حسابك قيد المراجعة من قبل الإدارة"})]}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{className:"h-5 w-5 text-orange-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-orange-800 mb-1",children:"حالة الحساب: في انتظار الموافقة"}),e.jsx("p",{className:"text-sm text-orange-700",children:"تم إنشاء حسابك بنجاح ولكنه يحتاج إلى موافقة من الإدارة قبل أن تتمكن من الوصول إلى لوحة التحكم."})]})]})}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-1",children:"معلومات الحساب"}),e.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["البريد الإلكتروني: ",s==null?void 0:s.email]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["تاريخ التسجيل: ",new Date().toLocaleDateString("ar-EG")]})]})]})}),!P&&!T&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"h-6 w-6 text-green-600 mt-0.5"}),e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsx("h3",{className:"font-medium text-green-800 mb-1",children:"🚀 فعّل باقة الزيرو الآن"}),e.jsx("p",{className:"text-sm text-green-700 leading-relaxed",children:"لا تنتظر الموافقة! فعّل باقة الزيرو المجانية وادخل مباشرة إلى لوحة المستخدم."}),e.jsxs("ul",{className:"text-xs text-green-600 space-y-1",children:[e.jsx("li",{children:"• إدارة المحافظ والمعاملات"}),e.jsx("li",{children:"• تقارير مفصلة"}),e.jsx("li",{children:"• دعم فني كامل"}),e.jsx("li",{children:"• جميع الميزات المتقدمة"})]}),e.jsxs("div",{className:"space-y-3 md:fixed md:bottom-8 md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-3xl md:px-4 md:py-4 md:bg-white/95 md:backdrop-blur-sm md:border md:border-gray-200 md:rounded-2xl md:shadow-2xl md:z-50",children:[e.jsx(m,{onClick:D,disabled:u,className:"w-full max-w-2xl mx-auto bg-gradient-to-r from-blue-600 to-indigo-600 hover:brightness-110 text-white text-lg font-bold py-3 px-6 rounded-xl ring-2 ring-blue-400 ring-offset-1 shadow-lg focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-400",children:u?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"جاري التفعيل..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsx("span",{children:`التجربة المجانية لمدة ${c} ${c>=3&&c<=10?"ساعات":c===2?"ساعتين":"ساعة"}`})]})}),e.jsx(m,{onClick:R,disabled:u,className:"w-full max-w-2xl mx-auto mt-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:brightness-110 text-white text-lg font-bold py-3 px-6 rounded-xl ring-2 ring-emerald-400 ring-offset-1 shadow-lg focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-emerald-400",children:u?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"جاري التفعيل..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{children:"فعّل باقة الزيرو الآن"})]})})]})]})]})}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-1",children:"أو انتظر الموافقة الكاملة"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• سيتم مراجعة حسابك من قبل فريق الإدارة"}),e.jsx("li",{children:"• ستتلقى إشعاراً عند الموافقة على حسابك"}),e.jsx("li",{children:"• يمكنك تسجيل الدخول مرة أخرى بعد الموافقة"})]})]})]})}),e.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"h-5 w-5 text-emerald-600 mt-0.5"}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"اختر باقة الاشتراك"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:'اضغط على "اشترك الآن" للتواصل عبر واتساب وبدء الاشتراك مباشرة.'}),e.jsx("div",{className:"space-y-3",children:E.map(r=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-700",children:["السعر: ",r.price]}),e.jsx("ul",{className:"mt-1 text-xs text-gray-600 list-disc list-inside",children:r.features.map(t=>e.jsx("li",{children:t},t))})]}),e.jsx(m,{onClick:()=>U(r),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"اشترك الآن"})]},r.key))})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{onClick:F,disabled:b,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700",children:b?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"جاري التحديث..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:"تحديث الصفحة"})]})}),e.jsx(m,{variant:"outline",onClick:I,className:"w-full border-gray-300 text-gray-700 hover:bg-gray-50",children:"تسجيل الخروج"})]}),e.jsxs("div",{className:"text-center pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"حسابك في انتظار التفعيل من قبل المسؤول"}),e.jsx("p",{className:"text-sm font-semibold text-orange-700 mb-3 bg-orange-50 p-3 rounded-lg border border-orange-200",children:"للتفعيل السريع: تواصل مع الإدارة عبر واتساب فقط على الرقم التالي"}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200 mb-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-base font-bold text-green-700",children:"واتساب الإدارة:"}),e.jsx("a",{href:"https://wa.me/201000392539",target:"_blank",rel:"noopener noreferrer",className:"text-lg font-bold text-green-600 hover:text-green-700 underline",children:"01000392539"})]}),e.jsx("p",{className:"text-sm text-green-600 mt-2",children:"اضغط على الرقم للتواصل المباشر عبر واتساب"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-base font-bold text-blue-700",children:"البريد الإلكتروني للإدارة:"}),e.jsx("a",{href:"mailto:info@cashy-link.com",className:"text-lg font-bold text-blue-600 hover:text-blue-700 underline",children:"info@cashy-link.com"})]}),e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"راسلنا بالبريد في حال وجود أي مشكلة بالتفعيل"})]})]})]})]})})}export{oe as default};
