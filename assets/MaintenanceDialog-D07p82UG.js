import{c as K,d as ne,R as v,j as e,aB as ue,X as ge,r as x,a6 as se,a5 as fe,aC as je,u as be,ap as ye,C as Ne}from"./index-DLB6adv0.js";import{D as M,a as T,b as B,c as z}from"./dialog-CsPLQ8Z0.js";import{B as c}from"./button-CaTNqGZH.js";import{C as V,d as J,a as H,b as W}from"./card-Curo_9Lp.js";import{a as q,P as ve}from"./separator-COiasg2p.js";import{B as L}from"./badge-DLBkvxFR.js";import{a as R}from"./MasterPinDialog-Yign3RaM.js";import{T as X,P as we}from"./progress-CKg6hE9M.js";import{C as Q}from"./circle-check-big-DbAXO5YF.js";import{L as te}from"./lock-Bi1iD8yC.js";import{E as ae,a as le}from"./eye-JFptnmdo.js";import{I as N}from"./input-9quFkSAk.js";import{L as F}from"./label-Dvr0e7z3.js";import{C as re}from"./circle-alert-_g7YJ02S.js";import{C as ie}from"./calendar-D2wkyE0n.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=K("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=K("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=K("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),Re=({isOpen:A,onClose:C,transaction:a,onPrint:h,onDelete:g,onComplete:f})=>{const{toast:o}=ne(),[p,j]=v.useState(!1),[l,d]=v.useState(""),[D,u]=v.useState(!1),[k,m]=v.useState(""),[S,E]=v.useState(!1),[$,w]=v.useState(!1),[P,b]=v.useState(""),[s,t]=v.useState(!1),[n,i]=v.useState(""),[y,O]=v.useState(!1);if(!a)return null;const de=r=>{switch(r){case"completed":return e.jsx(L,{className:"bg-green-100 text-green-800 border-green-200",children:"مكتملة"});case"pending":return e.jsx(L,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"قيد المراجعة"});case"failed":return e.jsx(L,{className:"bg-red-100 text-red-800 border-red-200",children:"فاشلة"});default:return e.jsx(L,{className:"bg-gray-100 text-gray-800 border-gray-200",children:r})}},Y=r=>r==="transfer"?"تحويل":"سحب",ce=r=>new Date(r).toLocaleString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=r=>{if((r==null?void 0:r.totalCharged)!==void 0&&(r==null?void 0:r.totalCharged)!==null)return Number(r.totalCharged)||0;const I=Number(r.commission||0),_=Number(r.amount||0);return(r==null?void 0:r.commissionMode)==="add"?_+I:_},oe=Z(a),me=r=>{switch(r){case"completed":return"مكتملة";case"pending":return"قيد المراجعة";case"failed":return"فاشلة";default:return r}},xe=()=>{try{const r=me(a.status),I=Y(a.type),_=(a==null?void 0:a.shopName)||"غير محدد",U=(a==null?void 0:a.cashierName)||"",ee=a.reference||a.id,he=new Date(a.createdAt).toLocaleString("ar-EG"),pe=`
        <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 520px; margin: 0 auto; padding: 24px; background: #fff; direction: rtl;">
          <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #2563eb; padding-bottom: 16px;">
            <h1 style="color: #2563eb; margin: 0 0 6px 0; font-size: 26px;">إيصال المعاملة</h1>
            <p style="color: #666; font-size: 14px; margin: 0;">رقم المرجع: ${ee}</p>
            <p style="color: #888; font-size: 13px; margin: 6px 0 0 0;">${he}</p>
          </div>

          <div style="background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
            <h3 style="color: #1e293b; margin: 0 0 12px 0; font-size: 16px;">معلومات المحل</h3>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-weight: 600; color: #475569;">اسم المحل:</span>
              <span style="color: #1e293b;">${_}</span>
            </div>
            ${U?`<div style="display:flex; justify-content:space-between;">
              <span style="font-weight:600; color:#475569;">الكاشير:</span>
              <span style="color:#1e293b;">${U}</span>
            </div>`:""}
          </div>

          <div style="background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px;">
            <h3 style="color: #1e293b; margin: 0 0 12px 0; font-size: 16px;">تفاصيل المعاملة</h3>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px; padding:6px 0; border-bottom:1px solid #f1f5f9;">
              <span style="font-weight:600; color:#475569;">نوع المعاملة:</span>
              <span style="color:#2563eb; font-weight:600;">${I}</span>
            </div>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px; padding:6px 0; border-bottom:1px solid #f1f5f9;">
              <span style="font-weight:600; color:#475569;">الحالة:</span>
              <span style="color:${a.status==="completed"?"#16a34a":a.status==="pending"?"#ca8a04":"#dc2626"}; font-weight:600;">${r}</span>
            </div>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">من:</span>
              <span style="font-family:monospace;">${a.sender_msisdn}</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">إلى:</span>
              <span style="font-family:monospace;">${a.receiver_msisdn}</span>
            </div>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">المبلغ:</span>
              <span style="font-weight:600;">${a.amount} جنيه</span>
            </div>
            ${a.commission>0?`<div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">العمولة:</span>
              <span>${a.commission} جنيه</span>
            </div>`:""}

            <div style="display:flex; justify-content:space-between; margin-top:10px; font-weight:700; font-size:16px;">
              <span>الإجمالي:</span>
              <span style="color:#2563eb;">${Z(a)} جنيه</span>
            </div>
          </div>
        </div>
      `,G=window.open("","_blank");if(!G)return;G.document.write(`
        <html>
          <head>
            <title>إيصال المعاملة - ${ee}</title>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <style>
              body { margin: 0; padding: 20px; background: #f8fafc; }
              @media print { body { background: white; } }
            </style>
          </head>
          <body dir="rtl">
            ${pe}
          </body>
        </html>
      `),G.document.close(),G.print()}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(M,{open:A,onOpenChange:C,children:e.jsxs(T,{className:"max-w-md w-full mx-auto overflow-hidden",dir:"rtl",children:[e.jsx(B,{className:"text-center",children:e.jsxs(z,{className:"flex items-center justify-center gap-2 text-xl font-bold text-primary",children:[e.jsx(ue,{className:"h-6 w-6"}),"إيصال المعاملة"]})}),e.jsx(V,{className:"border-2 border-primary/20 overflow-hidden rounded-xl",children:e.jsxs(J,{className:"p-6 space-y-4 break-words",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:"كاشي لينك"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["إيصال ",Y(a.type)]}),de(a.status),(a==null?void 0:a.shopName)&&e.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:["المحل: ",a.shopName]}),(a==null?void 0:a.cashierName)&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["الكاشير: ",a.cashierName]})]}),e.jsx(q,{}),e.jsxs("div",{className:"space-y-3 break-words",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"رقم المعاملة:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.id})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"من:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.sender_msisdn})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"إلى:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.receiver_msisdn})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"المبلغ:"}),e.jsxs("span",{className:"text-sm font-semibold",children:[a.amount," جنيه"]})]}),a.commission>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"العمولة:"}),e.jsxs("span",{className:"text-sm",children:[a.commission," جنيه"]})]}),e.jsx(q,{}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"الإجمالي:"}),e.jsxs("span",{className:"text-primary",children:[oe," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"التاريخ:"}),e.jsx("span",{className:"text-sm",children:ce(a.createdAt)})]}),a.reference&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"المرجع:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.reference})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 flex-wrap",children:[g&&e.jsxs(c,{onClick:()=>{m(""),d(""),u(!1),j(!0)},variant:"destructive",size:"lg",className:"flex-1",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"حذف الإيصال"]}),f&&a.status==="pending"&&e.jsxs(c,{onClick:()=>{i(""),b(""),t(!1),w(!0)},className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white",size:"lg",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"إكمال المعاملة"]}),e.jsxs(c,{onClick:xe,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"طباعة الإيصال"]}),e.jsxs(c,{onClick:C,variant:"outline",size:"lg",className:"px-6",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"إغلاق"]})]})]})}),e.jsx(M,{open:p,onOpenChange:j,children:e.jsxs(T,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(B,{children:e.jsxs(z,{className:"flex items-center gap-2 text-center justify-center",children:[e.jsx(te,{className:"h-5 w-5 text-red-600"}),"تأكيد حذف المعاملة"]})}),e.jsx("div",{className:"text-center text-sm text-gray-600 mb-4",children:"أدخل الرقم السري لتأكيد حذف هذه المعاملة"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"deletePin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"deletePin",type:D?"text":"password",autoComplete:"off",value:l,onChange:r=>d(r.target.value),placeholder:"أدخل الرقم السري",className:"pr-10 w-full border rounded-md h-10 px-3",dir:"ltr"}),e.jsx("button",{type:"button",onClick:()=>u(!D),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:D?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(le,{className:"h-4 w-4"})})]})]}),k&&e.jsx("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:k}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(c,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{j(!1),d(""),m(""),u(!1)},disabled:S,children:"إلغاء"}),e.jsx(c,{type:"button",className:"flex-1 bg-red-600 hover:bg-red-700",disabled:S,onClick:async()=>{m(""),E(!0);try{if(!R.hasMasterPin()){m("الرقم السري غير مُعيَّن، يرجى تعيينه أولاً"),o({title:"الرقم السري غير مُعيَّن",description:"يرجى تعيين الرقم السري من إدارة الأرقام السرية قبل الحذف.",variant:"destructive"});return}if(!l){m("يرجى إدخال الرقم السري");return}if(!R.verifyMasterPin(l)){m("الرقم السري غير صحيح"),o({title:"رقم سري غير صحيح",description:"تعذر تنفيذ الحذف بسبب رقم سري خاطئ.",variant:"destructive"});return}try{g&&a&&g(a.id),j(!1),d(""),m(""),u(!1),C()}catch{}}finally{E(!1)}},children:"تأكيد الحذف"})]})]})]})}),e.jsx(M,{open:$,onOpenChange:r=>{r?w(!0):(w(!1),b(""),i(""),t(!1))},children:e.jsxs(T,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(B,{children:e.jsxs(z,{className:"flex items-center gap-2 text-center justify-center",children:[e.jsx(te,{className:"h-5 w-5 text-emerald-600"}),"تأكيد إكمال المعاملة"]})}),e.jsx("div",{className:"text-center text-sm text-gray-600 mb-4",children:"أدخل الرقم السري لتأكيد إكمال هذه المعاملة المؤجلة"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"completePin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"completePin",type:s?"text":"password",autoComplete:"off",value:P,onChange:r=>b(r.target.value),placeholder:"أدخل الرقم السري",className:"pr-10 w-full border rounded-md h-10 px-3",dir:"ltr"}),e.jsx("button",{type:"button",onClick:()=>t(!s),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:s?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(le,{className:"h-4 w-4"})})]})]}),n&&e.jsx("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:n}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(c,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{w(!1),b(""),i(""),t(!1)},disabled:y,children:"إلغاء"}),e.jsx(c,{type:"button",className:"flex-1 bg-emerald-600 hover:bg-emerald-700",disabled:y,onClick:async()=>{i(""),O(!0);try{if(!R.hasMasterPin()){i("الرقم السري غير مُعيَّن، يرجى تعيينه أولاً"),o({title:"الرقم السري غير مُعيَّن",description:"يرجى تعيين الرقم السري من إدارة الأرقام السرية قبل الإكمال.",variant:"destructive"});return}if(!P){i("يرجى إدخال الرقم السري");return}if(!R.verifyMasterPin(P)){i("الرقم السري غير صحيح"),o({title:"رقم سري غير صحيح",description:"تعذر تنفيذ الإكمال بسبب رقم سري خاطئ.",variant:"destructive"});return}try{f&&a&&f(a.id),w(!1),b(""),i(""),t(!1),C()}catch{}}finally{O(!1)}},children:"تأكيد الإكمال"})]})]})]})})]})},Ve=({isOpen:A,onClose:C})=>{console.log("CreditCardsDialog rendered with isOpen:",A);const{toast:a}=ne(),[h,g]=x.useState([]),[f,o]=x.useState(!1),[p,j]=x.useState(null),[l,d]=x.useState({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"}),D=["#8B5CF6","#EF4444","#10B981","#F59E0B","#3B82F6","#EC4899","#6366F1","#14B8A6"];x.useEffect(()=>{const s=localStorage.getItem("creditCards");s&&g(JSON.parse(s))},[]);const u=s=>{localStorage.setItem("creditCards",JSON.stringify(s)),g(s)},k=()=>{if(!l.name||!l.bank||!l.creditLimit){a({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const s=parseFloat(l.creditLimit),t={id:Date.now().toString(),name:l.name,bank:l.bank,creditLimit:s,usedAmount:0,availableAmount:s,startDate:l.startDate,endDate:l.endDate,reminderDate:l.reminderDate,color:l.color},n=[...h,t];u(n),d({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"}),o(!1),a({title:"تم بنجاح",description:"تم إضافة بطاقة الائتمان بنجاح"})},m=s=>{const t=h.filter(n=>n.id!==s);u(t),a({title:"تم الحذف",description:"تم حذف بطاقة الائتمان بنجاح"})},S=s=>{j(s),d({name:s.name,bank:s.bank,creditLimit:s.creditLimit.toString(),startDate:s.startDate,endDate:s.endDate,reminderDate:s.reminderDate,color:s.color}),o(!0)},E=()=>{if(!p)return;const s=parseFloat(l.creditLimit),t={...p,name:l.name,bank:l.bank,creditLimit:s,availableAmount:s-p.usedAmount,startDate:l.startDate,endDate:l.endDate,reminderDate:l.reminderDate,color:l.color},n=h.map(i=>i.id===p.id?t:i);u(n),j(null),o(!1),d({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"}),a({title:"تم التحديث",description:"تم تحديث بطاقة الائتمان بنجاح"})},$=()=>{j(null),o(!1),d({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"})},w=(s,t)=>{const n=h.map(i=>{if(i.id===s){const y=i.usedAmount+t;return y>i.creditLimit?(a({title:"خطأ",description:"المبلغ يتجاوز الحد الائتماني المتاح",variant:"destructive"}),i):{...i,usedAmount:y,availableAmount:i.creditLimit-y}}return i});u(n)},P=s=>s.usedAmount/s.creditLimit*100,b=s=>{if(!s)return!1;const t=new Date,i=new Date(s).getTime()-t.getTime(),y=Math.ceil(i/(1e3*60*60*24));return y<=7&&y>=0};return e.jsx(M,{open:A,onOpenChange:C,children:e.jsxs(T,{className:"max-w-4xl max-h-[95vh] overflow-y-auto p-3 sm:p-6",children:[e.jsx(B,{className:"pb-4",children:e.jsxs(z,{className:"flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(se,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-600"}),"إدارة كروت الائتمان"]})}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[!f&&e.jsxs(c,{onClick:()=>o(!0),className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3 text-base",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"إضافة بطاقة ائتمان جديدة"]}),f&&e.jsxs("div",{className:"bg-gray-50 p-3 sm:p-4 rounded-lg border",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4",children:p?"تعديل بطاقة الائتمان":"إضافة بطاقة ائتمان جديدة"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"cardName",className:"text-sm font-medium",children:"اسم البطاقة"}),e.jsx(N,{id:"cardName",value:l.name,onChange:s=>d({...l,name:s.target.value}),placeholder:"مثال: بطاقة التسوق",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"bankName",className:"text-sm font-medium",children:"اسم البنك"}),e.jsx(N,{id:"bankName",value:l.bank,onChange:s=>d({...l,bank:s.target.value}),placeholder:"مثال: البنك الأهلي",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"creditLimit",className:"text-sm font-medium",children:"الحد الائتماني (جنيه)"}),e.jsx(N,{id:"creditLimit",type:"number",value:l.creditLimit,onChange:s=>d({...l,creditLimit:s.target.value}),placeholder:"10000",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"cardColor",className:"text-sm font-medium",children:"لون البطاقة"}),e.jsx("div",{className:"flex gap-3 mt-2 flex-wrap",children:D.map(s=>e.jsx("button",{type:"button",className:`w-10 h-10 rounded-full border-2 ${l.color===s?"border-gray-800":"border-gray-300"}`,style:{backgroundColor:s},onClick:()=>d({...l,color:s})},s))})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"startDate",className:"text-sm font-medium",children:"تاريخ بداية المدة"}),e.jsx(N,{id:"startDate",type:"date",value:l.startDate,onChange:s=>d({...l,startDate:s.target.value}),className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"endDate",className:"text-sm font-medium",children:"تاريخ نهاية المدة"}),e.jsx(N,{id:"endDate",type:"date",value:l.endDate,onChange:s=>d({...l,endDate:s.target.value}),className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"reminderDate",className:"text-sm font-medium",children:"تاريخ التذكير"}),e.jsx(N,{id:"reminderDate",type:"date",value:l.reminderDate,onChange:s=>d({...l,reminderDate:s.target.value}),className:"mt-1 h-11"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsxs(c,{onClick:p?E:k,className:"bg-green-600 hover:bg-green-700 text-white py-3 text-base flex-1",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),p?"حفظ التعديلات":"إضافة البطاقة"]}),e.jsx(c,{onClick:$,variant:"outline",className:"py-3 text-base flex-1",children:"إلغاء"})]})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:h.length===0?e.jsxs("div",{className:"text-center py-6 sm:py-8 text-gray-500",children:[e.jsx(se,{className:"h-10 w-10 sm:h-12 sm:w-12 mx-auto mb-3 sm:mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm sm:text-base",children:"لا توجد بطاقات ائتمان مضافة بعد"})]}):h.map(s=>e.jsxs("div",{className:"bg-white border-2 rounded-lg p-3 sm:p-4 shadow-sm",style:{borderColor:s.color},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-800",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.bank})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-full transition-colors",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors",children:e.jsx(X,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"حد السحب"}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600",children:[s.availableAmount.toFixed(2)," / ",s.creditLimit.toFixed(2)," ج.م"]})]}),e.jsx(we,{value:P(s),className:"h-2 sm:h-3",style:{"--progress-background":s.color,"--progress-foreground":s.color}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["مستخدم: ",s.usedAmount.toFixed(2)," ج.م"]}),e.jsxs("span",{children:["متاح: ",s.availableAmount.toFixed(2)," ج.م"]})]})]}),b(s.endDate)&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 p-2 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(re,{className:"h-4 w-4 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-orange-700",children:"موعد السداد قريب!"})]}),(s.startDate||s.endDate||s.reminderDate)&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs text-gray-600 mb-3 sm:mb-4",children:[s.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["البداية: ",new Date(s.startDate).toLocaleDateString("ar-EG")]})]}),s.endDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["النهاية: ",new Date(s.endDate).toLocaleDateString("ar-EG")]})]}),s.reminderDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["التذكير: ",new Date(s.reminderDate).toLocaleDateString("ar-EG")]})]})]}),e.jsxs(c,{onClick:()=>{const t=prompt("أدخل مبلغ السحب:");t&&!isNaN(parseFloat(t))&&w(s.id,parseFloat(t))},className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 text-base",disabled:s.availableAmount<=0,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"سحب من البطاقة"]})]},s.id))})]})]})})},Je=({open:A,onOpenChange:C})=>{const{user:a}=be(),h=x.useMemo(()=>`maintenance_items_${(a==null?void 0:a.uid)||"anonymous"}`,[a==null?void 0:a.uid]),[g,f]=x.useState([]),[o,p]=x.useState(""),[j,l]=x.useState(""),[d,D]=x.useState(""),[u,k]=x.useState(""),[m,S]=x.useState("");x.useEffect(()=>{try{const t=localStorage.getItem(h);if(t){const n=JSON.parse(t);f(n)}}catch(t){console.warn("Failed to load maintenance items:",t)}},[h]),x.useEffect(()=>{try{localStorage.setItem(h,JSON.stringify(g))}catch(t){console.warn("Failed to save maintenance items:",t)}},[g,h]);const E=()=>{p(""),l(""),D(""),k(""),S("")},$=t=>{const n=typeof m=="string"?Number(m):m;if(!o.trim()||!n||Number.isNaN(n)||n<=0){alert("يرجى إدخال اسم المنتج والسعر بشكل صحيح");return}const y={id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,productName:o.trim(),faultType:j.trim()||void 0,customerName:d.trim()||void 0,mobile:u.trim()||void 0,price:n,status:t,createdAt:new Date().toISOString()};f(O=>[y,...O]),E()},w=t=>{f(n=>n.map(i=>i.id===t?{...i,status:"completed"}:i))},P=t=>{f(n=>n.filter(i=>i.id!==t))},b=g.filter(t=>t.status==="in_progress"),s=g.filter(t=>t.status==="completed");return e.jsx(M,{open:A,onOpenChange:C,children:e.jsxs(T,{className:"sm:max-w-3xl",children:[e.jsx(B,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-amber-600"}),"إدارة الصيانة"]})}),e.jsxs(V,{className:"mb-3",children:[e.jsx(H,{className:"pb-2",children:e.jsx(W,{className:"text-sm",children:"إضافة منتج للصيانة"})}),e.jsxs(J,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"اسم المنتج"}),e.jsx(N,{value:o,onChange:t=>p(t.target.value),placeholder:"اسم المنتج"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"نوع العطل (اختياري)"}),e.jsx(N,{value:j,onChange:t=>l(t.target.value),placeholder:"نوع العطل"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"اسم العميل (اختياري)"}),e.jsx(N,{value:d,onChange:t=>D(t.target.value),placeholder:"اسم العميل"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"رقم الموبايل (اختياري)"}),e.jsx(N,{value:u,onChange:t=>k(t.target.value),placeholder:"01xxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"السعر"}),e.jsx(N,{value:m,onChange:t=>S(t.target.value),placeholder:"السعر بالجنيه"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(c,{className:"bg-amber-600 hover:bg-amber-700",onClick:()=>$("in_progress"),children:"جاري التصليح"}),e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:()=>$("completed"),children:"تم التصليح"})]})]})]}),e.jsx(q,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3",children:[e.jsxs(V,{children:[e.jsx(H,{className:"pb-2",children:e.jsxs(W,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-amber-600"}),"جاري التصليح",e.jsx(L,{variant:"secondary",className:"ml-auto text-[10px]",children:b.length})]})}),e.jsx(J,{className:"space-y-2 max-h-[280px] overflow-y-auto",children:b.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"لا توجد عناصر قيد التصليح"}):b.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:[t.productName," ",e.jsxs("span",{className:"text-gray-600",children:["— ",t.price," جنيه"]})]}),e.jsxs("p",{className:"text-[11px] text-gray-600",children:[t.faultType||"بدون"," ",t.customerName&&`• ${t.customerName}`," ",t.mobile&&`• ${t.mobile}`]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{size:"sm",className:"h-7 bg-green-600 hover:bg-green-700",onClick:()=>w(t.id),children:"تم التصليح"}),e.jsx(c,{size:"sm",variant:"outline",className:"h-7",onClick:()=>P(t.id),children:e.jsx(X,{className:"h-3 w-3"})})]})]},t.id))})]}),e.jsxs(V,{children:[e.jsx(H,{className:"pb-2",children:e.jsxs(W,{className:"text-sm flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-green-600"}),"تم التصليح",e.jsx(L,{variant:"secondary",className:"ml-auto text-[10px]",children:s.length})]})}),e.jsx(J,{className:"space-y-2 max-h-[280px] overflow-y-auto",children:s.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"لا توجد عناصر منتهية"}):s.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:[t.productName," ",e.jsxs("span",{className:"text-gray-600",children:["— ",t.price," جنيه"]})]}),e.jsxs("p",{className:"text-[11px] text-gray-600",children:[t.faultType||"بدون"," ",t.customerName&&`• ${t.customerName}`," ",t.mobile&&`• ${t.mobile}`]})]}),e.jsx(L,{className:"text-[10px] bg-green-100 text-green-800",children:"مكتمل"})]},t.id))})]})]})]})})};export{_e as C,Je as M,Ce as P,Re as R,Ge as a,Ve as b};
