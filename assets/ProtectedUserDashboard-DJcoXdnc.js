const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UserDashboardPage-C32HEH9-.js","assets/index-B5n92zOC.js","assets/index-CUGoRur3.css","assets/card-Bm7bbC2u.js","assets/button-FeyfJZ27.js","assets/input-BuCYb69R.js","assets/badge-BMAf037M.js","assets/select-D_EklLHY.js","assets/index-BHbUHjHm.js","assets/Combination-BvlzZEg2.js","assets/index-DMk_zi5k.js","assets/check-By7gZRoT.js","assets/dialog-DWoQrafE.js","assets/label-BQI93MKC.js","assets/MasterPinDialog-QpwG2jOl.js","assets/shield-GIlM90pW.js","assets/eye-B6Ir0EyV.js","assets/circle-alert-CNDGjer6.js","assets/lock-C7WYjR2g.js","assets/walletDailyLimitsService-nhG-CgdD.js","assets/progress-CwGSALEp.js","assets/wallet-DJuQWKSi.js","assets/star-B_uA0frr.js","assets/square-pen-rI-EW9vj.js","assets/phone-DvYT0myF.js","assets/arrow-left-q3DG2yuA.js","assets/separator-BXUqC26L.js","assets/calendar-D0htB39F.js","assets/chart-column-Calqz13g.js","assets/dollar-sign-CNEytZ7m.js","assets/bell-nU3diOP2.js","assets/circle-x-vP2qjoNi.js","assets/circle-check-big-C_maXGly.js","assets/store-Bf2NwUHB.js","assets/arrow-right-BCa5d9XU.js","assets/user-CQRrKiqL.js","assets/MaintenanceDialog-Bg5J09SE.js","assets/PasswordConfirmDialog-CQj3KGWh.js","assets/minus-BcBxyNdW.js","assets/WalletsManagement-CQfFAXpW.js","assets/dropdown-menu-BUlvubWb.js","assets/index-B_9yOEiC.js","assets/reportsService-Bp1Io21u.js","assets/ProfileIcon-lUMw1o-n.js","assets/avatars-0dbCB7hN.js","assets/key-round-BNZ_nsUw.js","assets/broadcastService-DKN9DQPo.js","assets/gift-D9ZbdPLF.js","assets/profitService-WOL_cZ8K.js","assets/refresh-cw-DIJQahWn.js"])))=>i.map(i=>d[i]);
import{u as w,r as n,x as D,a as y,j as e,X as S,R as P,_ as k,d as E}from"./index-B5n92zOC.js";import{s as A,E as I}from"./broadcastService-DKN9DQPo.js";import{L as R}from"./link-B-4O_Lsn.js";const j="dismissedBroadcastIds",_=()=>{const{user:a,profile:s,isSubscriptionActive:t,userSubscription:u}=w(),[i,d]=n.useState(null),[r,m]=n.useState(!1),[g,c]=n.useState(!1),b=D(),f=y(),x=n.useMemo(()=>{const o=["global"];return s!=null&&s.shopId&&o.push(`shop:${s.shopId}`),a!=null&&a.uid&&o.push(`user:${a.uid}`),o},[s==null?void 0:s.shopId,a==null?void 0:a.uid]),h=b.pathname.startsWith("/admin");n.useEffect(()=>{if(!a||h)return;const o=A(x,l=>{if(l){d(l);try{const p=localStorage.getItem(j),N=p?JSON.parse(p):[],U=l.id&&N.includes(l.id);m(!U),c(!1),requestAnimationFrame(()=>c(!0))}catch{m(!0),c(!0)}}});return()=>o()},[a,x,h]);const v=()=>{m(!1);try{const o=localStorage.getItem(j),l=o?JSON.parse(o):[],p=i==null?void 0:i.id;p&&!l.includes(p)&&(l.push(p),localStorage.setItem(j,JSON.stringify(l)))}catch{}};return!r||!i?null:e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:`absolute inset-0 bg-black/25 backdrop-blur-sm transition-opacity duration-300 ease-out ${g?"opacity-100":"opacity-0"}`}),e.jsxs("div",{className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[92%] sm:w-auto sm:min-w-[380px] sm:max-w-md md:max-w-lg bg-white shadow-2xl rounded-2xl border border-gray-100 ring-1 ring-black/5 transition-all duration-300 ease-out ${g?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e.jsx("div",{className:"relative overflow-hidden rounded-t-2xl",children:e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 relative",children:[e.jsx("button",{"aria-label":"إغلاق",onClick:v,className:"absolute top-3 right-3 p-2 rounded-full bg-white/10 hover:bg-white/20",children:e.jsx(S,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"p-4",children:e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-white tracking-wide text-center",children:i.title||"إشعار"})})]})}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"text-gray-700 leading-relaxed text-sm sm:text-base",children:i.message}),i.linkUrl&&e.jsxs("button",{"aria-label":"فتح الرابط",title:"فتح الرابط",onClick:()=>{const o=i.linkUrl;/^https?:\/\//i.test(o)?window.open(o,"_blank","noopener"):f(o)},className:"shrink-0 inline-flex items-center gap-2 px-3 py-2 rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 whitespace-nowrap",children:[/^https?:\/\//i.test(i.linkUrl)?e.jsx(I,{className:"w-6 h-6"}):e.jsx(R,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold",children:"فتح الرابط"})]})]})})]})]})},L=P.lazy(()=>k(()=>import("./UserDashboardPage-C32HEH9-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49]))),$=()=>{const a=y(),{user:s,profile:t,loading:u,refreshProfile:i,isSubscriptionActive:d,userSubscription:r,checkSubscriptionStatus:m}=w(),[g,c]=n.useState(!1),{toast:b}=E();return n.useEffect(()=>{const f=async x=>{const{userId:h,isActive:v}=x.detail;console.log("🔔 ProtectedUserDashboard: Subscription update event received:",{userId:h,isActive:v,currentUserId:s==null?void 0:s.uid}),h===(s==null?void 0:s.uid)&&v&&(console.log("✅ ProtectedUserDashboard: Subscription activated for current user, refreshing status"),await m(),c(!0),b({title:"تم تفعيل الاشتراك",description:"مرحباً بك في لوحة التحكم!"}))};return window.addEventListener("userSubscriptionUpdated",f),()=>{window.removeEventListener("userSubscriptionUpdated",f)}},[s==null?void 0:s.uid,m,b]),n.useEffect(()=>{if(console.log("ProtectedUserDashboard - useEffect triggered",{loading:u,user:s?"exists":"null",profile:t?{role:t.role,approved:t.approved}:"null",isSubscriptionActive:d,userSubscription:r?"exists":"null"}),!u){if(!s)console.log("ProtectedUserDashboard - No user, redirecting to login"),a("/user/login");else if(t){if(console.log("ProtectedUserDashboard - Profile found:",{role:t.role,approved:t.approved,isSubscriptionActive:d,hasSubscription:!!(r!=null&&r.subscription)}),t.role==="user"){if(d){console.log("ProtectedUserDashboard - User has active subscription, allowing access"),c(!0);return}if(t.approved===!1){console.log("ProtectedUserDashboard - User not approved and no active subscription, redirecting to pending approval"),a("/user/pending-approval");return}}console.log("ProtectedUserDashboard - User approved or admin, setting authenticated"),c(!0)}}},[s,t,u,a,d,r]),u||!g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):(console.log("ProtectedUserDashboard - Render state:",{isAuthenticated:g,profileRole:t==null?void 0:t.role,profileApproved:t==null?void 0:t.approved,isSubscriptionActive:d,hasSubscription:!!(r!=null&&r.subscription)}),console.log("🔥 ProtectedUserDashboard - user:",s?{uid:s.uid,email:s.email}:"null"),console.log("🔥 ProtectedUserDashboard - profile:",t?{userId:t.userId,role:t.role}:"null"),console.log("🔥 ProtectedUserDashboard - loading:",u),console.log("🔥 ProtectedUserDashboard - About to render UserDashboardPage"),e.jsxs("div",{className:"relative",children:[e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}),children:e.jsx(L,{})}),e.jsx(_,{})]}))};export{$ as default};
