import{d as H,u as Q,K as X,r as s,j as e,O as G,Q as M,C as Y,J as W,i as _,k as $,p as Z,q as ee,U as te,a as se}from"./index-uPMs_SiV.js";import{C as u,a as x,b as h,d as f}from"./card-DLfFpd5q.js";import{B as J}from"./button-CT9D47wc.js";import{I as F}from"./input-9TEX77Cv.js";import{B as ae}from"./badge-C7PYx-Yk.js";import{S as le,a as ne,b as ce,c as re,d as R}from"./select-Cs8iU9-d.js";import{D as U}from"./dollar-sign-CYb4MZOr.js";import{W as oe}from"./wallet-orzipGOZ.js";import{C as ie}from"./circle-check-big-AnCOXh3G.js";import{C as de}from"./circle-x-Dp9GYX9K.js";import"./index-fzBWuzr4.js";import"./Combination-Bfgt0yjX.js";import"./check-Des-GJSA.js";const me=()=>{const{toast:o}=H(),{signOut:C,user:a,profile:g}=Q();X();const[p,T]=s.useState("01030302038"),[j,b]=s.useState(""),[r,v]=s.useState(""),[y,A]=s.useState("transfer"),[w,K]=s.useState([]);s.useState("all"),s.useState(!1);const[V,ue]=s.useState(""),[L,xe]=s.useState([]);s.useState(null),s.useState(!1),s.useState([]),s.useState([]),s.useState(!1),s.useState("daily");const[he,P]=s.useState([]),[B,S]=s.useState(0),[k,D]=s.useState({});s.useState(!1),s.useState(!1),s.useState(!1),s.useState(!1),s.useState(!1),s.useState(""),s.useState(!1);const[q,O]=s.useState(!1),E=async t=>{if(a)try{const l=await W.getById(a.uid);if(l!=null&&l.shopId){const n=_($,"dashboardData",l.shopId);await te(n,t)}}catch(l){console.error("Error saving to Firebase:",l),o({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ البيانات في Firebase",variant:"destructive"})}};s.useEffect(()=>{if(!a)return;(async()=>{O(!0);try{const l=await W.getById(a.uid);if(l!=null&&l.shopId){const n=_($,"dashboardData",l.shopId),i=await Z(n);if(i.exists()){const c=i.data();S(c.cashBalance||0),D(c.walletBalances||{"wallet-1":5e3,"wallet-2":3e3}),P(c.deletedTransactions||[])}else{const c={cashBalance:0,walletBalances:{"wallet-1":5e3,"wallet-2":3e3},deletedTransactions:[]};await ee(n,c),S(c.cashBalance),D(c.walletBalances),P(c.deletedTransactions)}}}catch(l){console.error("Error loading data from Firebase:",l);const n=`cashBalance_${(a==null?void 0:a.uid)||"default"}`,i=`userCashBalance_${(a==null?void 0:a.uid)||"default"}`,c=`walletBalances_${(a==null?void 0:a.uid)||"default"}`,I=localStorage.getItem(n);if(I!=null)S(parseFloat(I));else{const d=localStorage.getItem(i);if(d!=null){const m=parseFloat(d);if(!Number.isNaN(m)){S(m);try{localStorage.setItem(n,m.toString()),localStorage.removeItem(i)}catch{}}}}const N=localStorage.getItem(c);D(N?JSON.parse(N):{"wallet-1":5e3,"wallet-2":3e3})}finally{O(!1)}})()},[a]),s.useEffect(()=>{try{const t=`cashBalance_${(a==null?void 0:a.uid)||"default"}`;localStorage.setItem(t,String(B||0))}catch{}},[B,a==null?void 0:a.uid]),s.useEffect(()=>{try{const t=`walletBalances_${(a==null?void 0:a.uid)||"default"}`;localStorage.setItem(t,JSON.stringify(k||{}))}catch{}},[k,a==null?void 0:a.uid]);const z=async t=>{if(t.preventDefault(),y==="transfer"){if(!p||!j||!r){o({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const l=(g==null?void 0:g.shopName)||(a==null?void 0:a.displayName)||"محل كاشي لينك",n=L.find(d=>d.id===V)||L.find(d=>d.isDefault),i={id:Date.now().toString(),type:"send",senderPhone:p,receiverPhone:j,amount:parseFloat(r),status:"pending",createdAt:new Date,withdrawnAmount:0,sentAmount:parseFloat(r),merchantShopName:l,shopName:(n==null?void 0:n.name)||"المحفظة الرئيسية"},c=[i,...w];K(c),await E({transactions:c});const I=parseFloat(r)*.02,N=B-I;S(N),await E({cashBalance:N}),o({title:"تم إرسال التحويل",description:"جاري معالجة التحويل..."}),setTimeout(async()=>{const m=[{...i,status:"completed"},...w];K(m),await E({transactions:m})},2e3),T("01030302038"),b(""),v("")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-center",children:"جاري تحميل البيانات..."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"لوحة تحكم الإدارة"}),e.jsxs(J,{onClick:C,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"تسجيل الخروج"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(u,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"الرصيد النقدي"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[B.toLocaleString()," جنيه"]})})]}),e.jsxs(u,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"الأرصدة علي المحافظ"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[Object.values(k).reduce((t,l)=>t+l,0).toLocaleString()," جنيه"]})})]}),e.jsxs(u,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"المعاملات اليوم"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:w.length})})]}),e.jsxs(u,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"إجمالي اليوم"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[w.reduce((t,l)=>t+l.amount,0).toLocaleString()," جنيه"]})})]})]}),e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(h,{children:"إجراء معاملة جديدة"})}),e.jsx(f,{children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نوع المعاملة"}),e.jsxs(le,{value:y,onValueChange:t=>A(t),children:[e.jsx(ne,{children:e.jsx(ce,{})}),e.jsxs(re,{children:[e.jsx(R,{value:"transfer",children:"تحويل"}),e.jsx(R,{value:"withdraw",children:"سحب"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المرسل"}),e.jsx(F,{type:"tel",value:p,onChange:t=>T(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const l=document.getElementById("receiverPhoneInput");if(l)l.focus();else{const n=document.getElementById("amountInput");n==null||n.focus()}}},placeholder:"01xxxxxxxxx"})]}),y==="transfer"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المستقبل"}),e.jsx(F,{id:"receiverPhoneInput",type:"tel",value:j,onChange:t=>b(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const l=document.getElementById("amountInput");l==null||l.focus()}},placeholder:"01xxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"المبلغ"}),e.jsx(F,{id:"amountInput",type:"number",value:r,onChange:t=>v(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const l=document.getElementById("txSubmitButton");l==null||l.focus()}},placeholder:"0.00"})]})]}),e.jsx(J,{id:"txSubmitButton",type:"submit",className:"w-full",children:y==="transfer"?"إرسال التحويل":"تنفيذ السحب"})]})})]}),e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(h,{children:"المعاملات الأخيرة"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4 max-h-[210px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:w.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="completed"&&e.jsx(ie,{className:"h-5 w-5 text-green-500"}),t.status==="pending"&&e.jsx(Y,{className:"h-5 w-5 text-yellow-500"}),t.status==="failed"&&e.jsx(de,{className:"h-5 w-5 text-red-500"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[t.type==="send"?"تحويل":"سحب"," - ",t.amount.toLocaleString()," جنيه"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["من ",t.senderPhone," إلى ",t.receiverPhone]})]})]}),e.jsx(ae,{variant:t.status==="completed"?"default":t.status==="pending"?"secondary":"destructive",children:t.status==="completed"?"مكتمل":t.status==="pending"?"قيد المعالجة":"فشل"})]},t.id))})})]})]})]})},Ce=()=>{const o=se(),[C,a]=s.useState(!1),[g,p]=s.useState(!0);return s.useEffect(()=>{(()=>{const j=localStorage.getItem("dashboardAuth"),b=localStorage.getItem("dashboardUser");if(j==="true"&&b)try{const r=JSON.parse(b),v=new Date(r.loginTime);(new Date().getTime()-v.getTime())/(1e3*60*60)<24?a(!0):(localStorage.removeItem("dashboardAuth"),localStorage.removeItem("dashboardUser"),o("/dashboard/login"))}catch(r){console.error("Error parsing user data:",r),o("/dashboard/login")}else o("/dashboard/login");p(!1)})()},[o]),g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})}):C?e.jsx(me,{}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})})};export{Ce as default};
