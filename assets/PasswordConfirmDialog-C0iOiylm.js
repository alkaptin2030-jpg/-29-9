import{c as X,d as Q,R as k,j as e,ay as ue,X as ge,r as x,a4 as ae,a3 as fe,az as je,u as ye,am as be,C as Ne,g as ve,aA as we,aB as Ce}from"./index-uPMs_SiV.js";import{D as I,a as M,b as T,c as B,d as De,e as ke}from"./dialog-DqnS_HL-.js";import{B as m}from"./button-CT9D47wc.js";import{C as U,d as V,a as H,b as W}from"./card-DLfFpd5q.js";import{a as q,P as Se}from"./separator-qs5AXAvY.js";import{B as A}from"./badge-C7PYx-Yk.js";import{M as R}from"./masterPinService-D7OTlzbr.js";import{T as Y,P as Pe}from"./progress-bnCjODDa.js";import{C as Z}from"./circle-check-big-AnCOXh3G.js";import{L as K}from"./lock-fExlWLc7.js";import{E as le,a as re}from"./eye-bjoK2-ED.js";import{I as v}from"./input-9TEX77Cv.js";import{L}from"./label-BYpBA-ru.js";import{C as ie}from"./circle-alert-BlYBPsCa.js";import{C as ne}from"./calendar-uH-70w0U.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=X("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=X("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=X("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),We=({isOpen:P,onClose:j,transaction:a,onPrint:g,onDelete:y,onComplete:b})=>{const{toast:o}=Q(),[h,p]=k.useState(!1),[l,d]=k.useState(""),[u,f]=k.useState(!1),[D,i]=k.useState(""),[N,E]=k.useState(!1),[$,S]=k.useState(!1),[F,w]=k.useState(""),[s,t]=k.useState(!1),[c,n]=k.useState(""),[C,O]=k.useState(!1);if(!a)return null;const de=r=>{switch(r){case"completed":return e.jsx(A,{className:"bg-green-100 text-green-800 border-green-200",children:"مكتملة"});case"pending":return e.jsx(A,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"قيد المراجعة"});case"failed":return e.jsx(A,{className:"bg-red-100 text-red-800 border-red-200",children:"فاشلة"});default:return e.jsx(A,{className:"bg-gray-100 text-gray-800 border-gray-200",children:r})}},ee=r=>r==="transfer"?"تحويل":"سحب",ce=r=>new Date(r).toLocaleString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),se=r=>{if((r==null?void 0:r.totalCharged)!==void 0&&(r==null?void 0:r.totalCharged)!==null)return Number(r.totalCharged)||0;const z=Number(r.commission||0),_=Number(r.amount||0);return(r==null?void 0:r.commissionMode)==="add"?_+z:_},oe=se(a),me=r=>{switch(r){case"completed":return"مكتملة";case"pending":return"قيد المراجعة";case"failed":return"فاشلة";default:return r}},xe=()=>{try{const r=me(a.status),z=ee(a.type),_=(a==null?void 0:a.shopName)||"غير محدد",J=(a==null?void 0:a.cashierName)||"",te=a.reference||a.id,he=new Date(a.createdAt).toLocaleString("ar-EG"),pe=`
        <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 520px; margin: 0 auto; padding: 24px; background: #fff; direction: rtl;">
          <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #2563eb; padding-bottom: 16px;">
            <h1 style="color: #2563eb; margin: 0 0 6px 0; font-size: 26px;">إيصال المعاملة</h1>
            <p style="color: #666; font-size: 14px; margin: 0;">رقم المرجع: ${te}</p>
            <p style="color: #888; font-size: 13px; margin: 6px 0 0 0;">${he}</p>
          </div>

          <div style="background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
            <h3 style="color: #1e293b; margin: 0 0 12px 0; font-size: 16px;">معلومات المحل</h3>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-weight: 600; color: #475569;">اسم المحل:</span>
              <span style="color: #1e293b;">${_}</span>
            </div>
            ${J?`<div style="display:flex; justify-content:space-between;">
              <span style="font-weight:600; color:#475569;">الكاشير:</span>
              <span style="color:#1e293b;">${J}</span>
            </div>`:""}
          </div>

          <div style="background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px;">
            <h3 style="color: #1e293b; margin: 0 0 12px 0; font-size: 16px;">تفاصيل المعاملة</h3>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px; padding:6px 0; border-bottom:1px solid #f1f5f9;">
              <span style="font-weight:600; color:#475569;">نوع المعاملة:</span>
              <span style="color:#2563eb; font-weight:600;">${z}</span>
            </div>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px; padding:6px 0; border-bottom:1px solid #f1f5f9;">
              <span style="font-weight:600; color:#475569;">الحالة:</span>
              <span style="color:${a.status==="completed"?"#16a34a":a.status==="pending"?"#ca8a04":"#dc2626"}; font-weight:600;">${r}</span>
            </div>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">من:</span>
              <span style="font-family:monospace;">${a.sender_msisdn}</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">إلى:</span>
              <span style="font-family:monospace;">${a.receiver_msisdn}</span>
            </div>

            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">المبلغ:</span>
              <span style="font-weight:600;">${a.amount} جنيه</span>
            </div>
            ${a.commission>0?`<div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span style="font-weight:600; color:#475569;">العمولة:</span>
              <span>${a.commission} جنيه</span>
            </div>`:""}

            <div style="display:flex; justify-content:space-between; margin-top:10px; font-weight:700; font-size:16px;">
              <span>الإجمالي:</span>
              <span style="color:#2563eb;">${se(a)} جنيه</span>
            </div>
          </div>
        </div>
      `,G=window.open("","_blank");if(!G)return;G.document.write(`
        <html>
          <head>
            <title>إيصال المعاملة - ${te}</title>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <style>
              body { margin: 0; padding: 20px; background: #f8fafc; }
              @media print { body { background: white; } }
            </style>
          </head>
          <body dir="rtl">
            ${pe}
          </body>
        </html>
      `),G.document.close(),G.print()}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{open:P,onOpenChange:j,children:e.jsxs(M,{className:"max-w-md w-full mx-auto overflow-hidden",dir:"rtl",children:[e.jsx(T,{className:"text-center",children:e.jsxs(B,{className:"flex items-center justify-center gap-2 text-xl font-bold text-primary",children:[e.jsx(ue,{className:"h-6 w-6"}),"إيصال المعاملة"]})}),e.jsx(U,{className:"border-2 border-primary/20 overflow-hidden rounded-xl",children:e.jsxs(V,{className:"p-6 space-y-4 break-words",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:"كاشي لينك"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["إيصال ",ee(a.type)]}),de(a.status),(a==null?void 0:a.shopName)&&e.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:["المحل: ",a.shopName]}),(a==null?void 0:a.cashierName)&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["الكاشير: ",a.cashierName]})]}),e.jsx(q,{}),e.jsxs("div",{className:"space-y-3 break-words",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"رقم المعاملة:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.id})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"من:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.sender_msisdn})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"إلى:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.receiver_msisdn})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"المبلغ:"}),e.jsxs("span",{className:"text-sm font-semibold",children:[a.amount," جنيه"]})]}),a.commission>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"العمولة:"}),e.jsxs("span",{className:"text-sm",children:[a.commission," جنيه"]})]}),e.jsx(q,{}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"الإجمالي:"}),e.jsxs("span",{className:"text-primary",children:[oe," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"التاريخ:"}),e.jsx("span",{className:"text-sm",children:ce(a.createdAt)})]}),a.reference&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"المرجع:"}),e.jsx("span",{className:"text-sm font-mono break-all",dir:"ltr",children:a.reference})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 flex-wrap",children:[y&&e.jsxs(m,{onClick:()=>{i(""),d(""),f(!1),p(!0)},variant:"destructive",size:"lg",className:"flex-1",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"حذف الإيصال"]}),b&&a.status==="pending"&&e.jsxs(m,{onClick:()=>{n(""),w(""),t(!1),S(!0)},className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white",size:"lg",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"إكمال المعاملة"]}),e.jsxs(m,{onClick:xe,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"طباعة الإيصال"]}),e.jsxs(m,{onClick:j,variant:"outline",size:"lg",className:"px-6",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"إغلاق"]})]})]})}),e.jsx(I,{open:h,onOpenChange:p,children:e.jsxs(M,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(T,{children:e.jsxs(B,{className:"flex items-center gap-2 text-center justify-center",children:[e.jsx(K,{className:"h-5 w-5 text-red-600"}),"تأكيد حذف المعاملة"]})}),e.jsx("div",{className:"text-center text-sm text-gray-600 mb-4",children:"أدخل الرقم السري لتأكيد حذف هذه المعاملة"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"deletePin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"deletePin",type:u?"text":"password",autoComplete:"off",value:l,onChange:r=>d(r.target.value),placeholder:"أدخل الرقم السري",className:"pr-10 w-full border rounded-md h-10 px-3",dir:"ltr"}),e.jsx("button",{type:"button",onClick:()=>f(!u),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u?e.jsx(le,{className:"h-4 w-4"}):e.jsx(re,{className:"h-4 w-4"})})]})]}),D&&e.jsx("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:D}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(m,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{p(!1),d(""),i(""),f(!1)},disabled:N,children:"إلغاء"}),e.jsx(m,{type:"button",className:"flex-1 bg-red-600 hover:bg-red-700",disabled:N,onClick:async()=>{i(""),E(!0);try{if(!R.hasMasterPin()){i("الرقم السري غير مُعيَّن، يرجى تعيينه أولاً"),o({title:"الرقم السري غير مُعيَّن",description:"يرجى تعيين الرقم السري من إدارة الأرقام السرية قبل الحذف.",variant:"destructive"});return}if(!l){i("يرجى إدخال الرقم السري");return}if(!R.verifyMasterPin(l)){i("الرقم السري غير صحيح"),o({title:"رقم سري غير صحيح",description:"تعذر تنفيذ الحذف بسبب رقم سري خاطئ.",variant:"destructive"});return}try{y&&a&&y(a.id),p(!1),d(""),i(""),f(!1),j()}catch{}}finally{E(!1)}},children:"تأكيد الحذف"})]})]})]})}),e.jsx(I,{open:$,onOpenChange:r=>{r?S(!0):(S(!1),w(""),n(""),t(!1))},children:e.jsxs(M,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(T,{children:e.jsxs(B,{className:"flex items-center gap-2 text-center justify-center",children:[e.jsx(K,{className:"h-5 w-5 text-emerald-600"}),"تأكيد إكمال المعاملة"]})}),e.jsx("div",{className:"text-center text-sm text-gray-600 mb-4",children:"أدخل الرقم السري لتأكيد إكمال هذه المعاملة المؤجلة"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"completePin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"completePin",type:s?"text":"password",autoComplete:"off",value:F,onChange:r=>w(r.target.value),placeholder:"أدخل الرقم السري",className:"pr-10 w-full border rounded-md h-10 px-3",dir:"ltr"}),e.jsx("button",{type:"button",onClick:()=>t(!s),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:s?e.jsx(le,{className:"h-4 w-4"}):e.jsx(re,{className:"h-4 w-4"})})]})]}),c&&e.jsx("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:c}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(m,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{S(!1),w(""),n(""),t(!1)},disabled:C,children:"إلغاء"}),e.jsx(m,{type:"button",className:"flex-1 bg-emerald-600 hover:bg-emerald-700",disabled:C,onClick:async()=>{n(""),O(!0);try{if(!R.hasMasterPin()){n("الرقم السري غير مُعيَّن، يرجى تعيينه أولاً"),o({title:"الرقم السري غير مُعيَّن",description:"يرجى تعيين الرقم السري من إدارة الأرقام السرية قبل الإكمال.",variant:"destructive"});return}if(!F){n("يرجى إدخال الرقم السري");return}if(!R.verifyMasterPin(F)){n("الرقم السري غير صحيح"),o({title:"رقم سري غير صحيح",description:"تعذر تنفيذ الإكمال بسبب رقم سري خاطئ.",variant:"destructive"});return}try{b&&a&&b(a.id),S(!1),w(""),n(""),t(!1),j()}catch{}}finally{O(!1)}},children:"تأكيد الإكمال"})]})]})]})})]})},qe=({isOpen:P,onClose:j})=>{console.log("CreditCardsDialog rendered with isOpen:",P);const{toast:a}=Q(),[g,y]=x.useState([]),[b,o]=x.useState(!1),[h,p]=x.useState(null),[l,d]=x.useState({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"}),u=["#8B5CF6","#EF4444","#10B981","#F59E0B","#3B82F6","#EC4899","#6366F1","#14B8A6"];x.useEffect(()=>{const s=localStorage.getItem("creditCards");s&&y(JSON.parse(s))},[]);const f=s=>{localStorage.setItem("creditCards",JSON.stringify(s)),y(s)},D=()=>{if(!l.name||!l.bank||!l.creditLimit){a({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const s=parseFloat(l.creditLimit),t={id:Date.now().toString(),name:l.name,bank:l.bank,creditLimit:s,usedAmount:0,availableAmount:s,startDate:l.startDate,endDate:l.endDate,reminderDate:l.reminderDate,color:l.color},c=[...g,t];f(c),d({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"}),o(!1),a({title:"تم بنجاح",description:"تم إضافة بطاقة الائتمان بنجاح"})},i=s=>{const t=g.filter(c=>c.id!==s);f(t),a({title:"تم الحذف",description:"تم حذف بطاقة الائتمان بنجاح"})},N=s=>{p(s),d({name:s.name,bank:s.bank,creditLimit:s.creditLimit.toString(),startDate:s.startDate,endDate:s.endDate,reminderDate:s.reminderDate,color:s.color}),o(!0)},E=()=>{if(!h)return;const s=parseFloat(l.creditLimit),t={...h,name:l.name,bank:l.bank,creditLimit:s,availableAmount:s-h.usedAmount,startDate:l.startDate,endDate:l.endDate,reminderDate:l.reminderDate,color:l.color},c=g.map(n=>n.id===h.id?t:n);f(c),p(null),o(!1),d({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"}),a({title:"تم التحديث",description:"تم تحديث بطاقة الائتمان بنجاح"})},$=()=>{p(null),o(!1),d({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6"})},S=(s,t)=>{const c=g.map(n=>{if(n.id===s){const C=n.usedAmount+t;return C>n.creditLimit?(a({title:"خطأ",description:"المبلغ يتجاوز الحد الائتماني المتاح",variant:"destructive"}),n):{...n,usedAmount:C,availableAmount:n.creditLimit-C}}return n});f(c)},F=s=>s.usedAmount/s.creditLimit*100,w=s=>{if(!s)return!1;const t=new Date,n=new Date(s).getTime()-t.getTime(),C=Math.ceil(n/(1e3*60*60*24));return C<=7&&C>=0};return e.jsx(I,{open:P,onOpenChange:j,children:e.jsxs(M,{className:"max-w-4xl max-h-[95vh] overflow-y-auto p-3 sm:p-6",children:[e.jsx(T,{className:"pb-4",children:e.jsxs(B,{className:"flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(ae,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-600"}),"إدارة كروت الائتمان"]})}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[!b&&e.jsxs(m,{onClick:()=>o(!0),className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3 text-base",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"إضافة بطاقة ائتمان جديدة"]}),b&&e.jsxs("div",{className:"bg-gray-50 p-3 sm:p-4 rounded-lg border",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4",children:h?"تعديل بطاقة الائتمان":"إضافة بطاقة ائتمان جديدة"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"cardName",className:"text-sm font-medium",children:"اسم البطاقة"}),e.jsx(v,{id:"cardName",value:l.name,onChange:s=>d({...l,name:s.target.value}),placeholder:"مثال: بطاقة التسوق",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"bankName",className:"text-sm font-medium",children:"اسم البنك"}),e.jsx(v,{id:"bankName",value:l.bank,onChange:s=>d({...l,bank:s.target.value}),placeholder:"مثال: البنك الأهلي",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"creditLimit",className:"text-sm font-medium",children:"الحد الائتماني (جنيه)"}),e.jsx(v,{id:"creditLimit",type:"number",value:l.creditLimit,onChange:s=>d({...l,creditLimit:s.target.value}),placeholder:"10000",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"cardColor",className:"text-sm font-medium",children:"لون البطاقة"}),e.jsx("div",{className:"flex gap-3 mt-2 flex-wrap",children:u.map(s=>e.jsx("button",{type:"button",className:`w-10 h-10 rounded-full border-2 ${l.color===s?"border-gray-800":"border-gray-300"}`,style:{backgroundColor:s},onClick:()=>d({...l,color:s})},s))})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"startDate",className:"text-sm font-medium",children:"تاريخ بداية المدة"}),e.jsx(v,{id:"startDate",type:"date",value:l.startDate,onChange:s=>d({...l,startDate:s.target.value}),className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"endDate",className:"text-sm font-medium",children:"تاريخ نهاية المدة"}),e.jsx(v,{id:"endDate",type:"date",value:l.endDate,onChange:s=>d({...l,endDate:s.target.value}),className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"reminderDate",className:"text-sm font-medium",children:"تاريخ التذكير"}),e.jsx(v,{id:"reminderDate",type:"date",value:l.reminderDate,onChange:s=>d({...l,reminderDate:s.target.value}),className:"mt-1 h-11"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsxs(m,{onClick:h?E:D,className:"bg-green-600 hover:bg-green-700 text-white py-3 text-base flex-1",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),h?"حفظ التعديلات":"إضافة البطاقة"]}),e.jsx(m,{onClick:$,variant:"outline",className:"py-3 text-base flex-1",children:"إلغاء"})]})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:g.length===0?e.jsxs("div",{className:"text-center py-6 sm:py-8 text-gray-500",children:[e.jsx(ae,{className:"h-10 w-10 sm:h-12 sm:w-12 mx-auto mb-3 sm:mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm sm:text-base",children:"لا توجد بطاقات ائتمان مضافة بعد"})]}):g.map(s=>e.jsxs("div",{className:"bg-white border-2 rounded-lg p-3 sm:p-4 shadow-sm",style:{borderColor:s.color},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-800",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.bank})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-full transition-colors",children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>i(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors",children:e.jsx(Y,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"حد السحب"}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600",children:[s.availableAmount.toFixed(2)," / ",s.creditLimit.toFixed(2)," ج.م"]})]}),e.jsx(Pe,{value:F(s),className:"h-2 sm:h-3",style:{"--progress-background":s.color,"--progress-foreground":s.color}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["مستخدم: ",s.usedAmount.toFixed(2)," ج.م"]}),e.jsxs("span",{children:["متاح: ",s.availableAmount.toFixed(2)," ج.م"]})]})]}),w(s.endDate)&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 p-2 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(ie,{className:"h-4 w-4 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-orange-700",children:"موعد السداد قريب!"})]}),(s.startDate||s.endDate||s.reminderDate)&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs text-gray-600 mb-3 sm:mb-4",children:[s.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["البداية: ",new Date(s.startDate).toLocaleDateString("ar-EG")]})]}),s.endDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["النهاية: ",new Date(s.endDate).toLocaleDateString("ar-EG")]})]}),s.reminderDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["التذكير: ",new Date(s.reminderDate).toLocaleDateString("ar-EG")]})]})]}),e.jsxs(m,{onClick:()=>{const t=prompt("أدخل مبلغ السحب:");t&&!isNaN(parseFloat(t))&&S(s.id,parseFloat(t))},className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 text-base",disabled:s.availableAmount<=0,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"سحب من البطاقة"]})]},s.id))})]})]})})},Ke=({open:P,onOpenChange:j})=>{const{user:a}=ye(),g=x.useMemo(()=>`maintenance_items_${(a==null?void 0:a.uid)||"anonymous"}`,[a==null?void 0:a.uid]),[y,b]=x.useState([]),[o,h]=x.useState(""),[p,l]=x.useState(""),[d,u]=x.useState(""),[f,D]=x.useState(""),[i,N]=x.useState("");x.useEffect(()=>{try{const t=localStorage.getItem(g);if(t){const c=JSON.parse(t);b(c)}}catch(t){console.warn("Failed to load maintenance items:",t)}},[g]),x.useEffect(()=>{try{localStorage.setItem(g,JSON.stringify(y))}catch(t){console.warn("Failed to save maintenance items:",t)}},[y,g]);const E=()=>{h(""),l(""),u(""),D(""),N("")},$=t=>{const c=typeof i=="string"?Number(i):i;if(!o.trim()||!c||Number.isNaN(c)||c<=0){alert("يرجى إدخال اسم المنتج والسعر بشكل صحيح");return}const C={id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,productName:o.trim(),faultType:p.trim()||void 0,customerName:d.trim()||void 0,mobile:f.trim()||void 0,price:c,status:t,createdAt:new Date().toISOString()};b(O=>[C,...O]),E()},S=t=>{b(c=>c.map(n=>n.id===t?{...n,status:"completed"}:n))},F=t=>{b(c=>c.filter(n=>n.id!==t))},w=y.filter(t=>t.status==="in_progress"),s=y.filter(t=>t.status==="completed");return e.jsx(I,{open:P,onOpenChange:j,children:e.jsxs(M,{className:"sm:max-w-3xl",children:[e.jsx(T,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-amber-600"}),"إدارة الصيانة"]})}),e.jsxs(U,{className:"mb-3",children:[e.jsx(H,{className:"pb-2",children:e.jsx(W,{className:"text-sm",children:"إضافة منتج للصيانة"})}),e.jsxs(V,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"اسم المنتج"}),e.jsx(v,{value:o,onChange:t=>h(t.target.value),placeholder:"اسم المنتج"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"نوع العطل (اختياري)"}),e.jsx(v,{value:p,onChange:t=>l(t.target.value),placeholder:"نوع العطل"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"اسم العميل (اختياري)"}),e.jsx(v,{value:d,onChange:t=>u(t.target.value),placeholder:"اسم العميل"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"رقم الموبايل (اختياري)"}),e.jsx(v,{value:f,onChange:t=>D(t.target.value),placeholder:"01xxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700",children:"السعر"}),e.jsx(v,{value:i,onChange:t=>N(t.target.value),placeholder:"السعر بالجنيه"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(m,{className:"bg-amber-600 hover:bg-amber-700",onClick:()=>$("in_progress"),children:"جاري التصليح"}),e.jsx(m,{className:"bg-green-600 hover:bg-green-700",onClick:()=>$("completed"),children:"تم التصليح"})]})]})]}),e.jsx(q,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3",children:[e.jsxs(U,{children:[e.jsx(H,{className:"pb-2",children:e.jsxs(W,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-amber-600"}),"جاري التصليح",e.jsx(A,{variant:"secondary",className:"ml-auto text-[10px]",children:w.length})]})}),e.jsx(V,{className:"space-y-2 max-h-[280px] overflow-y-auto",children:w.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"لا توجد عناصر قيد التصليح"}):w.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:[t.productName," ",e.jsxs("span",{className:"text-gray-600",children:["— ",t.price," جنيه"]})]}),e.jsxs("p",{className:"text-[11px] text-gray-600",children:[t.faultType||"بدون"," ",t.customerName&&`• ${t.customerName}`," ",t.mobile&&`• ${t.mobile}`]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{size:"sm",className:"h-7 bg-green-600 hover:bg-green-700",onClick:()=>S(t.id),children:"تم التصليح"}),e.jsx(m,{size:"sm",variant:"outline",className:"h-7",onClick:()=>F(t.id),children:e.jsx(Y,{className:"h-3 w-3"})})]})]},t.id))})]}),e.jsxs(U,{children:[e.jsx(H,{className:"pb-2",children:e.jsxs(W,{className:"text-sm flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-green-600"}),"تم التصليح",e.jsx(A,{variant:"secondary",className:"ml-auto text-[10px]",children:s.length})]})}),e.jsx(V,{className:"space-y-2 max-h-[280px] overflow-y-auto",children:s.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"لا توجد عناصر منتهية"}):s.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:[t.productName," ",e.jsxs("span",{className:"text-gray-600",children:["— ",t.price," جنيه"]})]}),e.jsxs("p",{className:"text-[11px] text-gray-600",children:[t.faultType||"بدون"," ",t.customerName&&`• ${t.customerName}`," ",t.mobile&&`• ${t.mobile}`]})]}),e.jsx(A,{className:"text-[10px] bg-green-100 text-green-800",children:"مكتمل"})]},t.id))})]})]})]})})},Xe=({open:P,onOpenChange:j,title:a="تأكيد كلمة المرور",description:g="أدخل كلمة مرور تسجيل الدخول للمتابعة",onSuccess:y})=>{const{toast:b}=Q(),[o,h]=x.useState(""),[p,l]=x.useState(!1),[d,u]=x.useState(null),f=async()=>{u(null);try{const i=ve.currentUser;if(!i||!i.email){u("لا يوجد مستخدم مسجل حالياً. يرجى تسجيل الدخول أولاً.");return}l(!0);const N=we.credential(i.email,o);await Ce(i,N),l(!1),h(""),b({title:"تم التأكيد",description:"تم التحقق من كلمة المرور بنجاح"}),y(),j&&j(!1)}catch(i){console.error("إعادة التحقق بكلمة المرور فشلت:",i),l(!1);const N=(i==null?void 0:i.code)||"";u(N==="auth/wrong-password"?"كلمة المرور غير صحيحة. حاول مرة أخرى.":N==="auth/too-many-requests"?"تمت محاولات كثيرة. يرجى الانتظار قليلاً ثم المحاولة.":"حدث خطأ أثناء التحقق. حاول مرة أخرى.")}},D=i=>{j&&j(i),i||(h(""),u(null),l(!1))};return e.jsx(I,{open:P,onOpenChange:D,children:e.jsxs(M,{className:"sm:max-w-[400px]",children:[e.jsxs(T,{children:[e.jsx(B,{className:"text-right",children:a}),e.jsx(De,{className:"text-right",children:g})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[e.jsx("label",{htmlFor:"password",className:"text-right col-span-1 text-sm",children:"كلمة المرور"}),e.jsxs("div",{className:"col-span-3 relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(v,{id:"password",type:"password",value:o,onChange:i=>h(i.target.value),placeholder:"نفس كلمة مرور تسجيل الدخول",autoComplete:"off"})]})]}),d&&e.jsx("div",{className:"text-red-600 text-xs text-right",children:d})]}),e.jsxs(ke,{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>D(!1),disabled:p,children:"إلغاء"}),e.jsx(m,{onClick:f,disabled:p||!o,children:p?"جاري التحقق...":"تأكيد"})]})]})})};export{Je as C,Ke as M,Xe as P,We as R,He as a,qe as b,Fe as c};
