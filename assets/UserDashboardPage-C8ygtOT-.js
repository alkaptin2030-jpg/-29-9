const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-uPMs_SiV.js","assets/index-BOam0xtp.css","assets/walletDailyLimitsService-O4QsIztL.js","assets/profitService-CoFuE1nE.js","assets/reportsService-Bp1Io21u.js","assets/masterPinService-D7OTlzbr.js"])))=>i.map(i=>d[i]);
var no=Object.defineProperty;var io=(i,d,t)=>d in i?no(i,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[d]=t;var Er=(i,d,t)=>io(i,typeof d!="symbol"?d+"":d,t);import{c as _t,h as oo,f as co,u as ls,r as l,j as e,a4 as Ra,I as Es,a2 as ss,aX as Ua,C as fs,d as Rt,a as an,a3 as ut,V as rn,X as ln,_ as es,ay as Ba,R as it,F as Ea,l as mo,S as Yt,Z as Ws,a0 as ts,k as ot,$ as kt,an as Fs,a5 as Yr,U as ta,i as qt,H as Zs,aU as ho,a1 as Hl,z as xo,A as nn,E as uo,aY as go,v as ys,K as za,ak as Gl,aZ as on,ai as je,x as po,ag as fo,aF as vo,m as yo,o as jo,Q as Xs,al as bo,am as No,aE as wo,aj as Aa,p as ka,g as So,aA as Do,aB as Co}from"./index-uPMs_SiV.js";import{C as Ue,a as ct,b as jt,d as qe}from"./card-DLfFpd5q.js";import{B as c,b as cn}from"./button-CT9D47wc.js";import{I as L}from"./input-9TEX77Cv.js";import{B as rt}from"./badge-C7PYx-Yk.js";import{S as Ts,a as As,b as ks,c as Ps,d as Os,C as Hr,e as dn}from"./select-Cs8iU9-d.js";import{D as oe,a as ce,b as de,c as me,f as mn,T as Io,O as To,W as Ao,C as ko,g as Po,h as Oo,i as hn,R as Wo,P as Fo,d as Vt,e as Se}from"./dialog-DqnS_HL-.js";import{L as Y}from"./label-BYpBA-ru.js";import{M as ra,a as gs}from"./MasterPinDialog-DezuvR3F.js";import{T as Ct,P as Ma}from"./progress-bnCjODDa.js";import{W as $t}from"./wallet-orzipGOZ.js";import{S as xn}from"./star-BacF8x4W.js";import{S as un}from"./square-pen-BAn8yOZe.js";import{P as Ht}from"./phone-sZc6bnvC.js";import{A as gn}from"./arrow-left-u3t4NtLn.js";import{a as zr,S as Bo}from"./separator-qs5AXAvY.js";import{C as rs}from"./calendar-uH-70w0U.js";import{C as Jr}from"./chart-column-BEhq7vOJ.js";import{D as Qe}from"./dollar-sign-CYb4MZOr.js";import{A as Mr}from"./activity-CNvbI1bm.js";import{C as js}from"./circle-alert-BlYBPsCa.js";import{C as Gr}from"./circle-x-Dp9GYX9K.js";import{C as La}from"./circle-check-big-AnCOXh3G.js";import{a as et,E as It}from"./eye-bjoK2-ED.js";import{S as Eo}from"./store-BPv1ARsw.js";import{A as Mo}from"./arrow-right-xuJElq1n.js";import{U as Kr}from"./user-Ds0_EC87.js";import{c as Lo,C as pn,a as $o,R as _o,P as Pa,b as Ro,M as Uo}from"./PasswordConfirmDialog-C0iOiylm.js";import{M as as}from"./masterPinService-D7OTlzbr.js";import{L as vs}from"./lock-fExlWLc7.js";import{w as zo,W as Jo}from"./WalletsManagement-tAYS_V_J.js";import{walletDailyLimitsService as ps}from"./walletDailyLimitsService-O4QsIztL.js";import{reportsService as Lt}from"./reportsService-Bp1Io21u.js";import{P as Ko}from"./ProfileIcon-D-RfENzf.js";import{S as Lr}from"./shield-CtMjnAJT.js";import{ProfitService as Ms}from"./profitService-CoFuE1nE.js";import{R as Vo}from"./refresh-cw-DsFPRrWD.js";import"./index-fzBWuzr4.js";import"./Combination-Bfgt0yjX.js";import"./check-Des-GJSA.js";import"./dropdown-menu-Dwcisbe_.js";import"./index-BkvIApK-.js";import"./avatars-BOESVd_j.js";import"./key-round-B4s3M5Ai.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=_t("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=_t("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qo=_t("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=_t("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=_t("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=_t("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=_t("IdCard",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=_t("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=_t("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=_t("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Go=async(i={})=>{try{return(await oo(co,"getLastTransactions")(i)).data}catch(d){throw console.error("Error getting last transactions:",d),d.code==="functions/unauthenticated"?new Error("يجب تسجيل الدخول للوصول إلى المعاملات"):d.code==="functions/invalid-argument"?new Error("بيانات الاستعلام غير صالحة: "+d.message):d.code==="functions/permission-denied"?new Error("ليس لديك صلاحية للوصول إلى هذه المعاملات: "+d.message):new Error("حدث خطأ أثناء جلب المعاملات: "+(d.message||"خطأ غير معروف"))}},Qo=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],Zo=({isOpen:i,onClose:d,onWalletSelect:t,onEditWallet:m,onDeleteWallet:y})=>{const{user:u}=ls(),[T,E]=l.useState([]),[f,h]=l.useState(!1),v=()=>`wallets_${(u==null?void 0:u.uid)||"default"}`,k=()=>{try{const C=v(),U=localStorage.getItem(C);if(U){const ae=JSON.parse(U);if(Array.isArray(ae)&&ae.length>0)return ae}const re="wallets_default",$=localStorage.getItem(re);if($){const ae=JSON.parse($);if(Array.isArray(ae)&&ae.length>0){localStorage.setItem(C,$);try{localStorage.removeItem(re)}catch{}return ae}}const P=Object.keys(localStorage).filter(ae=>ae.startsWith("wallets_")&&ae!==C);let J=null,ne=null;for(const ae of P)try{const pe=localStorage.getItem(ae);if(!pe)continue;const G=JSON.parse(pe);Array.isArray(G)&&G.length>0&&(!J||G.length>((J==null?void 0:J.length)||0))&&(J=G,ne=ae)}catch{}if(J&&ne){localStorage.setItem(C,JSON.stringify(J));try{localStorage.removeItem(ne)}catch{}return J}}catch(C){console.warn("WalletsViewPage migration failed:",C)}return null},I=async(C,U)=>{const re=new Date().getMonth(),$=new Date().getFullYear(),P=U.filter(G=>{const Z=new Date(G.createdAt);return Z.getMonth()===re&&Z.getFullYear()===$&&G.lineId===C}),J=G=>{const Z=G.type;return G.txnType==="receive"||Z==="withdraw"||Z==="withdrawal"||Z==="receive"},ne=G=>{const Z=G.type;return G.txnType==="send"||Z==="send"||Z==="transfer"},ae=P.filter(J).reduce((G,Z)=>{const Ne=Z.withdrawnAmount!==void 0?Z.withdrawnAmount:Z.amount;return G+(Ne||0)},0),pe=P.filter(ne).reduce((G,Z)=>{const Ne=Z.sentAmount!==void 0?Z.sentAmount:Z.amount;return G+(Ne||0)},0);return{withdrawalUsage:ae,transferUsage:pe}},M=C=>{const U=new Date().toISOString().split("T")[0],re=C.lastResetDate;if(!re)return{...C,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:U};const $=new Date(re),P=new Date;return $.getMonth()!==P.getMonth()||$.getFullYear()!==P.getFullYear()?{...C,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:U}:C};l.useEffect(()=>{if(!(u!=null&&u.uid)||!i)return;(async()=>{h(!0);try{const U=await ss.getByMerchantId(u.uid),re=await Ua.getByUserId(u.uid),P=(await Promise.all(U.map(async J=>{const{withdrawalUsage:ne,transferUsage:ae}=await I(J.id,re);return{id:J.id,name:J.label||"محفظة بدون اسم",phone:J.msisdn,nationalId:J.nationalId||"",isDefault:!1,monthlyWithdrawalLimit:J.withdrawLimit||2e5,monthlyTransferLimit:J.transferLimit||2e5,monthlyWithdrawalUsage:ne,monthlyTransferUsage:ae,lastResetDate:new Date().toISOString().split("T")[0],walletProvider:J.walletProvider||""}}))).map(M);if(E(P),!P||P.length===0){const J=k();J&&J.length>0&&E(J.map(M))}}catch(U){console.error("Error loading wallets:",U);const re=k();re&&E(re.map($=>({...$,phone:$.phone||$.phoneNumber,monthlyWithdrawalLimit:$.monthlyWithdrawalLimit||2e5,monthlyTransferLimit:$.monthlyTransferLimit||2e5})))}finally{h(!1)}})()},[u==null?void 0:u.uid,i]);const H=C=>Qo.find(U=>U.id===C),V=(C,U)=>U>0?Math.min(C/U*100,100):0,W=C=>new Intl.NumberFormat("ar-EG").format(C);return e.jsx(oe,{open:i,onOpenChange:d,children:e.jsxs(ce,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(de,{className:"pb-4",children:e.jsxs(me,{className:"flex items-center gap-2 text-lg",children:[e.jsx($t,{className:"h-5 w-5"}),"الاطلاع على جميع المحافظ",e.jsxs(rt,{variant:"secondary",className:"mr-2",children:[T.length," محفظة"]})]})}),f?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المحافظ..."})]})}):T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($t,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد محافظ مضافة حتى الآن"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(C=>{const U=H(C.walletProvider||""),re=V(C.monthlyWithdrawalUsage||0,C.monthlyWithdrawalLimit),$=V(C.monthlyTransferUsage||0,C.monthlyTransferLimit);return e.jsxs(Ue,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300",onClick:()=>t(C),children:[e.jsx(ct,{className:"pb-3",children:e.jsxs(jt,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"h-4 w-4"}),e.jsx("span",{children:C.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[C.isDefault&&e.jsxs(rt,{variant:"default",className:"text-xs",children:[e.jsx(xn,{className:"h-3 w-3 mr-1"}),"افتراضية"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:P=>{P.stopPropagation(),m==null||m(C)},className:"h-7 px-2",children:e.jsx(un,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:P=>{P.stopPropagation(),y==null||y(C.id)},className:"h-7 px-2 text-destructive hover:text-destructive",children:e.jsx(Ct,{className:"h-4 w-4"})})]})]})}),e.jsxs(qe,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ht,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:C.phone})]}),C.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_a,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:C.nationalId})]}),U&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(vn,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:U.name})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(sa,{className:"h-3 w-3 text-red-500"}),"السحب الشهري"]}),e.jsxs("span",{className:"font-mono",children:[W(C.monthlyWithdrawalUsage||0)," / ",W(C.monthlyWithdrawalLimit)]})]}),e.jsx(Ma,{value:re,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Es,{className:"h-3 w-3 text-green-500"}),"التحويل الشهري"]}),e.jsxs("span",{className:"font-mono",children:[W(C.monthlyTransferUsage||0)," / ",W(C.monthlyTransferLimit)]})]}),e.jsx(Ma,{value:$,className:"h-2"})]}),e.jsx(c,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:P=>{P.stopPropagation(),t(C)},children:"عرض التفاصيل الكاملة"})]})]},C.id)})}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs(c,{onClick:d,variant:"outline",children:[e.jsx(gn,{className:"h-4 w-4 mr-2"}),"إغلاق"]})})]})})},Xo=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],ec=({wallet:i,isOpen:d,onClose:t,onBack:m})=>{const{user:y}=ls(),[u,T]=l.useState([]),[E,f]=l.useState(!1),[h,v]=l.useState("month");if(l.useEffect(()=>{if(!i||!(y!=null&&y.uid)||!d)return;(async()=>{f(!0);try{const We=(await Ua.getByUserId(y.uid)).filter(ze=>ze.walletId===i.id).sort((ze,Ie)=>new Date(Ie.createdAt).getTime()-new Date(ze.createdAt).getTime());T(We)}catch(te){console.error("Error loading transactions:",te)}finally{f(!1)}})()},[i,y==null?void 0:y.uid,d]),!i)return null;const k=K=>Xo.find(te=>te.id===K),I=(K,te)=>te>0?Math.min(K/te*100,100):0,M=K=>new Intl.NumberFormat("ar-EG").format(K),H=K=>new Date(K).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=(()=>{const K=new Date;let te;switch(h){case"week":te=new Date(K.getTime()-7*24*60*60*1e3);break;case"month":te=new Date(K.getFullYear(),K.getMonth(),1);break;default:return u}return u.filter(We=>new Date(We.createdAt)>=te)})(),C=K=>{const te=K.type,We=K.txnType;return te==="withdraw"||te==="withdrawal"||te==="receive"||We==="receive"},U=K=>{const te=K.type,We=K.txnType;return te==="send"||te==="transfer"||We==="send"},re=W.filter(K=>C(K)&&K.status==="completed").reduce((K,te)=>{const We=te.withdrawnAmount!==void 0?te.withdrawnAmount:te.amount;return K+(We||0)},0),$=W.filter(K=>U(K)&&K.status==="completed").reduce((K,te)=>{const We=te.sentAmount!==void 0?te.sentAmount:te.amount;return K+(We||0)},0),P=W.filter(K=>K.type==="deposit"&&K.status==="completed").reduce((K,te)=>K+te.amount,0),J=k(i.walletProvider||""),ne=I(i.monthlyWithdrawalUsage||0,i.monthlyWithdrawalLimit),ae=I(i.monthlyTransferUsage||0,i.monthlyTransferLimit),pe=K=>{switch(K){case"withdrawal":return e.jsx(sa,{className:"h-4 w-4 text-red-500"});case"transfer":return e.jsx(Es,{className:"h-4 w-4 text-blue-500"});case"deposit":return e.jsx(Qe,{className:"h-4 w-4 text-green-500"});default:return e.jsx(Mr,{className:"h-4 w-4 text-gray-500"})}},G=K=>{switch(K){case"completed":return e.jsx(La,{className:"h-4 w-4 text-green-500"});case"pending":return e.jsx(fs,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(Gr,{className:"h-4 w-4 text-red-500"});default:return e.jsx(js,{className:"h-4 w-4 text-gray-500"})}},Z=K=>{switch(K){case"withdrawal":return"سحب";case"transfer":return"تحويل";case"deposit":return"إيداع";default:return"معاملة"}},Ne=K=>{switch(K){case"completed":return"مكتملة";case"pending":return"قيد الانتظار";case"failed":return"فاشلة";default:return"غير محدد"}};return e.jsx(oe,{open:d,onOpenChange:t,children:e.jsxs(ce,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(de,{className:"pb-4",children:e.jsxs(me,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Ra,{className:"h-5 w-5"}),"تفاصيل المحفظة: ",i.name,i.isDefault&&e.jsxs(rt,{variant:"default",className:"mr-2",children:[e.jsx(xn,{className:"h-3 w-3 mr-1"}),"افتراضية"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(Ue,{children:[e.jsx(ct,{children:e.jsxs(jt,{className:"text-sm flex items-center gap-2",children:[e.jsx(_a,{className:"h-4 w-4"}),"المعلومات الأساسية"]})}),e.jsxs(qe,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ht,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:i.phone})]}),i.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_a,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:i.nationalId})]}),J&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(vn,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:J.name})]}),e.jsxs("div",{className:"text-xs text-gray-600 pr-6",children:[e.jsxs("div",{children:["المالك: ",J.ownerName]}),e.jsxs("div",{className:"font-mono",children:["الرقم القومي: ",J.nationalId]})]})]}),i.lastResetDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(rs,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["آخر إعادة تعيين: ",new Date(i.lastResetDate).toLocaleDateString("ar-EG")]})]})]})]}),e.jsxs(Ue,{children:[e.jsx(ct,{children:e.jsxs(jt,{className:"text-sm flex items-center gap-2",children:[e.jsx(Jr,{className:"h-4 w-4"}),"حدود الاستخدام الشهري"]})}),e.jsxs(qe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(sa,{className:"h-3 w-3 text-red-500"}),"السحب الشهري"]}),e.jsxs("span",{className:"font-mono",children:[M(i.monthlyWithdrawalUsage||0)," / ",M(i.monthlyWithdrawalLimit)]})]}),e.jsx(Ma,{value:ne,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",M(i.monthlyWithdrawalLimit-(i.monthlyWithdrawalUsage||0))," جنيه"]})]}),e.jsx(zr,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Es,{className:"h-3 w-3 text-green-500"}),"التحويل الشهري"]}),e.jsxs("span",{className:"font-mono",children:[M(i.monthlyTransferUsage||0)," / ",M(i.monthlyTransferLimit)]})]}),e.jsx(Ma,{value:ae,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",M(i.monthlyTransferLimit-(i.monthlyTransferUsage||0))," جنيه"]})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(Ue,{children:e.jsxs(qe,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(sa,{className:"h-5 w-5 text-red-500"})}),e.jsx("div",{className:"text-lg font-bold",children:M(re)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي السحب"})]})}),e.jsx(Ue,{children:e.jsxs(qe,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Es,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"text-lg font-bold",children:M($)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي التحويل"})]})}),e.jsx(Ue,{children:e.jsxs(qe,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Qe,{className:"h-5 w-5 text-green-500"})}),e.jsx("div",{className:"text-lg font-bold",children:M(P)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي الإيداع"})]})})]}),e.jsxs(Ue,{children:[e.jsx(ct,{children:e.jsxs(jt,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Mr,{className:"h-4 w-4"}),"سجل المعاملات"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{size:"sm",variant:h==="week"?"default":"outline",onClick:()=>v("week"),className:"text-xs",children:"أسبوع"}),e.jsx(c,{size:"sm",variant:h==="month"?"default":"outline",onClick:()=>v("month"),className:"text-xs",children:"شهر"}),e.jsx(c,{size:"sm",variant:h==="all"?"default":"outline",onClick:()=>v("all"),className:"text-xs",children:"الكل"})]})]})}),e.jsx(qe,{children:E?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المعاملات..."})]})}):W.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Mr,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد معاملات في هذه الفترة"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:W.map(K=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[pe(K.type),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[Z(K.type)," - ",M(K.amount)," جنيه"]}),e.jsx("div",{className:"text-xs text-gray-600",children:H(K.createdAt)}),K.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:K.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[G(K.status),e.jsx("span",{className:"text-xs",children:Ne(K.status)})]})]},K.id))})})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(c,{onClick:m,variant:"outline",children:[e.jsx(gn,{className:"h-4 w-4 mr-2"}),"العودة للمحافظ"]}),e.jsx(c,{onClick:t,variant:"outline",children:"إغلاق"})]})]})})},$r=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],tc=({isOpen:i,onClose:d,onWalletUpdate:t,initialEditingWallet:m})=>{const{toast:y}=Rt(),{user:u}=ls(),T=an(),[E,f]=l.useState([]),[h,v]=l.useState(!1),[k,I]=l.useState(null),[M,H]=l.useState(""),[V,W]=l.useState(""),[C,U]=l.useState(""),[re,$]=l.useState(""),[P,J]=l.useState("200000"),[ne,ae]=l.useState("200000"),[pe,G]=l.useState("100000"),[Z,Ne]=l.useState("60000"),[K,te]=l.useState(!1),[We,ze]=l.useState(null),[Ie,Te]=l.useState(!1),[tt,Je]=l.useState(!1),[Pt,vt]=l.useState(!1),[p,_]=l.useState(null),se=()=>`wallets_${(u==null?void 0:u.uid)||"default"}`;l.useEffect(()=>{m&&(I(m),v(!0),H(m.name||""),W(m.phone||""),U(m.nationalId||""),$(m.walletProvider||""),J((m.monthlyWithdrawalLimit||2e5).toString()),ae((m.monthlyTransferLimit||2e5).toString()),G((m.dailyWithdrawalLimit||1e5).toString()),Ne((m.dailyTransferLimit||6e4).toString()),te(!!m.isDefault))},[m]);const he=D=>{const X=new Date,ge=X.getMonth(),Ae=X.getFullYear();if(!D.lastResetDate)return{...D,monthlyWithdrawalUsage:D.monthlyWithdrawalUsage||0,monthlyTransferUsage:D.monthlyTransferUsage||0,lastResetDate:X.toISOString().split("T")[0]};const ke=new Date(D.lastResetDate),Ke=ke.getMonth(),O=ke.getFullYear();return ge!==Ke||Ae!==O?{...D,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:X.toISOString().split("T")[0]}:D},we=async(D,X)=>{const ge=new Date().getMonth(),Ae=new Date().getFullYear(),ke=X.filter(ee=>{const z=new Date(ee.createdAt);return z.getMonth()===ge&&z.getFullYear()===Ae&&ee.lineId===D}),Ke=ke.filter(ee=>ee.txnType==="receive").reduce((ee,z)=>ee+(z.amount||0),0),O=ke.filter(ee=>ee.txnType==="send").reduce((ee,z)=>ee+(z.amount||0),0);return{withdrawalUsage:Ke,transferUsage:O}},Le=async(D,X)=>{const ge=new Date,Ae=ge.getDate(),ke=ge.getMonth(),Ke=ge.getFullYear(),O=X.filter(ue=>{const Pe=new Date(ue.createdAt);return Pe.getDate()===Ae&&Pe.getMonth()===ke&&Pe.getFullYear()===Ke&&ue.lineId===D}),ee=O.filter(ue=>ue.txnType==="receive").reduce((ue,Pe)=>ue+(Pe.amount||0),0),z=O.filter(ue=>ue.txnType==="send").reduce((ue,Pe)=>ue+(Pe.amount||0),0);return{withdrawalUsage:ee,transferUsage:z}};l.useEffect(()=>{(async()=>{if(!(u!=null&&u.uid)){console.log("No user authenticated, skipping wallet loading"),Te(!1);return}console.log("Loading wallets for user:",u.uid),Te(!0);try{const{auth:X}=await es(async()=>{const{auth:z}=await import("./index-uPMs_SiV.js").then(ue=>ue.a$);return{auth:z}},__vite__mapDeps([0,1]));let ge=0;const Ae=5;for(;!X.currentUser&&ge<Ae;)console.log(`Waiting for auth state... attempt ${ge+1}`),await new Promise(z=>setTimeout(z,1e3)),ge++;if(!X.currentUser)throw console.error("User not authenticated in Firebase Auth after retries"),new Error("not authenticated");console.log("Firebase Auth User:",X.currentUser.uid),console.log("Context User:",u.uid),console.log("Fetching wallets from Firebase...");const ke=await ss.getByMerchantId(u.uid);console.log("Fetched wallets:",ke),console.log("Fetching transactions from Firebase...");const Ke=await Ua.getByUserId(u.uid);console.log("Fetched transactions:",Ke);const ee=(await Promise.all(ke.map(async z=>{const{withdrawalUsage:ue,transferUsage:Pe}=await we(z.id,Ke),{withdrawalUsage:dt,transferUsage:lt}=await Le(z.id,Ke);return{id:z.id,name:z.label||"محفظة بدون اسم",phone:z.msisdn,isDefault:!1,monthlyWithdrawalLimit:z.withdrawLimit||2e5,monthlyTransferLimit:z.transferLimit||2e5,dailyWithdrawalLimit:1e5,dailyTransferLimit:6e4,monthlyWithdrawalUsage:ue,monthlyTransferUsage:Pe,dailyWithdrawalUsage:dt,dailyTransferUsage:lt,lastResetDate:new Date().toISOString().split("T")[0],defaultTransferCommission:z.defaultTransferCommission!=null?Number(z.defaultTransferCommission):null,defaultWithdrawCommission:z.defaultWithdrawCommission!=null?Number(z.defaultWithdrawCommission):null}}))).map(he);f(ee),console.log("Wallets loaded successfully:",ee)}catch(X){console.error("Error loading wallets:",X),console.log("تم تحميل المحافظ من البيانات المحفوظة محلياً");const ge=localStorage.getItem(se());if(ge){const Ae=JSON.parse(ge);f(Ae.map(ke=>({...ke,phone:ke.phone||ke.phoneNumber,monthlyWithdrawalLimit:ke.monthlyWithdrawalLimit||2e5,monthlyTransferLimit:ke.monthlyTransferLimit||2e5})))}}finally{Te(!1)}})()},[u==null?void 0:u.uid]);const $e=()=>{H(""),W(""),U(""),$(""),J("200000"),ae("200000"),G("100000"),Ne("60000"),te(!1),I(null),v(!1)},gt=async()=>{if(!M.trim()||!V.trim()||!re.trim()){y({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!(u!=null&&u.uid)){y({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}Te(!0);try{if(k){await ss.update(k.id,{label:M.trim(),msisdn:V.trim(),withdrawLimit:parseInt(P),transferLimit:parseInt(ne)});const D=E.map(X=>X.id===k.id?{...X,name:M.trim(),phone:V.trim(),nationalId:C.trim(),walletProvider:re,monthlyWithdrawalLimit:parseInt(P),monthlyTransferLimit:parseInt(ne),dailyWithdrawalLimit:parseInt(pe),dailyTransferLimit:parseInt(Z)}:X);f(D),localStorage.setItem(se(),JSON.stringify(D)),y({title:"تم التحديث",description:"تم تحديث المحفظة بنجاح"})}else{const D={merchantUserId:u.uid,provider:re,msisdn:V.trim(),label:M.trim(),isActive:!0,dailyLimit:2e5,monthlyLimit:2e5,withdrawLimit:parseInt(P),transferLimit:parseInt(ne),dailyUsage:0,monthlyUsage:0,transferUsage:0,withdrawUsage:0},X=await ss.create(D),ge=new Date().toISOString().split("T")[0],Ae={id:X,name:M.trim(),phone:V.trim(),nationalId:C.trim(),walletProvider:re,isDefault:K,monthlyWithdrawalLimit:parseInt(P),monthlyTransferLimit:parseInt(ne),dailyWithdrawalLimit:parseInt(pe),dailyTransferLimit:parseInt(Z),monthlyWithdrawalUsage:0,monthlyTransferUsage:0,dailyWithdrawalUsage:0,dailyTransferUsage:0,lastResetDate:ge,defaultTransferCommission:null,defaultWithdrawCommission:null},ke=[...E,Ae];f(ke),localStorage.setItem(se(),JSON.stringify(ke)),y({title:"تم الإنشاء",description:"تم إنشاء المحفظة بنجاح"})}t&&t(),$e(),v(!1),I(null)}catch(D){console.error("Error saving wallet:",D),y({title:"خطأ",description:"حدث خطأ أثناء حفظ المحفظة",variant:"destructive"})}finally{Te(!1)}},Ot=D=>{I(D),H(D.name),W(D.phone),U(D.nationalId||""),$(D.walletProvider||""),J(D.monthlyWithdrawalLimit.toString()),ae(D.monthlyTransferLimit.toString()),te(D.isDefault),v(!0)},bt=async D=>{const X=E.find(ge=>ge.id===D);if(X!=null&&X.isDefault){y({title:"تحذير",description:"لا يمكن حذف المحفظة الافتراضية",variant:"destructive"});return}if(!(u!=null&&u.uid)){y({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}Te(!0);try{await ss.delete(D);const ge=E.filter(Ae=>Ae.id!==D);f(ge),localStorage.setItem(se(),JSON.stringify(ge)),t&&t(),y({title:"تم الحذف",description:"تم حذف المحفظة بنجاح"})}catch(ge){console.error("Error deleting wallet:",ge),y({title:"خطأ",description:"حدث خطأ أثناء حذف المحفظة",variant:"destructive"})}finally{Te(!1)}},pt=D=>{const X=E.map(ge=>({...ge,isDefault:ge.id===D}));f(X),localStorage.setItem(se(),JSON.stringify(X)),t&&t(),y({title:"تم تحديث المحفظة الافتراضية",description:"تم تعيين المحفظة كافتراضية بنجاح"})};return e.jsxs(oe,{open:i,onOpenChange:d,children:[e.jsxs(ce,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(de,{className:"pb-2",children:e.jsxs(me,{className:"flex items-center gap-1 text-sm",children:[e.jsx($t,{className:"h-3 w-3"}),"إدارة المحافظ"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-semibold",children:["المحافظ المتاحة (",E.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:()=>vt(!0),className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",variant:"outline",children:[e.jsx(et,{className:"h-3 w-3"}),"الاطلاع على المحافظ"]}),e.jsxs(c,{onClick:()=>{d(),T("/user/add-wallet")},className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",children:[e.jsx(ut,{className:"h-3 w-3"}),"إضافة محفظة جديدة"]})]})]}),(h||k)&&e.jsxs(Ue,{className:"border-2 border-blue-200 bg-blue-50",children:[e.jsx(ct,{className:"pb-1",children:e.jsx(jt,{className:"text-sm",children:k?"تعديل المحفظة":"إضافة محفظة جديدة"})}),e.jsxs(qe,{className:"space-y-2 pt-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"شركة المحفظة"}),e.jsx("div",{className:"flex gap-1 items-center",children:e.jsxs(Ts,{value:re,onValueChange:$,children:[e.jsx(As,{className:"h-6 text-xs flex-1",children:e.jsx(ks,{placeholder:"اختر شركة المحفظة"})}),e.jsx(Ps,{children:$r.map(D=>e.jsx(Os,{value:D.id,className:"text-xs",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:D.name}),e.jsx("button",{type:"button",className:"h-4 w-4 p-0 ml-2 flex items-center justify-center hover:bg-blue-100 rounded",onClick:X=>{X.preventDefault(),X.stopPropagation(),ze(D.id)},children:e.jsx(Vr,{className:"h-3 w-3 text-blue-500 hover:text-blue-700"})})]})},D.id))})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"اسم المحفظة"}),e.jsx(L,{value:M,onChange:D=>H(D.target.value),placeholder:"مثال: محفظة العمل",className:"h-6 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(L,{value:V,onChange:D=>W(D.target.value),placeholder:"01030302038",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الرقم القومي للخط"}),e.jsxs("div",{className:"relative",children:[e.jsx(_a,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(L,{value:C,onChange:D=>U(D.target.value),placeholder:"29012345678901",maxLength:14,className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد الشهري للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(L,{type:"number",value:P,onChange:D=>J(D.target.value),placeholder:"200000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد الشهري للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(L,{type:"number",value:ne,onChange:D=>ae(D.target.value),placeholder:"200000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد اليومي للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(sa,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400"}),e.jsx(L,{type:"number",value:pe,onChange:D=>G(D.target.value),placeholder:"100000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد اليومي للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400"}),e.jsx(L,{type:"number",value:Z,onChange:D=>Ne(D.target.value),placeholder:"60000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isDefault",checked:K,onChange:D=>te(D.target.checked),className:"rounded w-3 h-3"}),e.jsx("label",{htmlFor:"isDefault",className:"text-xs font-medium text-gray-700",children:"تعيين كمحفظة افتراضية"})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(rn,{className:"h-3 w-3 text-gray-600"}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"إعدادات العمولة"})]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{onClick:gt,className:"flex-1 h-6 text-xs",size:"sm",children:k?"تحديث المحفظة":"إضافة المحفظة"}),e.jsx(c,{variant:"outline",onClick:$e,className:"h-6 text-xs",size:"sm",children:"إلغاء"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:E.map(D=>{var X;return e.jsxs(Ue,{className:`${D.isDefault?"border-green-300 bg-green-50":""}`,children:[e.jsx(ct,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(jt,{className:"text-sm flex items-center gap-1",children:[e.jsx($t,{className:"h-3 w-3"}),D.name]}),D.isDefault&&e.jsx(rt,{variant:"default",className:"bg-green-600 text-xs px-1 py-0",children:"افتراضية"})]})}),e.jsxs(qe,{className:"space-y-1 pt-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ht,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-xs",children:D.phone})]}),D.walletProvider&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:((X=$r.find(ge=>ge.id===D.walletProvider))==null?void 0:X.name)||D.walletProvider}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود الشهرية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((D.monthlyWithdrawalUsage||0)/D.monthlyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((D.monthlyTransferUsage||0)/D.monthlyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",Math.max(D.monthlyWithdrawalLimit-(D.monthlyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",Math.max(D.monthlyTransferLimit-(D.monthlyTransferUsage||0),0)," جنيه"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود اليومية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-orange-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((D.dailyWithdrawalUsage||0)/D.dailyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-green-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((D.dailyTransferUsage||0)/D.dailyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["متبقي سحب يومي: ",Math.max(D.dailyWithdrawalLimit-(D.dailyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["متبقي تحويل يومي: ",Math.max(D.dailyTransferLimit-(D.dailyTransferUsage||0),0)," جنيه"]})]})]})]}),e.jsxs("div",{className:"flex gap-1 pt-1",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>Ot(D),className:"flex-1 h-5 text-xs px-1",children:[e.jsx(un,{className:"h-2 w-2 mr-0.5"}),"تعديل"]}),!D.isDefault&&e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>pt(D.id),className:"flex-1 h-5 text-xs px-1",children:"جعلها افتراضية"}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>bt(D.id),className:"h-5 px-1",children:e.jsx(Ct,{className:"h-2 w-2"})})]})]})]})]},D.id)})}),E.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500 text-xs",children:"لا توجد محافظ متاحة. قم بإضافة محفظة جديدة للبدء."})]}),We&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"معلومات صاحب المحفظة"}),e.jsx("button",{onClick:()=>ze(null),className:"h-8 w-8 p-0 flex items-center justify-center hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(ln,{className:"h-4 w-4 text-gray-500"})})]}),(()=>{const D=$r.find(X=>X.id===We);return D?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg inline-block",children:e.jsx("h4",{className:"font-bold text-blue-700 text-lg",children:D.name})})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{className:"font-semibold text-gray-700",children:"اسم صاحب المحفظة:"})]}),e.jsx("p",{className:"text-gray-900 font-medium text-lg mr-4",children:D.ownerName})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"font-semibold text-gray-700",children:"الرقم القومي:"})]}),e.jsx("p",{className:"text-gray-900 font-mono text-lg mr-4 tracking-wider",children:D.nationalId})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Vr,{className:"h-4 w-4 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-800 font-medium",children:"هذه البيانات مسجلة رسمياً في النظام لهذه المحفظة"})]})})]}):null})()]})})]}),e.jsx(ra,{open:Pt,onOpenChange:vt,mode:"verify",title:"إدخال الرقم السري الرئيسي",description:"لا يمكن الاطلاع على المحافظ إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{vt(!1),Je(!0)}}),e.jsx(Zo,{isOpen:tt,onClose:()=>Je(!1),onWalletSelect:D=>{_(D),Je(!1)},onEditWallet:D=>{T(`/user/add-wallet?edit=1&id=${D.id}`),Je(!1)},onDeleteWallet:async D=>{try{if(await ss.delete(D),f(X=>{const ge=X.filter(Ae=>Ae.id!==D);try{localStorage.setItem(se(),JSON.stringify(ge))}catch(Ae){console.error("Failed to update localStorage wallets after delete:",Ae)}return ge}),t)try{await t()}catch(X){console.error("onWalletUpdate callback failed:",X)}}catch(X){console.error("Error deleting wallet:",X)}}}),e.jsx(ec,{wallet:p,isOpen:!!p,onClose:()=>_(null),onBack:()=>{_(null),Je(!0)}})]})},sc=({isOpen:i,onClose:d,transaction:t,onDelete:m})=>{if(!t)return null;const y=h=>{switch(h){case"completed":return e.jsx(La,{className:"h-5 w-5 text-green-500"});case"pending":return e.jsx(fs,{className:"h-5 w-5 text-yellow-500"});case"failed":return e.jsx(Gr,{className:"h-5 w-5 text-red-500"});default:return e.jsx(fs,{className:"h-5 w-5 text-gray-500"})}},u=h=>{switch(h){case"completed":return"مكتملة";case"pending":return"قيد الانتظار";case"failed":return"فاشلة";default:return"غير معروف"}},T=h=>{switch(h){case"withdraw":return"سحب";case"send":return"إرسال";case"receive":return"استقبال";default:return"تحويل"}},E=()=>{const h=!!t.senderNumber,v=!!t.senderName,k=h?"الرقم المرسل:":v?"الرقم الراسل:":"رقم المحفظة:",I=h?t.senderNumber:v?t.senderName:t.senderPhone,M=`
      <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 500px; margin: 0 auto; padding: 30px; background: #fff;">
        <!-- Header -->
        <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2563eb; padding-bottom: 20px;">
          <h1 style="color: #2563eb; margin-bottom: 5px; font-size: 28px;">إيصال المعاملة</h1>
          <p style="color: #666; font-size: 16px; margin: 0;">رقم المرجع: ${t.transactionReference||t.id}</p>
          <p style="color: #888; font-size: 14px; margin: 5px 0 0 0;">${new Date().toLocaleString("ar-EG")}</p>
        </div>
        
        <!-- Shop Info -->
        <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
          <h3 style="color: #1e293b; margin: 0 0 15px 0; font-size: 18px;">معلومات المحل</h3>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-weight: 600; color: #475569;">اسم المحل:</span>
            <span style="color: #1e293b;">${t.merchantShopName||t.shopName||"غير محدد"}</span>
          </div>
        </div>
        
        <!-- Transaction Details -->
        <div style="background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
          <h3 style="color: #1e293b; margin: 0 0 15px 0; font-size: 18px;">تفاصيل المعاملة</h3>
          
          <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
            <span style="font-weight: 600; color: #475569;">نوع المعاملة:</span>
            <span style="color: #2563eb; font-weight: 600;">${T(t.type)}</span>
          </div>
          
          <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
            <span style="font-weight: 600; color: #475569;">الحالة:</span>
            <span style="color: ${t.status==="completed"?"#16a34a":t.status==="pending"?"#ca8a04":"#dc2626"}; font-weight: 600;">
              ${u(t.status)}
            </span>
          </div>

          ${t!=null&&t.cashierName?`
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
              <span style="font-weight: 600; color: #475569;">الكاشير:</span>
              <span style="color: #1e293b;">${t.cashierName}</span>
            </div>
          `:""}
          
          ${t.type!=="withdraw"?`
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
              <span style="font-weight: 600; color: #475569;">${k}</span>
              <span style="color: #1e293b;">${I}</span>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
              <span style="font-weight: 600; color: #475569;">الرقم المستقبل:</span>
              <span style="color: #1e293b;">${t.receiverNumber||t.receiverPhone}</span>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
              <span style="font-weight: 600; color: #475569;">المبلغ المحول:</span>
              <span style="color: #2563eb; font-weight: bold; font-size: 16px;">${t.transferredAmount||t.amount} جنيه</span>
            </div>
          `:`
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
              <span style="font-weight: 600; color: #475569;">رقم المحفظة:</span>
              <span style="color: #1e293b;">${t.senderPhone}</span>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
              <span style="font-weight: 600; color: #475569;">المبلغ المسحوب:</span>
              <span style="color: #dc2626; font-weight: bold; font-size: 16px;">${t.withdrawnAmountDetailed||t.withdrawnAmount||t.amount} جنيه</span>
            </div>
          `}
          
          ${t.commission?`
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
              <span style="font-weight: 600; color: #475569;">العمولة:</span>
              <span style="color: #f59e0b; font-weight: 600;">${t.commission} جنيه</span>
            </div>
          `:""}
          
          <div style="display: flex; justify-content: space-between; padding: 8px 0;">
            <span style="font-weight: 600; color: #475569;">التاريخ والوقت:</span>
            <span style="color: #1e293b;">${t.createdAt.toLocaleString("ar-EG")}</span>
          </div>
        </div>
        
        <!-- Total Amount -->
        <div style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center;">
          <h3 style="color: white; margin: 0 0 10px 0; font-size: 16px;">إجمالي المبلغ</h3>
          <p style="color: white; font-size: 24px; font-weight: bold; margin: 0;">
            ${t.type==="withdraw"?"-":""}${t.amount} جنيه
          </p>
        </div>
        
        
        
        
        <!-- Footer -->
        <div style="text-align: center; color: #64748b; font-size: 12px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
          <p style="margin: 0 0 5px 0;">شكراً لاستخدام خدماتنا</p>
          <p style="margin: 0;">تم إنشاء الإيصال في: ${new Date().toLocaleString("ar-EG")}</p>
        </div>
      </div>
    `,H=window.open("","_blank");H&&(H.document.write(`
        <html>
          <head>
            <title>إيصال المعاملة - ${t.transactionReference||t.id}</title>
            <meta charset="UTF-8">
            <style>
              body { 
                margin: 0; 
                padding: 20px; 
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #f8fafc;
              }
              @media print {
                body { 
                  margin: 0; 
                  background: white;
                }
              }
            </style>
          </head>
          <body>
            ${M}
          </body>
        </html>
      `),H.document.close(),H.print())},f=()=>{window.confirm("هل أنت متأكد من حذف هذه المعاملة؟ لا يمكن التراجع عن هذا الإجراء.")&&(m(t.id),d())};return e.jsx(oe,{open:i,onOpenChange:d,children:e.jsxs(ce,{className:"w-[92vw] sm:w-auto sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Ba,{className:"h-6 w-6 text-blue-600"}),"إيصال المعاملة المفصل"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ue,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs(ct,{className:"text-center pb-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[y(t.status),e.jsx(rt,{variant:t.status==="completed"?"default":"secondary",className:"text-sm",children:u(t.status)})]}),e.jsxs("h3",{className:"text-2xl font-bold text-blue-600",children:[t.type==="withdraw"?"-":"",t.amount," جنيه"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["رقم المرجع: ",t.transactionReference||t.id]})]})}),e.jsxs(Ue,{children:[e.jsx(ct,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Eo,{className:"h-5 w-5 text-green-600"}),e.jsx("h4",{className:"font-semibold text-lg",children:"معلومات المحل"})]})}),e.jsxs(qe,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"اسم المحل:"}),e.jsx("span",{className:"text-gray-900",children:t.merchantShopName||t.shopName||"غير محدد"})]}),(t==null?void 0:t.cashierName)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"الكاشير:"}),e.jsx("span",{className:"text-gray-900",children:t.cashierName})]})]})]}),e.jsxs(Ue,{children:[e.jsx(ct,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"h-5 w-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-lg",children:"تفاصيل المعاملة"})]})}),e.jsx(qe,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"نوع المعاملة:"}),e.jsx(rt,{variant:"outline",className:"bg-blue-100 text-blue-800",children:T(t.type)})]}),t.type!=="withdraw"?e.jsxs(e.Fragment,{children:[(()=>{const h=!!t.senderNumber,v=!!t.senderName,k=h?"الرقم المرسل:":v?"الرقم الراسل:":"رقم المحفظة:",I=h?t.senderNumber:v?t.senderName:t.senderPhone,M=h?Kr:Ht;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:k})]}),e.jsx("span",{className:"text-gray-900 font-mono",children:I})]})})(),e.jsx("div",{className:"flex items-center justify-center p-2",children:e.jsx(Mo,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kr,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium text-green-700",children:"الرقم المستقبل:"})]}),e.jsx("span",{className:"text-green-900 font-mono",children:t.receiverNumber||t.receiverPhone})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium text-blue-700",children:"المبلغ المحول:"})]}),e.jsxs("span",{className:"text-blue-900 font-bold text-lg",children:[t.transferredAmount||t.amount," جنيه"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"رقم المحفظة:"})]}),e.jsx("span",{className:"text-gray-900 font-mono",children:t.senderPhone})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"font-medium text-red-700",children:"المبلغ المسحوب:"})]}),e.jsxs("span",{className:"text-red-900 font-bold text-lg",children:[t.withdrawnAmountDetailed||t.withdrawnAmount||t.amount," جنيه"]})]})]}),t.commission&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-yellow-700",children:"العمولة:"}),e.jsxs("span",{className:"text-yellow-900 font-semibold",children:[t.commission," جنيه"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"التاريخ والوقت:"})]}),e.jsx("span",{className:"text-gray-900",children:t.createdAt.toLocaleString("ar-EG")})]})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(c,{onClick:E,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[e.jsx(Lo,{className:"h-5 w-5 mr-2"}),"طباعة الإيصال"]}),e.jsxs(c,{onClick:f,variant:"destructive",className:"flex-1",size:"lg",children:[e.jsx(Ct,{className:"h-5 w-5 mr-2"}),"حذف المعاملة"]})]}),e.jsx(c,{onClick:d,variant:"outline",className:"w-full",size:"lg",children:"إغلاق الإيصال"})]})]})})};function Ql({open:i,onOpenChange:d,onSuccess:t,title:m,description:y,currentBalance:u,balanceLabel:T,userId:E}){const[f,h]=l.useState(""),[v,k]=l.useState(u.toString()),[I,M]=l.useState(!1),[H,V]=l.useState(""),[W,C]=l.useState(!1),U=as.hasMasterPin(),re=async P=>{P.preventDefault(),V(""),C(!0);try{const J=parseFloat(v);if(isNaN(J)||J<0){V("يرجى إدخال مبلغ صحيح"),C(!1);return}U?as.verifyMasterPin(f)?(t(J),d(!1),h(""),k("")):V("الرقم السري غير صحيح"):V("لم يتم تعيين رقم سري رئيسي. يرجى تعيين رقم سري رئيسي أولاً من إعدادات التطبيق")}catch{V("حدث خطأ أثناء التحقق من الرقم السري")}finally{C(!1)}},$=()=>{h(""),k(u.toString()),V(""),d(!1)};return it.useEffect(()=>{i&&k(u.toString())},[u,i]),e.jsx(oe,{open:i,onOpenChange:$,children:e.jsxs(ce,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-right",children:[e.jsx(Qe,{className:"h-5 w-5"}),m]})}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground text-right",children:y}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs(Y,{className:"text-sm font-medium text-gray-700",children:[T," الحالي"]}),e.jsxs("div",{className:"text-lg font-bold text-gray-900 mt-1",children:[u.toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"newAmount",className:"text-right",children:"المبلغ الجديد"}),e.jsx(L,{id:"newAmount",type:"number",step:"0.01",min:"0",value:v,onChange:P=>k(P.target.value),placeholder:"أدخل المبلغ الجديد",className:"text-right",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"pin",className:"text-right",children:"الرقم السري"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"pin",type:I?"text":"password",value:f,onChange:P=>h(P.target.value),placeholder:"أدخل الرقم السري",className:"text-right pr-10",required:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>M(!I),children:I?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),H&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:[e.jsx(js,{className:"h-4 w-4"}),H]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:$,className:"flex-1",children:"إلغاء"}),e.jsx(c,{type:"submit",disabled:W||!f||!v,className:"flex-1",children:W?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"جاري التحديث..."]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"تحديث الرصيد"]})})]})]})]})})}class aa{static getSecretKey(d){return d?`${this.SECRET_KEY_BASE}_${d}`:this.SECRET_KEY_BASE}static setSecretPin(d,t){const m=btoa(d);this.secretCache.set(this.getSecretKey(t),m)}static hasSecretPin(d){return this.secretCache.has(this.getSecretKey(d))}static verifySecretPin(d,t){const m=this.secretCache.get(this.getSecretKey(t));if(!m)return!1;try{return atob(m)===d}catch{return!1}}static clearSecretPin(d){this.secretCache.delete(this.getSecretKey(d))}}Er(aa,"SECRET_KEY_BASE","dashboard_secret_pin"),Er(aa,"secretCache",new Map);function ac({open:i,onOpenChange:d,userId:t}){const[m,y]=l.useState(""),[u,T]=l.useState(""),[E,f]=l.useState(""),[h,v]=l.useState(!1),[k,I]=l.useState(!1),[M,H]=l.useState(!1),[V,W]=l.useState(""),[C,U]=l.useState(!1),{toast:re}=Rt(),$=aa.hasSecretPin(t),P=async ne=>{ne.preventDefault(),W(""),U(!0);try{if(!u||u.length<4){W("يجب أن يكون الرقم السري 4 أرقام على الأقل"),U(!1);return}if(u!==E){W("الرقم السري الجديد وتأكيده غير متطابقين"),U(!1);return}if($){if(!m){W("يرجى إدخال الرقم السري الحالي"),U(!1);return}if(!aa.verifySecretPin(m,t)){W("الرقم السري الحالي غير صحيح"),U(!1);return}}aa.setSecretPin(u,t),re({title:$?"تم تغيير الرقم السري":"تم تعيين الرقم السري",description:$?"تم تغيير الرقم السري بنجاح":"تم تعيين الرقم السري بنجاح"}),J()}catch{W("حدث خطأ أثناء حفظ الرقم السري")}finally{U(!1)}},J=()=>{y(""),T(""),f(""),W(""),v(!1),I(!1),H(!1),d(!1)};return e.jsx(oe,{open:i,onOpenChange:J,children:e.jsxs(ce,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-right",children:[e.jsx(rn,{className:"h-5 w-5"}),$?"تغيير الرقم السري":"تعيين الرقم السري"]})}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground text-right",children:$?"أدخل الرقم السري الحالي والرقم السري الجديد لتغييره":"أدخل الرقم السري الجديد الذي تريد استخدامه في عمليات التعديل"}),$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"currentPin",className:"text-right block",children:"الرقم السري الحالي"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"currentPin",type:h?"text":"password",autoComplete:"off",value:m,onChange:ne=>y(ne.target.value),placeholder:"أدخل الرقم السري الحالي",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>v(!h),children:h?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"newPin",className:"text-right block",children:"الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"newPin",type:k?"text":"password",autoComplete:"off",value:u,onChange:ne=>T(ne.target.value),placeholder:"أدخل الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>I(!k),children:k?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"confirmPin",className:"text-right block",children:"تأكيد الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"confirmPin",type:M?"text":"password",autoComplete:"off",value:E,onChange:ne=>f(ne.target.value),placeholder:"أعد إدخال الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>H(!M),children:M?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),V&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(js,{className:"h-4 w-4"}),V]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(c,{type:"submit",disabled:C,className:"flex-1",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),C?"جاري الحفظ...":$?"تغيير الرقم السري":"تعيين الرقم السري"]}),e.jsx(c,{type:"button",variant:"outline",onClick:J,disabled:C,children:"إلغاء"})]})]})]})})}const _r=new Map;function rc({open:i,onOpenChange:d,userId:t}){const[m,y]=l.useState(""),[u,T]=l.useState(""),[E,f]=l.useState(""),[h,v]=l.useState(!1),[k,I]=l.useState(!1),[M,H]=l.useState(!1),[V,W]=l.useState(""),[C,U]=l.useState(!1),{toast:re}=Rt(),$=t?`cash_drawer_pin_${t}`:"cash_drawer_pin",P=()=>_r.has($),J=G=>{const Z=_r.get($);if(!Z)return!1;try{return atob(Z)===G}catch{return!1}},ne=G=>{const Z=btoa(G);_r.set($,Z)},ae=async G=>{G.preventDefault(),W(""),U(!0);try{if(!u||u.length<4){W("يجب أن يكون الرقم السري 4 أرقام على الأقل"),U(!1);return}if(u!==E){W("الرقم السري الجديد وتأكيده غير متطابقين"),U(!1);return}if(P()){if(!m){W("يرجى إدخال الرقم السري الحالي لدرج النقدية"),U(!1);return}if(!J(m)){W("الرقم السري الحالي لدرج النقدية غير صحيح"),U(!1);return}}ne(u),re({title:P()?"تم تغيير رقم درج النقدية":"تم تعيين رقم درج النقدية",description:P()?"تم تغيير الرقم السري لدرج النقدية بنجاح":"تم تعيين الرقم السري لدرج النقدية بنجاح"}),pe()}catch{W("حدث خطأ أثناء حفظ الرقم السري لدرج النقدية")}finally{U(!1)}},pe=()=>{y(""),T(""),f(""),W(""),v(!1),I(!1),H(!1),d(!1)};return e.jsx(oe,{open:i,onOpenChange:pe,children:e.jsxs(ce,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-right",children:[e.jsx(Qe,{className:"h-5 w-5 text-green-600"}),P()?"تغيير رقم درج النقدية":"تعيين رقم درج النقدية"]})}),e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground text-right",children:P()?"أدخل الرقم السري الحالي والرقم السري الجديد لدرج النقدية":"أدخل الرقم السري الجديد الذي تريد استخدامه لحماية درج النقدية"}),P()&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"currentPin",className:"text-right block",children:"الرقم السري الحالي لدرج النقدية"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"currentPin",type:h?"text":"password",autoComplete:"off",value:m,onChange:G=>y(G.target.value),placeholder:"أدخل الرقم السري الحالي",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>v(!h),children:h?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"newPin",className:"text-right block",children:"الرقم السري الجديد لدرج النقدية"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"newPin",type:k?"text":"password",autoComplete:"off",value:u,onChange:G=>T(G.target.value),placeholder:"أدخل الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>I(!k),children:k?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"confirmPin",className:"text-right block",children:"تأكيد الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"confirmPin",type:M?"text":"password",autoComplete:"off",value:E,onChange:G=>f(G.target.value),placeholder:"أعد إدخال الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>H(!M),children:M?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),V&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(js,{className:"h-4 w-4"}),V]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(c,{type:"submit",disabled:C,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),C?"جاري الحفظ...":P()?"تغيير رقم درج النقدية":"تعيين رقم درج النقدية"]}),e.jsx(c,{type:"button",variant:"outline",onClick:pe,disabled:C,children:"إلغاء"})]})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center mt-2",children:"💰 هذا الرقم السري خاص بحماية درج النقدية فقط"})]})})}const Rr=new Map;function lc({open:i,onOpenChange:d,userId:t}){const[m,y]=l.useState(""),[u,T]=l.useState(""),[E,f]=l.useState(""),[h,v]=l.useState(!1),[k,I]=l.useState(!1),[M,H]=l.useState(!1),[V,W]=l.useState(""),[C,U]=l.useState(!1),{toast:re}=Rt(),$=t?`wallet_total_pin_${t}`:"wallet_total_pin",P=()=>Rr.has($),J=G=>{const Z=Rr.get($);if(!Z)return!1;try{return atob(Z)===G}catch{return!1}},ne=G=>{const Z=btoa(G);Rr.set($,Z)},ae=async G=>{G.preventDefault(),W(""),U(!0);try{if(!u||u.length<4){W("يجب أن يكون الرقم السري 4 أرقام على الأقل"),U(!1);return}if(u!==E){W("الرقم السري الجديد وتأكيده غير متطابقين"),U(!1);return}if(P()){if(!m){W("يرجى إدخال الرقم السري الحالي لإجمالي المحفظة"),U(!1);return}if(!J(m)){W("الرقم السري الحالي لإجمالي المحفظة غير صحيح"),U(!1);return}}ne(u),re({title:P()?"تم تغيير رقم إجمالي المحفظة":"تم تعيين رقم إجمالي المحفظة",description:P()?"تم تغيير الرقم السري لإجمالي المحفظة بنجاح":"تم تعيين الرقم السري لإجمالي المحفظة بنجاح"}),pe()}catch{W("حدث خطأ أثناء حفظ الرقم السري لإجمالي المحفظة")}finally{U(!1)}},pe=()=>{y(""),T(""),f(""),W(""),v(!1),I(!1),H(!1),d(!1)};return e.jsx(oe,{open:i,onOpenChange:pe,children:e.jsxs(ce,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-right",children:[e.jsx($t,{className:"h-5 w-5 text-blue-600"}),P()?"تغيير رقم إجمالي المحفظة":"تعيين رقم إجمالي المحفظة"]})}),e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground text-right",children:P()?"أدخل الرقم السري الحالي والرقم السري الجديد لإجمالي المحفظة":"أدخل الرقم السري الجديد الذي تريد استخدامه لحماية إجمالي المحفظة"}),P()&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"currentPin",className:"text-right block",children:"الرقم السري الحالي لإجمالي المحفظة"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"currentPin",type:h?"text":"password",autoComplete:"off",value:m,onChange:G=>y(G.target.value),placeholder:"أدخل الرقم السري الحالي",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>v(!h),children:h?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"newPin",className:"text-right block",children:"الرقم السري الجديد لإجمالي المحفظة"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"newPin",type:k?"text":"password",autoComplete:"off",value:u,onChange:G=>T(G.target.value),placeholder:"أدخل الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>I(!k),children:k?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"confirmPin",className:"text-right block",children:"تأكيد الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"confirmPin",type:M?"text":"password",autoComplete:"off",value:E,onChange:G=>f(G.target.value),placeholder:"أعد إدخال الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>H(!M),children:M?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),V&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(js,{className:"h-4 w-4"}),V]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(c,{type:"submit",disabled:C,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),C?"جاري الحفظ...":P()?"تغيير رقم إجمالي المحفظة":"تعيين رقم إجمالي المحفظة"]}),e.jsx(c,{type:"button",variant:"outline",onClick:pe,disabled:C,children:"إلغاء"})]})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center mt-2",children:"💼 هذا الرقم السري خاص بحماية إجمالي المحفظة فقط"})]})})}function nc({open:i,onOpenChange:d,onSuccess:t,title:m,description:y,currentBalance:u,balanceLabel:T,userId:E}){const[f,h]=l.useState(""),[v,k]=l.useState(""),[I,M]=l.useState("add"),[H,V]=l.useState(!1),[W,C]=l.useState(""),[U,re]=l.useState(!1),$=as.hasMasterPin(),P=async ae=>{ae.preventDefault(),C(""),re(!0);try{const pe=parseFloat(v);if(isNaN(pe)||pe<=0){C("يرجى إدخال مبلغ صحيح أكبر من صفر"),re(!1);return}if(I==="subtract"&&pe>u){C("لا يمكن خصم مبلغ أكبر من الرصيد الحالي"),re(!1);return}if($)if(as.verifyMasterPin(f)){const G=I==="add"?pe:-pe;J(),t(G)}else C("الرقم السري غير صحيح");else C("لم يتم تعيين رقم سري رئيسي. يرجى تعيين رقم سري رئيسي أولاً من إعدادات التطبيق")}catch{C("حدث خطأ أثناء التحقق من الرقم السري")}finally{re(!1)}},J=()=>{h(""),k(""),M("add"),C(""),d(!1)},ne=()=>{const ae=parseFloat(v)||0;return I==="add"?u+ae:u-ae};return e.jsx(oe,{open:i,onOpenChange:J,children:e.jsxs(ce,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-right",children:[I==="add"?e.jsx(ut,{className:"h-5 w-5 text-green-600"}):e.jsx(gs,{className:"h-5 w-5 text-red-600"}),m]})}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground text-right",children:y}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs(Y,{className:"text-sm font-medium text-gray-700",children:[T," الحالي"]}),e.jsxs("div",{className:"text-lg font-bold text-gray-900 mt-1",children:[u.toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-right",children:"نوع العملية"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{type:"button",variant:I==="add"?"default":"outline",onClick:()=>M("add"),className:"flex-1 flex items-center gap-2",children:[e.jsx(ut,{className:"h-4 w-4"}),"إضافة"]}),e.jsxs(c,{type:"button",variant:I==="subtract"?"default":"outline",onClick:()=>M("subtract"),className:"flex-1 flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),"خصم"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{htmlFor:"amount",className:"text-right",children:["المبلغ المراد ",I==="add"?"إضافته":"خصمه"]}),e.jsx(L,{id:"amount",type:"number",step:"0.01",min:"0.01",value:v,onChange:ae=>k(ae.target.value),placeholder:`أدخل المبلغ المراد ${I==="add"?"إضافته":"خصمه"}`,className:"text-right",required:!0})]}),v&&!isNaN(parseFloat(v))&&e.jsxs("div",{className:`p-3 rounded-lg ${I==="add"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx(Y,{className:"text-sm font-medium text-gray-700",children:"الرصيد الجديد المتوقع"}),e.jsxs("div",{className:`text-lg font-bold mt-1 ${I==="add"?"text-green-700":"text-red-700"}`,children:[ne().toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"pin",className:"text-right",children:"الرقم السري"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"pin",type:H?"text":"password",autoComplete:"off",value:f,onChange:ae=>h(ae.target.value),placeholder:"أدخل الرقم السري",className:"text-right pr-10",required:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>V(!H),children:H?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),W&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:[e.jsx(js,{className:"h-4 w-4"}),W]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:J,className:"flex-1",children:"إلغاء"}),e.jsx(c,{type:"submit",disabled:U||!f||!v,className:`flex-1 ${I==="add"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:U?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"جاري التحديث..."]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),I==="add"?"إضافة المبلغ":"خصم المبلغ"]})})]})]})]})})}const Zl=({isOpen:i,onClose:d,onTrialStarted:t})=>{const{user:m}=ls(),[y,u]=l.useState(!1),[T,E]=l.useState(!1),[f,h]=l.useState(""),[v,k]=l.useState(24);l.useEffect(()=>{const M=async()=>{if(m!=null&&m.uid){const V=await Ea.getTrialData(m.uid);E(V.hasUsedFreeTrial)}},H=async()=>{try{const V=await Ea.getTrialDurationHours();k(V)}catch{}};i&&(M(),H())},[i,m]);const I=async()=>{if(m!=null&&m.uid){u(!0);try{await mo(m.uid,Yt.ZERO,m.uid),window.location.href="/user/dashboard"}catch{h("حدث خطأ أثناء تفعيل باقة الزيرو")}finally{u(!1)}}};return e.jsxs(e.Fragment,{children:[i&&e.jsx("div",{className:"fixed inset-0 z-40",style:{background:"rgba(0, 0, 0, 0.15)",backdropFilter:"blur(3px)",WebkitBackdropFilter:"blur(3px)",pointerEvents:"auto"}}),e.jsx(oe,{open:i,onOpenChange:()=>{},children:e.jsxs(ce,{className:"sm:max-w-lg z-50 border-0 shadow-2xl",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"auto",background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"20px",border:"1px solid rgba(255, 255, 255, 0.3)"},children:[e.jsxs(de,{className:"text-center pb-2",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",filter:"blur(8px)",opacity:.3}}),e.jsx("div",{className:"relative bg-gradient-to-br from-orange-400 to-orange-600 p-4 rounded-full",children:e.jsx(Lr,{className:"h-12 w-12 text-white"})})]})}),e.jsx(me,{className:"text-2xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent text-center",children:"تفعيل الحساب مطلوب"})]}),e.jsxs("div",{className:"text-center py-6 px-2",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-6 mb-6 border border-orange-100",children:[e.jsx("p",{className:"text-gray-700 text-lg leading-relaxed font-medium",children:"حسابك في انتظار التفعيل من قبل المسؤول"}),e.jsx("p",{className:"text-sm font-semibold text-orange-700 mt-3 mb-3 bg-orange-100 p-3 rounded-lg border border-orange-200",children:"للتفعيل السريع: تواصل مع الإدارة عبر واتساب فقط على الرقم التالي"}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200 mt-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-base font-bold text-green-700",children:"واتساب الإدارة:"}),e.jsx("a",{href:"https://wa.me/201000392539",target:"_blank",rel:"noopener noreferrer",className:"text-lg font-bold text-green-600 hover:text-green-700 underline",children:"01000392539"})]}),e.jsx("p",{className:"text-sm text-green-600 mt-2 text-center",children:"اضغط على الرقم للتواصل المباشر عبر واتساب"})]})]}),!T&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 mb-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(Lr,{className:"h-5 w-5 text-green-600 ml-2"}),e.jsx("span",{className:"text-green-700 font-semibold",children:"باقة الزيرو المجانية الدائمة"})]}),e.jsx("p",{className:"text-green-600 text-sm text-center",children:"فعّل باقة الزيرو وادخل مباشرة لكل الميزات بدون انتهاء صلاحية."})]}),f&&e.jsx("div",{className:`rounded-xl p-4 mb-4 text-center ${f.includes("تم تفعيل")?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"}`,children:e.jsx("p",{className:"font-medium",children:f})}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]}),e.jsx("span",{className:"mr-2",children:"في انتظار التفعيل"})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 pb-2",children:[!T&&!f.includes("تم تفعيل")&&e.jsxs(c,{onClick:I,disabled:y,className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 hover:from-blue-700 hover:via-purple-700 hover:to-indigo-700 text-white px-10 py-4 rounded-2xl font-bold text-xl shadow-2xl hover:shadow-3xl transition-all duration-500 transform hover:scale-110 hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",style:{boxShadow:"0 15px 35px rgba(99, 102, 241, 0.4), 0 5px 15px rgba(0, 0, 0, 0.1)"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsx("div",{className:"absolute -top-1 -left-1 w-3 h-3 bg-yellow-400 rounded-full animate-ping"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-green-400 rounded-full animate-pulse"}),y?e.jsxs("div",{className:"flex items-center relative z-10",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white ml-3"}),e.jsx("span",{className:"bg-gradient-to-r from-white to-gray-100 bg-clip-text text-transparent",children:"جاري التفعيل..."})]}):e.jsxs("div",{className:"flex items-center relative z-10",children:[e.jsx(Lr,{className:"h-6 w-6 ml-3 animate-bounce"}),e.jsx("span",{className:"bg-gradient-to-r from-white to-gray-100 bg-clip-text text-transparent",children:"فعّل باقة الزيرو الآن"})]})]}),e.jsx(c,{onClick:d,variant:"outline",className:"border-2 border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-800 px-10 py-3 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105",children:T?"فهمت":"إغلاق"})]})]})})]})};function ic({isOpen:i,onClose:d}){const[t,m]=l.useState("0"),[y,u]=l.useState(null),[T,E]=l.useState(null),[f,h]=l.useState(!1),v=$=>{f?(m($),h(!1)):m(t==="0"?$:t+$)},k=$=>{const P=parseFloat(t);if(y===null)u(P);else if(T){const ne=I(y||0,P,T);m(String(ne)),u(ne)}h(!0),E($)},I=($,P,J)=>{switch(J){case"+":return $+P;case"-":return $-P;case"×":return $*P;case"÷":return P===0?0:$/P;case"=":return P;default:return P}},M=()=>{const $=parseFloat(t);if(y!==null&&T){const P=I(y,$,T);m(String(P)),u(null),E(null),h(!0)}},H=()=>{m("0"),u(null),E(null),h(!1)},V=()=>{m("0")},W=()=>{f?(m("0."),h(!1)):t.indexOf(".")===-1&&m(t+".")},C=()=>{t!=="0"&&m(t.charAt(0)==="-"?t.slice(1):"-"+t)},U=()=>{const $=parseFloat(t);m(String($/100))},re=$=>{const P=$.key;$.preventDefault(),P>="0"&&P<="9"?v(P):P==="+"?k("+"):P==="-"?k("-"):P==="*"?k("×"):P==="/"?k("÷"):P==="Enter"||P==="="?M():P==="Escape"||P==="c"||P==="C"?H():P==="Backspace"?V():P==="."?W():P==="%"&&U()};return l.useEffect(()=>(i?document.addEventListener("keydown",re):document.removeEventListener("keydown",re),()=>{document.removeEventListener("keydown",re)}),[i,t,y,T,f]),e.jsx(oe,{open:i,onOpenChange:$=>!$&&d(),children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-right",children:[e.jsx(pn,{className:"h-5 w-5"}),"آلة حاسبة"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-900 text-white p-4 rounded-lg text-right",children:e.jsx("div",{className:"text-3xl font-mono font-bold min-h-[3rem] flex items-center justify-end overflow-hidden",children:t})}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200",onClick:H,children:"AC"}),e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200",onClick:V,children:"CE"}),e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200",onClick:U,children:"%"}),e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600",onClick:()=>k("÷"),children:"÷"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("7"),children:"7"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("8"),children:"8"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("9"),children:"9"}),e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600",onClick:()=>k("×"),children:"×"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("4"),children:"4"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("5"),children:"5"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("6"),children:"6"}),e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600",onClick:()=>k("-"),children:"-"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("1"),children:"1"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("2"),children:"2"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:()=>v("3"),children:"3"}),e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600",onClick:()=>k("+"),children:"+"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50 col-span-2",onClick:()=>v("0"),children:"0"}),e.jsx(c,{variant:"outline",className:"h-12 text-lg font-semibold bg-white hover:bg-gray-50",onClick:W,children:"."}),e.jsx(c,{variant:"outline",className:"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600",onClick:M,children:"="})]}),e.jsx(c,{variant:"outline",className:"w-full h-10 text-sm font-semibold bg-gray-100 hover:bg-gray-200",onClick:C,children:"+/-"})]})]})})}function oc({isOpen:i,onClose:d}){const[t,m]=l.useState([]),[y,u]=l.useState({productName:"",price:"",wholesalePrice:"",quantity:""}),[T,E]=l.useState(!1);l.useState(null);const{toast:f}=Rt(),{user:h,profile:v}=ls(),[k,I]=l.useState([]),[M,H]=l.useState({}),[V,W]=l.useState({}),[C,U]=l.useState(0),[re,$]=l.useState(0),[P,J]=l.useState(!1),[ne,ae]=l.useState(!0),[pe,G]=l.useState(!1),[Z,Ne]=l.useState(""),K=l.useMemo(()=>{const p=Z.trim().toLowerCase();return p?k.filter(_=>_.name.toLowerCase().includes(p)):k},[k,Z]);l.useEffect(()=>{i&&(h!=null&&h.uid)&&(We(),ne||Ie())},[i,h==null?void 0:h.uid,ne]);const te=async()=>{if(h!=null&&h.uid)try{const p=v==null?void 0:v.shopId;let _;if(p){const he=Ws(ts(ot,"products"),kt("shopId","==",p));if(_=await Fs(he),_.empty){const we=Ws(ts(ot,"products"),kt("userId","==",h.uid));_=await Fs(we)}}else{const he=Ws(ts(ot,"products"),kt("userId","==",h.uid));_=await Fs(he)}const se=_.docs.map(he=>({id:he.id,name:String(he.data().name??""),sellingPrice:Number(he.data().sellingPrice??0),wholesalePrice:Number(he.data().wholesalePrice??0),quantity:Number(he.data().quantity??0)}));I(se)}catch(p){console.error("Error loading shop products:",p)}};l.useEffect(()=>{i&&(h!=null&&h.uid)&&(te(),Ie())},[i,h==null?void 0:h.uid,v==null?void 0:v.shopId]);const We=()=>{if(!(h!=null&&h.uid)){console.log("No user authenticated, cannot load sales data");return}const p=new Date().toISOString().split("T")[0],_=localStorage.getItem(`salesData_${h.uid}_${p}`);m(_?JSON.parse(_):[])},ze=p=>{if(!(h!=null&&h.uid)){console.log("No user authenticated, cannot save sales data");return}const _=new Date().toISOString().split("T")[0];localStorage.setItem(`salesData_${h.uid}_${_}`,JSON.stringify(p)),m(p)},Ie=async()=>{if(h!=null&&h.uid)try{const p=new Date,_=new Date(p.getFullYear(),p.getMonth(),1),se=new Date(p.getFullYear(),p.getMonth()+1,0),he=pt=>pt.toISOString().split("T")[0],we=he(_),Le=he(se),$e=Ws(ts(ot,"dailySales"),kt("userId","==",h.uid),kt("date",">=",we),kt("date","<=",Le)),gt=await Fs($e);let Ot=0,bt=0;gt.forEach(pt=>{const D=pt.data(),X=Number(D.sellingPrice??0),ge=Number(D.quantity??0),Ae=Number(D.profit??(Number(D.sellingPrice??0)-Number(D.wholesalePrice??0))*ge);Ot+=X*ge,bt+=Ae}),U(Ot),$(bt)}catch(p){console.error("Error loading monthly stats:",p)}},Te=async p=>{if(h!=null&&h.uid)try{const _=((p.price??0)-(p.wholesalePrice??0))*(p.quantity??0);await Hl(ts(ot,"dailySales"),{userId:h.uid,productName:p.productName,quantity:p.quantity,wholesalePrice:p.wholesalePrice??null,sellingPrice:p.price,profit:_,date:p.date,time:p.time,createdAt:Zs()})}catch(_){console.error("Error saving sale:",_)}},tt=async p=>{const _=M[p.id]||"",se=parseInt(_);if(isNaN(se)||se<=0){f({title:"كمية غير صالحة",description:"أدخل كمية صحيحة للبيـع",variant:"destructive"});return}if(se>p.quantity){f({title:"كمية أكبر من المتاح",description:"الكمية المطلوب بيعها تتجاوز المخزون المتاح",variant:"destructive"});return}const he=new Date,we={id:Date.now().toString(),productName:p.name,price:p.sellingPrice,wholesalePrice:p.wholesalePrice,quantity:se,date:he.toISOString().split("T")[0],time:he.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})};try{ze([...t,we]),await Te(we);const Le=p.quantity-se;await ta(qt(ot,"products",p.id),{quantity:Le,updatedAt:Zs()}),I($e=>$e.map(gt=>gt.id===p.id?{...gt,quantity:Le}:gt)),H($e=>({...$e,[p.id]:""})),f({title:"تم البيع",description:`تم بيع ${se} قطعة من ${p.name}`})}catch(Le){console.error("Error selling product:",Le),f({title:"فشل البيع",description:"تعذّر تنفيذ عملية البيع",variant:"destructive"})}},Je=async p=>{const _=V[p.id]||"",se=parseInt(_);if(isNaN(se)||se<=0){f({title:"كمية غير صالحة",description:"أدخل كمية صحيحة للإضافة",variant:"destructive"});return}try{const he=p.quantity+se;await ta(qt(ot,"products",p.id),{quantity:he,updatedAt:Zs()}),I(we=>we.map(Le=>Le.id===p.id?{...Le,quantity:he}:Le)),W(we=>({...we,[p.id]:""})),f({title:"تمت الإضافة",description:`تمت إضافة ${se} قطعة إلى ${p.name}`})}catch(he){console.error("Error adding pieces:",he),f({title:"فشل الإضافة",description:"تعذّر إضافة الكمية إلى المخزون",variant:"destructive"})}},Pt=async p=>{if(!(!(h!=null&&h.uid)||!window.confirm(`هل تريد حذف المنتج "${p.name}"؟`)))try{await ho(qt(ot,"products",p.id)),I(se=>se.filter(he=>he.id!==p.id)),f({title:"تم الحذف",description:`تم حذف المنتج ${p.name}`})}catch(se){console.error("Error deleting product:",se),f({title:"فشل الحذف",description:"تعذّر حذف المنتج",variant:"destructive"})}},vt=async()=>{try{if(!(h!=null&&h.uid)){f({title:"خطأ",description:"غير مسجّل دخول",variant:"destructive"});return}const p=y.productName.trim(),_=parseFloat(y.price),se=parseFloat(y.wholesalePrice||"0"),he=parseInt(y.quantity);if(!p||isNaN(_)||isNaN(he)){f({title:"بيانات غير مكتملة",description:"أدخل اسم المنتج والسعر والكمية",variant:"destructive"});return}const we={name:p,sellingPrice:_,wholesalePrice:isNaN(se)?0:se,quantity:isNaN(he)?0:he,userId:h.uid,createdAt:Zs(),updatedAt:Zs()};v!=null&&v.shopId&&(we.shopId=v.shopId);const Le=await Hl(ts(ot,"products"),we);I($e=>[{id:Le.id,name:p,sellingPrice:_,wholesalePrice:isNaN(se)?0:se,quantity:isNaN(he)?0:he},...$e]),u({productName:"",price:"",wholesalePrice:"",quantity:""}),f({title:"تمت الإضافة",description:`تم إضافة المنتج ${p} بنجاح`})}catch(p){console.error("createProduct error",p),f({title:"فشل الإضافة",description:"تعذّر إضافة المنتج. حاول مجددًا",variant:"destructive"})}};return e.jsxs(oe,{open:i,onOpenChange:d,children:[e.jsxs(ce,{className:"max-w-7xl md:max-w-6xl lg:max-w-7xl w-[95vw] md:w-[90vw] h-[95vh] md:h-[90vh] p-0 overflow-y-auto",children:[e.jsx(de,{className:"px-3 md:px-6 py-3 md:py-4 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 bg-blue-100 rounded-lg",children:e.jsx(Jr,{className:"h-5 w-5 md:h-6 md:w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx(me,{className:"text-lg md:text-xl font-bold text-gray-800",children:"📊 بيانات المبيعات اليومية"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-600 mt-1 hidden sm:block",children:["إدارة وتتبع مبيعات اليوم - ",new Date().toLocaleDateString("ar-EG")]})]})]}),e.jsx("div",{className:"flex items-center gap-1 md:gap-2",children:e.jsx(c,{variant:"ghost",size:"sm",onClick:d,className:"h-8 w-8 md:h-9 md:w-9",children:e.jsx(ln,{className:"h-4 w-4"})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row h-full",dir:"rtl",children:[e.jsxs("div",{className:"w-full md:w-80 lg:w-96 bg-white/50 border-r",children:[e.jsxs("div",{className:"p-3 md:p-4 border-b bg-white/30",children:[e.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2 text-sm md:text-base",children:[e.jsx(Qe,{className:"h-4 w-4 text-green-600"}),"ملخص المبيعات"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 md:p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-blue-600",children:xt(t.reduce((p,_)=>p+_.price*_.quantity,0))}),e.jsx("div",{className:"text-xs md:text-sm text-blue-600",children:"إجمالي المبيعات"})]}),e.jsxs("div",{className:"bg-green-50 p-2 md:p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-green-600",children:xt(t.reduce((p,_)=>p+(_.price-(_.wholesalePrice??0))*_.quantity,0))}),e.jsx("div",{className:"text-xs md:text-sm text-green-600",children:"إجمالي الأرباح"})]}),e.jsxs("div",{className:"bg-yellow-50 p-2 md:p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-yellow-600",children:Is(k.length)}),e.jsx("div",{className:"text-xs md:text-sm text-yellow-600",children:"عدد المنتجات"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 md:p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-purple-600",children:Is(t.length)}),e.jsx("div",{className:"text-xs md:text-sm text-purple-600",children:"عدد المبيعات"})]})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 md:gap-2 text-xs md:text-sm font-semibold text-indigo-700",children:[e.jsx(rs,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx(Jr,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{children:"تقارير الشهر"})]}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>G(p=>!p),className:"h-6 w-6 p-0 rounded-full",title:pe?"إظهار التقارير":"إخفاء التقارير",children:pe?e.jsx(Hr,{className:"h-4 w-4"}):e.jsx(dn,{className:"h-4 w-4"})})]}),e.jsx("div",{className:pe?"overflow-hidden max-h-0 transition-[max-height] duration-300":"overflow-hidden transition-[max-height] duration-300 max-h-[400px]",children:e.jsxs("div",{className:ne?"grid grid-cols-2 gap-2 md:gap-4 filter blur-sm pointer-events-none":"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-indigo-50 p-2 md:p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-indigo-600",children:xt(C)}),e.jsx("div",{className:"text-xs md:text-sm text-indigo-600",children:"مبيعات الشهر"})]}),e.jsxs("div",{className:"bg-pink-50 p-2 md:p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-pink-600",children:xt(re)}),e.jsx("div",{className:"text-xs md:text-sm text-pink-600",children:"أرباح الشهر"})]})]})}),!pe&&ne&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60",children:e.jsxs(c,{size:"sm",variant:"ghost",onClick:async()=>{try{if(await isZeroPlan()){f({title:"الخطة زيرو",description:"التقارير الشهرية غير متاحة في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"});return}}catch{}J(!0)},className:"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all",title:"عرض تقارير الشهر",children:[e.jsx(et,{className:"h-5 w-5 md:h-7 md:w-7"}),e.jsx("span",{className:"text-xs md:text-sm",children:"عرض تقارير الشهر"})]})})]})]}),e.jsx("div",{className:"p-3 md:p-4 border-b bg-white/30",children:e.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2 text-sm md:text-base",children:[e.jsx(Oa,{className:"h-4 w-4 text-indigo-600"}),"إحصائيات المنتجات"]})}),e.jsx("div",{className:"p-3 md:p-4 flex-1 overflow-y-auto hidden md:block",children:e.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(Vr,{className:"h-4 w-4 text-blue-600"}),"نصائح للمبيعات"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto transition-all duration-300 ease-in-out scrollbar-thin scrollbar-thumb-blue-300 scrollbar-track-blue-100 hover:scrollbar-thumb-blue-400",children:e.jsxs("div",{className:"p-3 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 md:mb-6 gap-2",children:[e.jsxs("h2",{className:"text-base md:text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Yo,{className:"h-4 w-4 md:h-5 md:w-5 text-blue-600"}),"سجل المبيعات (",t.length," عنصر)"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs md:text-sm text-gray-600",children:[e.jsx(rs,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:new Date().toLocaleDateString("ar-EG")}),e.jsx(fs,{className:"h-3 w-3 md:h-4 md:w-4 ml-2"}),e.jsx("span",{children:new Date().toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-3 md:p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm md:text-base font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ut,{className:"h-4 w-4 text-emerald-600"}),"إضافة منتج جديد"]}),e.jsxs(c,{size:"sm",variant:"ghost",className:"h-8",onClick:()=>E(p=>!p),children:[e.jsx(ut,{className:"h-4 w-4 text-emerald-600"}),"إضافة منتج"]})]}),T&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(Y,{htmlFor:"new-product-name",className:"text-xs md:text-sm",children:"اسم المنتج"}),e.jsx(L,{id:"new-product-name",value:y.productName,onChange:p=>u(_=>({..._,productName:p.target.value})),placeholder:"أدخل اسم المنتج"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(Y,{htmlFor:"new-product-price",className:"text-xs md:text-sm",children:"سعر البيع (ج.م)"}),e.jsx(L,{type:"number",id:"new-product-price",value:y.price,onChange:p=>u(_=>({..._,price:p.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(Y,{htmlFor:"new-product-wholesale",className:"text-xs md:text-sm",children:"سعر الجملة (ج.م)"}),e.jsx(L,{type:"number",id:"new-product-wholesale",value:y.wholesalePrice||"",onChange:p=>u(_=>({..._,wholesalePrice:p.target.value})),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx(Y,{htmlFor:"new-product-qty",className:"text-xs md:text-sm",children:"الكمية"}),e.jsx(L,{type:"number",id:"new-product-qty",value:y.quantity,onChange:p=>u(_=>({..._,quantity:p.target.value})),placeholder:"1"})]}),e.jsx(c,{className:"w-full md:w-auto",onClick:vt,children:"إضافة المنتج"})]})]}),e.jsx("div",{id:"shop-products-section",className:"bg-white rounded-lg border border-gray-200 overflow-hidden mb-4",children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-sm md:text-base font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(Oa,{className:"h-4 w-4 text-green-600"}),"منتجات المحل"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(L,{value:Z,onChange:p=>Ne(p.target.value),placeholder:"ابحث عن منتج...",className:"h-9 w-full md:w-72 text-sm","aria-label":"البحث عن منتج من منتجات المحل"}),Z&&e.jsx(c,{variant:"ghost",size:"sm",className:"h-9",onClick:()=>Ne(""),children:"مسح"})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg hidden md:block",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-700",children:"المنتج"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-700",children:"سعر البيع"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-700",children:"سعر الجملة"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-700",children:"المتاح"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-700",children:"بيع"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:K.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-3 py-3 text-center text-gray-500",children:k.length===0?"لا توجد منتجات بعد، أضف منتجاً من النموذج أعلاه":"لا توجد نتائج مطابقة للبحث"})}):K.map(p=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 font-medium text-gray-900",children:p.name}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:xt(p.sellingPrice)}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:xt(p.wholesalePrice)}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:Is(p.quantity)}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2 flex-nowrap",children:[e.jsx(L,{value:M[p.id]||"",onChange:_=>H(se=>({...se,[p.id]:_.target.value})),type:"number",placeholder:"عدد القطع للبيع",className:"h-8 w-28 text-sm"}),e.jsx(c,{size:"sm",className:"h-8",onClick:()=>tt(p),children:"بيع"}),e.jsx(L,{value:V[p.id]||"",onChange:_=>W(se=>({...se,[p.id]:_.target.value})),type:"number",placeholder:"عدد للإضافة",className:"h-8 w-28 text-sm"}),e.jsxs("div",{className:"inline-flex items-center gap-2 flex-nowrap",children:[e.jsx(c,{size:"sm",variant:"outline",className:"h-8",onClick:()=>Je(p),children:"إضافة قطع جديدة"}),e.jsx(c,{size:"sm",variant:"destructive",className:"h-8",onClick:()=>Pt(p),title:"حذف المنتج",children:e.jsx(Ct,{className:"h-4 w-4"})})]})]})})]},p.id))})]})}),e.jsx("div",{className:"block md:hidden space-y-3",children:K.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm",children:k.length===0?"لا توجد منتجات بعد، أضف منتجاً من النموذج أعلاه":"لا توجد نتائج مطابقة للبحث"}):K.map(p=>e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm break-words",children:p.name}),e.jsx(c,{size:"sm",variant:"destructive",className:"h-8 min-w-[44px] touch-manipulation",onClick:()=>Pt(p),title:"حذف المنتج",children:e.jsx(Ct,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs text-gray-700",children:[e.jsx("div",{className:"text-gray-600",children:"سعر البيع"}),e.jsx("div",{className:"text-right font-medium",children:xt(p.sellingPrice)}),e.jsx("div",{className:"text-gray-600",children:"سعر الجملة"}),e.jsx("div",{className:"text-right font-medium",children:xt(p.wholesalePrice)}),e.jsx("div",{className:"text-gray-600",children:"المتاح"}),e.jsx("div",{className:"text-right font-medium",children:Is(p.quantity)})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{value:M[p.id]||"",onChange:_=>H(se=>({...se,[p.id]:_.target.value})),type:"number",placeholder:"عدد القطع للبيع",className:"h-9 flex-1 text-sm","aria-label":`عدد القطع للبيع لـ ${p.name}`}),e.jsx(c,{size:"sm",className:"h-9 min-w-[64px]",onClick:()=>tt(p),children:"بيع"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{value:V[p.id]||"",onChange:_=>W(se=>({...se,[p.id]:_.target.value})),type:"number",placeholder:"عدد للإضافة",className:"h-9 flex-1 text-sm","aria-label":`عدد القطع للإضافة لـ ${p.name}`}),e.jsx(c,{size:"sm",variant:"outline",className:"h-9 min-w-[64px]",onClick:()=>Je(p),children:"إضافة"})]})]})]},p.id))})]})}),t.length===0?e.jsxs("div",{className:"text-center py-8 md:py-12",children:[e.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(Oa,{className:"h-8 w-8 md:h-12 md:w-12 text-gray-400"})}),e.jsx("h3",{className:"text-base md:text-lg font-medium text-gray-900 mb-2",children:"لا توجد مبيعات اليوم"}),e.jsx("p",{className:"text-sm text-gray-500",children:"ابدأ ببيع منتج من القائمة أعلاه"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"max-h-[70vh] overflow-y-auto space-y-3 p-3",children:t.map(p=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"mb-3",children:e.jsx("h4",{className:"font-semibold text-gray-900 text-base break-words",children:p.productName})}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"سعر البيع"})]}),e.jsx("div",{className:"text-right font-medium",children:xt(p.price)}),typeof p.wholesalePrice=="number"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-indigo-600"}),e.jsx("span",{className:"text-gray-600",children:"سعر الجملة"})]}),e.jsx("div",{className:"text-right font-medium",children:xt(p.wholesalePrice)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oa,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"text-gray-600",children:"الكمية"})]}),e.jsx("div",{className:"text-right font-medium",children:Is(p.quantity)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"الربح"})]}),e.jsx("div",{className:"text-right font-semibold text-purple-700",children:xt(((p.price??0)-(p.wholesalePrice??0))*(p.quantity??0))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"الإجمالي"})]}),e.jsx("div",{className:"text-right font-bold text-green-700",children:xt(p.price*p.quantity)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"التاريخ"})]}),e.jsx("div",{className:"text-right text-gray-600",children:Xl(p.date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"الوقت"})]}),e.jsx("div",{className:"text-right text-gray-600",children:p.time})]})]},p.id))})}),e.jsx("div",{className:"hidden md:block overflow-x-auto max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-green-300 scrollbar-track-green-100 hover:scrollbar-thumb-green-400",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"المنتج"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"سعر البيع (ج.م)"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"سعر الجملة (ج.م)"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"الكمية"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"الإجمالي (ج.م)"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"الربح (ج.م)"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"التاريخ"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"الوقت"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t.map((p,_)=>e.jsxs("tr",{className:_%2===0?"bg-white":"bg-gray-50/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:p.productName}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:xt(p.price)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:typeof p.wholesalePrice=="number"?xt(p.wholesalePrice):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Is(p.quantity)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-green-600",children:xt(p.price*p.quantity)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-purple-600",children:xt(((p.price??0)-(p.wholesalePrice??0))*(p.quantity??0))}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:Xl(p.date)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:p.time})]},p.id))})]})})]}),e.jsxs("div",{className:"mt-4 md:mt-6 text-xs text-gray-500 text-center bg-gray-50/50 p-2 md:p-3 rounded border border-gray-200/40 space-y-1",children:[e.jsx("p",{className:"font-medium text-gray-600",children:"💰 نظام إدارة المبيعات اليومية"}),e.jsxs("p",{className:"hidden sm:block",children:["• يتم حفظ البيانات تلقائياً لليوم الحالي: ",new Date().toLocaleDateString("ar-EG")]}),e.jsx("p",{children:"• يمكنك إضافة وتعديل وحذف المنتجات حسب الحاجة"}),e.jsx("p",{className:"hidden sm:block",children:"• يتم حفظ البيانات محلياً وعلى Firebase لتعزيز الأمان"})]})]})})]})]}),e.jsx(ra,{open:P,onOpenChange:J,mode:"verify",title:"قفل إحصائيات الشهر",description:"لا يمكن الاطلاع على تقارير الشهر إلا بإدخال الرقم السري الرئيسي",onSuccess:async()=>{try{const p=h==null?void 0:h.uid;if(p){const _=await Yr(p),se=(_==null?void 0:_.planType)??(_==null?void 0:_.plan)??null,he=typeof se=="string"?se.toLowerCase():null;if(se===Yt.ZERO||he==="zero"){f({title:"الخطة زيرو",description:"التقارير الشهرية غير متاحة في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"});return}}}catch{}ae(!1),J(!1),Ie()}})]})}const Is=i=>new Intl.NumberFormat("ar-EG").format(Number(i||0)),xt=i=>`${new Intl.NumberFormat("ar-EG",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Number(i||0))} ج.م`,Xl=i=>{try{const d=new Date(i);return isNaN(d.getTime())?new Date(`${i}T00:00:00`).toLocaleDateString("ar-EG"):d.toLocaleDateString("ar-EG")}catch{return i}};function yn({size:i=24,className:d,...t}){return e.jsxs("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:d,...t,children:[e.jsx("rect",{x:"5",y:"2.5",width:"14",height:"19",rx:"2.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("rect",{x:"7",y:"4.5",width:"10",height:"5.5",rx:"1",stroke:"currentColor",strokeWidth:"1.2"}),e.jsx("path",{d:"M9.5 11.5h5",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round"}),e.jsx("circle",{cx:"8.5",cy:"14",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"12",cy:"14",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"15.5",cy:"14",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"8.5",cy:"17",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"12",cy:"17",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"15.5",cy:"17",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("rect",{x:"8",y:"19",width:"9",height:"1.8",rx:"0.6",stroke:"currentColor",strokeWidth:"1"})]})}var jn="AlertDialog",[cc,kd]=xo(jn,[mn]),Gt=mn(),bn=i=>{const{__scopeAlertDialog:d,...t}=i,m=Gt(d);return e.jsx(Wo,{...m,...t,modal:!0})};bn.displayName=jn;var dc="AlertDialogTrigger",mc=l.forwardRef((i,d)=>{const{__scopeAlertDialog:t,...m}=i,y=Gt(t);return e.jsx(Io,{...y,...m,ref:d})});mc.displayName=dc;var hc="AlertDialogPortal",Nn=i=>{const{__scopeAlertDialog:d,...t}=i,m=Gt(d);return e.jsx(Fo,{...m,...t})};Nn.displayName=hc;var xc="AlertDialogOverlay",wn=l.forwardRef((i,d)=>{const{__scopeAlertDialog:t,...m}=i,y=Gt(t);return e.jsx(To,{...y,...m,ref:d})});wn.displayName=xc;var Ls="AlertDialogContent",[uc,gc]=cc(Ls),pc=go("AlertDialogContent"),Sn=l.forwardRef((i,d)=>{const{__scopeAlertDialog:t,children:m,...y}=i,u=Gt(t),T=l.useRef(null),E=nn(d,T),f=l.useRef(null);return e.jsx(Ao,{contentName:Ls,titleName:Dn,docsSlug:"alert-dialog",children:e.jsx(uc,{scope:t,cancelRef:f,children:e.jsxs(ko,{role:"alertdialog",...u,...y,ref:E,onOpenAutoFocus:uo(y.onOpenAutoFocus,h=>{var v;h.preventDefault(),(v=f.current)==null||v.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[e.jsx(pc,{children:m}),e.jsx(vc,{contentRef:T})]})})})});Sn.displayName=Ls;var Dn="AlertDialogTitle",Cn=l.forwardRef((i,d)=>{const{__scopeAlertDialog:t,...m}=i,y=Gt(t);return e.jsx(Po,{...y,...m,ref:d})});Cn.displayName=Dn;var In="AlertDialogDescription",Tn=l.forwardRef((i,d)=>{const{__scopeAlertDialog:t,...m}=i,y=Gt(t);return e.jsx(Oo,{...y,...m,ref:d})});Tn.displayName=In;var fc="AlertDialogAction",An=l.forwardRef((i,d)=>{const{__scopeAlertDialog:t,...m}=i,y=Gt(t);return e.jsx(hn,{...y,...m,ref:d})});An.displayName=fc;var kn="AlertDialogCancel",Pn=l.forwardRef((i,d)=>{const{__scopeAlertDialog:t,...m}=i,{cancelRef:y}=gc(kn,t),u=Gt(t),T=nn(d,y);return e.jsx(hn,{...u,...m,ref:T})});Pn.displayName=kn;var vc=({contentRef:i})=>{const d=`\`${Ls}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Ls}\` by passing a \`${In}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ls}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{var m;document.getElementById((m=i.current)==null?void 0:m.getAttribute("aria-describedby"))||console.warn(d)},[d,i]),null},yc=bn,jc=Nn,On=wn,Wn=Sn,Fn=An,Bn=Pn,En=Cn,Mn=Tn;const bc=yc,Nc=jc,Ln=l.forwardRef(({className:i,...d},t)=>e.jsx(On,{className:ys("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...d,ref:t}));Ln.displayName=On.displayName;const $n=l.forwardRef(({className:i,...d},t)=>e.jsxs(Nc,{children:[e.jsx(Ln,{}),e.jsx(Wn,{ref:t,className:ys("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...d})]}));$n.displayName=Wn.displayName;const _n=({className:i,...d})=>e.jsx("div",{className:ys("flex flex-col space-y-2 text-center sm:text-left",i),...d});_n.displayName="AlertDialogHeader";const Rn=l.forwardRef(({className:i,...d},t)=>e.jsx(En,{ref:t,className:ys("text-lg font-semibold",i),...d}));Rn.displayName=En.displayName;const Un=l.forwardRef(({className:i,...d},t)=>e.jsx(Mn,{ref:t,className:ys("text-sm text-muted-foreground",i),...d}));Un.displayName=Mn.displayName;const qr=l.forwardRef(({className:i,...d},t)=>e.jsx(Fn,{ref:t,className:ys(cn(),i),...d}));qr.displayName=Fn.displayName;const zn=l.forwardRef(({className:i,...d},t)=>e.jsx(Bn,{ref:t,className:ys(cn({variant:"outline"}),"mt-2 sm:mt-0",i),...d}));zn.displayName=Bn.displayName;const Oe=i=>{try{return i.toLocaleString("en-US",{maximumFractionDigits:2})}catch{return String(i)}},en=i=>{try{return(i?new Date(i):new Date).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return new Date().toISOString()}},Wa="machine_daily_opening_values",tn="machine_daily_receipts",sn="machine_daily_transfer_receipts",Ur="machine_daily_opening_snapshot";function wc({open:i,onOpenChange:d}){const{toast:t}=Rt(),{shiftUser:m}=za(),[y,u]=l.useState(""),[T,E]=l.useState(""),[f,h]=l.useState(""),[v,k]=l.useState(null),[I,M]=l.useState(null),[H,V]=l.useState(null),[W,C]=l.useState(null),[U,re]=l.useState(!1),[$,P]=l.useState(!1),[J,ne]=l.useState(""),[ae,pe]=l.useState(""),[G,Z]=l.useState(null),[Ne,K]=l.useState(()=>{try{const O=localStorage.getItem(tn),ee=O?JSON.parse(O):[];return Array.isArray(ee)?ee:[]}catch{return[]}}),[te,We]=l.useState(()=>{try{const O=localStorage.getItem(sn),ee=O?JSON.parse(O):[];return Array.isArray(ee)?ee:[]}catch{return[]}}),[ze,Ie]=l.useState(!1),[Te,tt]=l.useState(""),[Je,Pt]=l.useState(""),[vt,p]=l.useState(!1),[_,se]=l.useState(null);l.useEffect(()=>{if(i)try{const O=localStorage.getItem(Wa);if(O){const z=JSON.parse(O);typeof(z==null?void 0:z.openingBase)=="number"&&k(z.openingBase),typeof(z==null?void 0:z.openingAir)=="number"&&M(z.openingAir),typeof(z==null?void 0:z.drawerCash)=="number"&&V(z.drawerCash)}const ee=localStorage.getItem(Ur);if(ee){const z=JSON.parse(ee);typeof(z==null?void 0:z.openingBase)=="number"&&typeof(z==null?void 0:z.openingAir)=="number"&&C({openingBase:z.openingBase,openingAir:z.openingAir,drawerCash:z.drawerCash||0})}}catch{}},[i]),l.useEffect(()=>{try{localStorage.setItem(tn,JSON.stringify(Ne))}catch{}},[Ne]),l.useEffect(()=>{try{localStorage.setItem(sn,JSON.stringify(te))}catch{}},[te]);const he=l.useMemo(()=>(m==null?void 0:m.displayName)||(m==null?void 0:m.name)||(m==null?void 0:m.username)||void 0,[m]),we=l.useMemo(()=>te.reduce((O,ee)=>O+(ee.profit||0),0),[te]),Le=l.useMemo(()=>te.reduce((O,ee)=>O+(ee.wholesalePrice||0),0),[te]),$e=()=>{te.length!==0&&(We([]),t({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات التحويل."}))},gt=()=>{Ne.length!==0&&(K([]),t({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات الماكينة."}))},Ot=O=>{K(ee=>ee.filter(z=>z.id!==O)),t({title:"تم حذف الإيصال",description:"تم إزالة إيصال الماكينة المحدد."})},bt=()=>{k(null),M(null),V(null),C(null),u(""),E(""),h("");try{localStorage.removeItem(Wa),localStorage.removeItem(Ur)}catch{}t({title:"تم التصفير",description:"يمكنك الآن إدخال رصيد افتتاحي جديد."})},pt=()=>{const O=parseFloat(y||"0"),ee=parseFloat(T||"0"),z=parseFloat(f||"0");if(isNaN(O)||isNaN(ee)||isNaN(z)){t({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة للرصيد الافتتاحي وفلوس الدرج.",variant:"destructive"});return}if(O<0||ee<0||z<0){t({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}k(O),M(ee),V(z);try{localStorage.setItem(Wa,JSON.stringify({openingBase:O,openingAir:ee,drawerCash:z})),localStorage.setItem(Ur,JSON.stringify({openingBase:O,openingAir:ee,drawerCash:z})),C({openingBase:O,openingAir:ee,drawerCash:z})}catch{}t({title:"تم تسجيل البيانات",description:`الافتتاحي الأساسي: ${Oe(O)}، الهواء: ${Oe(ee)}، فلوس الدرج: ${Oe(z)}`})},D=()=>{if(v==null||I==null){t({title:"سجل الرصيد الافتتاحي أولاً",description:'يرجى الضغط على زر "إضافة" بعد إدخال الافتتاحي.'});return}P(!0)},X=()=>{const O=parseFloat(J||"0"),ee=parseFloat(ae||"0");if(isNaN(O)||isNaN(ee)){t({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لرصيد التسليم.",variant:"destructive"});return}if(O<0||ee<0){t({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}const z=(W==null?void 0:W.openingBase)??(v||0),ue=(W==null?void 0:W.openingAir)??(I||0),Pe=z+ue,lt=O+ee-Pe;Z(lt);const Ye={id:`${Date.now()}`,openingBase:z,openingAir:ue,deliveryBase:O,deliveryAir:ee,netResult:lt,createdAt:new Date().toISOString(),cashierName:he,requiredDrawerNoProfit:lt<0?Math.round(-lt*100)/100:0};K(ft=>[Ye,...ft]),t({title:"تم إنشاء إيصال تسليم",description:`الناتج النهائي: ${Oe(lt)}`})},ge=()=>{const O=parseFloat(Te||"0"),ee=parseFloat(Je||"0");if(!Number.isFinite(O)||!Number.isFinite(ee)){t({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لسعر الجملة وسعر التجزئة.",variant:"destructive"});return}if(O<0||ee<0){t({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}if(v==null||I==null){t({title:"سجل الرصيد الافتتاحي أولاً",description:'يرجى إدخال الرصيد الأساسي ورصيد الهواء ثم الضغط "إضافة".'});return}const z=Math.round((ee-O)*100)/100;se({wholesalePrice:O,retailPrice:ee,profit:z}),p(!0)},Ae=O=>{if(!_)return;const ee={id:`transfer_${Date.now()}`,wholesalePrice:_.wholesalePrice,retailPrice:_.retailPrice,profit:_.profit,createdAt:new Date().toISOString(),cashierName:he,deductFrom:O},z=_.wholesalePrice,ue=v??0,Pe=I??0,dt=H??0;if(z>(O==="base"?ue:Pe)){t({title:"رصيد غير كافٍ",description:"لا يوجد رصيد كافٍ للخصم بسعر الجملة.",variant:"destructive"});return}const Ye=O==="base"?Math.round((ue-z)*100)/100:ue,ft=O==="air"?Math.round((Pe-z)*100)/100:Pe,Ut=Math.round((dt+_.retailPrice)*100)/100;k(Ye),M(ft),V(Ut);try{localStorage.setItem(Wa,JSON.stringify({openingBase:Ye,openingAir:ft,drawerCash:Ut}))}catch{}We(Tt=>[ee,...Tt]),Ie(!1),tt(""),Pt(""),se(null),p(!1),t({title:"تم تسجيل تحويل",description:`الربح الفوري: ${Oe(ee.profit)} | خصم المخزون: -${Oe(z)} (${O==="base"?"الأساسي":"الهواء"}) | درج: +${Oe(_.retailPrice)}`})},ke=()=>{u(""),E(""),P(!1),ne(""),pe(""),Z(null)},Ke=O=>{O||ke(),d(O)};return e.jsxs(oe,{open:i,onOpenChange:Ke,children:[e.jsxs(ce,{className:"w-[92vw] sm:w-auto sm:max-w-2xl max-h-[85vh] overflow-y-auto",children:[e.jsxs(de,{className:"space-y-2",children:[e.jsx(me,{className:"flex items-center justify-between text-right",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(yn,{className:"h-5 w-5 text-yellow-500"}),"يومية المكنة"]})}),e.jsx(Vt,{className:"text-right",children:'أدخل الرصيد الافتتاحي، ثم في نهاية اليوم قم بإدخال رصيد التسليم لإنشاء إيصال منظم باسم "إيصالات ماكينة".'})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs(Ue,{children:[e.jsx(ct,{className:"pb-2",children:e.jsxs(jt,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"الرصيد الافتتاحي"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>re(O=>!O),className:"flex items-center gap-1",children:e.jsx(Hr,{className:`h-4 w-4 transition-transform ${U?"rotate-180":""}`})})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(c,{variant:"outline",onClick:()=>Ie(!0),disabled:v==null||I==null,className:"border-violet-300 text-violet-700",children:"تحويل"})}),v!=null&&I!=null&&e.jsxs(rt,{className:"bg-violet-100 text-violet-700 border border-violet-200",children:["تم التسجيل: أساسي ",Oe(v)," | هواء ",Oe(I)," | درج ",Oe(H??0)]})]}),e.jsxs(qe,{className:`space-y-4 ${U?"":"hidden"}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي"}),e.jsx(L,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:y,onChange:O=>u(O.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء"}),e.jsx(L,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:T,onChange:O=>E(O.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"فلوس الدرج"}),e.jsx(L,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:f,onChange:O=>h(O.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(c,{variant:"outline",className:"mr-2",onClick:bt,children:"تصفير"}),e.jsx(c,{onClick:pt,className:"bg-violet-600 hover:bg-violet-700",children:"إضافة"})]})]})]}),e.jsxs(Ue,{children:[e.jsx(ct,{className:"pb-2",children:e.jsxs(jt,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-right",children:"إيصالات تحويل"}),e.jsxs(rt,{className:"bg-green-100 text-green-700 border border-green-200",children:["ربح: ",Oe(we)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:$e,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"}),e.jsx(Ba,{className:"h-4 w-4 text-gray-500"})]})]})}),e.jsx(qe,{className:"space-y-3",children:te.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد تحويلات مسجلة."}):e.jsx("div",{className:"space-y-3 max-h-52 overflow-y-auto pr-1",children:te.map(O=>e.jsxs("div",{className:"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"سعر الجملة"}),e.jsx("p",{className:"text-sm",children:Oe(O.wholesalePrice)})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"سعر التجزئة"}),e.jsx("p",{className:"text-sm",children:Oe(O.retailPrice)})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الربح الفوري"}),e.jsx("p",{className:"text-sm text-green-700",children:Oe(O.profit)}),O.deductFrom&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"text-[11px] bg-violet-100 text-violet-700 border border-violet-200 rounded px-2 py-0.5",children:["الخصم من: ",O.deductFrom==="base"?"الأساسي":"الهواء"]})}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-gray-500",children:[e.jsx(rs,{className:"h-3 w-3"}),e.jsx("span",{children:en(O.createdAt)}),O.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(zr,{orientation:"vertical",className:"h-3"}),e.jsxs("span",{children:["الكاشير: ",O.cashierName]})]})]})]})]},O.id))})})]}),e.jsxs(Ue,{children:[e.jsx(ct,{className:"pb-2",children:e.jsx(jt,{className:"text-right",children:"نهاية اليوم"})}),e.jsx(qe,{className:"space-y-4",children:$?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي الحالي"}),e.jsx(L,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:J,onChange:O=>ne(O.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء الحالي"}),e.jsx(L,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:ae,onChange:O=>pe(O.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{variant:"secondary",onClick:()=>P(!1),children:"إلغاء"}),e.jsx(c,{onClick:X,className:"bg-green-600 hover:bg-green-700",children:"تسليم"})]}),G!=null&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs(rt,{className:G>=0?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200",children:["الناتج النهائي: ",Oe(G)]})}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsxs(rt,{className:"bg-blue-100 text-blue-700 border border-blue-200",children:["المجموع النهائي: ",Oe(parseFloat(J||"0")+parseFloat(ae||"0"))]}),e.jsxs(rt,{className:"bg-amber-100 text-amber-700 border border-amber-200",children:["مطلوب من الدرج (بدون أرباح): ",Oe(Le)]})]})]})]}):e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{variant:"outline",onClick:D,className:"border-violet-300 text-violet-700",children:"تسليم يومية"})})})]}),e.jsxs(Ue,{children:[e.jsx(ct,{className:"pb-2",children:e.jsxs(jt,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إيصالات ماكينة"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:gt,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"}),e.jsx(Ba,{className:"h-4 w-4 text-gray-500"})]})]})}),e.jsx(qe,{className:"space-y-3",children:Ne.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد إيصالات حتى الآن."}):e.jsx("div",{className:"space-y-3",children:Ne.map(O=>e.jsxs("div",{className:"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الافتتاحي"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",Oe(O.openingBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",Oe(O.openingAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"التسليم"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",Oe(O.deliveryBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",Oe(O.deliveryAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>Ot(O.id),className:"border-red-300 text-red-700 hover:bg-red-50",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"})," حذف"]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"النتيجة"}),e.jsx("p",{className:`text-sm ${O.netResult>=0?"text-green-700":"text-red-700"}`,children:Oe(O.netResult)}),e.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2",children:[e.jsxs("span",{className:"text-[11px] bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-0.5",children:["المجموع النهائي: ",Oe(O.deliveryBase+O.deliveryAir)]}),typeof O.requiredDrawerNoProfit=="number"&&e.jsxs("span",{className:"text-[11px] bg-amber-100 text-amber-700 border border-amber-200 rounded px-2 py-0.5",children:["مطلوب من الدرج (بدون أرباح): ",Oe(O.requiredDrawerNoProfit||0)]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-gray-500",children:[e.jsx(rs,{className:"h-3 w-3"}),e.jsx("span",{children:en(O.createdAt)}),O.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(zr,{orientation:"vertical",className:"h-3"}),e.jsxs("span",{children:["الكاشير: ",O.cashierName]})]})]})]})]},O.id))})})]})]}),e.jsxs(Se,{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>Ke(!1),children:"إغلاق"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(fs,{className:"h-3 w-3"}),e.jsx("span",{children:"يسجل التاريخ والوقت تلقائياً لكل إيصال"})]})]})]}),e.jsx(oe,{open:ze,onOpenChange:Ie,children:e.jsxs(ce,{className:"sm:max-w-sm",children:[e.jsx(de,{children:e.jsx(me,{children:"تحويل رصيد"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر الجملة"}),e.jsx(L,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Te,onChange:O=>tt(O.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر التجزئة"}),e.jsx(L,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Je,onChange:O=>Pt(O.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsx("div",{className:"text-right",children:e.jsxs(rt,{className:"bg-green-100 text-green-700 border border-green-200",children:["الربح الفوري: ",Oe(parseFloat(Je||"0")-parseFloat(Te||"0")||0)]})})]}),e.jsxs(Se,{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{variant:"secondary",onClick:()=>Ie(!1),children:"إلغاء"}),e.jsx(c,{onClick:ge,className:"bg-violet-600 hover:bg-violet-700",children:"تحويل"})]})]})}),e.jsx(bc,{open:vt,onOpenChange:p,children:e.jsxs($n,{children:[e.jsxs(_n,{children:[e.jsx(Rn,{children:"اختيار مصدر الخصم"}),e.jsx(Un,{children:"هل يتم الخصم من الرصيد الأساسي أم من رصيد الهواء؟"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[e.jsx(zn,{onClick:()=>p(!1),children:"رجوع"}),e.jsx(qr,{onClick:()=>Ae("base"),children:"خصم من الأساسي"}),e.jsx(qr,{onClick:()=>Ae("air"),children:"خصم من الهواء"})]})]})})]})}function Sc(i,d=300){const[t,m]=it.useState(i);return it.useEffect(()=>{const y=setTimeout(()=>m(i),d);return()=>clearTimeout(y)},[i,d]),t}const Dc=({userId:i,transactions:d})=>{const[t,m]=l.useState(!1),[y,u]=l.useState(!1),[T,E]=l.useState(!1),[f,h]=l.useState({monthlyWithdrawalProfit:0,monthlyTransferProfit:0,lastUpdated:new Date}),{userSubscription:v}=ls();l.useEffect(()=>{i&&t&&T&&k()},[i,t,T]);const k=async()=>{if(i)try{const W=Ms.getWithdrawTransferProfits(i);h({monthlyWithdrawalProfit:W.monthlyWithdrawProfit||0,monthlyTransferProfit:W.monthlyTransferProfit||0,lastUpdated:new Date})}catch(W){console.error("Error loading profit data:",W)}},I=W=>`${W.toFixed(2)} ج.م`,M=async()=>{try{const W=(v==null?void 0:v.subscription)||null,C=(W==null?void 0:W.planType)??(W==null?void 0:W.plan)??null,U=typeof C=="string"?C.toLowerCase():null;if(C===Yt.ZERO||U==="zero"||U==="0"||C===0)return!0}catch{}try{if(i){const W=await Yr(i),C=(W==null?void 0:W.planType)??(W==null?void 0:W.plan)??null,U=typeof C=="string"?C.toLowerCase():null;if(C===Yt.ZERO||U==="zero"||U==="0"||C===0)return!0}}catch{}return!1},H=async()=>{try{if(await M()){Gl({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"});return}}catch{}u(!0)},V=async()=>{try{if(await M()){Gl({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"}),u(!1);return}}catch{}E(!0),m(!0),u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"ghost",onClick:H,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض الأرباح الشهرية",children:e.jsx(et,{className:"h-1.5 w-1.5"})}),e.jsx(oe,{open:t,onOpenChange:m,children:e.jsxs(ce,{className:"max-w-[220px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[180px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl",children:[e.jsx(de,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200",children:e.jsxs(me,{className:"text-xs font-bold text-purple-800 flex items-center justify-center gap-0 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[e.jsx(rs,{className:"h-2 w-2 text-purple-600 sm:h-3 sm:w-3"}),"شهري"]})}),e.jsxs("div",{className:"space-y-0 py-0 sm:space-y-2 sm:py-2",children:[e.jsx("div",{className:"bg-yellow-50 p-0.5 rounded border border-yellow-200 sm:bg-gradient-to-r sm:from-yellow-50 sm:to-yellow-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] sm:text-xs font-semibold text-yellow-900",children:"أرباح فوري"}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-yellow-900",children:I((f.monthlyWithdrawalProfit??0)+(f.monthlyTransferProfit??0))})]})}),e.jsx("div",{className:"bg-red-50 p-0.5 rounded border border-red-200 sm:bg-gradient-to-r sm:from-red-50 sm:to-red-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx($a,{className:"h-2 w-2 text-red-600 sm:h-3 sm:w-3"}),e.jsx("span",{className:"text-[10px] sm:text-xs",children:"سحب"})]}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-red-700",children:I(f.monthlyWithdrawalProfit)})]})}),e.jsx("div",{className:"bg-blue-50 p-0.5 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(fn,{className:"h-2 w-2 text-blue-600 sm:h-3 sm:w-3"}),e.jsx("span",{className:"text-[10px] sm:text-xs",children:"تحويل"})]}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-blue-700",children:I(f.monthlyTransferProfit)})]})}),e.jsx("div",{className:"bg-purple-50 p-0.5 rounded border border-purple-200 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(Qe,{className:"h-2 w-2 text-purple-600 sm:h-3 sm:w-3"}),e.jsx("span",{className:"text-[10px] sm:text-xs",children:"إجمالي"})]}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-purple-700",children:I(f.monthlyWithdrawalProfit+f.monthlyTransferProfit)})]})})]}),!T&&e.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>u(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:e.jsx(et,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex justify-center pt-0 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:e.jsx(c,{onClick:()=>m(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-xl text-sm sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),e.jsx(ra,{open:y,onOpenChange:u,onSuccess:V,description:"لا يمكن الاطلاع على الأرباح الشهرية إلا بإدخال الرقم السري الرئيسي"})]})},Cc=i=>e.jsx(Dc,{...i});function Ic({open:i,onOpenChange:d,onSuccess:t,userId:m}){const[y,u]=l.useState(""),[T,E]=l.useState(""),[f,h]=l.useState(!1),[v,k]=l.useState(!1),[I,M]=l.useState(""),[H,V]=l.useState(!1),{toast:W}=Rt(),C=Ms.hasProfitPin(m),U=()=>{u(""),E(""),M(""),h(!1),k(!1),d(!1)},re=async $=>{$.preventDefault(),M(""),V(!0);try{if(C){if(!Ms.verifyProfitPin(y,m)){M("الرقم السري غير صحيح"),V(!1);return}}else{if(y.length<4){M("يجب أن يكون الرقم السري 4 أرقام على الأقل"),V(!1);return}if(y!==T){M("الرقم السري غير متطابق"),V(!1);return}Ms.setProfitPin(y,m)}W({title:"نجح العملية",description:C?"تم التحقق من الرقم السري بنجاح":"تم إنشاء رقم سري الأرباح بنجاح"}),t(),U()}catch{M("حدث خطأ أثناء معالجة الرقم السري")}finally{V(!1)}};return e.jsx(oe,{open:i,onOpenChange:d,children:e.jsxs(ce,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(vs,{className:"h-5 w-5 text-green-600"}),C?"أدخل رقم سري الأرباح":"إنشاء رقم سري للأرباح"]})}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:C?"أدخل الرقم السري لعرض بيانات الأرباح":"قم بإنشاء رقم سري لحماية بيانات الأرباح. يمكنك تغييره لاحقاً من إعدادات البروفيل."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"pin",children:C?"الرقم السري":"الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"pin",type:f?"text":"password",value:y,onChange:$=>u($.target.value),placeholder:C?"أدخل الرقم السري":"أدخل رقم سري جديد (4 أرقام على الأقل)",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>h(!f),children:f?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),!C&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"confirmPin",children:"تأكيد الرقم السري"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"confirmPin",type:v?"text":"password",value:T,onChange:$=>E($.target.value),placeholder:"أعد إدخال الرقم السري",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>k(!v),children:v?e.jsx(It,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]})]}),I&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(js,{className:"h-4 w-4"}),I]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(c,{type:"submit",disabled:H,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),H?"جاري المعالجة...":C?"عرض الأرباح":"إنشاء وعرض الأرباح"]}),e.jsx(c,{type:"button",variant:"outline",onClick:U,disabled:H,children:"إلغاء"})]})]})]})})}const Tc=({userId:i,transactions:d})=>{const[t,m]=l.useState(!1),[y,u]=l.useState(!1),[T,E]=l.useState(!1),[f,h]=l.useState({dailyWithdrawalProfit:0,dailyTransferProfit:0,lastUpdated:new Date});l.useEffect(()=>{i&&t&&T&&v()},[i,t,T]);const v=async()=>{if(i)try{const H=Ms.getWithdrawTransferProfits(i);h({dailyWithdrawalProfit:H.dailyWithdrawProfit||0,dailyTransferProfit:H.dailyTransferProfit||0,lastUpdated:new Date})}catch(H){console.error("Error loading profit data:",H)}},k=H=>`${H.toFixed(2)} ج.م`,I=()=>{Ms.hasProfitPin(i),u(!0)},M=()=>{E(!0),m(!0),u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"ghost",onClick:I,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض الأرباح اليومية",children:e.jsx(et,{className:"h-1.5 w-1.5"})}),e.jsx(oe,{open:t,onOpenChange:m,children:e.jsxs(ce,{className:"max-w-[220px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[180px] sm:bg-gradient-to-br sm:from-blue-50 sm:to-white sm:border-2 sm:border-blue-200 sm:shadow-2xl sm:rounded-2xl",children:[e.jsx(de,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-blue-200",children:e.jsxs(me,{className:"text-xs font-bold text-blue-800 flex items-center justify-center gap-0 mb-0 leading-tight tracking-tight sm:text-sm sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[e.jsx(Qe,{className:"h-2 w-2 text-blue-600 sm:h-3 sm:w-3"}),"يومي"]})}),e.jsxs("div",{className:"space-y-0 py-0 sm:space-y-4 sm:py-4",children:[e.jsx("div",{className:"bg-yellow-50 p-2 rounded border border-yellow-200 sm:bg-gradient-to-r sm:from-yellow-50 sm:to-yellow-100 sm:p-4 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-0 sm:gap-2",children:[e.jsx(Qe,{className:"h-3 w-3 text-yellow-600 sm:h-5 sm:w-5"}),e.jsx("span",{className:"font-medium text-yellow-800 text-xs sm:text-base",children:"أرباح فوري"})]}),e.jsx("span",{className:"font-bold text-sm text-yellow-900 bg-white px-0 py-0.5 rounded text-center sm:text-lg sm:px-3 sm:py-1",children:k((f.dailyWithdrawalProfit??0)+(f.dailyTransferProfit??0))})]})}),e.jsx("div",{className:"bg-red-50 p-2 rounded border border-red-200 sm:bg-gradient-to-r sm:from-red-50 sm:to-red-100 sm:p-4 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-0 sm:gap-2",children:[e.jsx($a,{className:"h-3 w-3 text-red-600 sm:h-5 sm:w-5"}),e.jsx("span",{className:"font-medium text-red-800 text-xs sm:text-base",children:"سحب"})]}),e.jsx("span",{className:"font-bold text-sm text-red-900 bg-white px-0 py-0.5 rounded text-center sm:text-lg sm:px-3 sm:py-1",children:k(f.dailyWithdrawalProfit)})]})}),e.jsx("div",{className:"bg-green-50 p-0.5 rounded border border-green-200 sm:bg-gradient-to-r sm:from-green-50 sm:to-green-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between h-4 sm:h-auto",children:[e.jsxs("div",{className:"flex items-center gap-0 sm:gap-1",children:[e.jsx(fn,{className:"h-2 w-2 text-green-600 sm:h-3 sm:w-3"}),e.jsx("span",{className:"font-medium text-green-800 text-xs leading-tight tracking-tighter sm:font-semibold sm:text-xs sm:leading-normal sm:tracking-normal",children:"تحويل"})]}),e.jsx("span",{className:"font-bold text-xs text-green-900 bg-white px-0 py-0 rounded text-center leading-tight tracking-tighter sm:text-sm sm:px-2 sm:py-0.5 sm:leading-normal sm:tracking-normal",children:k(f.dailyTransferProfit)})]})}),e.jsx("div",{className:"bg-blue-50 p-0.5 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between h-4 sm:h-auto",children:[e.jsxs("div",{className:"flex items-center gap-0 sm:gap-1",children:[e.jsx(Qe,{className:"h-2 w-2 text-blue-600 sm:h-3 sm:w-3"}),e.jsx("span",{className:"font-medium text-blue-800 text-xs leading-tight tracking-tighter sm:font-semibold sm:text-xs sm:leading-normal sm:tracking-normal",children:"مجموع"})]}),e.jsx("span",{className:"font-bold text-xs text-blue-900 bg-white px-0 py-0 rounded text-center leading-tight tracking-tighter sm:text-sm sm:px-2 sm:py-0.5 sm:leading-normal sm:tracking-normal",children:k(f.dailyWithdrawalProfit+f.dailyTransferProfit)})]})})]}),e.jsx("div",{className:"flex justify-center pt-0 border-t-0 sm:pt-2 sm:border-t sm:border-blue-200",children:e.jsx(c,{onClick:()=>m(!1),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl text-sm sm:bg-gradient-to-r sm:from-blue-600 sm:to-blue-700 sm:hover:from-blue-700 sm:hover:to-blue-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300 sm:text-xs",children:"إغلاق"})})]})}),e.jsx(Ic,{open:y,onOpenChange:u,onSuccess:M,userId:i})]})},Ac=i=>e.jsx(Tc,{...i}),Fa=i=>Number(i||0).toFixed(2),kc=({open:i,onOpenChange:d,userId:t})=>{const{toast:m}=Rt(),[y,u]=it.useState([]),[T,E]=it.useState(!1),[f,h]=it.useState("");it.useEffect(()=>{(async()=>{if(!(!i||!t))try{E(!0);const M=[...await on.getByUser(t)].sort((H,V)=>H.reportDate<V.reportDate?1:-1);u(M)}catch(I){console.error("Failed to load daily archive history:",I),m({title:"فشل تحميل الأرشيف",description:"تعذر تحميل أرشيف التقارير اليومية",variant:"destructive"})}finally{E(!1)}})()},[i,t]);const v=it.useMemo(()=>{if(!f)return y;const k=f.trim();return y.filter(I=>I.reportDate.includes(k))},[y,f]);return e.jsx(oe,{open:i,onOpenChange:d,children:e.jsxs(ce,{className:"sm:max-w-xl",children:[e.jsxs(de,{children:[e.jsx(me,{children:"أرشيف التقارير اليومية"}),e.jsx(Vt,{children:"يعرض جميع الأيام المؤرشفة مع ملخص لكل يوم."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"archive-search",children:"بحث بالتاريخ (YYYY-MM-DD)"}),e.jsx(L,{id:"archive-search",placeholder:"مثال: 2025-10-19",value:f,onChange:k=>h(k.target.value)})]}),e.jsx("div",{className:"mt-3 space-y-2 max-h-[50vh] overflow-auto",children:T?e.jsx("div",{className:"text-sm text-muted-foreground",children:"جاري التحميل..."}):v.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"لا توجد تقارير مؤرشفة حتى الآن"}):v.map(k=>e.jsxs("div",{className:"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-bold text-blue-800",children:k.reportDate}),e.jsxs("div",{className:"text-xs text-blue-700",children:["عدد المعاملات: ",k.totalTransactions]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["إجمالي المبالغ: ",e.jsx("span",{className:"font-semibold",children:Fa(k.totalAmount)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المسحوب: ",e.jsx("span",{className:"font-semibold",children:Fa(k.totalWithdrawn)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المرسل: ",e.jsx("span",{className:"font-semibold",children:Fa(k.totalSent)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["الربح: ",e.jsx("span",{className:"font-semibold",children:Fa(k.profit)})]})]})]},k.id||`${k.userId}-${k.reportDate}`))}),e.jsx(Se,{children:e.jsx(c,{variant:"outline",onClick:()=>d(!1),children:"إغلاق"})})]})})},Pc=({open:i,onOpenChange:d})=>{var Ss;const{shiftUser:t,isShiftActive:m,shiftStartAt:y,setShiftUser:u,startShift:T,endShift:E}=za(),{userSubscription:f,user:h,signIn:v,profile:k}=ls(),{toast:I}=Rt(),[M,H]=l.useState((t==null?void 0:t.name)||""),[V,W]=l.useState((t==null?void 0:t.username)||""),[C,U]=l.useState(""),[re,$]=l.useState(!1),[P,J]=l.useState(null),[ne,ae]=l.useState(""),[pe,G]=l.useState("");l.useState(!1);const[Z,Ne]=l.useState(null),[K,te]=l.useState(""),[We,ze]=l.useState(""),[Ie,Te]=l.useState(!1),[tt,Je]=l.useState(!1),[Pt,vt]=l.useState({totalTransfers:0,totalWithdrawals:0}),[p,_]=l.useState(null),[se,he]=l.useState(""),[we,Le]=l.useState(""),[$e,gt]=l.useState(0),[Ot,bt]=l.useState({}),[pt,D]=l.useState(0),[X,ge]=l.useState(0),[Ae,ke]=l.useState({}),[Ke,O]=l.useState(""),[ee,z]=l.useState(!1),[ue,Pe]=l.useState(()=>{try{const b=localStorage.getItem("cashierUsers");return b?JSON.parse(b):[]}catch{return[]}}),dt=(Ss=f==null?void 0:f.subscription)==null?void 0:Ss.planType,lt=dt==="yearly"?2:dt==="lifetime"?4:Number.POSITIVE_INFINITY;l.useEffect(()=>{try{localStorage.setItem("cashierUsers",JSON.stringify(ue))}catch{}},[ue]);const[Ye,ft]=l.useState(!1),[Ut,Tt]=l.useState(""),[Wt,bs]=l.useState(null),[la,Ft]=l.useState([]),[Ns,ws]=l.useState(!1),[Ze,Ja]=l.useState(null),[Nt,ns]=l.useState(!1),[Ka,is]=l.useState(!1),Va=b=>{const ie=(t==null?void 0:t.username)===b;let Q=!1;try{Q=localStorage.getItem("lastHandoverToAdmin")==="true"}catch{}if(ie&&!(ie&&!m&&(Ke==="الأدمن الرئيسي"||Q))){I({title:"لا يمكن الحذف",description:"لا يمكنك حذف مستخدم الوردية أثناء كونها نشطة أو قبل تسليمها للأدمن الرئيسي"});return}const nt=`هل أنت متأكد من حذف المستخدم ${b}؟

هذا الإجراء لا يمكن التراجع عنه.`;window.confirm(nt)&&(Pe(_e=>_e.filter(os=>os.username!==b)),ie&&u(null),I({title:"تم حذف المستخدم",description:b}))},$s=()=>{if(!M.trim()||!V.trim()||!C.trim())return;if(ue.length>=lt){I({title:"وصلت الحد الأقصى للمستخدمين",description:`هذه الباقة تسمح بإضافة ${Number.isFinite(lt)?lt:"عدد غير محدود"} كاشير فقط`,variant:"destructive"});return}const b={name:M.trim(),username:V.trim(),password:C.trim()};Pe(ie=>[b,...ie]),H(""),W(""),U("")},mt=()=>{$(!0),J(null),Ne(null),te(""),ze("")},_s=async()=>{try{let b=[];try{h!=null&&h.uid&&(b=await je.getUserTransactions(h.uid))}catch{}if(!b||b.length===0)try{const be=await Go({merchantUserId:h==null?void 0:h.uid,limit:200});b=(be==null?void 0:be.transactions)||[]}catch{}const ie=y?new Date(y):null,Q=new Date,He=be=>{const R=be.type,wt=be.txnType;return R==="withdraw"||R==="withdrawal"||R==="receive"||wt==="receive"},De=be=>{const R=be.type,wt=be.txnType;return R==="send"||R==="transfer"||wt==="send"},nt=be=>{if(!be)return null;if(be instanceof Date)return be;try{const R=new Date(be);return Number.isNaN(R.getTime())?null:R}catch{return null}},_e=be=>{const R=nt(be.createdAt||be.created_at||be.timestamp);return!R||ie&&R<ie?!1:R<=Q},os=be=>be==="completed"||be==="confirmed",na=b.filter(be=>os(be.status)&&_e(be)),qa=na.filter(be=>He(be)).reduce((be,R)=>{const wt=R.withdrawnAmount??R.receivedAmount??R.amount??0;return be+(Number(wt)||0)},0);return{totalTransfers:na.filter(be=>De(be)).reduce((be,R)=>{const wt=R.sentAmount??R.transferredAmount??R.amount??0;return be+(Number(wt)||0)},0),totalWithdrawals:qa}}catch{return{totalTransfers:0,totalWithdrawals:0}}};l.useEffect(()=>{if(tt){try{const b=localStorage.getItem("shiftInitialReceivedDrawerFunds");b!==null&&Le(b)}catch{}try{const b=localStorage.getItem("shiftInitialReceivedWalletBalancesTotal");if(b!==null){const ie=parseFloat(b);gt(Number.isFinite(ie)?ie:0)}}catch{}}},[tt]),l.useEffect(()=>{if(!i&&!Ns)return;(async()=>{try{const Q=((h!=null&&h.uid?await je.getUserTransactions(h.uid):[])||[]).filter(He=>(He==null?void 0:He.type)==="report"||((He==null?void 0:He.title)||"").includes("إيصال تسليم وردية"));Q.sort((He,De)=>{const nt=new Date(He.createdAt||0).getTime();return new Date(De.createdAt||0).getTime()-nt}),Ft(Q)}catch{Ft([])}})()},[i,tt,Ns,h==null?void 0:h.uid]);const ht=async(b,ie,Q)=>{try{let He=0,De=0;try{const _e=parseFloat(localStorage.getItem("shiftInitialReceivedDrawerFunds")||"0");He=Number.isFinite(_e)?_e:0}catch{}try{const _e=parseFloat(localStorage.getItem("shiftInitialReceivedWalletBalancesTotal")||"0");De=Number.isFinite(_e)?_e:0}catch{}const nt={id:`shift_receipt_${Date.now()}`,type:"report",senderPhone:(t==null?void 0:t.username)||"cashier",receiverPhone:Ke||"admin",amount:0,status:"completed",createdAt:new Date().toISOString(),title:"إيصال تسليم وردية",cashierName:(t==null?void 0:t.name)||(t==null?void 0:t.username)||null,deficit:ie,deficitAmount:ie?Q:0,shiftStartAt:y,receivedDrawerFunds:He,receivedWalletBalancesTotal:De,receivedWalletBalances:Ot,deliveredDrawerFunds:pt||0,deliveredWalletBalancesTotal:X||0,deliveredWalletBalances:Ae,shiftProfit:Math.round(((pt||0)+(X||0)-(He+De))*100)/100};h!=null&&h.uid&&await je.saveUserTransaction(h.uid,nt),Ft(_e=>[nt,..._e||[]])}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{open:i,onOpenChange:d,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{children:m?"تسليم الورديه والخروج":"إضافة مستخدم وردية"})}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsx("div",{className:"text-sm",children:"المستخدم الحالي للوردية:"}),e.jsxs("div",{className:"font-semibold text-sm",children:[t==null?void 0:t.name," (",t==null?void 0:t.username,")"]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:'لإنهاء الوردية والخروج، اضغط "تسليم الورديه والخروج" وسيُطلب الرقم السري.'})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:'لاستكمال إضافة مستخدم جديد اضغط الزر أسفل "إضافة مستخدم جديد" لفتح النموذج.'}),ue.length>0&&e.jsxs("div",{className:"mt-4 border-t pt-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"المستخدمون المسجلون"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-auto",children:ue.map((b,ie)=>e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:b.name}),e.jsx("div",{className:"text-xs text-gray-500",children:b.username})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(c,{size:"sm",className:"w-full sm:w-auto",onClick:()=>{bs(b),ft(!0)},children:"دخول"}),e.jsx(c,{size:"sm",className:"w-full sm:w-auto",variant:"destructive",onClick:()=>Va(b.username),children:"حذف"})]})]},ie))})]})]}),e.jsx(Se,{className:"flex flex-wrap gap-2 justify-between",children:m?e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(c,{className:"w-full sm:w-auto",variant:"destructive",onClick:mt,children:"تسليم الورديه والخروج"})}):e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(c,{className:"w-full sm:w-auto",onClick:()=>is(!0),children:"إضافة مستخدم جديد"}),e.jsx(c,{className:"w-full sm:w-auto",variant:"outline",onClick:()=>ws(!0),children:"إيصالات التسليم"})]})})]})}),e.jsx(oe,{open:Ka,onOpenChange:is,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{children:"إضافة مستخدم جديد"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"mb-1 block",children:"الاسم"}),e.jsx(L,{value:M,onChange:b=>H(b.target.value),placeholder:"أدخل الاسم"})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"mb-1 block",children:"اسم المستخدم"}),e.jsx(L,{value:V,onChange:b=>W(b.target.value),placeholder:"أدخل اسم المستخدم"})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"mb-1 block",children:"الرقم السري"}),e.jsx(L,{type:"password",autoComplete:"new-password",value:C,onChange:b=>U(b.target.value),placeholder:"أدخل الرقم السري"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"المستخدم يمكنه: التحويل، السحب، اختيار المحفظة فقط."})]}),e.jsxs(Se,{className:"flex gap-2 justify-between",children:[e.jsx(c,{variant:"secondary",onClick:()=>{is(!1)},children:"إلغاء"}),e.jsx(c,{onClick:()=>{!M.trim()||!V.trim()||!C.trim()||($s(),is(!1))},children:"حفظ المستخدم"})]})]})}),e.jsx(oe,{open:Ns,onOpenChange:ws,children:e.jsxs(ce,{className:"sm:max-w-lg",children:[e.jsx(de,{children:e.jsx(me,{children:"إيصالات التسليم"})}),la.length===0?e.jsx("div",{className:"text-xs text-gray-600",children:"لا توجد إيصالات تسليم محفوظة بعد."}):e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-auto",children:la.map(b=>e.jsxs("div",{className:"rounded border px-3 py-2 cursor-pointer hover:bg-gray-50",onClick:()=>{Ja(b),ns(!0)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:new Date(b.createdAt).toLocaleString("ar-EG")}),e.jsxs("div",{className:"text-xs text-gray-500",children:["إلى: ",b.receiverPhone]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مسلّمة: ",b.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مسلّمة (إجمالي): ",b.deliveredWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مستلمة: ",b.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مستلمة (إجمالي): ",b.receivedWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مسلّمة: ",b.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مسلّمة (إجمالي): ",b.deliveredWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مستلمة: ",b.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مستلمة (إجمالي): ",b.receivedWalletBalancesTotal??0]}),e.jsxs("div",{className:["text-xs",(b.shiftProfit??(b.deliveredDrawerFunds??0)+(b.deliveredWalletBalancesTotal??0)-(b.receivedDrawerFunds??0)-(b.receivedWalletBalancesTotal??0))>=0?"text-green-700":"text-red-700"].join(" "),children:["أرباح الوردية: ",b.shiftProfit??(b.deliveredDrawerFunds??0)+(b.deliveredWalletBalancesTotal??0)-(b.receivedDrawerFunds??0)-(b.receivedWalletBalancesTotal??0)]})]}),b.deficit&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["عجز: ",b.deficitAmount??0]})]},b.id))}),e.jsx(Se,{className:"flex gap-2 justify-between",children:e.jsx(c,{variant:"secondary",onClick:()=>ws(!1),children:"إغلاق"})})]})}),e.jsx(oe,{open:Nt,onOpenChange:ns,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{children:"إيصال تسليم وردية"})}),Ze?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-sm",children:["التاريخ: ",new Date(Ze.createdAt).toLocaleString("ar-EG")]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["تم التسليم إلى: ",Ze.receiverPhone]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"المستلم عند الدخول"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية: ",Ze.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["أرصدة المحافظ (إجمالي): ",Ze.receivedWalletBalancesTotal??0]})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"المسلّم عند الخروج"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية: ",Ze.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["أرصدة المحافظ (إجمالي): ",Ze.deliveredWalletBalancesTotal??0]})]})]}),Ze.deficit&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2 text-red-600",children:"عجز"}),e.jsxs("div",{className:"text-xs text-red-600",children:["المبلغ: ",Ze.deficitAmount??0]})]}),Ze.receivedWalletBalances&&Object.keys(Ze.receivedWalletBalances).length>0&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"تفصيل المحافظ المستلمة"}),e.jsx("div",{className:"space-y-1",children:Object.entries(Ze.receivedWalletBalances).map(([b,ie])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:b}),e.jsx("span",{className:"font-semibold",children:ie})]},b))})]}),Ze.deliveredWalletBalances&&Object.keys(Ze.deliveredWalletBalances).length>0&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"تفصيل المحافظ المسلّمة"}),e.jsx("div",{className:"space-y-1",children:Object.entries(Ze.deliveredWalletBalances).map(([b,ie])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:b}),e.jsx("span",{className:"font-semibold",children:ie})]},b))})]})]}):e.jsx("div",{className:"text-xs text-gray-600",children:"لا يوجد تقرير محدد للعرض."}),e.jsx(Se,{className:"flex gap-2 justify-between",children:e.jsx(c,{variant:"secondary",onClick:()=>ns(!1),children:"إغلاق"})})]})}),e.jsx(oe,{open:Ye,onOpenChange:ft,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{children:"أدخل الرقم السري للدخول"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm",children:Wt?`${Wt.name} (${Wt.username})`:""}),e.jsx(L,{type:"password",autoComplete:"off",value:Ut,onChange:b=>Tt(b.target.value),placeholder:"أدخل الرقم السري"})]}),e.jsxs(Se,{className:"flex gap-2 justify-between",children:[e.jsx(c,{variant:"secondary",onClick:()=>{Tt(""),bs(null),ft(!1)},children:"إلغاء"}),e.jsx(c,{onClick:()=>{if(Wt){if(Ut.trim()!==Wt.password){I({title:"خطأ في الرقم السري",description:"الرقم السري للكاشير غير صحيح",variant:"destructive"});return}u({name:Wt.name,username:Wt.username}),Tt(""),ft(!1),d(!1),T(),z(!0)}},children:"دخول الورديه"})]})]})}),e.jsx(oe,{open:ee,onOpenChange:z,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{children:"تسجيل أرصدة البداية والنقدية"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(Y,{className:"mb-1 block",children:"الفلوس النقدية المستلمة عند الدخول"}),e.jsx(L,{type:"number",value:we,onChange:b=>Le(b.target.value),placeholder:"أدخل قيمة النقدية في الدرج عند بداية الورديه"})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(Y,{className:"mb-1 block",children:"أرصدة المحافظ المستلمة (إجمالي) عند الدخول"}),e.jsx(L,{type:"number",value:Number.isFinite($e)?$e:0,onChange:b=>{const ie=parseFloat(b.target.value);gt(Number.isFinite(ie)?ie:0)},placeholder:"أدخل إجمالي أرصدة المحافظ عند بداية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"يمكن إضافة التفصيل لاحقاً إن لزم، المهم تسجيل الإجمالي."})]})]}),e.jsx(Se,{className:"flex gap-2 justify-between",children:e.jsx(c,{onClick:()=>{const b=parseFloat(we),ie=$e,Q=Number.isFinite(b)&&b>=0,He=Number.isFinite(ie)&&ie>=0;if(!Q||!He){I({title:"يرجى إدخال قيم صحيحة",description:"أدخل قيمًا رقمية غير سالبة للنقدية ولإجمالي أرصدة المحافظ",variant:"destructive"});return}try{localStorage.setItem("shiftInitialReceivedDrawerFunds",String(b)),localStorage.setItem("shiftInitialReceivedWalletBalancesTotal",String(ie))}catch{}I({title:"تم تسجيل أرصدة البداية",description:"سُجّل إجمالي النقدية وأرصدة المحافظ لبداية الورديه"}),z(!1)},children:"تأكيد وحفظ"})})]})}),e.jsx(oe,{open:re,onOpenChange:b=>{b&&$(!0)},children:e.jsxs(ce,{className:"sm:max-w-md",hideClose:!0,disableOutsideClose:!0,disableEscClose:!0,children:[e.jsx(de,{children:e.jsx(me,{children:"تسليم الورديه والخروج"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:P==="toUser"?"default":"secondary",onClick:()=>J("toUser"),children:"تسليم إلى مستخدم آخر"}),e.jsx(c,{variant:P==="toAdmin"?"default":"secondary",onClick:()=>J("toAdmin"),children:"تسليم إلى الأدمن الرئيسي"})]}),P==="toUser"&&e.jsxs("div",{className:"space-y-3",children:[ue.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"لا يوجد مستخدمون مسجلون. قم بإضافة مستخدم أولاً."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"اختر المستخدم الذي سيتسلم الورديه"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-auto",children:ue.map((b,ie)=>e.jsxs("div",{className:`flex items-center justify-between rounded border px-3 py-2 cursor-pointer ${(Z==null?void 0:Z.username)===b.username?"bg-indigo-50 border-indigo-200":""}`,onClick:()=>Ne(b),children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:b.name}),e.jsx("div",{className:"text-xs text-gray-500",children:b.username})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"اختيار"})]},ie))})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"mb-1 block",children:"كلمة سر المستخدم المحدد"}),e.jsx(L,{type:"password",autoComplete:"off",value:K,onChange:b=>te(b.target.value),placeholder:"أدخل كلمة السر"})]}),We&&e.jsx("div",{className:"text-xs text-red-600",children:We})]}),P==="toAdmin"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"أدخل كلمة مرور الحساب الرئيسي لتسليم الورديه والخروج إلى الأدمن."}),e.jsx(L,{type:"password",autoComplete:"off",value:ne,onChange:b=>ae(b.target.value),placeholder:"كلمة المرور"}),pe&&e.jsx("div",{className:"text-xs text-red-600",children:pe})]})]}),e.jsx(Se,{className:"flex gap-2 justify-between",children:e.jsx(c,{disabled:Ie||!P,onClick:async()=>{if(P){Te(!0);try{const b=await _s();if(P==="toUser"){if(!Z){ze("يرجى اختيار المستخدم أولاً"),Te(!1);return}if(K.trim()!==Z.password){ze("كلمة السر غير صحيحة"),Te(!1);return}E(),u({name:Z.name,username:Z.username}),T(),O(`${Z.name} (${Z.username})`);try{localStorage.setItem("lastHandoverToAdmin","false")}catch{}$(!1),J(null),Ne(null),te(""),ze(""),d(!1),vt(b),_(null),he(""),Je(!0)}else if(P==="toAdmin"){G("");const ie=(h==null?void 0:h.email)||"";if(!ie){G("لا يوجد بريد للمستخدم الرئيسي للتحقق"),Te(!1);return}const{error:Q}=await v(ie,ne);if(Q){G("كلمة المرور غير صحيحة"),Te(!1);return}E(),u(null);try{localStorage.setItem("lastHandoverToAdmin","true")}catch{}ae(""),$(!1),d(!1),O("الأدمن الرئيسي"),vt(b),_(null),he(""),Je(!0)}}catch{ze("حدث خطأ أثناء التسليم، حاول مرة أخرى")}finally{Te(!1)}}},children:"تأكيد التسليم"})})]})}),e.jsx(oe,{open:tt,onOpenChange:Je,children:e.jsxs(ce,{className:"sm:max-w-lg",hideClose:!0,disableOutsideClose:!0,disableEscClose:!0,children:[e.jsx(de,{children:e.jsx(me,{children:"تقرير تسليم الورديه والخروج"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-sm",children:["تم تسليم الورديه إلى: ",e.jsx("span",{className:"font-semibold",children:Ke})]}),y&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["بداية الورديه: ",new Date(y).toLocaleString("ar-EG")]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نهاية الورديه: ",new Date().toLocaleString("ar-EG")]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(Y,{className:"mb-1 block",children:"الفلوس النقدية المستلمة"}),e.jsx(L,{type:"number",value:we,readOnly:!0,disabled:!0,placeholder:"قيمة مسجلة عند بداية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"قيمة غير قابلة للتعديل؛ تُسجّل عند الدخول."})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(Y,{className:"mb-1 block",children:"أرصدة المحافظ المستلمة (إجمالي)"}),e.jsx(L,{type:"number",value:$e,readOnly:!0,disabled:!0,placeholder:"إجمالي مسجل عند بداية الورديه"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(Y,{className:"mb-1 block",children:"الفلوس النقدية المسلمة"}),e.jsx(L,{type:"number",value:pt,onChange:b=>{const ie=parseFloat(b.target.value);D(Number.isFinite(ie)?ie:0)},placeholder:"أدخل قيمة النقدية المسلمة عند نهاية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"ادخال يدوي لقيمة النقدية المسلّمة عند نهاية الورديه"})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(Y,{className:"mb-1 block",children:"أرصدة المحافظ المسلمة (إجمالي)"}),e.jsx(L,{type:"number",value:X,onChange:b=>{const ie=parseFloat(b.target.value);ge(Number.isFinite(ie)?ie:0)},placeholder:"أدخل إجمالي أرصدة المحافظ المسلّمة"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"يمكنك إدخال الإجمالي يدوياً؛ التفصيل يُحفظ إن لزم"})]})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"أرباح الوردية"}),e.jsx("div",{className:["text-sm",(pt??0)+(X??0)-((parseFloat(we||"0")||0)+($e??0))>=0?"text-green-700":"text-red-700"].join(" "),children:Math.round(((pt??0)+(X??0)-((parseFloat(we||"0")||0)+($e??0)))*100)/100}),e.jsx("div",{className:"text-xs text-gray-600",children:"محسوبة: (المسلّم − المستلم) للنقدية + المحافظ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"هل يوجد عجز؟"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:p==="no"?"default":"secondary",onClick:()=>_("no"),children:"لا"}),e.jsx(c,{variant:p==="yes"?"default":"secondary",onClick:()=>_("yes"),children:"نعم"})]}),p==="yes"&&e.jsxs("div",{children:[e.jsx(Y,{className:"mb-1 block",children:"مبلغ العجز"}),e.jsx(L,{type:"number",value:se,onChange:b=>he(b.target.value),placeholder:"أدخل مبلغ العجز"})]})]})]}),e.jsx(Se,{className:"flex gap-2 justify-between",children:e.jsx(c,{onClick:()=>{const b=p==="yes",ie=parseFloat(se)||0;(async()=>await ht(Pt,b,ie))(),I({title:"تم إضافة إيصال تسليم الورديه",description:"أُضيف الإيصال إلى المعاملات الأخيرة بعنوان إيصال تسليم وردية"}),Je(!1)},children:"تأكيد وحفظ الإيصال"})})]})})]})},Oc=({open:i,onOpenChange:d})=>{const{shiftUser:t,endShift:m,setShiftUser:y}=za(),[u,T]=l.useState(""),[E,f]=l.useState(""),[h,v]=l.useState([]);l.useEffect(()=>{try{const I=localStorage.getItem("cashierUsers");v(I?JSON.parse(I):[])}catch{v([])}},[i]);const k=async()=>{if(f(""),!t)return;const I=h.find(M=>M.username===t.username);if(!I){f("لا يوجد مستخدم مطابق لهذه الوردية");return}if(u.trim()!==I.password){f("الرقم السري غير صحيح");return}m(),y(null),T(""),d(!1)};return e.jsx(oe,{open:i,onOpenChange:I=>{T(""),f(""),d(I)},children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{children:"بروفيل الوردية"})}),t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-lg border p-3 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:t.name}),e.jsx("div",{className:"text-xs text-gray-600",children:t.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"block",children:"أدخل الرقم السري لتسليم الوردية"}),e.jsx(L,{type:"password",value:u,onChange:I=>T(I.target.value),placeholder:"الرقم السري للمستخدم",dir:"ltr"}),E&&e.jsx("div",{className:"text-red-600 text-xs",children:E})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"لا يوجد مستخدم وردية نشط حالياً"}),e.jsxs(Se,{className:"flex justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>d(!1),children:"إغلاق"}),e.jsx(c,{onClick:k,disabled:!t,children:"تسليم الوردية"})]})]})})};class Bs{static async processTransfer(d){const{amount:t,currentCashBalance:m,currentWalletBalances:y,wallets:u,selectedWalletId:T}=d;if(t<=0)return{success:!1,newCashBalance:m,newWalletBalances:y,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(T&&!d.skipRemoteLimitsCheck)try{const v=await ps.canPerformOperation(T,t,"transfer");if(!v.canPerform)return{success:!1,newCashBalance:m,newWalletBalances:y,message:v.message||"تجاوز حد التحويل المسموح",error:"LIMIT_EXCEEDED"}}catch(v){return console.error("خطأ في التحقق من حدود التحويل:",v),{success:!1,newCashBalance:m,newWalletBalances:y,message:"خطأ في التحقق من حدود التحويل",error:"LIMIT_CHECK_ERROR"}}if(t<=0)return{success:!1,newCashBalance:m,newWalletBalances:y,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(T){const v=Math.max(y[T]||0,0);if(v<t){const k=u.find(I=>I.id===T);return{success:!1,newCashBalance:m,newWalletBalances:y,message:`رصيد غير كافي في المحفظة${k?` ${k.name}`:""}. المتاح: ${v} جنيه، المطلوب: ${t} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}}else{const v=Bs.calculateTotalWalletBalance(y);if(v<t)return{success:!1,newCashBalance:m,newWalletBalances:y,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${v} جنيه، المبلغ المطلوب: ${t} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}const E={...y};if(T){const v=E[T]||0;E[T]=v-t}else{let v=t;for(const k of u){if(v<=0)break;const I=Math.max(E[k.id]||0,0),M=Math.min(I,v);M>0&&(E[k.id]=(E[k.id]||0)-M,v-=M)}}const f=m+t;if(T)try{const v=ps.updateUsage(T,t,"transfer");d.nonBlockingUsageUpdate?v.catch(k=>console.error("خطأ في تحديث استخدام المحفظة:",k)):await v}catch(v){console.error("خطأ في تحديث استخدام المحفظة:",v)}let h="تم التحويل بنجاح";if(T){const v=E[T]||0;v<0&&(h=`تم التحويل بنجاح مع تحذير: رصيد محفظة ${T} أصبح ${v} جنيه.`)}return{success:!0,newCashBalance:f,newWalletBalances:E,message:h}}static processDeposit(d){const{amount:t,currentCashBalance:m,currentWalletBalances:y,wallets:u}=d;if(t<=0)return{success:!1,newCashBalance:m,newWalletBalances:y,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};const T=this.calculateTotalWalletBalance(y);if(T<t)return{success:!1,newCashBalance:m,newWalletBalances:y,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${T} جنيه، المبلغ المطلوب: ${t} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"};const E=m+t,f={...y};let h=t;const v=u.find(I=>I.isDefault);if(v&&f[v.id]>=h)f[v.id]-=h,h=0;else for(const I of u){if(h<=0)break;const M=f[I.id]||0;if(M>0){const H=Math.min(M,h);f[I.id]=M-H,h-=H}}const k=h>0?`تم الإيداع جزئياً. تم إيداع ${t-h} جنيه في صندوق النقدية`:`تم الإيداع بنجاح. تم إضافة ${t} جنيه إلى صندوق النقدية`;return{success:!0,newCashBalance:E,newWalletBalances:f,message:k}}static async processWithdraw(d){const{amount:t,currentCashBalance:m,currentWalletBalances:y,wallets:u,selectedWalletId:T}=d;if(t<=0)return{success:!1,newCashBalance:m,newWalletBalances:y,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(T&&!d.skipRemoteLimitsCheck)try{const v=await ps.canPerformOperation(T,t,"withdraw");if(!v.canPerform)return{success:!1,newCashBalance:m,newWalletBalances:y,message:v.reason||"تم تجاوز الحد المسموح للسحب",error:"LIMIT_EXCEEDED"}}catch(v){return console.error("خطأ في التحقق من حدود السحب:",v),{success:!1,newCashBalance:m,newWalletBalances:y,message:"خطأ في التحقق من حدود السحب",error:"LIMIT_CHECK_ERROR"}}if(m<t)return{success:!1,newCashBalance:m,newWalletBalances:y,message:`رصيد غير كافي في صندوق النقدية. الرصيد المتاح: ${m} جنيه، المبلغ المطلوب: ${t} جنيه`,error:"INSUFFICIENT_CASH_BALANCE"};const E=m-t,f={...y},h=T?u.find(v=>v.id===T):u.find(v=>v.isDefault)||u[0];if(h){const v=f[h.id]||0;f[h.id]=v+t}else return{success:!1,newCashBalance:m,newWalletBalances:y,message:"لا توجد محافظ متاحة لإضافة المبلغ إليها",error:"NO_WALLETS_AVAILABLE"};if(T)try{const v=ps.updateUsage(T,t,"withdraw");d.nonBlockingUsageUpdate?v.catch(k=>console.error("خطأ في تحديث استخدام المحفظة:",k)):await v}catch(v){console.error("خطأ في تحديث استخدام المحفظة:",v)}return{success:!0,newCashBalance:E,newWalletBalances:f,message:`تم السحب بنجاح. تم إضافة ${t} جنيه إلى محفظة ${(h==null?void 0:h.name)||""}`}}static validateOperation(d,t){return d<=0?{valid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"}:!t||t.length===0?{valid:!1,error:"لا توجد محافظ متاحة"}:{valid:!0}}static calculateTotalWalletBalance(d){return Object.values(d).reduce((t,m)=>t+Math.max(m,0),0)}static deductFromWalletsAddToCash(d,t,m,y){return this.processTransfer({amount:d,currentCashBalance:t,currentWalletBalances:m,wallets:y})}static deductFromWalletsAddToCashDeposit(d,t,m,y){return this.processDeposit({amount:d,currentCashBalance:t,currentWalletBalances:m,wallets:y})}static deductFromCashAddToWallets(d,t,m,y){return this.processWithdraw({amount:d,currentCashBalance:t,currentWalletBalances:m,wallets:y})}static applyTransactionResult(d,t,m){d.success&&(t(d.newCashBalance),m(d.newWalletBalances))}static validateTransaction(d,t,m,y){if(d<=0)return{isValid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"};if(t==="transfer"){const u=this.calculateTotalWalletBalance(y);if(u<d)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${u} جنيه) غير كافي للمبلغ المطلوب (${d} جنيه)`}}else if(t==="withdraw"){if(m<d)return{isValid:!1,error:`الرصيد المتاح في صندوق النقدية (${m} جنيه) غير كافي للمبلغ المطلوب (${d} جنيه)`}}else if(t==="deposit"){const u=this.calculateTotalWalletBalance(y);if(u<d)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${u} جنيه) غير كافي للمبلغ المطلوب (${d} جنيه)`}}return{isValid:!0}}static getDeductionPreview(d,t,m){const y=[];let u=d;for(const T of m){if(u<=0)break;const E=t[T.id]||0,f=Math.min(Math.max(E,0),u);f>0&&(y.push({walletId:T.id,walletName:T.name,currentBalance:E,deductedAmount:f,newBalance:E-f}),u-=f)}return y}}let ea=null;function Wc(){const i=window;if(!ea){const d=i.AudioContext||i.webkitAudioContext;ea=new d}return ea.state==="suspended"&&ea.resume(),ea}function Fc(i,d,t){const m=t/1e3,y=Math.floor(i.sampleRate*m),u=i.createBuffer(1,y,i.sampleRate),T=u.getChannelData(0);for(let v=0;v<y;v++)T[v]=(Math.random()*2-1)*.6;const E=i.createBufferSource();E.buffer=u;const f=i.createBiquadFilter();f.type="highpass",f.frequency.value=1500,f.Q.value=.7;const h=i.createGain();h.gain.setValueAtTime(1e-4,d),h.gain.exponentialRampToValueAtTime(.4,d+.015),h.gain.exponentialRampToValueAtTime(1e-4,d+m),E.connect(f),f.connect(h),h.connect(i.destination),E.start(d),E.stop(d+m+.01)}function Bc(i,d,t,m,y,u="triangle"){const T=i.createOscillator(),E=i.createGain();T.type=u;const f=y/1e3;T.frequency.setValueAtTime(t,d),T.frequency.linearRampToValueAtTime(m,d+f),E.gain.setValueAtTime(1e-4,d),E.gain.exponentialRampToValueAtTime(.25,d+.02),E.gain.exponentialRampToValueAtTime(1e-4,d+f),T.connect(E),E.connect(i.destination),T.start(d),T.stop(d+f+.02)}function Ec(){try{const i=Wc(),d=i.currentTime;Fc(i,d,90),Bc(i,d+.12,1900,1100,180,"sawtooth")}catch{}}const Pd=()=>{var Kl,Vl,ql,Yl;console.log("🔥 UserDashboardPage component is loading...");const{toast:i}=Rt(),{signOut:d,user:t,profile:m}=ls(),y=((t==null?void 0:t.email)||"").toLowerCase()==="vodafonecash00@gmail.com",u=po(),T=an(),{isShiftActive:E,shiftUser:f}=za(),{shopName:h}=fo(),v=vo(),[k,I]=l.useState(!1),[M,H]=l.useState(!1);console.log("🔥 UserDashboardPage - user:",t?"exists":"null");const[V,W]=l.useState(!0),[C,U]=l.useState(!0),[re,$]=l.useState(!1),[P,J]=l.useState(!1),[ne,ae]=l.useState(""),[pe,G]=l.useState(""),[Z,Ne]=l.useState(""),[K,te]=l.useState([]),[We,ze]=l.useState(!1),[Ie,Te]=l.useState(null),[tt,Je]=l.useState("");l.useState(!1);const[Pt,vt]=l.useState(!1),[p,_]=l.useState(!1),[se,he]=l.useState(!1),[we,Le]=l.useState(""),[$e,gt]=l.useState(""),[Ot,bt]=l.useState([]),[pt,D]=l.useState(!1),[X,ge]=l.useState(0),[Ae,ke]=l.useState(!1),[Ke,O]=l.useState(null),[ee,z]=l.useState(!1),[ue,Pe]=l.useState(()=>{try{const s=Object.keys(localStorage).find(a=>a.startsWith("wallets_")),r=s?localStorage.getItem(s):null;if(r){const a=JSON.parse(r);if(Array.isArray(a)&&a.length>0){const n=Object.keys(localStorage).find(g=>g.startsWith("selectedWallet_")),o=n?localStorage.getItem(n):null,x=o&&a.find(g=>g.id===o)||a.find(g=>g.isDefault)||a[0];return(x==null?void 0:x.phone)||"01030302038"}}}catch{}return"01030302038"}),[dt,lt]=l.useState(""),[Ye,ft]=l.useState(""),[Ut,Tt]=l.useState(!1),[Wt,bs]=l.useState(""),[la,Ft]=l.useState(""),[Ns,ws]=l.useState(""),[Ze,Ja]=l.useState(""),[Nt,ns]=l.useState(null),[Ka,is]=l.useState(!1),[Va,$s]=l.useState(!1),[mt,_s]=l.useState(""),[ht,Ss]=l.useState(""),[b,ie]=l.useState(()=>{try{const s=localStorage.getItem("commissionMode")||localStorage.getItem("commissionMode_default");return s?s==="add":!0}catch{return!0}}),[Q,He]=l.useState("transfer"),[De,nt]=l.useState([]),[_e,os]=l.useState("all");l.useEffect(()=>{try{if(localStorage.setItem("commissionMode",b?"add":"deduct"),t!=null&&t.uid){const s=`commissionMode_${t.uid}`;localStorage.setItem(s,b?"add":"deduct")}}catch{}},[b,t==null?void 0:t.uid]),l.useEffect(()=>{try{const s=t!=null&&t.uid?localStorage.getItem(`commissionMode_${t.uid}`):null,r=localStorage.getItem("commissionMode"),a=localStorage.getItem("commissionMode_default"),n=s??r??a;n&&ie(n==="add")}catch{}},[t==null?void 0:t.uid]);const[na,qa]=l.useState(!1),[Qr,be]=l.useState(null),[R,wt]=l.useState(()=>{var s,r,a;try{const n=Object.keys(localStorage).find(N=>N.startsWith("wallets_")),o=n?localStorage.getItem(n):null,x=o?JSON.parse(o):null,g=Object.keys(localStorage).find(N=>N.startsWith("selectedWallet_")),j=g?localStorage.getItem(g):null;return(x&&Array.isArray(x)&&x.length>0?j&&((s=x.find(N=>N.id===j))==null?void 0:s.id)||((r=x.find(N=>N.isDefault))==null?void 0:r.id)||((a=x[0])==null?void 0:a.id):"")||""}catch{}return""});l.useEffect(()=>{if(!Ut)return;const s=Qt(),r=parseFloat(Ye||"0")||0;let a=0;if(Q==="transfer"){if((s==null?void 0:s.defaultTransferCommission)!=null){const o=Number(s.defaultTransferCommission)||0;a=Math.round(o*r/1e3*100)/100}else{const o=ht&&ht.trim()!==""?parseFloat(ht):0;a=Math.max(0,o)}const n=b?r+a:r;Ft((n||0).toString())}else{if((s==null?void 0:s.defaultWithdrawCommission)!=null){const o=Number(s.defaultWithdrawCommission)||0;a=Math.round(o*r/1e3*100)/100}else{const o=mt&&mt.trim()!==""?parseFloat(mt):Math.round(r*.01*100)/100;a=Math.max(0,o)}const n=b?r:Math.max(0,Math.round((r-a)*100)/100);Ft((n||0).toString())}},[Ut,Ye,ht,mt,R,b,Q]);const Qt=()=>{var r,a;let s=ye.find(n=>n.id===R);if(!s)try{const n=localStorage.getItem(hs());if(n){const o=JSON.parse(n);if(Array.isArray(o)&&o.length>0){const g=localStorage.getItem(`selectedWallet_${(t==null?void 0:t.uid)||"default"}`)||((r=o.find(j=>j.isDefault))==null?void 0:r.id)||((a=o[0])==null?void 0:a.id);s=o.find(j=>j.id===g)}}}catch{}return s};l.useLayoutEffect(()=>{try{const s=`wallets_${(t==null?void 0:t.uid)||"default"}`;let r=localStorage.getItem(s);if(!r){const a=Object.keys(localStorage).find(n=>n.startsWith("wallets_"));a&&(r=localStorage.getItem(a)||null)}if(r){const a=JSON.parse(r);if(Array.isArray(a)&&a.length>0){zt(a);const n=`selectedWallet_${(t==null?void 0:t.uid)||"default"}`,o=localStorage.getItem(n),x=o&&a.find(g=>g.id===o)||a.find(g=>g.isDefault)||a[0];x&&(wt(x.id),Pe(x.phone))}}}catch(s){console.error("تهيئة فورية للمحافظ من التخزين المحلي فشلت:",s)}},[]),l.useEffect(()=>{console.log("🔍 selectedWallet state changed to:",R)},[R]),l.useEffect(()=>{Ai()},[]),l.useEffect(()=>{Pi()},[]);const[ye,zt]=l.useState(()=>{try{const s=Object.keys(localStorage).find(a=>a.startsWith("wallets_")),r=s?localStorage.getItem(s):null;if(r){const a=JSON.parse(r);if(Array.isArray(a))return a}}catch{}return[]}),[Jn,Mc]=l.useState(null),[Kn,Zr]=l.useState(!1),[Vn,ia]=l.useState(!1),[qn,Yn]=l.useState(null);l.useState([]),l.useState([]);const[Hn,Rs]=l.useState(!1),[Ya,Xr]=l.useState("daily"),[Gn,el]=l.useState(!1),[Qn,Ha]=l.useState(!1),[tl,cs]=l.useState([]),Zn=async s=>{try{const r=De.find(n=>n.id===s);if(!r||!t)return;const a=De.filter(n=>n.id!==s);nt(a);try{await je.removeUserTransaction(t.uid,s),await Aa.permanentlyDeleteTransaction(s,t.uid)}catch(n){console.warn("تعذر الحذف النهائي من قواعد البيانات أثناء حذف الإيصال:",n)}try{const n=Ve(),o=Re(),x=localStorage.getItem(n),g=localStorage.getItem(o);let j=x?parseFloat(x):Ee,A=g?JSON.parse(g):{...ve};const N=r.amount||r.transferredAmount||r.withdrawnAmount||r.withdrawnAmountDetailed||0;if(r.type==="send"&&(r.fromWallet||R)){j-=r.commission||0;const F=r.fromWallet||R;A[F]=(A[F]||0)+N}else if(r.type==="withdraw"&&(r.fromWallet||R)){j+=N,j-=r.commission||0;const F=r.fromWallet||R;A[F]=Math.max(0,(A[F]||0)-N)}Ge(j),Be(A),localStorage.setItem(n,j.toString()),localStorage.setItem(o,JSON.stringify(A));const w={cashBalance:j,walletBalances:A,lastUpdated:new Date().toISOString()},B=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(B,JSON.stringify(w)),t!=null&&t.uid?je.updateUserData(t.uid,w).then(()=>{localStorage.removeItem(B),xe(!1)}).catch(F=>{console.warn("تعذر حفظ الأرصدة في Firebase بعد الحذف، تم الاحتفاظ محليًا:",F),xe(!0)}):xe(!0)}catch(n){console.warn("تعذر عكس تأثير الأرصدة بعد الحذف:",n)}try{const n=r.fromWallet||R,o=await ps.getWalletLimits(t.uid,n);if(o){const x=r.amount||r.transferredAmount||r.withdrawnAmount||r.withdrawnAmountDetailed||0,g={...o};r.type==="send"?(g.dailyTransferUsed=Math.max(0,(o.dailyTransferUsed||0)-x),g.monthlyTransferUsed=Math.max(0,(o.monthlyTransferUsed||0)-x)):(g.dailyWithdrawUsed=Math.max(0,(o.dailyWithdrawUsed||0)-x),g.monthlyWithdrawUsed=Math.max(0,(o.monthlyWithdrawUsed||0)-x)),await ps.updateWalletLimits(t.uid,n,g)}}catch(n){console.warn("تعذر تحديث حدود المحفظة بعد الحذف:",n)}try{Lt.removeTransactionEffects(r,t.uid)}catch(n){console.warn("تعذر تحديث التقارير بعد الحذف:",n)}i({title:"تم الحذف نهائيًا",description:"تم حذف الإيصال نهائيًا وعكس تأثيراته على الأرصدة والحدود والتقارير."}),ia(!1)}catch(r){console.error("خطأ أثناء حذف الإيصال:",r),i({title:"خطأ في حذف الإيصال",description:"حدث خطأ غير متوقع أثناء الحذف.",variant:"destructive"})}},Xn=async s=>{try{if(!De.find(a=>a.id===s)||!t)return;await ta(qt(ot,"userTransactions",s),{status:"completed",confirmedAt:new Date}),nt(a=>a.map(n=>n.id===s?{...n,status:"completed"}:n)),i({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),ia(!1)}catch(r){console.error("خطأ أثناء إكمال الإيصال:",r),i({title:"فشل الإكمال",description:"حدث خطأ غير متوقع أثناء تحديث الحالة.",variant:"destructive"})}},[sl,ei]=l.useState(""),al=Sc(sl,300),[oa,rl]=l.useState(""),[ca,ll]=l.useState(""),[Zt,Lc]=l.useState(""),[Ga,Ds]=l.useState(!1),[nl,Us]=l.useState(!1),[ti,il]=l.useState(!1),[si,Qa]=l.useState(!1),[ai,Za]=l.useState(!1),[ri,Xa]=l.useState(!1),[li,er]=l.useState(!1),[ni,ol]=l.useState(!0),[zs,ii]=l.useState(!1),[oi,da]=l.useState(!1),[ci,ma]=l.useState(!1),[di,ha]=l.useState(!1),[St,Et]=l.useState([]),[tr,cl]=l.useState(""),[sr,dl]=l.useState(""),[ar,ml]=l.useState(""),[fe,hl]=l.useState(null),[mi,Js]=l.useState(!1);l.useState(!1);const[hi,rr]=l.useState(!1),[xl,lr]=l.useState(""),[xi,nr]=l.useState(!1),[ui,ir]=l.useState(!1),[Jt,or]=l.useState([]),[cr,ul]=l.useState(""),[dr,gl]=l.useState(""),[mr,pl]=l.useState(""),[fl,vl]=l.useState(""),[gi,xa]=l.useState(!1),[hr,xr]=l.useState(null),[Dt,Ks]=l.useState(null),[ua,ur]=l.useState(""),[pi,Cs]=l.useState(!1),[yl,ga]=l.useState(0),[Mt,ds]=l.useState(null),[ms,gr]=l.useState(""),[Fe,fi]=l.useState(null),Xt=async s=>{try{const r=JSON.stringify(s);localStorage.setItem(wl(),r);try{localStorage.setItem(Dl(),r)}catch{}t!=null&&t.uid&&je.updateUserData(t.uid,{debts:s}).catch(()=>xe(!0))}catch(r){console.error("خطأ في حفظ الديون:",r)}},vi=async()=>{try{const s=wl(),r=Dl(),a=localStorage.getItem(s),n=localStorage.getItem(r),o=g=>{if(!g)return null;try{const j=JSON.parse(g);return Array.isArray(j)?j.map(A=>{var N;return{...A,createdAt:(N=A.createdAt)!=null&&N.toDate?A.createdAt.toDate():new Date(A.createdAt),partialPayments:Array.isArray(A.partialPayments)?A.partialPayments.map(w=>{var B;return{amount:Number(w.amount)||0,paidAt:(B=w.paidAt)!=null&&B.toDate?w.paidAt.toDate():new Date(w.paidAt)}}):[]}}):[]}catch(j){return console.warn("فشل في تحليل ديون localStorage:",j),null}};let x=o(a);if(!x||x.length===0){const g=o(n);if(g&&g.length>0&&(x=g,Et(g),t!=null&&t.uid))try{await Xt(g),localStorage.removeItem(r)}catch(j){console.warn("تعذر ترحيل الديون من المفتاح الافتراضي:",j)}}if(x&&x.length>0&&Et(x),t!=null&&t.uid)try{const g=await ka(qt(ot,"users",t.uid));if(g.exists()){const j=g.data(),A=j.debts&&Array.isArray(j.debts)?j.debts.map(F=>{var S;return{...F,createdAt:(S=F.createdAt)!=null&&S.toDate?F.createdAt.toDate():new Date(F.createdAt),partialPayments:Array.isArray(F.partialPayments)?F.partialPayments.map(q=>{var Ce;return{amount:Number(q.amount)||0,paidAt:(Ce=q.paidAt)!=null&&Ce.toDate?q.paidAt.toDate():new Date(q.paidAt)}}):[]}}):[],N=new Map;for(const F of x||[])N.set(F.id,F);for(const F of A)N.set(F.id,F);const w=Array.from(N.values());Et(w);try{localStorage.setItem(s,JSON.stringify(w))}catch{}(w.length!==A.length||w.some(F=>{const S=A.find(q=>q.id===F.id);return!S||S.amount!==F.amount||S.status!==F.status||(S.paidAmount??0)!==(F.paidAmount??0)}))&&await je.updateUserData(t.uid,{debts:w})}else x&&x.length>0&&await je.saveUserData(t.uid,{debts:x})}catch(g){console.warn("تعذر تحميل الديون من Firebase، الاعتماد على المحلي:",g)}}catch(s){console.error("خطأ في تحميل الديون:",s)}},yi=async()=>{if(t!=null&&t.uid){console.log("🔄 إعادة فحص حالة المستخدم...");try{await new Promise(r=>setTimeout(r,500));const s=await ka(qt(ot,"users",t.uid));if(s.exists()){const a=s.data().isActive===!0,n=await Ea.checkTrialValidity(t.uid),o=n.isValid&&!n.isExpired;console.log("📊 حالة المستخدم:",{isActive:a,isOnTrial:o,hoursRemaining:n.hoursRemaining}),W(a||o),D(o),ge(n.hoursRemaining),ke(n.hasUsedTrial),_(!a&&!o),console.log("✅ تم تحديث حالة المستخدم بنجاح:",{userIsActive:a||o,isOnFreeTrial:o})}}catch(s){console.error("خطأ في إعادة فحص حالة المستخدم:",s)}}},ji=async()=>{console.log("🎉 تم بدء التجربة المجانية، إعادة فحص حالة المستخدم..."),await yi()},bi=async()=>{if(t!=null&&t.uid)try{z(!0);const s=await Yr(t.uid);O(s)}catch(s){console.error("خطأ في جلب بيانات الاشتراك:",s)}finally{z(!1)}};l.useState(!1);const[Ni,pr]=l.useState(!1),[Ee,Ge]=l.useState(0),[ve,Be]=l.useState({}),[wi,jl]=l.useState(!1),[Si,bl]=l.useState(!1),[Di,fr]=l.useState(!1),[Ci,pa]=l.useState(!1),[Nl,vr]=l.useState(""),[Ii,yr]=l.useState(!1),[Ti,fa]=l.useState(!1),[jr,va]=l.useState(""),Re=()=>`walletBalances_${(t==null?void 0:t.uid)||"default"}`,Ve=()=>`cashBalance_${(t==null?void 0:t.uid)||"default"}`,wl=()=>`debts_${(t==null?void 0:t.uid)||"default"}`,Sl=()=>`customers_${(t==null?void 0:t.uid)||"default"}`,Dl=()=>"debts_default",Cl=()=>`shopExpenses_${(t==null?void 0:t.uid)||"default"}`,Ai=()=>{try{const s=localStorage.getItem(Cl());if(s){const r=JSON.parse(s);te(r.map(a=>({...a,createdAt:new Date(a.createdAt)})))}}catch(s){console.error("خطأ أثناء تحميل مصروفات المحل من التخزين:",s)}},ki=async s=>{try{localStorage.setItem(Cl(),JSON.stringify(s)),te(s)}catch(r){console.error("خطأ أثناء حفظ مصروفات المحل في التخزين:",r)}},Il=()=>`deficiencies_${(t==null?void 0:t.uid)||"default"}`,Pi=()=>{try{const s=localStorage.getItem(Il());if(s){const r=JSON.parse(s);bt(r.map(a=>({...a,createdAt:new Date(a.createdAt)})))}}catch(s){console.error("خطأ أثناء تحميل النواقص من التخزين:",s)}},br=async s=>{try{localStorage.setItem(Il(),JSON.stringify(s)),bt(s)}catch(r){console.error("خطأ أثناء حفظ النواقص في التخزين:",r)}},Oi=async s=>{try{localStorage.setItem(Sl(),JSON.stringify(s)),or(s),t!=null&&t.uid&&await je.updateUserData(t.uid,{customers:s})}catch(r){console.error("خطأ أثناء حفظ العملاء في التخزين:",r)}},Wi=async()=>{try{if(t!=null&&t.uid){const r=await ka(qt(ot,"users",t.uid));if(r.exists()){const a=r.data();if(a.customers&&Array.isArray(a.customers)){const n=a.customers.map(o=>{var x;return{...o,createdAt:(x=o.createdAt)!=null&&x.toDate?o.createdAt.toDate():new Date(o.createdAt)}});or(n);return}}}const s=localStorage.getItem(Sl());if(s){const r=JSON.parse(s);or(r.map(a=>({...a,createdAt:new Date(a.createdAt)})))}}catch(s){console.error("خطأ أثناء تحميل العملاء من التخزين:",s)}},Vs=()=>`transactions_${(t==null?void 0:t.uid)||"default"}`,qs=()=>`deletedTransactions_${(t==null?void 0:t.uid)||"default"}`,hs=()=>`wallets_${(t==null?void 0:t.uid)||"default"}`,xs=()=>`selectedWallet_${(t==null?void 0:t.uid)||"default"}`,Nr=()=>{try{const s=hs(),r=localStorage.getItem(s);if(r){const j=JSON.parse(r);if(Array.isArray(j)&&j.length>0)return j}const a="wallets_default",n=localStorage.getItem(a);if(n){const j=JSON.parse(n);if(Array.isArray(j)&&j.length>0){localStorage.setItem(s,n);try{localStorage.removeItem(a)}catch{}return j}}const o=Object.keys(localStorage).filter(j=>j.startsWith("wallets_")&&j!==s);let x=null,g=null;for(const j of o)try{const A=localStorage.getItem(j);if(!A)continue;const N=JSON.parse(A);Array.isArray(N)&&N.length>0&&(!x||N.length>((x==null?void 0:x.length)||0))&&(x=N,g=j)}catch{}if(x&&g){localStorage.setItem(s,JSON.stringify(x));try{localStorage.removeItem(g)}catch{}return x}}catch(s){console.warn("loadWalletsFromLocalWithMigration failed:",s)}return null},wr=s=>{try{const r=xs(),a=localStorage.getItem(r);if(a&&s.find(o=>o.id===a))return a;const n=[`selectedWallet_${(t==null?void 0:t.uid)||""}`,"selectedWallet_default",...Object.keys(localStorage).filter(o=>o.startsWith("selectedWallet_"))];for(const o of n)try{const x=localStorage.getItem(o);if(x&&s.find(g=>g.id===x)){if(localStorage.setItem(r,x),o!==r)try{localStorage.removeItem(o)}catch{}return x}}catch{}}catch{}return null},[Sr,ya]=l.useState(""),[yt,Tl]=l.useState(""),us=it.useMemo(()=>{const s=Ke;if(!s)return!1;const r=yo(s),a=s.planType??s.plan??null,n=typeof a=="string"?a.toLowerCase():null,o=n==="monthly"||n==="quarterly"||n==="yearly"||n==="lifetime"||a===Yt.MONTHLY||a===Yt.QUARTERLY||a===Yt.YEARLY||a===Yt.LIFETIME;return r&&o},[Ke]),st=it.useMemo(()=>{const s=Ke;if(!s)return!1;const r=s.planType??s.plan??null,a=typeof r=="string"?r.toLowerCase():null;return r===Yt.ZERO||a==="zero"},[Ke]),Fi=()=>{if(!us){i({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}I(!0)};l.useState(!1);const[Bi,Ei]=l.useState(!1),[Mi,Li]=l.useState(!1),[$i,_i]=l.useState(!1),[Ri,ja]=l.useState(!1),[ba,Dr]=l.useState(""),[Cr,Ir]=l.useState(""),[Al,kl]=l.useState(!1),[Ui,Na]=l.useState(!1),[Pl,Tr]=l.useState(""),[Ol,Ar]=l.useState(""),[Wl,Fl]=l.useState(!1),Bl=async()=>{if(t!=null&&t.uid)try{const s=`userData_${t.uid}`,r=localStorage.getItem(s);if(r){const a=JSON.parse(r);console.log("🔄 مزامنة البيانات المحلية مع Firebase...",a);const n={lastSynced:new Date().toISOString()};typeof a.cashBalance=="number"&&(n.cashBalance=a.cashBalance),a.walletBalances&&typeof a.walletBalances=="object"&&(n.walletBalances=a.walletBalances),await je.updateUserData(t.uid,n),localStorage.removeItem(s),xe(!1),console.log("✅ تمت المزامنة بنجاح وحذف البيانات المحلية")}else console.log("لا توجد بيانات محلية تحتاج للمزامنة")}catch(s){console.error("❌ فشل في مزامنة البيانات:",s),i({title:"فشل في المزامنة",description:"حدث خطأ أثناء مزامنة البيانات مع الخادم",variant:"destructive"})}},El=t!=null&&t.uid?`recentTransactionsResetAt:${t.uid}`:null,kr=it.useMemo(()=>{if(!El)return null;try{const s=localStorage.getItem(El);return s?new Date(s):null}catch{return null}},[t==null?void 0:t.uid]),Ml=it.useMemo(()=>{const s=De||[];return kr?s.filter(r=>new Date(r.createdAt)>=kr):s},[De,kr]),Ll=it.useCallback(()=>{let s=Ml;const r=al.trim();if(r&&(s=s.filter(a=>a.senderPhone&&a.senderPhone.includes(r)||a.receiverPhone&&a.receiverPhone.includes(r))),oa){const a=new Date(oa);s=s.filter(n=>{const o=new Date(n.createdAt);if(ca){const[x,g]=ca.split(":"),j=new Date(a);j.setHours(parseInt(x),parseInt(g),0,0);const A=new Date(j);return A.setHours(A.getHours()+1),o>=j&&o<A}else return o.toDateString()===a.toDateString()})}try{s=[...s].sort((a,n)=>{const o=new Date(a.createdAt||0).getTime();return new Date(n.createdAt||0).getTime()-o})}catch{}return s},[Ml,al,oa,ca]),[zi,wa]=l.useState(!1),[$l,Sa]=l.useState(""),[Ji,Da]=l.useState(!1),[Pr,Or]=l.useState(""),[Ki,xe]=l.useState(!1);ye.reduce((s,r)=>s+(ve[r.id]||0),0);const Vi=s=>as.verifyMasterPin(s),Wr=s=>as.verifyMasterPin(s),Fr=async s=>{try{const r=So.currentUser;if(!r||!r.email)return!1;const a=Do.credential(r.email,s);return await Co(r,a),!0}catch(r){return console.error("فشل التحقق من كلمة المرور:",r),!1}};l.useEffect(()=>{if(!(t!=null&&t.uid))return;console.log("🚀 استعادة البيانات من localStorage عند تحميل الصفحة للمستخدم:",t.uid);const s=`walletBalances_${t.uid}`,r=localStorage.getItem(s);if(r)try{const o=JSON.parse(r);console.log("📱 استعادة أرصدة المحافظ من localStorage:",o),Be(o)}catch(o){console.error("خطأ في قراءة أرصدة المحافظ من localStorage:",o)}const a=`cashBalance_${t.uid}`;let n=localStorage.getItem(a);if(!n){const o=`userCashBalance_${t.uid}`,x=localStorage.getItem(o);if(x){n=x;try{localStorage.setItem(a,x),localStorage.removeItem(o)}catch{}}}if(n){const o=parseFloat(n);console.log("💰 استعادة رصيد الدرج النقدي من localStorage:",o),Ge(o)}},[t==null?void 0:t.uid]);const _l=async()=>{try{if(!R)return;const s=await ps.autoResetLimitsIfNeeded(R);fi(s)}catch(s){console.error("خطأ في جلب حدود المحفظة المختارة:",s)}};l.useEffect(()=>{_l()},[R]),l.useEffect(()=>{const s=r=>{var a;(a=r==null?void 0:r.detail)!=null&&a.walletId&&r.detail.walletId===R&&_l()};return window.addEventListener("walletLimitsUpdated",s),()=>window.removeEventListener("walletLimitsUpdated",s)},[R]),l.useEffect(()=>{if(u.state){if(console.log("Location state:",u.state),u.state.openDebtDialog&&(st?i({title:"غير متاح",description:"الديون/الأجل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):ha(!0),window.history.replaceState({},document.title)),u.state.openSalesDialog&&(st?i({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Qa(!0),window.history.replaceState({},document.title)),u.state.openMaintenanceDialog&&(st?i({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Xa(!0),window.history.replaceState({},document.title)),u.state.openCreditCardsDialog&&(console.log("Opening credit cards dialog"),st?i({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Za(!0),window.history.replaceState({},document.title)),u.state.openShopExpensesDialog&&(st?i({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):as.hasMasterPin()?J(!0):$(!0),window.history.replaceState({},document.title)),u.state.openDeficienciesDialog&&(he(!0),window.history.replaceState({},document.title)),u.state.openTransactionSection){const s=document.getElementById("transaction-section");s&&s.scrollIntoView({behavior:"smooth"}),u.state.transactionType&&He(u.state.transactionType),u.state.startNewTransaction&&(lt(""),ft(""),_s(""),Ss(""),console.log("🔒 Starting new transaction without changing wallet selection")),u.state.focusWalletSelection&&setTimeout(()=>{const r=document.querySelector('[data-testid="wallet-select"]');r&&r.focus()},500),window.history.replaceState({},document.title)}u.state.openCashierShiftModal&&(us?I(!0):i({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}),window.history.replaceState({},document.title)),u.state.openMachineDailyDialog&&(us?er(!0):i({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}),window.history.replaceState({},document.title))}},[u.state,ye]),l.useEffect(()=>{var s;if(t!=null&&t.uid)try{const r=Nr();if(r&&r.length>0){zt(r);const a=wr(r)||localStorage.getItem(xs()),n=a&&r.find(o=>o.id===a)?a:(s=r[0])==null?void 0:s.id;n&&!R&&Ys(n,"localStorageHydration")}}catch(r){console.error("خطأ في تهيئة المحافظ من التخزين المحلي:",r)}},[t==null?void 0:t.uid]),l.useEffect(()=>{u.pathname==="/user/dashboard"&&sessionStorage.getItem("previousPath")==="/user/add-wallet"&&(console.log("🔄 Returned from wallet addition page - reloading wallets"),Ca(),sessionStorage.removeItem("previousPath")),sessionStorage.setItem("previousPath",u.pathname)},[u.pathname,t==null?void 0:t.uid]),l.useEffect(()=>{if(!(t!=null&&t.uid))return;console.log("🔥 Setting up real-time user activation listener for:",t.uid);const s=qt(ot,"users",t.uid),r=jo(s,a=>{if(a.exists()){const n=a.data(),o=n.isActive===!0;console.log("🔥 Real-time user status update:",{userId:t.uid,isActive:o,subscription:n.subscription}),o&&!V?(console.log("🎉 User activated! Redirecting to dashboard..."),W(!0),_(!1),U(!1)):!o&&V&&(console.log("❌ User deactivated! Showing activation modal..."),W(!1),_(!0))}},a=>{console.error("❌ Error in real-time user listener:",a)});return()=>{console.log("🔥 Cleaning up real-time user listener"),r()}},[t==null?void 0:t.uid,V]),l.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=a=>{const{userId:n}=a.detail;n===t.uid&&(console.log("🎉 Subscription activation event received for current user!"),W(!0),_(!1),U(!1),setTimeout(()=>{console.log("✅ User activation completed - data updated")},1e3))},r=a=>{const{userId:n,isActive:o}=a.detail;n===t.uid&&(console.log("🔄 User subscription update event received:",{userId:n,isActive:o}),o&&!V&&(W(!0),_(!1),U(!1),setTimeout(()=>{console.log("✅ User subscription updated - data refreshed")},1e3)))};return window.addEventListener("subscriptionActivated",s),window.addEventListener("userSubscriptionUpdated",r),()=>{window.removeEventListener("subscriptionActivated",s),window.removeEventListener("userSubscriptionUpdated",r)}},[t==null?void 0:t.uid,V]),l.useEffect(()=>{console.log("🔥 useEffect loadUserData started",{user:t==null?void 0:t.uid,isCheckingActivation:C}),(async()=>{try{if(!(t!=null&&t.uid)){console.log("🔥 No user UID, setting isCheckingActivation to false"),U(!1);return}let n=!1;const o=`userData_${t==null?void 0:t.uid}`,x=localStorage.getItem(o);if(x)try{const w=JSON.parse(x);w.walletBalances&&(Be(w.walletBalances),n=!0,console.log("⚡ تحميل فوري لأرصدة المحافظ من بيانات المستخدم:",w.walletBalances))}catch(w){console.error("خطأ في قراءة بيانات المستخدم من localStorage:",w)}if(!n){const w=localStorage.getItem(Re());if(w)try{const B=JSON.parse(w);Be(B),n=!0,console.log("⚡ تحميل فوري لأرصدة المحافظ من النسخة الاحتياطية:",B)}catch(B){console.error("خطأ في قراءة أرصدة المحافظ من localStorage:",B)}}if(!n){const B=Object.keys(localStorage).filter(F=>F.startsWith("walletBalances_backup_")).sort().reverse();for(const F of B)try{const S=localStorage.getItem(F);if(S){const q=JSON.parse(S);Be(q),n=!0,console.log("⚡ تحميل فوري لأرصدة المحافظ من النسخة الاحتياطية بالتوقيت:",q);break}}catch(S){console.error("خطأ في قراءة النسخة الاحتياطية:",S);continue}}let g=localStorage.getItem(Ve());if(!g&&(t!=null&&t.uid)){const w=`userCashBalance_${t.uid}`,B=localStorage.getItem(w);if(B){g=B;try{localStorage.setItem(Ve(),B),localStorage.removeItem(w)}catch{}}}g&&(Ge(parseFloat(g)),console.log("⚡ تحميل فوري لرصيد الدرج النقدي من localStorage:",g));try{const w=await ka(qt(ot,"users",t.uid));if(w.exists()){const F=w.data().isActive===!0,S=await Ea.checkTrialValidity(t.uid),q=S.isValid&&!S.isExpired;W(F||q),D(q),ge(S.hoursRemaining),ke(S.hasUsedTrial),_(!F&&!q),console.log("📊 حالة المستخدم:",{isActive:F,isOnTrial:q,hoursRemaining:S.hoursRemaining,hasUsedTrial:S.hasUsedTrial})}else W(!1),_(!0)}catch(w){console.error("خطأ في فحص حالة تفعيل المستخدم:",w),W(!1),_(!0)}finally{U(!1)}console.log("🔄 بدء تحميل بيانات المستخدم من Firebase...",{userId:t==null?void 0:t.uid});const j=localStorage.getItem(o);let A=!1;if(j)try{const w=JSON.parse(j),B=new Date(w.lastUpdated);(new Date().getTime()-B.getTime())/(1e3*60)<1&&(A=!0,console.log("⚡ توجد تغييرات محلية حديثة (أقل من دقيقة)، تجنب إعادة التحميل من Firebase"),w.walletBalances&&Be(w.walletBalances),w.cashBalance!==void 0&&Ge(w.cashBalance))}catch(w){console.error("خطأ في قراءة البيانات المحلية:",w)}if(j&&!A)try{const w=JSON.parse(j),B=new Date(w.lastUpdated);(new Date().getTime()-B.getTime())/(1e3*60)>10&&(console.log("🗑️ حذف البيانات المحلية القديمة (أكثر من 10 دقائق)"),localStorage.removeItem(o))}catch(w){console.error("خطأ في حذف البيانات المحلية القديمة:",w)}if(!A&&(t!=null&&t.uid)){const w=await je.getUserData(t.uid);if(console.log("📥 البيانات المحملة من Firebase:",w),w){if(w.walletBalances!==void 0&&Object.keys(ve).length===0)console.log("👛 تحميل أرصدة المحافظ:",w.walletBalances),Be(w.walletBalances),localStorage.setItem(Re(),JSON.stringify(w.walletBalances));else{const B=localStorage.getItem(Re());if(B)try{const F=JSON.parse(B);console.log("📱 استعادة أرصدة المحافظ من localStorage:",F),Be(F),t!=null&&t.uid?await je.updateUserData(t.uid,{walletBalances:F,lastUpdated:new Date().toISOString()}):xe(!0)}catch(F){console.error("خطأ في قراءة أرصدة المحافظ من localStorage:",F);const S={"wallet-1":1e4,"wallet-2":5e3};Be(S),localStorage.setItem(Re(),JSON.stringify(S)),t!=null&&t.uid?await je.updateUserData(t.uid,{walletBalances:S,lastUpdated:new Date().toISOString()}):xe(!0)}else{console.log("⚠️ لا توجد أرصدة محافظ في Firebase أو localStorage، إنشاء أرصدة افتراضية");const F={"wallet-1":1e4,"wallet-2":5e3};Be(F),localStorage.setItem(Re(),JSON.stringify(F)),t!=null&&t.uid?await je.updateUserData(t.uid,{walletBalances:F,lastUpdated:new Date().toISOString()}):xe(!0)}}w.cashBalance!==void 0&&Ee===0?(console.log("💰 تحميل رصيد الدرج النقدي:",w.cashBalance),Ge(w.cashBalance),localStorage.setItem(Ve(),w.cashBalance.toString())):(console.log("⚠️ لا يوجد رصيد درج نقدي، استخدام القيمة الافتراضية: 0"),Ge(0),localStorage.setItem(Ve(),"0"));try{const B=await Aa.getDeletedTransactions();if(B&&B.length>0)cs(B),console.log("🗑️ تم تحميل المعاملات المحذوفة من Firebase:",B.length);else{const F=localStorage.getItem(qs());if(F)try{const S=JSON.parse(F);cs(S),console.log("🗑️ تم تحميل المعاملات المحذوفة من localStorage:",S.length)}catch(S){console.error("خطأ في قراءة المعاملات المحذوفة من localStorage:",S)}}}catch(B){console.error("خطأ في تحميل المعاملات المحذوفة من Firebase:",B);const F=localStorage.getItem(qs());if(F)try{const S=JSON.parse(F);cs(S),console.log("🗑️ تم تحميل المعاملات المحذوفة من localStorage (fallback):",S.length)}catch(S){console.error("خطأ في قراءة المعاملات المحذوفة من localStorage:",S)}}}else{console.log("⚠️ لا توجد بيانات مستخدم في Firebase، محاولة استعادة من localStorage");const B=localStorage.getItem(Re());if(B)try{const S=JSON.parse(B);console.log("📱 استعادة أرصدة المحافظ من localStorage:",S),Be(S)}catch(S){console.error("خطأ في قراءة أرصدة المحافظ من localStorage:",S)}let F=localStorage.getItem(Ve());if(!F&&(t!=null&&t.uid)){const S=`userCashBalance_${t.uid}`,q=localStorage.getItem(S);if(q){F=q;try{localStorage.setItem(Ve(),q),localStorage.removeItem(S)}catch{}}}F&&(Ge(parseFloat(F)),console.log("💰 استعادة رصيد الدرج النقدي من localStorage:",F));try{const S=await Aa.getDeletedTransactions();if(S&&S.length>0)cs(S),console.log("🗑️ تم تحميل المعاملات المحذوفة من Firebase:",S.length);else{const q=localStorage.getItem(qs());if(q)try{const Ce=JSON.parse(q);cs(Ce),console.log("🗑️ تم تحميل المعاملات المحذوفة من localStorage:",Ce.length)}catch(Ce){console.error("خطأ في قراءة المعاملات المحذوفة من localStorage:",Ce)}}}catch(S){console.error("خطأ في تحميل المعاملات المحذوفة من Firebase:",S);const q=localStorage.getItem(qs());if(q)try{const Ce=JSON.parse(q);cs(Ce),console.log("🗑️ تم تحميل المعاملات المحذوفة من localStorage (fallback):",Ce.length)}catch(Ce){console.error("خطأ في قراءة المعاملات المحذوفة من localStorage:",Ce)}}}}console.log("🔄 بدء تحميل المحافظ من Firebase...");try{const w=await ss.getByMerchantId((t==null?void 0:t.uid)||"");if(w&&w.length>0){console.log("✅ تم العثور على محافظ في Firebase:",w.length);const B=w.map(q=>({id:q.id,name:q.label||"محفظة بدون اسم",phone:q.msisdn,isDefault:!1,monthlyWithdrawalLimit:q.monthlyWithdrawalLimit??q.withdrawLimit??2e5,monthlyTransferLimit:q.monthlyTransferLimit??q.transferLimit??2e5,defaultTransferCommission:q.defaultTransferCommission!=null?Number(q.defaultTransferCommission):null,defaultWithdrawCommission:q.defaultWithdrawCommission!=null?Number(q.defaultWithdrawCommission):null}));zt(B),localStorage.setItem(hs(),JSON.stringify(B));const F=localStorage.getItem(xs());let S=null;F&&B.find(q=>q.id===F)?S=B.find(q=>q.id===F):S=B[0],S&&(wt(S.id),Pe(S.phone)),console.log("🔄 تم تحديث المحافظ من Firebase وحفظها في localStorage")}else{console.log("⚠️ لا توجد محافظ في Firebase، محاولة التحميل من localStorage...");const B=Nr();if(B&&B.length>0)try{console.log("📱 تم العثور على محافظ محلية بعد الهجرة:",B.length),zt(B);const F=wr(B)||localStorage.getItem(xs());let S=null;F&&B.find(q=>q.id===F)?S=B.find(q=>q.id===F):S=B.find(q=>q.isDefault)||B[0],S&&(wt(S.id),Pe(S.phone))}catch(F){console.error("خطأ في معالجة المحافظ بعد الهجرة:",F)}else{console.log("⚠️ لا توجد محافظ محلية، إنشاء محافظ افتراضية...");const F=[{id:"wallet-1",name:"المحفظة الرئيسية",phone:"01030302038",isDefault:!0,monthlyWithdrawalLimit:2e5,monthlyTransferLimit:2e5},{id:"wallet-2",name:"محفظة احتياطية",phone:"01234567890",isDefault:!1,monthlyWithdrawalLimit:2e5,monthlyTransferLimit:2e5}];zt(F),localStorage.setItem(hs(),JSON.stringify(F))}}}catch(w){console.error("خطأ في تحميل المحافظ من Firebase:",w);const B=Nr();if(B&&B.length>0)try{console.log("📱 استخدام المحافظ من localStorage بعد الهجرة:",B.length),zt(B);const F=wr(B)||localStorage.getItem(xs());let S=null;F&&B.find(q=>q.id===F)?S=B.find(q=>q.id===F):S=B.find(q=>q.isDefault)||B[0],S&&(wt(S.id),Pe(S.phone))}catch(F){console.error("خطأ في قراءة المحافظ من localStorage بعد الهجرة:",F),zt([{id:"wallet-1",name:"المحفظة الرئيسية",phone:"01030302038",isDefault:!0,monthlyWithdrawalLimit:2e5,monthlyTransferLimit:2e5}])}else console.log("⚠️ لا توجد محافظ محلية، إنشاء محفظة افتراضية..."),zt([{id:"wallet-1",name:"المحفظة الرئيسية",phone:"01030302038",isDefault:!0,monthlyWithdrawalLimit:2e5,monthlyTransferLimit:2e5}])}const N=t!=null&&t.uid?await je.getUserTransactions(t.uid):[];if(N&&N.length>0){console.log("📊 تم تحميل المعاملات من Firebase:",N.length);const w=N.map(S=>({...S,createdAt:new Date(S.createdAt),senderPhone:S.senderMsisdn||S.senderPhone||"",receiverPhone:S.receiverMsisdn||S.receiverPhone||"",type:S.txnType==="send"?"send":S.txnType==="receive"?"withdraw":S.type||"withdraw",status:S.status==="confirmed"?"completed":S.status||"completed"})),B=tl.map(S=>S.id||S.originalTransactionId),F=w.filter(S=>!B.includes(S.id));console.log("✅ تم فلترة المعاملات المحذوفة:",{total:N.length,deleted:B.length,active:F.length}),nt(F)}await Bl()}catch(n){console.error("خطأ في تحميل بيانات المستخدم من Firebase:",n);let o=localStorage.getItem(Ve());if(!o&&(t!=null&&t.uid)){const g=`userCashBalance_${t.uid}`,j=localStorage.getItem(g);if(j){o=j;try{localStorage.setItem(Ve(),j),localStorage.removeItem(g)}catch{}}}o&&Ge(parseFloat(o));const x=localStorage.getItem(Re());if(x)try{const g=JSON.parse(x);Be(g),console.log("📱 تم استعادة أرصدة المحافظ من localStorage:",g)}catch(g){console.error("خطأ في قراءة أرصدة المحافظ من localStorage:",g)}}})().then(async()=>{await r(),await a()});const r=async()=>{try{for(const n of ye)await zo.autoResetLimitsIfNeeded(n.phone)}catch(n){console.error("خطأ في التصفير التلقائي للحدود:",n)}},a=async()=>{try{const n=Lt.getReportsData(t==null?void 0:t.uid);if((n.lastDailyResetDate?Lt.shouldResetDailyReports(n.lastDailyResetDate):!1)&&(t!=null&&t.uid)&&n.lastDailyResetDate){const g=new Date(n.lastDailyResetDate),j=g.toDateString();let A=De.filter(Xe=>new Date(Xe.createdAt).toDateString()===j&&Xe.status==="completed");const N=Lt.filterVisibleTransactions(A,"daily",t==null?void 0:t.uid),w=N.length,B=N.reduce((Xe,le)=>Xe+le.amount,0),F=N.filter(Hs).reduce((Xe,le)=>{const Me=le.withdrawnAmount!==void 0?le.withdrawnAmount:le.amount;return Xe+Me},0),S=N.filter(Gs).reduce((Xe,le)=>{const Me=le.sentAmount!==void 0?le.sentAmount:le.amount;return Xe+Me},0),q=N.reduce((Xe,le)=>Xe+Lt.calculateTransactionProfit(le),0),Ce=new Date(g).toISOString().slice(0,10);await on.add({userId:t.uid,reportDate:Ce,totalTransactions:w,totalAmount:Number(B.toFixed(2)),totalWithdrawn:Number(F.toFixed(2)),totalSent:Number(S.toFixed(2)),profit:Number(q.toFixed(2)),walletId:null}),i({title:"تم أرشفة تقارير اليوم",description:Ce})}const x=Lt.autoResetReportsIfNeeded(t==null?void 0:t.uid);(x.dailyReset||x.monthlyReset)&&console.log("تم التصفير التلقائي:",x)}catch(n){console.error("خطأ في التصفير التلقائي للتقارير:",n)}};bi(),vi(),Wi(),console.log("🔥 useEffect loadUserData completed")},[t==null?void 0:t.uid]);const Ca=async()=>{var s;if(t!=null&&t.uid)try{const r=await ss.getByMerchantId(t.uid);if(r&&r.length>0){const a=r.map(n=>({id:n.id,name:n.label||"محفظة بدون اسم",phone:n.msisdn,isDefault:!1,monthlyWithdrawalLimit:n.monthlyWithdrawalLimit??n.withdrawLimit??2e5,monthlyTransferLimit:n.monthlyTransferLimit??n.transferLimit??2e5,defaultTransferCommission:n.defaultTransferCommission!=null?Number(n.defaultTransferCommission):void 0,defaultWithdrawCommission:n.defaultWithdrawCommission!=null?Number(n.defaultWithdrawCommission):void 0}));if(zt(a),localStorage.setItem(hs(),JSON.stringify(a)),t!=null&&t.uid){const n=localStorage.getItem(xs());if(!!(R&&a.find(x=>x.id===R)))console.log("🔒 Preserving current wallet selection:",R);else{const g=(n&&a.find(j=>j.id===n)?n:null)||((s=a[0])==null?void 0:s.id);g&&(console.log("🔄 Fixing invalid wallet selection:",g),Ys(g))}}console.log("🔄 تم تحديث المحافظ من Firebase:",a.length)}}catch(r){console.error("خطأ في تحميل المحافظ من Firebase:",r)}};l.useEffect(()=>{const s=u.pathname;sessionStorage.getItem("previousPath")==="/user/add-wallet"&&s==="/user/dashboard"&&(console.log("🔄 Returning from add wallet page - reloading wallets"),console.log("🔒 Current wallet before add-wallet return reload:",R),Ca(),sessionStorage.removeItem("previousPath")),sessionStorage.setItem("previousPath",s)},[u.pathname,t==null?void 0:t.uid]),l.useEffect(()=>{const s=()=>{console.log("🔄 Window focused - reloading wallets"),console.log("🔒 Current wallet before focus reload:",R),Ca().then(()=>{console.log("🔒 Wallet preserved after focus reload:",R)})};return window.addEventListener("focus",s),()=>{window.removeEventListener("focus",s)}},[t==null?void 0:t.uid,R,ye]);const Ys=(s,r="unknown")=>{console.log(`🎯 setWalletSelection called from ${r} with walletId:`,s),console.log("🔍 Previous selectedWallet:",R),wt(s);const a=ye.find(n=>n.id===s);a&&(Pe(a.phone),console.log("✅ Wallet set successfully:",s,"Phone:",a.phone)),t!=null&&t.uid&&(localStorage.setItem(xs(),s),console.log("💾 Saved wallet to localStorage:",s))},qi=s=>{if(s==="__add_wallet"){T("/user/add-wallet");return}if(s==="__view_wallets"){$s(!0);return}Ys(s,"handleWalletChange")},Rl=s=>{console.log("🔄 handleTransactionTypeChange called with type:",s),console.log("🔍 Current selectedWallet before change:",R),console.log("🔍 Available wallets count:",ye.length),He(s),lt(""),ft(""),_s(""),Ss(""),console.log("✅ Transaction type changed to:",s,"- Wallet selection preserved:",R),setTimeout(()=>{const r=document.getElementById("transaction-section");r&&r.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},Yi=s=>{Yn((a=>({id:a.id,type:a.type==="send"?"transfer":"withdraw",sender_msisdn:a.senderPhone,receiver_msisdn:a.receiverPhone,amount:a.amount,commission:a.commission||0,status:a.status==="failed"?"failed":a.status==="completed"?"completed":"pending",createdAt:new Date(a.createdAt).toISOString(),updatedAt:new Date(a.createdAt).toISOString(),shopName:h??(m==null?void 0:m.shopName)??(t==null?void 0:t.displayName)??"المحل",cashierName:(a==null?void 0:a.cashierName)??null,commissionMode:(a==null?void 0:a.commissionMode)??(b?"add":"deduct"),totalCharged:(a==null?void 0:a.totalCharged)??(b?Number(a.amount||0)+Number(a.commission||0):Number(a.amount||0))}))(s)),ia(!0)},Hi=async s=>{if(!(t!=null&&t.uid)){i({title:"خطأ في المصادقة",description:"يجب تسجيل الدخول أولاً لحذف المعاملات",variant:"destructive"});return}const r=De.find(a=>a.id===s);if(!r){i({title:"خطأ في الحذف",description:"لم يتم العثور على المعاملة المطلوب حذفها",variant:"destructive"});return}try{console.log("🗑️ بدء عملية حذف المعاملة:",s),console.log("🔄 حذف المعاملة نهائياً من Firebase...",{transactionId:r.id,userId:t.uid,transactionData:r}),await je.removeUserTransaction(t.uid,r.id),console.log("✅ تم حذف المعاملة نهائياً من Firebase userTransactions");try{await Aa.saveDeletedTransaction({...r,userId:t.uid,originalTransactionId:r.id,deletedAt:new Date().toISOString()}),console.log("✅ تم حفظ المعاملة في سجل المحذوفات مع تاريخ الحذف")}catch(o){console.warn("⚠️ فشل في حفظ المعاملة في سجل المحذوفات، لكن الحذف من Firebase نجح:",o)}const a=[...tl,r],n=De.filter(o=>o.id!==s);cs(a),nt(n),Zr(!1),localStorage.setItem(qs(),JSON.stringify(a)),localStorage.setItem(Vs(),JSON.stringify(n)),console.log("✅ تم تحديث البيانات المحلية بنجاح بعد الحذف من Firebase");try{let o=localStorage.getItem(Ve());if(!o&&(t!=null&&t.uid)){const A=`userCashBalance_${t.uid}`,N=localStorage.getItem(A);if(N){o=N;try{localStorage.setItem(Ve(),N),localStorage.removeItem(A)}catch{}}}const x=localStorage.getItem(Re());let g=o?parseFloat(o):0,j=x?JSON.parse(x):{};if(r.type==="send"){const A=r.commission||0;g-=A;const N=r.fromWallet||Object.keys(j)[0];if(N){const w=j[N]||0;j[N]=w+r.amount}}else if(r.type==="withdraw"){const A=r.commission||0;g+=r.amount,g-=A;const N=r.fromWallet||Object.keys(j)[0];if(N){const w=j[N]||0;j[N]=Math.max(0,w-r.amount)}}localStorage.setItem(Ve(),g.toString()),localStorage.setItem(Re(),JSON.stringify(j))}catch(o){console.warn("فشل عكس تأثير الأرصدة محليًا بعد الحذف:",o)}try{const o=r.fromWallet;if(o){const{walletDailyLimitsService:x}=await es(async()=>{const{walletDailyLimitsService:j}=await import("./walletDailyLimitsService-O4QsIztL.js");return{walletDailyLimitsService:j}},__vite__mapDeps([2,0,1])),g=await x.getWalletLimits(o);if(g){const j=r.type==="send",A={updatedAt:(await es(async()=>{const{serverTimestamp:S}=await import("./index-uPMs_SiV.js").then(q=>q.a_);return{serverTimestamp:S}},__vite__mapDeps([0,1]))).serverTimestamp()};j?(A.dailyTransferUsed=Math.max(0,(g.dailyTransferUsed||0)-r.amount),A.monthlyTransferUsed=Math.max(0,(g.monthlyTransferUsed||0)-r.amount)):(A.dailyWithdrawUsed=Math.max(0,(g.dailyWithdrawUsed||0)-r.amount),A.monthlyWithdrawUsed=Math.max(0,(g.monthlyWithdrawUsed||0)-r.amount));const{doc:N,setDoc:w}=await es(async()=>{const{doc:S,setDoc:q}=await import("./index-uPMs_SiV.js").then(Ce=>Ce.a_);return{doc:S,setDoc:q}},__vite__mapDeps([0,1])),{db:B}=await es(async()=>{const{db:S}=await import("./index-uPMs_SiV.js").then(q=>q.a$);return{db:S}},__vite__mapDeps([0,1])),F=N(B,"walletLimits",o);await w(F,A,{merge:!0})}}}catch(o){console.warn("فشل استرجاع حدود المحفظة بعد الحذف:",o)}try{const{ProfitService:o}=await es(async()=>{const{ProfitService:N}=await import("./profitService-CoFuE1nE.js");return{ProfitService:N}},__vite__mapDeps([3,4,5])),{ReportsService:x}=await es(async()=>{const{ReportsService:N}=await import("./reportsService-Bp1Io21u.js");return{ReportsService:N}},[]),j={txnType:r.type==="send"?"send":"receive",amount:r.amount,commission:r.commission||0,createdAt:r.createdAt,status:"confirmed"},A=o.calculateProfitFromTransaction(j);A>0&&o.addProfit(-A,t.uid);try{x.removeTransactionEffects(r,t.uid)}catch{}}catch(o){console.warn("فشل تحديث الأرباح/التقارير بعد الحذف:",o)}i({title:"تم حذف المعاملة نهائياً",description:"تم حذف المعاملة نهائياً من النظام. يمكنك العثور عليها في قائمة المحذوفات"})}catch(a){console.error("❌ خطأ في حذف المعاملة من Firebase:",a);let n="فشل في حذف المعاملة من الخادم. يرجى المحاولة مرة أخرى";a instanceof Error&&(a.message.includes("network")||a.message.includes("offline")?n="مشكلة في الاتصال بالإنترنت. تحقق من الاتصال وحاول مرة أخرى":a.message.includes("permission")||a.message.includes("unauthorized")?n="ليس لديك صلاحية لحذف هذه المعاملة":a.message.includes("not-found")&&(n="المعاملة غير موجودة أو تم حذفها مسبقاً")),i({title:"خطأ في الحذف",description:n,variant:"destructive"})}},Hs=s=>{const r=s.type,a=s.txnType;return r==="withdraw"||r==="withdrawal"||r==="receive"||a==="receive"},Gs=s=>{const r=s.type,a=s.txnType;return r==="send"||r==="transfer"||a==="send"},Ia=(s,r)=>{const a=new Date().toDateString();let n=De.filter(N=>new Date(N.createdAt).toDateString()===a&&N.status==="completed");Zt&&Zt.trim()!==""&&(n=n.filter(N=>N.senderPhone&&N.senderPhone.includes(Zt)||N.receiverPhone&&N.receiverPhone.includes(Zt)));const o=Lt.filterVisibleTransactions(n,"daily",t==null?void 0:t.uid),x=o.length,g=o.reduce((N,w)=>N+w.amount,0),j=o.filter(Hs).reduce((N,w)=>{const B=w.withdrawnAmount!==void 0?w.withdrawnAmount:w.amount;return N+B},0),A=o.filter(Gs).reduce((N,w)=>{const B=w.sentAmount!==void 0?w.sentAmount:w.amount;return N+B},0);return{totalTransactions:x,totalAmount:g,totalWithdrawn:j,totalSent:A}},Qs=s=>{const r=new Date().getMonth(),a=new Date().getFullYear();let n=De.filter(N=>{const w=new Date(N.createdAt);return w.getMonth()===r&&w.getFullYear()===a&&N.status==="completed"});Zt&&Zt.trim()!==""&&(n=n.filter(N=>N.senderPhone&&N.senderPhone.includes(Zt)||N.receiverPhone&&N.receiverPhone.includes(Zt)));const o=Lt.filterVisibleTransactions(n,"monthly",t==null?void 0:t.uid),x=o.length,g=o.reduce((N,w)=>N+w.amount,0),j=o.filter(Hs).reduce((N,w)=>{const B=w.withdrawnAmount!==void 0?w.withdrawnAmount:w.amount;return N+B},0),A=o.filter(Gs).reduce((N,w)=>{const B=w.sentAmount!==void 0?w.sentAmount:w.amount;return N+B},0);return{totalTransactions:x,totalAmount:g,totalWithdrawn:j,totalSent:A}},Ul=s=>{const r=new Date().getMonth(),a=new Date().getFullYear(),n=De.filter(g=>{const j=new Date(g.createdAt);return j.getMonth()===r&&j.getFullYear()===a&&g.status==="completed"&&g.fromWallet===s}),o=n.filter(Hs).reduce((g,j)=>{const A=j.withdrawnAmount||j.amount;return g+A},0),x=n.filter(Gs).reduce((g,j)=>{const A=j.sentAmount||j.amount;return g+A},0);return{totalWithdrawn:o,totalTransferred:x}},Gi=s=>{const r=new Date,a=r.getDate(),n=r.getMonth(),o=r.getFullYear(),x=De.filter(A=>{const N=new Date(A.createdAt);return N.getDate()===a&&N.getMonth()===n&&N.getFullYear()===o&&A.status==="completed"&&A.fromWallet===s}),g=x.filter(Hs).reduce((A,N)=>{const w=N.withdrawnAmount||N.amount;return A+w},0),j=x.filter(Gs).reduce((A,N)=>{const w=N.sentAmount||N.amount;return A+w},0);return{totalWithdrawn:g,totalTransferred:j}};Qs(),l.useEffect(()=>{const s=localStorage.getItem(Vs());if(s){const a=JSON.parse(s).map(n=>({...n,createdAt:new Date(n.createdAt)}));nt(a)}},[]),l.useEffect(()=>{De.length>0&&localStorage.setItem(Vs(),JSON.stringify(De))},[De]);const zl=async()=>{Ec(),console.log("🔄 بدء عملية التحويل/السحب"),console.log("📊 البيانات المدخلة:",{senderPhone:ue,receiverPhone:dt,amount:Ye,transactionType:Q});const s=()=>{Q==="transfer"?Ds(!0):Us(!0)},r=()=>{Q==="transfer"?Ds(!1):Us(!1)};if(s(),!ue||!Ye){console.log("❌ خطأ: بيانات ناقصة"),i({title:"خطأ في البيانات",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"}),r();return}if(Q==="transfer"&&!dt&&!y){console.log("❌ خطأ: رقم المستقبل مفقود"),i({title:"خطأ في البيانات",description:"يرجى إدخال رقم المستقبل",variant:"destructive"}),r();return}const a=parseFloat(Ye);if(console.log("💰 المبلغ المحول:",a),a<=0){console.log("❌ خطأ: مبلغ غير صحيح"),i({title:"خطأ في المبلغ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"}),r();return}if(st)try{const le=new Date,Me=le.getFullYear(),At=String(le.getMonth()+1).padStart(2,"0"),at=String(le.getDate()).padStart(2,"0"),Kt=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${Me}-${At}-${at}`,Bt=localStorage.getItem(Kt);if((Bt&&parseInt(Bt,10)||0)>=10){i({title:"حد التأكيد اليومي",description:"باقة زيرو تسمح بـ 10 تأكيدات تحويل/سحب يومياً فقط.",variant:"destructive"}),r();return}}catch(le){console.warn("فشل قراءة عداد تأكيدات باقة زيرو من التخزين المحلي:",le)}const n=ye.find(le=>le.id===R);if(!n){i({title:"خطأ في المحفظة",description:"يرجى اختيار محفظة صحيحة",variant:"destructive"}),r();return}const o=Ul(R);if(console.log("📈 فحص الحدود الشهرية للمحفظة المختارة"),console.log("📊 الإحصائيات الشهرية للمحفظة:",{walletId:R,walletName:n.name,currentWithdrawn:o.totalWithdrawn,currentTransferred:o.totalTransferred,withdrawalLimit:n.monthlyWithdrawalLimit,transferLimit:n.monthlyTransferLimit}),Q==="withdraw"){if(console.log("🏧 فحص حد السحب الشهري للمحفظة"),console.log(`💸 المسحوب حالياً من المحفظة: ${o.totalWithdrawn}, المبلغ الجديد: ${a}, الحد الأقصى: ${n.monthlyWithdrawalLimit}`),o.totalWithdrawn+a>n.monthlyWithdrawalLimit){console.log("❌ تجاوز حد السحب الشهري للمحفظة"),i({title:"تجاوز حد السحب الشهري",description:`لا يمكن سحب أكثر من ${n.monthlyWithdrawalLimit} جنيه شهرياً من محفظة ${n.name}`,variant:"destructive"}),r();return}}else if(console.log("💸 فحص حد التحويل الشهري للمحفظة"),console.log(`📤 المحول حالياً من المحفظة: ${o.totalTransferred}, المبلغ الجديد: ${a}, الحد الأقصى: ${n.monthlyTransferLimit}`),o.totalTransferred+a>n.monthlyTransferLimit){console.log("❌ تجاوز حد التحويل الشهري للمحفظة"),i({title:"تجاوز حد التحويل الشهري",description:`لا يمكن تحويل أكثر من ${n.monthlyTransferLimit} جنيه شهرياً من محفظة ${n.name}`,variant:"destructive"}),r();return}const x=(m==null?void 0:m.shopName)||(t==null?void 0:t.displayName)||"محل كاشي لينك",g={id:Date.now().toString(),type:Q==="transfer"?"send":Q==="deposit"?"deposit":"withdraw",senderPhone:ue,receiverPhone:Q==="transfer"?dt:ue,amount:a,status:"completed",createdAt:new Date,withdrawnAmount:Q==="withdraw"?a:void 0,sentAmount:Q==="transfer"?a:void 0,depositedAmount:void 0,fromWallet:R,senderNumber:ue,senderName:ue,shopName:(n==null?void 0:n.name)||"المحفظة الرئيسية",transferredAmount:Q==="transfer"?a:void 0,receiverNumber:Q==="transfer"?dt:void 0,withdrawnAmountDetailed:Q==="withdraw"?a:void 0,depositedAmountDetailed:void 0,merchantShopName:x,transactionReference:`TXN-${Date.now()}`,commission:0,notes:Q==="transfer"?`تحويل من ${ue} إلى ${dt}`:`سحب نقدي من محفظة ${ue}`};E&&(f!=null&&f.name||f!=null&&f.username)&&(g.cashierName=(f==null?void 0:f.name)||(f==null?void 0:f.username));const j=Bs.validateTransaction(a,Q,Ee,ve);if(!j.isValid){i({title:"خطأ في العملية",description:j.error,variant:"destructive"}),r();return}j.warning&&i({title:"تحذير",description:j.warning,variant:"destructive"});let A;if(Q==="transfer")if((n==null?void 0:n.defaultTransferCommission)!=null){const le=Number(n.defaultTransferCommission)||0;A=Math.round(le*a/1e3*100)/100}else ht&&ht.trim()!==""?A=Math.max(0,parseFloat(ht)):A=0;else if((n==null?void 0:n.defaultWithdrawCommission)!=null){const le=Number(n.defaultWithdrawCommission)||0;A=Math.round(le*a/1e3*100)/100}else mt&&mt.trim()!==""?A=Math.max(0,parseFloat(mt)):A=Math.round(a*.01*100)/100;if(g.commission=A,!b&&A>=a){i({title:"خطأ في العمولة",description:"العمولة أكبر من أو تساوي المبلغ المدخل",variant:"destructive"}),r();return}const N=b?a:Math.round((a-A)*100)/100;g.amount=N,g.withdrawnAmount=Q==="withdraw"?N:void 0,g.sentAmount=Q==="transfer"?N:void 0,g.transferredAmount=Q==="transfer"?N:void 0,g.withdrawnAmountDetailed=Q==="withdraw"?N:void 0;let w;const B=Q==="transfer"&&!!Nt,F=Q==="withdraw"&&!!Nt,S=B||F;let q=null;if(S)if(B){const le=Bs.validateTransaction(N,"transfer",Ee,ve);le.isValid?w={success:!0,newCashBalance:Ee,newWalletBalances:ve}:w={success:!1,newCashBalance:Ee,newWalletBalances:ve,message:le.error||"رصيد غير كافٍ للتحويل المؤجل",error:"INSUFFICIENT_WALLET_BALANCE"}}else w={success:!0,newCashBalance:Ee,newWalletBalances:ve};else Q==="transfer"?w=await Bs.processTransfer({amount:N,currentCashBalance:Ee,currentWalletBalances:ve,wallets:ye,selectedWalletId:R,skipRemoteLimitsCheck:!0,nonBlockingUsageUpdate:!0}):w=await Bs.processWithdraw({amount:N,currentCashBalance:Ee,currentWalletBalances:ve,wallets:ye,selectedWalletId:R,skipRemoteLimitsCheck:!0,nonBlockingUsageUpdate:!0});if(!w.success){i({title:"فشل في العملية",description:w.error||w.message,variant:"destructive"}),r();return}let Ce=S?Ee:w.newCashBalance,Xe=S?ve:w.newWalletBalances;if(S&&F){const le=ye.find(at=>at.id===R)??ye.find(at=>at.isDefault)??ye[0],Me=(le==null?void 0:le.id)||R;if(Me!==R)try{Ys(Me)}catch{}const At=Number(ve[Me]||0);Xe={...ve,[Me]:Math.round((At+Number(N))*100)/100};try{const at=`walletEffectsAppliedOnCreation_${(t==null?void 0:t.uid)||"default"}`,Kt=localStorage.getItem(at),Bt=Kt?JSON.parse(Kt):[];g!=null&&g.id&&!Bt.includes(g.id)&&(Bt.push(g.id),localStorage.setItem(at,JSON.stringify(Bt)))}catch{}}if(S&&B){const le=ye.find(at=>at.id===R)??ye.find(at=>at.isDefault)??ye[0],Me=(le==null?void 0:le.id)||R;if(Me!==R)try{Ys(Me)}catch{}const At=Number(ve[Me]||0);Xe={...ve,[Me]:Math.round((At-Number(N))*100)/100}}if((B||F)&&Nt&&!Ka){const le={id:`DEBT-${Date.now()}`,debtorName:Nt.debtorName,amount:Nt.amount,reason:Nt.notes||"",customerId:Nt.customerId,mobile:Nt.mobile,status:"pending",createdAt:new Date};q=le.id;const Me=[le,...St];Et(Me);try{await Xt(Me)}catch(At){console.error("⚠️ فشل حفظ الدين المؤجل محلياً:",At)}i({title:"تم إضافة الدين",description:"أضيف إلى إيصالات الديون حتى يتم السداد",variant:"default"})}if(A>0&&!S&&(Ce+=A,console.log(`💰 تم إضافة عمولة ${A} جنيه لدرج النقدية`)),console.log("⚡ تحديث الواجهة فوراً..."),Ge(Ce),Be(Xe),S&&(g.status="pending"),nt(le=>[g,...le]),st)try{const le=new Date,Me=le.getFullYear(),At=String(le.getMonth()+1).padStart(2,"0"),at=String(le.getDate()).padStart(2,"0"),Kt=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${Me}-${At}-${at}`,Bt=localStorage.getItem(Kt),Ta=Bt&&parseInt(Bt,10)||0;localStorage.setItem(Kt,String(Ta+1))}catch{}localStorage.setItem(Ve(),Ce.toString()),localStorage.setItem(Re(),JSON.stringify(Xe)),(async()=>{try{console.log("🔄 بدء حفظ المعاملة في Firebase في الخلفية...");const le={shopId:"default-shop",lineId:R||"default-line",merchantUserId:(t==null?void 0:t.uid)||null,provider:"vodafone_cash",txnType:Q==="transfer"?"send":"receive",amount:N,commission:A,profit:0,senderMsisdn:ue,receiverMsisdn:Q==="transfer"?dt:ue,note:Q==="transfer"?`تحويل من ${ue} إلى ${dt}`:`سحب ${N} جنيه من ${(n==null?void 0:n.name)||"المحفظة الرئيسية"}`,status:S?"pending":"confirmed",linkedDebtId:q||void 0,createdBy:(t==null?void 0:t.uid)||null,walletEffectAppliedOnCreation:!!(S&&F)},Me={...le,status:S?"pending":"completed",commissionMode:b?"add":"deduct",totalCharged:b?N+A:N,walletEffectAppliedOnCreation:!!(S&&F)},{ProfitService:At}=await es(async()=>{const{ProfitService:Ta}=await import("./profitService-CoFuE1nE.js");return{ProfitService:Ta}},__vite__mapDeps([3,4,5])),at=At.calculateProfitFromTransaction(Me);at>0&&(At.addProfit(at,t==null?void 0:t.uid),console.log("✅ تم إضافة الربح:",at,"جنيه")),await Promise.all([...t!=null&&t.uid?[je.updateUserData(t.uid,{cashBalance:Ce,walletBalances:Xe,lastUpdated:new Date().toISOString()})]:[],Ua.create(le),...t!=null&&t.uid?[je.saveUserTransaction(t.uid,{...Me,transactionType:Q,fromWallet:R,toWallet:Q==="transfer"?B?null:"cash":null,cashierName:E&&((f==null?void 0:f.name)||(f==null?void 0:f.username))||"الحساب الرئيسي",linkedDebtId:q||void 0,description:`${Q==="transfer"?"تحويل":"سحب"} ${N} من ${R} ${Q==="transfer"?B?"":"إلى الدرج النقدي":""} — عمولة: ${A} (${b?"مضافة":"مخصومة"})${S?" — دين مؤجل (قيد المراجعة)":""}`})]:[]]),console.log("✅ تم حفظ جميع البيانات في Firebase بنجاح");const Kt=`userData_${t==null?void 0:t.uid}`,Bt={cashBalance:Ce,walletBalances:Xe,lastUpdated:new Date().toISOString()};localStorage.setItem(Kt,JSON.stringify(Bt))}catch(le){console.error("❌ خطأ في حفظ المعاملة في Firebase (في الخلفية):",le),i({title:"تحذير",description:"تم تنفيذ العملية محلياً، لكن فشلت المزامنة مع الخادم. ستتم المحاولة مرة أخرى تلقائياً.",variant:"destructive"})}})(),Q==="transfer"?(Ds(!0),setTimeout(()=>{Ds(!1)},2e3)):(Us(!0),setTimeout(()=>{Us(!1)},2e3)),lt(""),ft(""),ns(null),bs(""),Ft(""),ws(""),is(!1)},Br=it.useMemo(()=>new Intl.DateTimeFormat("ar-EG"),[]),Qi=it.useMemo(()=>new Intl.DateTimeFormat("ar-EG",{hour:"2-digit",minute:"2-digit"}),[]),Zi=it.useMemo(()=>{try{return St.reduce((s,r)=>{const a=Number(r.paidAmount||0)+(Array.isArray(r.partialPayments)?r.partialPayments.reduce((o,x)=>o+Number(x.amount||0),0):0),n=Math.max(0,Number(r.amount||0)-a);return s+n},0)}catch{return 0}},[St]),Jl=it.useMemo(()=>Ll().filter(r=>_e==="all"?!0:_e==="send"?r.type==="send":_e==="receive"?r.type==="receive":_e==="withdraw"?r.type==="withdraw":_e!=="deleted"),[Ll,_e]),Xi=()=>{if(Ya==="daily"){const s=Lt.resetReportsManually("daily",De,t==null?void 0:t.uid);Rs(!1),i({title:"تم تصفير المعاملات اليومية",description:`تم إخفاء ${s.length} معاملة من تقارير اليوم (الحدود لم تتأثر)`})}else{const s=Lt.resetReportsManually("monthly",De,t==null?void 0:t.uid);Rs(!1),i({title:"تم تصفير المعاملات الشهرية",description:`تم إخفاء ${s.length} معاملة من تقارير الشهر (الحدود لم تتأثر)`})}},eo=()=>Ya==="daily"?"تصفير المعاملات اليومية":"تصفير المعاملات الشهرية",to=()=>Ya==="daily"?"أدخل كلمة مرور تسجيل الدخول لتصفير جميع معاملات اليوم":"أدخل كلمة مرور تسجيل الدخول لتصفير جميع معاملات الشهر",so=s=>{Tl(s),fr(!0)},ao=s=>{Ge(s),localStorage.setItem(Ve(),s.toString()),jl(!1),i({title:"تم تحديث الرصيد النقدي",description:`تم تحديث الرصيد النقدي إلى ${s} جنيه`})},ro=async s=>{var g;if(!yt){console.warn("لا يوجد معرف محفظة محدد لتعديل الرصيد");return}const r={...ve,[yt]:s};Be(r);const a=new Date().toISOString(),n={walletBalances:r,lastUpdated:a},o=`userData_${t==null?void 0:t.uid}`;try{localStorage.setItem(o,JSON.stringify(n)),localStorage.setItem(Re(),JSON.stringify(r)),localStorage.setItem(`walletBalances_backup_${a}`,JSON.stringify(r))}catch{}try{t!=null&&t.uid&&await je.updateUserData(t.uid,n)}catch(j){console.error("خطأ أثناء حفظ رصيد المحفظة في Firebase:",j)}bl(!1);const x=((g=ye.find(j=>j.id===yt))==null?void 0:g.name)||"المحفظة";i({title:"تم تحديث رصيد المحفظة",description:`تم تحديث رصيد ${x} إلى ${s.toLocaleString()} جنيه`})},lo=async s=>{var r;if(console.log("💰 بدء تحديث رصيد المحفظة"),console.log("📊 معرف المحفظة المحررة:",yt),console.log("💵 المبلغ المضاف/المخصوم:",s),yt){const a=ve[yt]||0;console.log("💰 الرصيد الحالي:",a);const n=a+s;console.log("💰 الرصيد الجديد:",n);const o={...ve,[yt]:n};console.log("📊 الأرصدة المحدثة:",o),Be(o);const x=new Date().toISOString(),g={walletBalances:o,lastUpdated:x},j=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(j,JSON.stringify(g)),localStorage.setItem(Re(),JSON.stringify(o)),localStorage.setItem(`walletBalances_backup_${x}`,JSON.stringify(o));try{if(t!=null&&t.uid){console.log("🔄 حفظ البيانات في Firebase...");try{await je.updateUserData(t.uid,g),console.log("✅ تم حفظ الأرصدة في Firebase بنجاح"),setTimeout(()=>{localStorage.removeItem(j),console.log("🧹 تم حذف النسخة المحلية المؤقتة بعد دقيقة واحدة")},6e4)}catch(B){console.error("❌ فشل في حفظ البيانات في Firebase:",B),xe(!0)}}else console.log("⚠️ المستخدم غير مسجل دخول، حفظ في localStorage"),localStorage.setItem(Re(),JSON.stringify(o));const A=((r=ye.find(B=>B.id===yt))==null?void 0:r.name)||"المحفظة",N=s>0?"إضافة":"خصم",w=Math.abs(s);i({title:`تم ${N} مبلغ ${N==="إضافة"?"إلى":"من"} رصيد المحفظة`,description:`تم ${N} ${w} جنيه ${N==="إضافة"?"إلى":"من"} رصيد ${A}. الرصيد الجديد: ${n.toLocaleString()} جنيه`})}catch(A){if(console.error("❌ فشل في حفظ البيانات في Firebase:",A),localStorage.setItem(Re(),JSON.stringify(o)),t!=null&&t.uid){const N=`userData_${t.uid}`,w={walletBalances:o,lastUpdated:new Date().toISOString()};localStorage.setItem(N,JSON.stringify(w)),xe(!0)}i({title:"تم حفظ البيانات محلياً",description:"تم حفظ التغييرات محلياً وسيتم مزامنتها مع الخادم لاحقاً",variant:"default"})}}else console.log("❌ لا يوجد معرف محفظة للتحرير");setTimeout(()=>{const n=Object.keys(localStorage).filter(o=>o.startsWith("walletBalances_backup_")).sort();n.length>5&&n.slice(0,n.length-5).forEach(x=>{localStorage.removeItem(x),console.log("🗑️ حذف النسخة الاحتياطية القديمة:",x)})},5e3),fr(!1),Tl("")};return console.log("🔥 UserDashboardPage - Render conditions:",{isCheckingActivation:C,isUserActive:V,showActivationModal:p}),!C&&!V?(console.log("🔥 UserDashboardPage - Showing activation modal"),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsx(Zl,{isOpen:!0,onClose:()=>{}})})):C?(console.log("🔥 UserDashboardPage - Showing loading screen"),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-bounce",style:{animationDelay:"300ms"}})]})})})):(console.log("🔥 UserDashboardPage - Rendering main dashboard"),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/20 px-2 sm:px-4 py-2 sm:py-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-10 sm:top-20 left-2 sm:left-10 w-32 sm:w-72 h-32 sm:h-72 bg-blue-400/8 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-10 sm:bottom-20 right-2 sm:right-10 w-40 sm:w-96 h-40 sm:h-96 bg-purple-400/8 rounded-full blur-3xl",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-36 sm:w-80 h-36 sm:h-80 bg-indigo-400/5 rounded-full blur-3xl",style:{animationDelay:"4s"}})]}),e.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-6 relative z-10",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up",children:[!zs&&e.jsxs(Ue,{className:"bg-gradient-to-br from-purple-50 via-purple-25 to-white border border-purple-200/60 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/5 to-purple-600/3 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"absolute top-0 right-0 w-20 sm:w-32 h-20 sm:h-32 bg-gradient-to-br from-purple-300/15 to-transparent rounded-full -translate-y-8 sm:-translate-y-16 translate-x-8 sm:translate-x-16 group-hover:scale-110 transition-transform duration-300"}),e.jsx(ct,{className:"pb-2 sm:pb-1 lg:pb-1 px-3 sm:px-3 lg:px-2 pt-3 sm:pt-2 lg:pt-1 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(jt,{className:"text-xs font-bold text-purple-800 flex items-center gap-1.5 sm:gap-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2.5 sm:w-2 h-2.5 sm:h-2 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full shadow-sm"}),e.jsx("div",{className:"absolute inset-0 w-2.5 sm:w-2 h-2.5 sm:h-2 bg-purple-400 rounded-full opacity-60 animate-pulse"})]}),e.jsx("span",{className:"text-xs",children:"الشهر"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1",children:[e.jsx("div",{className:"hidden"}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{Xr("monthly"),Rs(!0)},className:"h-7 w-7 sm:h-6 sm:w-6 p-0 bg-gradient-to-r from-purple-100 to-purple-200 text-purple-700 hover:from-purple-200 hover:to-purple-300 hover:text-purple-800 rounded-lg sm:rounded-md transition-all duration-300 hover:scale-105 shadow-sm hover:shadow-md",title:"تصفير معاملات الشهر",children:e.jsx(Ct,{className:"h-3 w-3 sm:h-2.5 sm:w-2.5"})}),e.jsx("div",{className:"p-1.5 sm:p-1 bg-gradient-to-r from-purple-100 to-purple-200 rounded-lg sm:rounded-md",children:e.jsx(Xs,{className:"h-3 w-3 sm:h-2.5 sm:w-2.5 text-purple-600"})})]})]})}),!zs&&e.jsxs(qe,{className:"space-y-0.5 sm:space-y-1 lg:space-y-0 pt-0 px-2 sm:px-3 lg:px-2 pb-1.5 sm:pb-2 lg:pb-1 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-purple-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-purple-700",children:"عدد المعاملات:"}),e.jsx("span",{className:"font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm",children:Qs().totalTransactions})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-purple-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-purple-700",children:"إجمالي المبالغ:"}),e.jsx("span",{className:"font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm",children:Qs().totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-purple-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-purple-700",children:"المسحوب:"}),e.jsx("span",{className:"font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm",children:Qs().totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-purple-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-purple-700",children:"المرسل:"}),e.jsx("span",{className:"font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm",children:Qs().totalSent.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-purple-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-purple-700",children:"الأرباح:"}),e.jsx(Cc,{userId:t==null?void 0:t.uid,transactions:De})]})]}),ni&&e.jsx("div",{className:"absolute inset-0 z-20 bg-yellow-100/60 backdrop-blur-sm rounded-xl border border-yellow-300/70 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(c,{size:"sm",variant:"ghost",onClick:async()=>{if(st){i({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}da(!0)},className:"px-2.5 py-1 rounded-full bg-gradient-to-r from-yellow-300 to-yellow-400 text-black hover:from-yellow-400 hover:to-yellow-500 shadow-md flex items-center gap-1 text-[11px] font-semibold",title:"عرض تقارير الشهر (يتطلب الرقم السري)",children:[e.jsx("span",{children:"عرض تقارير الشهر"}),e.jsx(et,{className:"h-2.5 w-2.5"})]})})]}),e.jsx(ra,{open:oi,onOpenChange:da,mode:"verify",title:"الرقم السري لفتح تقارير الشهر",description:"لا يمكن الاطلاع على إحصائيات الشهر إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{if(st){i({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}),da(!1),ol(!0);return}ol(!1),da(!1)},userId:t==null?void 0:t.uid}),e.jsxs(Ue,{className:"bg-gradient-to-br from-blue-50 via-blue-25 to-white border border-blue-200/60 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-blue-600/3 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"absolute top-0 right-0 w-20 sm:w-32 h-20 sm:h-32 bg-gradient-to-br from-blue-300/15 to-transparent rounded-full -translate-y-8 sm:-translate-y-16 translate-x-8 sm:translate-x-16 group-hover:scale-110 transition-transform duration-300"}),e.jsx(ct,{className:"pb-2 sm:pb-3 lg:pb-1 px-3 sm:px-4 lg:px-2 pt-3 sm:pt-4 lg:pt-1 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(jt,{className:"text-sm sm:text-base font-bold text-blue-800 flex items-center gap-1.5 sm:gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2.5 sm:w-3 h-2.5 sm:h-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm"}),e.jsx("div",{className:"absolute inset-0 w-2.5 sm:w-3 h-2.5 sm:h-3 bg-blue-400 rounded-full opacity-60 animate-pulse"})]}),e.jsx("span",{className:"text-xs sm:text-sm",children:"اليوم"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{Xr("daily"),Rs(!0)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 rounded-lg transition-all duration-300 hover:scale-105 shadow-sm hover:shadow-md",title:"تصفير معاملات اليوم",children:e.jsx(Ct,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5"})}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>Ha(!0),className:"h-7 w-7 sm:h-8 sm:w-8 p-0 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 rounded-lg transition-all duration-300 hover:scale-105 shadow-sm hover:shadow-md",title:"أرشيف التقارير اليومية",children:e.jsx(Ho,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5"})}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>ii(s=>!s),className:"h-7 w-7 sm:h-8 sm:w-8 p-0 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 rounded-lg transition-all duration-300 hover:scale-105 shadow-sm hover:shadow-md",title:zs?"توسيع اليوم والشهر":"طي اليوم والشهر",children:zs?e.jsx(Hr,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5"}):e.jsx(dn,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5"})}),e.jsx("div",{className:"p-1.5 sm:p-2 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg",children:e.jsx(Xs,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-blue-600"})})]})]})}),!zs&&e.jsxs(qe,{className:"space-y-0 pt-0 px-2 pb-1 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-blue-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-blue-700",children:"عدد المعاملات:"}),e.jsx("span",{className:"font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm",children:Ia().totalTransactions})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-blue-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-blue-700",children:"إجمالي المبالغ:"}),e.jsx("span",{className:"font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm",children:Ia().totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-blue-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-blue-700",children:"المسحوب:"}),e.jsx("span",{className:"font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm",children:Ia().totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-blue-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-blue-700",children:"المرسل:"}),e.jsx("span",{className:"font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm",children:Ia().totalSent.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-white/70 to-blue-50/70 rounded-sm sm:rounded-lg hover:from-white/90 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60",children:[e.jsx("span",{className:"text-xs font-semibold text-blue-700",children:"الأرباح:"}),e.jsx(Ac,{userId:t==null?void 0:t.uid})]})]})]})]}),e.jsxs(Ue,{className:"bg-white border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx(qe,{className:"p-3 relative z-10",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-emerald-50 border-2 border-emerald-200/50 p-1 rounded-xl shadow-lg hover:shadow-md transition-all duration-200 group/cash relative overflow-hidden ",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 rounded-lg shadow-sm",children:e.jsx(Qe,{className:"h-1.5 w-1.5 text-emerald-600"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-emerald-800",children:"الفلوس النقدية"}),e.jsxs("span",{className:"text-[10px] font-extrabold text-emerald-700 bg-gradient-to-r from-emerald-100 to-emerald-200 px-1 py-0.5 rounded-lg shadow-sm",children:[Ee.toLocaleString("en-US")," جنيه"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-gradient-to-r from-green-100 to-green-200 text-green-700 hover:from-green-200 hover:to-green-300 hover:text-green-800 rounded-xl transition-all duration-300 hover:scale-110 shadow-md hover:shadow-lg",onClick:()=>ja(!0),children:e.jsx(ut,{className:"h-2 w-2"})}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 rounded-xl transition-all duration-300  hover:rotate-12 shadow-md hover:shadow-lg",onClick:()=>Da(!0),children:e.jsx(Ct,{className:"h-2 w-2"})})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200/50 p-1 rounded-xl shadow-lg hover:shadow-md transition-all duration-200 group/wallet relative overflow-hidden ",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg shadow-sm",children:e.jsx($t,{className:"h-1.5 w-1.5 text-blue-600"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-800",children:"الأرصدة علي المحافظ"}),e.jsxs("span",{className:"text-[10px] font-extrabold text-blue-700 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-lg shadow-sm",children:[Object.values(ve).reduce((s,r)=>s+r,0).toLocaleString("en-US")," جنيه"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-gradient-to-r from-green-100 to-green-200 text-green-700 hover:from-green-200 hover:to-green-300 hover:text-green-800 rounded-xl transition-all duration-300 hover:scale-110 shadow-md hover:shadow-lg",onClick:()=>Na(!0),title:"إضافة أموال لإجمالي المحفظة",children:e.jsx(ut,{className:"h-2 w-2"})}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 rounded-xl transition-all duration-300  hover:rotate-12 shadow-md hover:shadow-lg",onClick:()=>{wa(!0),Sa("")},title:"تصفير إجمالي المحفظة",children:e.jsx(Ct,{className:"h-2 w-2"})})]})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1 bg-indigo-50 border-2 border-indigo-200/50 p-1 rounded-xl shadow-lg hover:shadow-md transition-all duration-200 group/selwallet relative overflow-hidden ",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 rounded-lg shadow-sm",children:e.jsx($t,{className:"h-1.5 w-1.5 text-indigo-600"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-indigo-800",children:"رصيد المحفظه"}),e.jsxs("span",{className:"text-[10px] font-extrabold text-indigo-700 bg-gradient-to-r from-indigo-100 to-indigo-200 px-1 py-0.5 rounded-lg shadow-sm",children:[(R&&ve[R]||0).toLocaleString("en-US")," جنيه"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-gradient-to-r from-green-100 to-green-200 text-green-700 hover:from-green-200 hover:to-green-300 hover:text-green-800 rounded-xl transition-all duration-300 hover:scale-110 shadow-md hover:shadow-lg",onClick:()=>{if(!R){i({title:"اختر محفظة",description:"يرجى اختيار محفظة من اختيار المحافظ بالأعلى أولاً",variant:"destructive"});return}so(R)},title:"إضافة/خصم إلى رصيد المحفظة المختارة",children:e.jsx(ut,{className:"h-2 w-2"})}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 rounded-xl transition-all duration-300  hover:rotate-12 shadow-md hover:shadow-lg",onClick:()=>{if(!R){i({title:"اختر محفظة",description:"يرجى اختيار محفظة لتصفير رصيدها فقط",variant:"destructive"});return}pa(!0)},title:"تصفير رصيد المحفظة المختارة",children:e.jsx(Ct,{className:"h-2 w-2"})})]})]})]})]})})]}),e.jsxs(Ue,{className:"bg-gradient-to-br from-gray-50 via-white to-slate-50 border border-gray-200/60 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 group relative overflow-hidden fade-in-up",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-500/5 to-slate-600/3 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs(ct,{className:"pb-2 px-4 pt-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(jt,{className:"text-sm font-bold flex items-center gap-2 text-gray-800",children:[!v&&e.jsx("div",{className:"p-1.5 sm:p-2 bg-gradient-to-r from-gray-100 to-slate-200 rounded-lg",children:e.jsx(Xs,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-600"})}),e.jsx("span",{className:"bg-gradient-to-r from-gray-600 to-slate-600 bg-clip-text text-transparent",children:"المعاملات الأخيرة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!v&&e.jsxs("div",{className:"flex items-center gap-0.5 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[e.jsx(Bo,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),e.jsx(L,{placeholder:"بحث...",value:sl,onChange:s=>ei(s.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),!v&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"حاسبة"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>il(!0),title:"آلة حاسبة",children:e.jsx(pn,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"كروت"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{st?i({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Za(!0)},title:"كروت الائتمان",children:e.jsx(Ra,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"الوردية"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105",onClick:Fi,title:E&&(f!=null&&f.name||f!=null&&f.username)?`بروفيل الوردية: ${(f==null?void 0:f.name)||(f==null?void 0:f.username)}`:"وردية الكاشير",children:e.jsx(Kr,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"المبيعات"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{st?i({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Qa(!0)},title:"بيانات المبيعات",children:e.jsx($o,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600",children:"الديون"}),St.filter(s=>s.status==="pending").length>0&&e.jsx("span",{className:"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white",children:St.filter(s=>s.status==="pending").length})]}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{st?i({title:"غير متاح",description:"إدارة الديون/الأجل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):ha(!0)},title:"الديون",children:e.jsx(bo,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-amber-700 mb-1",children:"الصيانة"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{st?i({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Xa(!0)},title:"الصيانة",children:e.jsx(No,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-yellow-500 mb-1",children:"المكنة"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-violet-50 text-violet-700 hover:bg-violet-100 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{us?er(!0):i({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"})},title:"يومية المكنة",children:e.jsx(yn,{className:"h-5 w-5 text-yellow-500"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 mb-1",children:"مصروفات"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{st?i({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):as.hasMasterPin()?J(!0):$(!0)},title:"مصروفات المحل",children:e.jsx(Ba,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-rose-600 mb-1",children:"النواقص"}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-rose-50 text-rose-600 hover:bg-rose-100 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105",onClick:()=>he(!0),title:"النواقص",children:e.jsx(wo,{className:"h-5 w-5"})})]})]})]})]}),!v&&e.jsx("div",{className:"mt-2 w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 bg-gray-50 rounded-md p-3 border border-gray-200",children:[e.jsx(c,{variant:"ghost",size:"sm",className:`h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${_e==="send"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-50"}`,onClick:()=>os("send"),title:"تصفية التحويل",children:"التحويل"}),e.jsx(c,{variant:"ghost",size:"sm",className:`h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${_e==="withdraw"?"bg-red-600 text-white border-red-600":"text-red-700 border-red-300 hover:bg-red-50"}`,onClick:()=>os("withdraw"),title:"تصفية السحب",children:"السحب"}),e.jsx(c,{variant:"ghost",size:"sm",className:`h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${_e==="all"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-50"}`,onClick:()=>os("all"),title:"عرض الكل",children:"الكل"}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs(c,{variant:"ghost",size:"sm",className:"h-8 px-3 text-[12px] rounded-full border bg-red-50 text-red-700 border-red-300 hover:bg-red-100",onClick:()=>yr(!0),title:"تصفير المعاملات الأخيرة",children:[e.jsx(Ct,{className:"h-3.5 w-3.5 mr-1"}),"تصفير"]}),(t==null?void 0:t.uid)&&localStorage.getItem(`recentTransactionsResetAt:${t.uid}`)&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"})]})]})})]}),e.jsx(qe,{className:"space-y-2 pt-0 px-4 pb-4 relative z-10",children:Jl.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Xs,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"لا توجد معاملات حتى الآن"})]}):e.jsx("div",{className:"max-h-[210px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors",children:e.jsx("div",{className:"space-y-2 pr-2",children:Jl.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-white/70 to-gray-50/70 rounded-lg hover:from-white/90 hover:to-gray-50/90 transition-all duration-300 border border-gray-100/60 cursor-pointer hover:shadow-sm",onClick:()=>Yi(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="completed"&&e.jsx(La,{className:"h-4 w-4 text-green-500"}),s.status==="pending"&&e.jsx(fs,{className:"h-4 w-4 text-yellow-500"}),s.status==="failed"&&e.jsx(Gr,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("div",{children:[(()=>{const r=(s==null?void 0:s.type)==="report"||((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية");return e.jsx("p",{className:"font-medium text-sm text-gray-800",children:r?"إيصال تسليم وردية":(s.type==="send"?"تحويل":"سحب")+` - ${s.amount.toLocaleString()} جنيه`})})(),e.jsxs("p",{className:"text-[10px] text-gray-700",children:["تمت بواسطة: ",(s==null?void 0:s.cashierName)??"الحساب الرئيسي"]}),(()=>{const r=(s==null?void 0:s.type)==="report"||((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية");return e.jsx("p",{className:"text-xs text-gray-500",children:r?`تم التسليم إلى: ${s.receiverPhone}`:`من ${s.senderPhone}${s.type==="send"?` إلى ${s.receiverPhone}`:""}`})})(),e.jsxs("p",{className:"text-xs text-gray-400",children:[Br.format(s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt))," - ",Qi.format(s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt))]})]})]}),e.jsx(rt,{variant:s.status==="completed"?"default":s.status==="pending"?"secondary":"destructive",className:"text-xs",children:s.status==="completed"?"مكتمل":s.status==="pending"?"قيد المعالجة":"فشل"})]},s.id))})})})]})]}),e.jsx(_o,{isOpen:Vn,onClose:()=>ia(!1),transaction:qn,onPrint:()=>window.print(),onDelete:Zn,onComplete:Xn}),e.jsxs("div",{className:"space-y-1 fade-in-right w-full lg:w-5/6 mx-auto",children:[e.jsxs(Ue,{id:"transaction-section",className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/50 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  "}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  ",style:{animationDelay:"1s"}}),e.jsx(ct,{className:"pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(jt,{className:"text-sm font-bold flex items-center gap-2 text-gray-800",children:[e.jsxs("div",{className:"relative",children:[e.jsx(La,{className:"h-1 w-1 text-emerald-500 "}),e.jsx("div",{className:"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 "})]}),e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"إجراء معاملة جديدة"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[pt&&e.jsx("div",{className:"hidden md:flex items-center gap-1 bg-gradient-to-r from-emerald-50 to-green-50 hover:from-emerald-100 hover:to-green-100 border border-emerald-200 text-emerald-800 text-sm transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm",children:e.jsxs("span",{className:"text-sm font-semibold whitespace-nowrap",children:["تجربة: ",X," ",X>=3&&X<=10?"ساعات":X===2?"ساعتين":"ساعة"]})}),e.jsx("div",{className:"hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm",children:e.jsx(Ko,{})})]}),Ki&&e.jsxs(c,{variant:"outline",size:"sm",className:"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation",onClick:Bl,title:"مزامنة البيانات المحفوظة محلياً مع الخادم",children:[e.jsx(Vo,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap",children:"مزامنة"})]})]})}),e.jsxs(qe,{className:"space-y-1 px-2 pb-2 relative z-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0.5 p-0.5 bg-gradient-to-r from-gray-50 to-slate-50 rounded-xl border border-gray-200/50 fade-in-up w-full lg:w-5/6 mx-auto ",children:[e.jsxs(c,{variant:Q==="transfer"?"default":"ghost",onClick:()=>Rl("transfer"),className:`text-xs font-semibold transition-all duration-300 hover:scale-105 h-7 rounded-lg px-2 ${Q==="transfer"?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg hover:shadow-md hover:from-blue-600 hover:to-indigo-700":"text-gray-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-blue-700 hover:border-blue-200"}`,children:[e.jsx(Xs,{className:"h-1 w-1 mr-1"}),"تحويل"]}),e.jsxs(c,{variant:Q==="withdraw"?"default":"ghost",onClick:()=>Rl("withdraw"),className:`text-xs font-semibold transition-all duration-300 hover:scale-105 h-7 rounded-lg px-2 ${Q==="withdraw"?"bg-gradient-to-r from-emerald-500 to-green-600 text-white shadow-lg hover:shadow-md hover:from-emerald-600 hover:to-green-700":"text-gray-600 hover:bg-gradient-to-r hover:from-emerald-50 hover:to-green-50 hover:text-emerald-700 hover:border-emerald-200"}`,children:[e.jsx($a,{className:"h-1 w-1 mr-1"}),"سحب"]})]}),ye.length>0&&e.jsxs("div",{className:"fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 block flex items-center gap-2",children:[e.jsx($t,{className:"h-1 w-1 text-blue-600"}),"اختيار المحفظة"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(c,{variant:"ghost",size:"sm",className:"h-6 rounded-md px-2 text-[10px] bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border border-emerald-200",onClick:()=>T("/user/add-wallet"),title:"إضافة محفظة",children:[e.jsx(ut,{className:"h-3 w-3 mr-1"}),"إضافة محفظة"]}),e.jsxs(c,{variant:"ghost",size:"sm",className:"h-6 rounded-md px-2 text-[10px] bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200",onClick:()=>$s(!0),title:"المحافظ",children:[e.jsx($t,{className:"h-3 w-3 mr-1"}),"المحافظ"]})]})]}),e.jsxs(Ts,{value:R,onValueChange:qi,children:[e.jsx(As,{"data-testid":"wallet-select",className:"w-full h-12 text-sm bg-gradient-to-r from-white to-gray-50 border-2 border-gray-200 hover:border-blue-400 focus:border-blue-500 rounded-xl transition-all duration-300 hover:shadow-md focus:shadow-lg",children:e.jsx(ks,{placeholder:"اختر محفظة للمعاملة",className:"text-gray-600"})}),e.jsx(Ps,{className:"rounded-xl border-2 border-gray-200 shadow-md max-h-[220px] overflow-y-auto z-50 ",children:e.jsx("div",{className:"max-h-[180px] overflow-y-auto pr-1",children:ye.map(s=>e.jsx(Os,{value:s.id,className:"rounded-lg hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center gap-1 py-1 w-full justify-between",children:[e.jsx("div",{className:"p-1 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-lg",children:e.jsx($t,{className:"h-1 w-1 text-blue-600"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-800",children:s.name}),e.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",s.phone,")"]})]}),s.isDefault&&e.jsx(rt,{variant:"secondary",className:"text-[10px] bg-gradient-to-r from-emerald-100 to-green-100 text-emerald-700 border-emerald-200",children:"افتراضي"})]}),e.jsx("div",{className:"ml-auto flex flex-col items-end gap-1"})]})},s.id))})})]})]}),e.jsx(oe,{open:Va,onOpenChange:$s,children:e.jsxs(ce,{className:"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsx(me,{children:"عرض المحافظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(Jo,{showAddButton:!1,showUsageBars:!1,showLimitCards:!1,showEditButton:!0})})]})}),R&&ye.length>0&&(()=>{const s=ye.find(Xe=>Xe.id===R),r=Ul(R),a=Gi(R),n=(Fe==null?void 0:Fe.monthlyWithdrawLimit)??(s==null?void 0:s.monthlyWithdrawalLimit)??2e5,o=(Fe==null?void 0:Fe.monthlyTransferLimit)??(s==null?void 0:s.monthlyTransferLimit)??2e5,x=r.totalWithdrawn??(Fe==null?void 0:Fe.monthlyWithdrawUsed)??0,g=r.totalTransferred??(Fe==null?void 0:Fe.monthlyTransferUsed)??0,j=(Fe==null?void 0:Fe.dailyWithdrawLimit)??1e5,A=(Fe==null?void 0:Fe.dailyTransferLimit)??6e4,N=a.totalWithdrawn??(Fe==null?void 0:Fe.dailyWithdrawUsed)??0,w=a.totalTransferred??(Fe==null?void 0:Fe.dailyTransferUsed)??0,B=parseFloat(Ye||"0")||0,F=x+(Q==="withdraw"?B:0),S=g+(Q==="transfer"?B:0),q=N+(Q==="withdraw"?B:0),Ce=w+(Q==="transfer"?B:0);return s?e.jsxs("div",{className:"fade-in-up mb-2 space-y-2",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-1 rounded-md border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"text-[10px] text-gray-600 font-medium mb-1 text-center",children:["الحدود الشهرية: ",s.name]}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(F/Math.max(n,1)*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(S/Math.max(o,1)*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[e.jsxs("div",{className:"text-[10px] text-red-600 font-medium",children:["متبقي سحب: ",Math.max(n-F,0).toLocaleString("en-US")," جنيه"]}),e.jsxs("div",{className:"text-[10px] text-blue-600 font-medium",children:["متبقي تحويل: ",Math.max(o-S,0).toLocaleString("en-US")," جنيه"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-1 rounded-md border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"text-[10px] text-gray-600 font-medium mb-1 text-center",children:["الحدود اليومية: ",s.name]}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-orange-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(q/Math.max(j,1)*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-green-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(Ce/Math.max(A,1)*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[e.jsxs("div",{className:"text-[10px] text-orange-600 font-medium",children:["متبقي سحب يومي: ",Math.max(j-q,0).toLocaleString("en-US")," جنيه"]}),e.jsxs("div",{className:"text-[10px] text-green-600 font-medium",children:["متبقي تحويل يومي: ",Math.max(A-Ce,0).toLocaleString("en-US")," جنيه"]})]})]})]}):null})(),Q==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"رقم المرسل"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(L,{value:ue,onChange:s=>Pe(s.target.value),onKeyDown:s=>{if(s.key==="Enter"){const r=document.getElementById("receiverPhoneInput");if(r)r.focus();else{const a=document.getElementById("amountInput");a==null||a.focus()}}},placeholder:"01030302038",className:"pl-10 h-10 text-sm transition-all duration-300 hover:border-blue-400 focus:border-blue-500"})]})]}),!y&&e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(L,{id:"receiverPhoneInput",value:dt,onChange:s=>{lt(s.target.value),Ga&&Ds(!1)},onKeyDown:s=>{if(s.key==="Enter"){const r=document.getElementById("amountInput");r==null||r.focus()}},placeholder:"أدخل رقم المستقبل",className:"pl-10 h-10 text-sm transition-all duration-300 hover:border-blue-400 focus:border-blue-500"})]})]})]}):e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(L,{value:R&&((Kl=ye.find(s=>s.id===R))==null?void 0:Kl.phone)||"",readOnly:!0,placeholder:"اختر محفظة أولاً",className:"pl-10 h-10 text-sm bg-gray-50 transition-all duration-300"})]})]}),Q==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"المبلغ (جنيه)"}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(L,{id:"amountInput",value:Ye,onChange:s=>{ft(s.target.value),Ga&&Ds(!1)},onKeyDown:s=>{if(s.key==="Enter"){const r=document.getElementById("transferCommissionInput");if(r)r.focus();else{const a=document.getElementById("quickDebtButton");a==null||a.focus()}}},placeholder:"أدخل المبلغ",type:"number",className:"pl-10 h-10 text-sm transition-all duration-300 hover:border-blue-400 focus:border-blue-500"})]}),Nt?e.jsxs("div",{className:"mt-2 text-xs text-green-700 bg-green-50 border border-green-200 rounded px-2 py-1 flex items-center gap-2",children:[e.jsxs("span",{children:["تم إدخال تفاصيل الأجل لـ ",Nt.debtorName," بمبلغ ",Nt.amount," جنيه"]}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>ns(null),children:"إلغاء"})]}):null]}),(()=>{if(y)return null;const s=Qt();return s&&s.defaultTransferCommission!=null?e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["سيتم تطبيق عمولة التحويل الافتراضية لكل ألف: ",s==null?void 0:s.defaultTransferCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(c,{id:"quickDebtButton",type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>{const a=Qt(),n=(a==null?void 0:a.defaultTransferCommission)!=null?Number(a.defaultTransferCommission):0,o=parseFloat(Ye||"0")||0,x=Math.round((n||0)*o/1e3*100)/100,g=b?o+x:o;Ft((g||0).toString()),st?i({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Tt(!0)},children:"أجل"}),e.jsx(c,{type:"button",variant:"outline",size:"icon",title:b?"العمولة تُضاف":"العمولة تُخصم",onClick:()=>ie(a=>!a),children:b?e.jsx(ut,{className:"h-4 w-4 text-green-600"}):e.jsx(gs,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:b?"العمولة تُضاف":"العمولة تُخصم"})]})]}):e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل على العملية (جنيه)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-orange-500"}),e.jsx(L,{id:"transferCommissionInput",value:ht,onChange:a=>Ss(a.target.value),placeholder:"أدخل عمولة التحويل",type:"number",className:"pl-10 h-10 text-sm transition-all duration-300 hover:border-blue-400 focus:border-blue-500"})]}),e.jsx(c,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>{const a=Qt(),n=parseFloat(Ye||"0")||0;let o=0;if((a==null?void 0:a.defaultTransferCommission)!=null){const g=Number(a.defaultTransferCommission)||0;o=Math.round(g*n/1e3*100)/100}else{const g=ht&&ht.trim()!==""?parseFloat(ht):0;o=Math.max(0,g)}const x=b?n+o:n;Ft((x||0).toString()),st?i({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Tt(!0)},children:"أجل"}),e.jsx(c,{type:"button",variant:"outline",size:"icon",title:b?"العمولة تُضاف":"العمولة تُخصم",onClick:()=>ie(a=>!a),children:b?e.jsx(ut,{className:"h-4 w-4 text-green-600"}):e.jsx(gs,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:b?"العمولة تُضاف":"العمولة تُخصم"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"يمكنك إدخال عمولة العملية الإجمالية (اختياري)"})]})})(),e.jsx(c,{onClick:zl,className:"w-full font-medium h-10 text-sm btn-bounce hover-glow transition-all duration-300 bg-blue-600 hover:bg-blue-700 text-white",children:Ga?"تم التحويل بنجاح":"تأكيد التحويل"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"مبلغ السحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx($a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-green-500"}),e.jsx(L,{id:"amountInput",value:Ye,onChange:s=>{ft(s.target.value),nl&&Us(!1)},onKeyDown:s=>{if(s.key==="Enter"){const r=document.getElementById("manualWithdrawCommissionInput");if(r)r.focus();else{const a=document.getElementById("withdrawSubmitButton");a==null||a.focus()}}},placeholder:"أدخل مبلغ السحب",type:"number",className:"pl-10 h-10 text-sm transition-all duration-300 hover:border-blue-400 focus:border-blue-500"})]})]}),(()=>{const s=Qt();return s&&s.defaultWithdrawCommission!=null?e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة السحب (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["سيتم تطبيق عمولة السحب الافتراضية لكل ألف: ",s==null?void 0:s.defaultWithdrawCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(c,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>{const a=Qt(),n=parseFloat(Ye||"0")||0,o=(a==null?void 0:a.defaultWithdrawCommission)!=null&&Number(a.defaultWithdrawCommission)||0,x=Math.round(o*n/1e3*100)/100,g=b?n+x:n;Ft((g||0).toString()),st?i({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Tt(!0)},children:"أجل"}),e.jsx(c,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>ie(a=>!a),title:b?"العمولة تُضاف إلى الدين":"العمولة تُخصم من الدين",children:b?e.jsx(ut,{className:"h-4 w-4"}):e.jsx(gs,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-gray-600",children:b?"العمولة تُضاف":"العمولة تُخصم"})]})]}):e.jsxs("div",{className:"fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة السحب على العملية (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-orange-500"}),e.jsx(L,{id:"manualWithdrawCommissionInput",value:mt,onChange:a=>_s(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const n=document.getElementById("withdrawSubmitButton");n==null||n.focus()}},placeholder:"أدخل العمولة المطلوبة",type:"number",className:"pl-10 h-10 text-sm transition-all duration-300 hover:border-blue-400 focus:border-blue-500"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"أدخل العمولة الإجمالية لإتمام عملية السحب"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(c,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>{const a=Qt(),n=parseFloat(Ye||"0")||0;let o=0;if((a==null?void 0:a.defaultWithdrawCommission)!=null){const g=Number(a.defaultWithdrawCommission)||0;o=Math.round(g*n/1e3*100)/100}else{const g=mt&&mt.trim()!==""?parseFloat(mt):Math.round(n*.01*100)/100;o=Math.max(0,g)}const x=b?n+o:n;Ft((x||0).toString()),st?i({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Tt(!0)},children:"أجل"}),e.jsx(c,{type:"button",variant:"outline",size:"icon",title:b?"العمولة تُضاف":"العمولة تُخصم",onClick:()=>ie(a=>!a),children:b?e.jsx(ut,{className:"h-4 w-4 text-green-600"}):e.jsx(gs,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:b?"العمولة تُضاف":"العمولة تُخصم"})]})]})})(),e.jsx(c,{id:"withdrawSubmitButton",onClick:zl,className:"w-full font-medium h-10 text-sm btn-bounce hover-glow transition-all duration-300 bg-green-600 hover:bg-green-700 text-white",children:nl?"تم السحب بنجاح":"تأكيد السحب"})]}),e.jsx(oe,{open:Ut,onOpenChange:Tt,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:"تحويل مؤجل"}),e.jsx(Vt,{children:"أدخل بيانات صاحب الدين والمبلغ والملاحظات ثم اضغط حفظ"})]}),e.jsxs("div",{className:"space-y-3",children:[Jt&&Jt.length>0?e.jsxs("div",{children:[e.jsx(Y,{children:"اختيار عميل"}),e.jsxs(Ts,{value:Ze,onValueChange:s=>{Ja(s);const r=Jt.find(a=>a.id===s);r&&bs(r.name)},children:[e.jsx(As,{className:"w-full",children:e.jsx(ks,{placeholder:"اختر عميل"})}),e.jsx(Ps,{children:Jt.map(s=>e.jsxs(Os,{value:s.id,children:[s.name,s.mobile?` — ${s.mobile}`:""]},s.id))})]})]}):e.jsx("div",{className:"text-xs text-gray-500",children:"لا يوجد عملاء مُسجلين حالياً. يمكنك إضافة عميل من نافذة الديون."}),e.jsxs("div",{children:[e.jsx(Y,{htmlFor:"quickDebtName",children:"اسم صاحب الدين"}),e.jsx(L,{id:"quickDebtName",value:Wt,onChange:s=>bs(s.target.value),placeholder:"اكتب الاسم"})]}),e.jsxs("div",{children:[e.jsx(Y,{htmlFor:"quickDebtAmount",children:"المبلغ (محسوب تلقائياً)"}),e.jsx(L,{id:"quickDebtAmount",type:"number",value:la,readOnly:!0,placeholder:"المبلغ + عمولة التحويل"})]}),e.jsxs("div",{children:[e.jsx(Y,{htmlFor:"quickDebtNotes",children:"ملاحظات"}),e.jsx(L,{id:"quickDebtNotes",value:Ns,onChange:s=>ws(s.target.value),placeholder:"اكتب ملاحظات (اختياري)"})]})]}),e.jsx(Se,{children:e.jsx(c,{type:"button",onClick:()=>{const s=Qt(),r=parseFloat((Ye||"").toString())||0;let a=0;if(Q==="transfer")if((s==null?void 0:s.defaultTransferCommission)!=null){const x=Number(s.defaultTransferCommission)||0;a=Math.round(x*r/1e3*100)/100}else{const x=ht&&ht.trim()!==""?parseFloat(ht):0;a=Math.max(0,x)}else if((s==null?void 0:s.defaultWithdrawCommission)!=null){const x=Number(s.defaultWithdrawCommission)||0;a=Math.round(x*r/1e3*100)/100}else{const x=mt&&mt.trim()!==""?parseFloat(mt):Math.round(r*.01*100)/100;a=Math.max(0,x)}let n=0;if(Q==="withdraw"?n=b?r:Math.max(0,Math.round((r-a)*100)/100):n=b?r+a:r,!Wt||isNaN(n)||n<=0){i({title:"خطأ في بيانات الأجل",description:"يرجى إدخال الاسم والمبلغ بشكل صحيح",variant:"destructive"});return}const o=Jt.find(x=>x.id===Ze);ns({debtorName:Wt,amount:n,notes:Ns,customerId:Ze||void 0,mobile:o==null?void 0:o.mobile}),is(!1),Tt(!1),i({title:"تم حفظ بيانات الأجل",description:"سيتم إضافة الدين عند تأكيد العملية",variant:"default"})},children:"حفظ"})})]})})]})]}),e.jsx(Ue,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float",children:e.jsxs(qe,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-red-600 font-medium text-[10px] mb-1",children:"⚠️ تحذير من التحويل"}),e.jsx("div",{className:"text-[10px] text-red-700",children:"لا يمكن إلغاء أي عملية بعد تأكيدها للمحافظة على الأمان"})]})})]})]}),e.jsx(tc,{isOpen:na,onClose:()=>qa(!1),initialEditingWallet:Qr,onWalletUpdate:async()=>{try{await Ca()}catch(s){console.error("Error reloading wallets after update:",s)}}}),e.jsx(sc,{isOpen:Kn,onClose:()=>Zr(!1),transaction:Jn,onDelete:Hi}),e.jsx(Pa,{open:Hn,onOpenChange:Rs,onSuccess:Xi,title:eo(),description:to()}),e.jsx(Pa,{open:Qn,onOpenChange:Ha,onSuccess:()=>{Ha(!1),el(!0)},title:"حماية أرشيف التقارير اليومية",description:"أدخل كلمة مرور تسجيل الدخول للوصول إلى الأرشيف"}),e.jsx(kc,{open:Gn,onOpenChange:el,userId:t==null?void 0:t.uid}),e.jsx(Ql,{open:wi,onOpenChange:jl,onSuccess:ao,title:"تعديل الرصيد النقدي في الدرج",description:"أدخل الرقم السري والمبلغ الجديد لتعديل الرصيد النقدي في الدرج",currentBalance:Ee,balanceLabel:"الرصيد النقدي",userId:t==null?void 0:t.uid}),e.jsx(Ql,{open:Si,onOpenChange:bl,onSuccess:ro,title:"تعديل رصيد المحفظة",description:"أدخل الرقم السري والمبلغ الجديد لتعديل رصيد المحفظة",currentBalance:yt&&ve[yt]||0,balanceLabel:`رصيد ${((Vl=ye.find(s=>s.id===yt))==null?void 0:Vl.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(nc,{open:Di,onOpenChange:fr,onSuccess:lo,title:"إضافة أو خصم مبلغ من رصيد المحفظة",description:"أدخل الرقم السري والمبلغ المراد إضافته أو خصمه من رصيد المحفظة",currentBalance:yt&&ve[yt]||0,balanceLabel:`رصيد ${((ql=ye.find(s=>s.id===yt))==null?void 0:ql.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(ac,{open:Bi,onOpenChange:Ei,userId:t==null?void 0:t.uid}),e.jsx(rc,{open:Mi,onOpenChange:Li,userId:t==null?void 0:t.uid}),e.jsx(lc,{open:$i,onOpenChange:_i}),e.jsx(oe,{open:Ti,onOpenChange:fa,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{className:"text-right",children:"تعديل الدرج النقدية"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Y,{htmlFor:"amount",className:"text-right block",children:"المبلغ"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(L,{id:"amount",type:"number",placeholder:"أدخل المبلغ",value:jr,onChange:s=>va(s.target.value),className:"text-right flex-1",dir:"rtl",min:"0"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(c,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2",onClick:()=>{if(!Wr(Sr)){i({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const s=parseFloat(jr);if(isNaN(s)||s<=0){i({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const r=Ee+s;Ge(r);const a={cashBalance:r,lastUpdated:new Date().toISOString()},n=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(n,JSON.stringify(a)),t!=null&&t.uid?je.updateUserData(t.uid,a).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(n),xe(!1)}).catch(o=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",o),xe(!0)}):xe(!0),i({title:"تم بنجاح",description:`تم إضافة ${s} جنيه إلى الدرج النقدية وحفظه في السحابة`}),fa(!1),va(""),ya("")},children:[e.jsx(ut,{className:"h-1 w-1 mr-1"}),"إضافة"]}),e.jsxs(c,{type:"button",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2",onClick:()=>{if(!Wr(Sr)){i({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const s=parseFloat(jr);if(isNaN(s)||s<=0){i({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const r=Ee-s;Ge(r);const a={cashBalance:r,lastUpdated:new Date().toISOString()},n=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(n,JSON.stringify(a)),t!=null&&t.uid?je.updateUserData(t.uid,a).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(n),xe(!1)}).catch(o=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",o),xe(!0)}):xe(!0),i({title:"تم بنجاح",description:`تم خصم ${s} جنيه من الدرج النقدية وحفظه في السحابة`}),fa(!1),va(""),ya("")},children:[e.jsx(gs,{className:"h-1 w-1 mr-1"}),"خصم"]})]})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 text-right",children:["الرصيد الحالي: ",Ee.toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Y,{htmlFor:"pin",className:"text-right block",children:"الرقم السري"}),e.jsx(L,{id:"pin",type:"password",placeholder:"أدخل الرقم السري",value:Sr,onChange:s=>ya(s.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsx(Se,{className:"flex gap-2",children:e.jsx(c,{variant:"outline",onClick:()=>{fa(!1),va(""),ya("")},children:"إلغاء"})})]})}),e.jsx(oe,{open:zi,onOpenChange:wa,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{className:"text-right text-red-600",children:"تصفير إجمالي المحفظة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير جميع أرصدة المحافظ إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["الرصيد الحالي: ",Object.values(ve).reduce((s,r)=>s+r,0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Y,{htmlFor:"resetWalletTotalPin",className:"text-right block",children:"كلمة مرور تسجيل الدخول"}),e.jsx(L,{id:"resetWalletTotalPin",type:"password",placeholder:"أدخل كلمة مرور تسجيل الدخول",value:$l,onChange:s=>Sa(s.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(Se,{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{wa(!1),Sa("")},children:"إلغاء"}),e.jsx(c,{variant:"destructive",onClick:async()=>{if(!await Fr($l)){i({title:"خطأ",description:"كلمة المرور غير صحيحة",variant:"destructive"});return}try{const r={};Object.keys(ve).forEach(x=>{r[x]=0}),Be(r),localStorage.setItem(Re(),JSON.stringify(r)),wa(!1),Sa("");const a=new Date().toISOString(),n={walletBalances:r,lastUpdated:a},o=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(o,JSON.stringify(n)),t!=null&&t.uid?je.updateUserData(t.uid,n).then(()=>{localStorage.removeItem(o),xe(!1)}).catch(x=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",x),xe(!0),i({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):xe(!0),setTimeout(()=>{Be({...r})},100)}catch(r){console.error("خطأ في تصفير أرصدة المحافظ:",r),i({title:"خطأ",description:"حدث خطأ أثناء تصفير المحافظ",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(oe,{open:Ci,onOpenChange:pa,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{className:"text-right text-red-600",children:"تصفير رصيد المحفظة المختارة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير رصيد المحفظة المحددة إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["المحفظة: ",((Yl=ye.find(s=>s.id===R))==null?void 0:Yl.name)||R]}),e.jsxs("p",{className:"text-red-600 text-sm",children:["الرصيد الحالي: ",(R&&ve[R]?ve[R]:0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Y,{htmlFor:"resetSelectedWalletPin",className:"text-right block",children:"كلمة مرور تسجيل الدخول"}),e.jsx(L,{id:"resetSelectedWalletPin",type:"password",autoComplete:"off",placeholder:"أدخل كلمة مرور تسجيل الدخول",value:Nl,onChange:s=>vr(s.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(Se,{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{pa(!1),vr("")},children:"إلغاء"}),e.jsx(c,{variant:"destructive",onClick:async()=>{var r;if(!R){i({title:"اختر محفظة",description:"يرجى اختيار محفظة أولاً",variant:"destructive"});return}if(!await Fr(Nl)){i({title:"خطأ",description:"كلمة المرور غير صحيحة",variant:"destructive"});return}try{const a={...ve};a[R]=0,Be(a),localStorage.setItem(Re(),JSON.stringify(a)),pa(!1),vr("");const n=new Date().toISOString(),o={walletBalances:a,lastUpdated:n},x=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(x,JSON.stringify(o)),t!=null&&t.uid?je.updateUserData(t.uid,o).then(()=>{localStorage.removeItem(x),xe(!1)}).catch(g=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",g),xe(!0),i({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):xe(!0),i({title:"تم التصفير بنجاح",description:`تم تصفير رصيد المحفظة ${((r=ye.find(g=>g.id===R))==null?void 0:r.name)||R}`})}catch(a){console.error("خطأ في تصفير رصيد المحفظة المختارة:",a),i({title:"خطأ",description:"حدث خطأ أثناء تصفير رصيد المحفظة المختارة",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(oe,{open:Ui,onOpenChange:Na,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsxs(me,{className:"text-right text-green-600 flex items-center gap-2 justify-end",children:[e.jsx(ut,{className:"h-4 w-4"}),"إضافة أموال لإجمالي المحفظة"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-green-800 font-medium mb-2",children:"إضافة أموال"}),e.jsx("p",{className:"text-green-700 text-sm",children:"سيتم إضافة المبلغ المحدد إلى إجمالي المحفظة بشكل متناسب على جميع المحافظ."}),e.jsxs("p",{className:"text-green-600 text-sm mt-2",children:["الرصيد الحالي: ",Object.values(ve).reduce((s,r)=>s+r,0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"addWalletTotalAmount",className:"text-right block",children:"المبلغ المراد إضافته"}),e.jsx(L,{id:"addWalletTotalAmount",type:"number",placeholder:"أدخل المبلغ",value:Pl,onChange:s=>Tr(s.target.value),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"addWalletTotalPin",className:"text-right block",children:"الرقم السري للتأكيد"}),e.jsx(L,{id:"addWalletTotalPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري",value:Ol,onChange:s=>Ar(s.target.value),className:"text-right",dir:"rtl"})]})]})]}),e.jsxs(Se,{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{Na(!1),Tr(""),Ar("")},children:"إلغاء"}),e.jsx(c,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:Wl,onClick:async()=>{const s=parseFloat(Pl);if(!s||s<=0){i({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!Vi(Ol)){i({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}Fl(!0);try{const r=Object.values(ve).reduce((a,n)=>a+n,0);if(r===0){const a=Object.keys(ve),n=s/a.length,o={};a.forEach(x=>{o[x]=n}),Be(o),localStorage.setItem(Re(),JSON.stringify(o)),t!=null&&t.uid?await je.updateUserData(t.uid,{walletBalances:o,lastUpdated:new Date().toISOString()}):xe(!0)}else{const a={};Object.entries(ve).forEach(([n,o])=>{const x=o/r,g=s*x;a[n]=o+g}),Be(a),localStorage.setItem(Re(),JSON.stringify(a)),t!=null&&t.uid?await je.updateUserData(t.uid,{walletBalances:a,lastUpdated:new Date().toISOString()}):xe(!0)}setTimeout(()=>{Be(a=>({...a}))},100),Na(!1),Tr(""),Ar("")}catch(r){console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",r),i({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات",variant:"destructive"})}finally{Fl(!1)}},children:Wl?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(oe,{open:Ji,onOpenChange:Da,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsx(de,{children:e.jsxs(me,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(Ct,{className:"h-1 w-1"}),"تصفير الرصيد النقدي"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700",children:"⚠️ تحذير: سيتم تصفير الرصيد النقدي في الدرج إلى صفر. هذا الإجراء لا يمكن التراجع عنه."})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Y,{htmlFor:"resetCashPin",children:"كلمة مرور تسجيل الدخول"}),e.jsx(L,{id:"resetCashPin",type:"password",autoComplete:"off",placeholder:"أدخل كلمة مرور تسجيل الدخول",value:Pr,onChange:s=>Or(s.target.value)})]})]}),e.jsxs(Se,{children:[e.jsx(c,{variant:"outline",onClick:()=>{Da(!1),Or("")},children:"إلغاء"}),e.jsx(c,{variant:"destructive",onClick:async()=>{if(!Pr){i({title:"خطأ",description:"يرجى إدخال كلمة المرور",variant:"destructive"});return}if(!await Fr(Pr)){i({title:"خطأ",description:"كلمة المرور غير صحيحة",variant:"destructive"});return}try{Ge(0),Da(!1),Or("");const r={cashBalance:0,lastUpdated:new Date().toISOString()};localStorage.setItem(Ve(),"0");const a=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(a,JSON.stringify(r)),t!=null&&t.uid?je.updateUserData(t.uid,r).then(()=>{localStorage.removeItem(a),xe(!1)}).catch(n=>{console.error("خطأ في حفظ الرصيد في Firebase:",n),xe(!0),i({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):xe(!0)}catch(r){console.error("خطأ في تصفير الرصيد النقدي:",r),i({title:"خطأ",description:"حدث خطأ أثناء تصفير الرصيد النقدي",variant:"destructive"})}},children:"تصفير الرصيد"})]})]})}),e.jsx(oe,{open:Ri,onOpenChange:ja,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsx(de,{children:e.jsxs(me,{className:"text-green-600 flex items-center gap-2",children:[e.jsx(ut,{className:"h-4 w-4"}),"إضافة أموال للدرج"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-green-700",children:"💰 سيتم إضافة المبلغ المحدد إلى الرصيد النقدي في الدرج"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"addCashAmount",children:"المبلغ المراد إضافته"}),e.jsx(L,{id:"addCashAmount",type:"number",placeholder:"أدخل المبلغ",value:ba,onChange:s=>Dr(s.target.value),min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"addCashPin",children:"الرقم السري لدرج النقدية"}),e.jsx(L,{id:"addCashPin",type:"password",placeholder:"أدخل الرقم السري",value:Cr,onChange:s=>Ir(s.target.value)})]})]}),e.jsxs(Se,{children:[e.jsx(c,{variant:"outline",onClick:()=>{ja(!1),Dr(""),Ir("")},children:"إلغاء"}),e.jsx(c,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:Al,onClick:async()=>{if(!ba||parseFloat(ba)<=0){i({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}if(!Cr){i({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!Wr(Cr)){i({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}kl(!0);try{const s=parseFloat(ba),r=Ee+s;Ge(r),localStorage.setItem(Ve(),r.toString());const a={cashBalance:r,lastUpdated:new Date().toISOString()},n=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(n,JSON.stringify(a)),t!=null&&t.uid?(await je.updateUserData(t.uid,a),localStorage.removeItem(n),xe(!1)):xe(!0),ja(!1),Dr(""),Ir("")}catch(s){console.error("خطأ في حفظ الرصيد في Firebase:",s),Ge(Ee),localStorage.setItem("cashBalance",Ee.toString()),i({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{kl(!1)}},children:Al?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(oe,{open:Ni,onOpenChange:pr,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{className:"text-right",children:"اختيار التاريخ والوقت للبحث"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Y,{htmlFor:"search-date",className:"text-right block",children:"التاريخ"}),e.jsx(L,{id:"search-date",type:"date",value:oa,onChange:s=>rl(s.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Y,{htmlFor:"search-time",className:"text-right block",children:"الوقت (اختياري)"}),e.jsx(L,{id:"search-time",type:"time",value:ca,onChange:s=>ll(s.target.value),className:"text-right",placeholder:"اختر الوقت للبحث في ساعة محددة"}),e.jsx("p",{className:"text-[10px] text-gray-500 text-right",children:"إذا لم تختر وقتاً محدداً، سيتم البحث في كامل اليوم"})]})]}),e.jsxs(Se,{className:"flex justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>{rl(""),ll(""),pr(!1)},children:"مسح"}),e.jsx(c,{onClick:()=>pr(!1),children:"تطبيق"})]})]})}),e.jsx(Zl,{isOpen:p&&!C,onClose:()=>_(!1),onTrialStarted:ji}),e.jsx(ic,{isOpen:ti,onClose:()=>il(!1)}),e.jsx(oc,{isOpen:si,onClose:()=>Qa(!1)}),e.jsx(Ro,{isOpen:ai,onClose:()=>Za(!1)}),e.jsx(Uo,{open:ri,onOpenChange:Xa}),e.jsx(wc,{open:li,onOpenChange:s=>{if(s&&!us){i({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});return}er(s)}}),e.jsx(Pc,{open:k,onOpenChange:s=>{if(s&&!us){i({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}I(s)}}),e.jsx(Oc,{open:M,onOpenChange:s=>{if(s&&!us){i({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}H(s)}}),e.jsx(Pa,{open:di,onOpenChange:ha,title:"تأكيد كلمة المرور لفتح الديون",description:"أدخل كلمة مرور تسجيل الدخول لفتح صفحة الديون",onSuccess:()=>{ha(!1),ma(!0)}}),e.jsx(Pa,{open:Ii,onOpenChange:yr,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"لن يتم حذف الإيصالات؛ سنبدأ القائمة من الآن.",onSuccess:()=>{try{t!=null&&t.uid&&(localStorage.setItem(`recentTransactionsResetAt:${t.uid}`,new Date().toISOString()),i({title:"تم التصفير",description:"تم بدء قائمة المعاملات من الآن."}))}catch{}yr(!1)}}),e.jsx(ra,{open:P,onOpenChange:J,mode:"verify",title:"الرقم السري لفتح مصروفات المحل",description:"أدخل الرقم السري الرئيسي لفتح نافذة مصروفات المحل",onSuccess:()=>{J(!1),$(!0)}}),e.jsx(oe,{open:ci,onOpenChange:ma,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsxs(de,{className:"flex items-center justify-between",children:[e.jsx(me,{className:"text-right",children:"إدارة الديون"}),e.jsxs("div",{className:"flex items-center gap-1 text-orange-700",children:[e.jsx(qo,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-xs font-bold",children:[Zi," جنيه"]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"debtorName",className:"text-right col-span-1",children:"اسم المديون"}),e.jsx(L,{id:"debtorName",value:tr,onChange:s=>cl(s.target.value),className:"col-span-3 text-right",placeholder:"أدخل اسم المديون"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"debtAmount",className:"text-right col-span-1",children:"المبلغ"}),e.jsx(L,{id:"debtAmount",type:"number",value:sr,onChange:s=>dl(s.target.value),className:"col-span-3 text-right",placeholder:"أدخل المبلغ"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"debtReason",className:"text-right col-span-1",children:"سبب الدين"}),e.jsx(L,{id:"debtReason",value:ar,onChange:s=>ml(s.target.value),className:"col-span-3 text-right",placeholder:"أدخل سبب الدين"})]})]}),e.jsx(Se,{children:e.jsx(c,{onClick:()=>{if(tr&&sr&&ar){const s={id:Date.now().toString(),debtorName:tr,amount:parseFloat(sr),reason:ar,status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};xr(s),xa(!0)}else i({title:"بيانات غير مكتملة",description:"يرجى إدخال الاسم والمبلغ والسبب",variant:"destructive"})},className:"bg-orange-500 hover:bg-orange-600",children:"حفظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(c,{variant:"outline",className:"w-full",onClick:()=>nr(!0),children:"إيصالات الديون"})}),e.jsx("div",{className:"mt-2",children:e.jsx(c,{variant:"outline",className:"w-full",onClick:()=>ir(!0),children:"إضافة عميل"})})]})}),e.jsx(oe,{open:xi,onOpenChange:nr,children:e.jsxs(ce,{className:"sm:max-w-[520px]",children:[e.jsxs(de,{children:[e.jsx(me,{className:"text-right",children:"إيصالات الديون"}),e.jsx(Vt,{className:"text-right",children:"اختر دينًا لعرض إيصاله بالتفصيل"})]}),St.length>0?e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:St.map(s=>e.jsx("div",{onClick:()=>{hl(s),Js(!0),nr(!1),ma(!1)},className:"p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium",children:s.debtorName}),e.jsx("p",{className:"text-sm text-gray-600",children:s.reason}),e.jsx("p",{className:"text-sm text-gray-500",children:Br.format(s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt))})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-lg",children:[s.amount," جنيه"]}),e.jsx(rt,{variant:s.status==="paid"?"default":"secondary",className:s.status==="paid"?"bg-green-500":"bg-yellow-500",children:s.status==="paid"?"مدفوع":"قيد المراجعة"})]})]})},s.id))}):e.jsx("div",{className:"text-center text-sm text-gray-500",children:"لا توجد ديون مسجلة"})]})}),e.jsx(oe,{open:ui,onOpenChange:ir,children:e.jsxs(ce,{className:"sm:max-w-[480px]",children:[e.jsxs(de,{children:[e.jsx(me,{className:"text-right",children:"إضافة عميل"}),e.jsx(Vt,{className:"text-right",children:"أدخل بيانات العميل ثم يمكنك تسجيل مبلغ دين عليه"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"customerName",className:"text-right col-span-1",children:"اسم العميل"}),e.jsx(L,{id:"customerName",value:cr,onChange:s=>ul(s.target.value),className:"col-span-3 text-right",placeholder:"اكتب اسم العميل"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"customerMobile",className:"text-right col-span-1",children:"رقم الموبايل"}),e.jsx(L,{id:"customerMobile",value:dr,onChange:s=>gl(s.target.value),className:"col-span-3 text-right",placeholder:"اكتب رقم الموبايل"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{if(!cr||!dr){i({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العميل ورقم الموبايل",variant:"destructive"});return}const s={id:Date.now().toString(),name:cr.trim(),mobile:dr.trim(),createdAt:new Date},r=[s,...Jt];await Oi(r),ul(""),gl(""),i({title:"تمت إضافة العميل",description:`تم إضافة ${s.name}`})},children:"إضافة"})}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx(Y,{className:"text-right block",children:"إضافة مبلغ على عميل"}),Jt.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Ts,{value:mr,onValueChange:pl,children:[e.jsx(As,{className:"w-full",children:e.jsx(ks,{placeholder:"اختر عميل"})}),e.jsx(Ps,{children:Jt.map(s=>e.jsxs(Os,{value:s.id,children:[s.name," — ",s.mobile]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"customerDebtAmount",className:"text-right col-span-1",children:"المبلغ"}),e.jsx(L,{id:"customerDebtAmount",type:"number",value:fl,onChange:s=>vl(s.target.value),className:"col-span-3 text-right",placeholder:"أدخل المبلغ"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{className:"bg-orange-600 hover:bg-orange-700",onClick:async()=>{const s=parseFloat(fl);if(!mr){i({title:"اختر عميل",description:"يرجى اختيار عميل أولاً",variant:"destructive"});return}if(isNaN(s)||s<=0){i({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const r=Jt.find(o=>o.id===mr);if(!r)return;const a={id:Date.now().toString(),debtorName:r.name,customerId:r.id,mobile:r.mobile,amount:Number(s.toFixed(2)),reason:"دين عميل",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]},n=[...St,a];Et(n),await Xt(n),pl(""),vl(""),i({title:"تم تسجيل المبلغ على العميل",description:`تمت إضافة ${a.amount} جنيه للعميل ${r.name}`})},children:"إضافة المبلغ"})})]}):e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد عملاء مسجلين. أضف عميلًا أولاً."})]})]}),e.jsx(Se,{className:"flex justify-end",children:e.jsx(c,{variant:"outline",onClick:()=>ir(!1),children:"إغلاق"})})]})}),e.jsx(oe,{open:re,onOpenChange:$,children:e.jsxs(ce,{className:"sm:max-w-[520px]",children:[e.jsxs(de,{children:[e.jsx(me,{className:"text-right",children:"مصروفات المحل"}),e.jsx(Vt,{className:"text-right",children:"أدخل تفاصيل المصروف ثم اختر مصدر الخصم."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"expenseName",className:"text-right col-span-1",children:"اسم المصروف"}),e.jsx(L,{id:"expenseName",value:ne,onChange:s=>ae(s.target.value),className:"col-span-3 text-right",placeholder:"مثال: كهرباء، صيانة، مشتريات"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"expenseAmount",className:"text-right col-span-1",children:"تمن المصروف"}),e.jsx(L,{id:"expenseAmount",type:"number",value:pe,onChange:s=>G(s.target.value),className:"col-span-3 text-right",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"expenseNotes",className:"text-right col-span-1",children:"ملاحظات"}),e.jsx(L,{id:"expenseNotes",value:Z,onChange:s=>Ne(s.target.value),className:"col-span-3 text-right",placeholder:"معلومات إضافية إن وجدت"})]})]}),e.jsxs(Se,{className:"flex justify-between",children:[e.jsx(c,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>{if(!ne||!pe){i({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم المصروف وقيمته",variant:"destructive"});return}ze(!0)},children:"إضافة مصروف"}),e.jsx(c,{variant:"outline",onClick:()=>vt(!0),children:"إيصالات المصاريف"})]})]})}),e.jsx(oe,{open:Pt,onOpenChange:vt,children:e.jsxs(ce,{className:"sm:max-w-[420px]",dir:"rtl",children:[e.jsxs(de,{children:[e.jsx(me,{className:"text-right",children:"إيصالات المصاريف"}),e.jsx(Vt,{className:"text-right",children:"آخر المصاريف المسجلة"})]}),K.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:K.map(s=>e.jsx("div",{className:"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-[11px] text-gray-600",children:s.notes||"بدون ملاحظات"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:new Date(s.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-sm",children:[s.amount," جنيه"]}),e.jsx(rt,{variant:"secondary",className:s.source==="cash"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700",children:s.source==="cash"?"من النقدية":`من المحفظة${s.walletId?` (${s.walletId})`:""}`})]})]})},s.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد مصاريف مسجلة بعد"})]})}),e.jsx(oe,{open:We,onOpenChange:ze,children:e.jsxs(ce,{className:"sm:max-w-[480px]",children:[e.jsx(de,{children:e.jsx(me,{className:"text-right",children:"اختيار مصدر خصم المصروف"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 text-right",children:"اختر هل تريد خصم مبلغ المصروف من الرصيد النقدي في الدرج أم من إحدى المحافظ."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{variant:Ie==="cash"?"default":"outline",className:Ie==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>Te("cash"),children:"الفلوس النقدية"}),e.jsx(c,{variant:Ie==="wallet"?"default":"outline",className:Ie==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>Te("wallet"),children:"أرصدة المحافظ"})]}),Ie==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-right block",children:"اختر المحفظة للخصم"}),e.jsxs(Ts,{value:tt,onValueChange:Je,children:[e.jsx(As,{className:"w-full",children:e.jsx(ks,{placeholder:"اختر محفظة"})}),e.jsx(Ps,{children:ye.map(s=>e.jsx(Os,{value:s.id,children:s.phone||s.name||s.id},s.id))})]})]})]}),e.jsxs(Se,{className:"flex justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>{ze(!1),Te(null),Je("")},children:"إلغاء"}),e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const s=Number(pe);if(isNaN(s)||s<=0){i({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!Ie){i({title:"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}try{if(Ie==="cash"){const n=Number((Ee-s).toFixed(2));Ge(n),localStorage.setItem(Ve(),n.toString());const o={cashBalance:n,lastUpdated:new Date().toISOString()},x=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(x,JSON.stringify(o)),t!=null&&t.uid?(await je.updateUserData(t.uid,o),localStorage.removeItem(x),xe(!1)):xe(!0)}else if(Ie==="wallet"){if(!tt){i({title:"اختر محفظة",description:"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const n=ve[tt]||0,o=Number((n-s).toFixed(2)),x={...ve,[tt]:o};Be(x);const g=new Date().toISOString(),j={walletBalances:x,lastUpdated:g},A=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(A,JSON.stringify(j)),localStorage.setItem(Re(),JSON.stringify(x)),localStorage.setItem(`walletBalances_backup_${g}`,JSON.stringify(x)),t!=null&&t.uid&&await je.updateUserData(t.uid,j)}}catch(n){console.error("خطأ أثناء تحديث الأرصدة عند حفظ المصروف:",n)}const r={id:Date.now().toString(),name:ne,amount:s,notes:Z,source:Ie,walletId:Ie==="wallet"?tt:void 0,createdAt:new Date},a=[...K,r];await ki(a),ae(""),G(""),Ne(""),Te(null),Je(""),ze(!1),$(!0),vt(!0),i({title:"تم إضافة المصروف",description:Ie==="cash"?"تم الخصم من النقدية":"تم الخصم من أرصدة المحافظ"})},children:"تأكيد الخصم"})]})]})}),e.jsx(oe,{open:se,onOpenChange:he,children:e.jsxs(ce,{className:"sm:max-w-[520px]",children:[e.jsxs(de,{children:[e.jsx(me,{className:"text-right",children:"النواقص"}),e.jsx(Vt,{className:"text-right",children:"سجل العناصر الناقصة التي تحتاج شراء وتابع حالتها."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"deficiencyName",className:"text-right col-span-1",children:"اسم العنصر"}),e.jsx(L,{id:"deficiencyName",value:we,onChange:s=>Le(s.target.value),className:"col-span-3 text-right",placeholder:"مثال: سكر، زيت، مناديل"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Y,{htmlFor:"deficiencyQuantity",className:"text-right col-span-1",children:"الكمية"}),e.jsx(L,{id:"deficiencyQuantity",type:"number",value:$e,onChange:s=>gt(s.target.value),className:"col-span-3 text-right",placeholder:"1"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{className:"bg-rose-600 hover:bg-rose-700",onClick:()=>{const s=parseInt($e||"1",10);if(!we){i({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العنصر",variant:"destructive"});return}if(isNaN(s)||s<=0){i({title:"كمية غير صحيحة",description:"يرجى إدخال كمية صحيحة",variant:"destructive"});return}const r={id:Date.now().toString(),name:we,quantity:s,status:"pending",createdAt:new Date};bt(a=>{const n=[...a,r];return br(n),n}),Le(""),gt(""),i({title:"تمت الإضافة",description:"تمت إضافة العنصر إلى قائمة النواقص"})},children:"إضافة للنواقص"})}),Ot.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Ot.map(s=>e.jsx("div",{className:"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-[11px] text-gray-600",children:["الكمية: ",s.quantity]}),e.jsx("p",{className:"text-[10px] text-gray-500",children:new Date(s.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{variant:"secondary",className:s.status==="pending"?"bg-rose-100 text-rose-700":"bg-green-100 text-green-700",children:s.status==="pending"?"قيد الشراء":"تم الشراء"}),e.jsx(c,{variant:"outline",className:s.status==="pending"?"text-green-700 border-green-300 hover:bg-green-50":"text-rose-700 border-rose-300 hover:bg-rose-50",onClick:()=>{bt(r=>{const a=r.map(n=>n.id===s.id?{...n,status:n.status==="pending"?"purchased":"pending"}:n);return br(a),a})},title:s.status==="pending"?"تم الشراء":"إلغاء الشراء",children:s.status==="pending"?"تم الشراء":"إلغاء الشراء"}),e.jsx(c,{variant:"outline",className:"text-red-700 border-red-300 hover:bg-red-50",onClick:()=>{bt(r=>{const a=r.filter(n=>n.id!==s.id);return br(a),a})},title:"حذف",children:"حذف"})]})]})},s.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد عناصر مسجلة في النواقص"})]}),e.jsx(Se,{className:"flex justify-end",children:e.jsx(c,{variant:"outline",onClick:()=>he(!1),children:"إغلاق"})})]})}),e.jsx(oe,{open:gi,onOpenChange:xa,children:e.jsxs(ce,{className:"sm:max-w-[480px]",children:[e.jsx(de,{children:e.jsx(me,{className:"text-right",children:"اختيار مصدر خصم الدين"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 text-right",children:"اختر هل تريد خصم مبلغ الدين من الرصيد النقدي في الدرج أم من إحدى المحافظ أو تسجيله بدون خصم."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(c,{variant:Dt==="cash"?"default":"outline",className:Dt==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>Ks("cash"),children:"الفلوس النقدية"}),e.jsx(c,{variant:Dt==="wallet"?"default":"outline",className:Dt==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>Ks("wallet"),children:"أرصدة المحافظ"}),e.jsx(c,{variant:Dt==="none"?"default":"outline",className:Dt==="none"?"bg-gray-600 hover:bg-gray-700 text-white":"",onClick:()=>Ks("none"),children:"بدون خصم"})]}),Dt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-right block",children:"اختر المحفظة للخصم"}),e.jsxs(Ts,{value:ua,onValueChange:ur,children:[e.jsx(As,{className:"w-full",children:e.jsx(ks,{placeholder:"اختر محفظة"})}),e.jsx(Ps,{children:ye.map(s=>e.jsx(Os,{value:s.id,children:s.phone||s.name||s.id},s.id))})]})]})]}),e.jsxs(Se,{className:"flex justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>{xa(!1),xr(null),Ks(null),ur("")},children:"إلغاء"}),e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{if(!hr)return;const s=Number(hr.amount);if(!Dt){i({title:"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}try{if(Dt==="cash"){const a=Number((Ee-s).toFixed(2));Ge(a),localStorage.setItem(Ve(),a.toString());const n=new Date().toISOString(),o={cashBalance:a,lastUpdated:n},x=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(x,JSON.stringify(o)),t!=null&&t.uid?await je.updateUserData(t.uid,o).then(()=>{localStorage.removeItem(x),xe(!1)}).catch(()=>{xe(!0)}):xe(!0)}else if(Dt==="wallet"){if(!ua){i({title:"اختر محفظة",description:"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const a=ve[ua]||0,n=Number((a-s).toFixed(2)),o={...ve,[ua]:n};Be(o);const x=new Date().toISOString(),g={walletBalances:o,lastUpdated:x},j=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(j,JSON.stringify(g)),localStorage.setItem(Re(),JSON.stringify(o)),localStorage.setItem(`walletBalances_backup_${x}`,JSON.stringify(o)),t!=null&&t.uid&&await je.updateUserData(t.uid,g)}}catch(a){console.error("خطأ أثناء تحديث الأرصدة عند حفظ الدين:",a)}const r=[...St,hr];Et(r),await Xt(r),cl(""),dl(""),ml(""),ma(!1),xa(!1),xr(null),Ks(null),ur(""),i(Dt==="none"?{title:"تم حفظ الدين بدون خصم",description:"لم يتم الخصم من الدرج أو المحافظ"}:{title:"تم حفظ الدين وخصم المبلغ",description:Dt==="cash"?`تم خصم ${s} من الرصيد النقدي`:`تم خصم ${s} من رصيد المحفظة`})},children:"تأكيد الخصم وحفظ الدين"})]})]})}),e.jsx(oe,{open:mi,onOpenChange:Js,children:e.jsxs(ce,{className:"sm:max-w-[425px] z-[60]",children:[e.jsx(de,{children:e.jsx(me,{className:"text-right",children:"إيصال الدين"})}),fe&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"إيصال دين"}),e.jsx("p",{className:"text-sm text-gray-500",children:Br.format(fe.createdAt instanceof Date?fe.createdAt:new Date(fe.createdAt))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم المديون:"}),e.jsx("span",{children:fe.debtorName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ:"}),e.jsxs("span",{className:"font-bold text-lg",children:[fe.amount," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"سبب الدين:"}),e.jsx("span",{children:fe.reason})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"الحالة:"}),e.jsx(rt,{variant:fe.status==="paid"?"default":"secondary",className:fe.status==="paid"?"bg-green-500":"bg-yellow-500",children:fe.status==="paid"?"مدفوع":"مؤجل"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ المتبقي:"}),e.jsxs("span",{className:"font-bold text-lg",children:[fe.amount," جنيه"]})]}),fe.paidAmount?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"إجمالي المدفوع:"}),e.jsxs("span",{className:"text-green-700",children:[fe.paidAmount," جنيه"]})]}):null,e.jsxs("div",{className:"mt-3 p-3 border rounded-lg bg-gray-50",children:[hi?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"partialAmount",className:"text-right block",children:"المبلغ المراد دفعه"}),e.jsx(L,{id:"partialAmount",type:"number",value:xl,onChange:s=>lr(s.target.value),className:"text-right",placeholder:"أدخل المبلغ"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{rr(!1),lr("")},children:"إلغاء"}),e.jsx(c,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{const s=parseFloat(xl);if(!fe||isNaN(s)||s<=0){i({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(s>fe.amount){i({title:"مبلغ زائد",description:"المبلغ المدفوع أكبر من المتبقي",variant:"destructive"});return}const r={...fe,amount:Number((fe.amount-s).toFixed(2)),paidAmount:Number(((fe.paidAmount||0)+s).toFixed(2)),status:fe.amount-s<=0?"paid":"pending",partialPayments:[...fe.partialPayments||[],{amount:s,paidAt:new Date}]},a=St.map(n=>n.id===fe.id?r:n);Et(a),hl(r),await Xt(a);try{r.status==="paid"&&(t!=null&&t.uid)&&(async()=>{const n=Ws(ts(ot,"userTransactions"),kt("userId","==",t.uid),kt("linkedDebtId","==",fe.id),kt("status","==","pending")),o=await Fs(n);await Promise.allSettled(o.docs.map(x=>ta(x.ref,{status:"completed",confirmedAt:new Date})))})().catch(n=>console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",n))}catch(n){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",n)}try{const n=Vs(),o=localStorage.getItem(n);if(o){const g=(JSON.parse(o)||[]).map(j=>(j==null?void 0:j.linkedDebtId)===fe.id&&(j==null?void 0:j.status)==="pending"?{...j,status:"completed",confirmedAt:new Date}:j);localStorage.setItem(n,JSON.stringify(g)),nt(j=>j.map(A=>(A==null?void 0:A.linkedDebtId)===fe.id&&(A==null?void 0:A.status)==="pending"?{...A,status:"completed",confirmedAt:new Date}:A))}}catch(n){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",n)}ga(s),ds("cash"),Cs(!0),rr(!1),lr(""),i({title:"تم تسجيل دفع جزء",description:`تم دفع ${s} جنيه بتاريخ ${new Date().toLocaleString("ar-EG")}`})},children:"دفع"})]})]}):e.jsx(c,{variant:"outline",className:"w-full",onClick:()=>rr(!0),children:"دفع جزء"}),fe.partialPayments&&fe.partialPayments.length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"سجل الدفعات الجزئية:"}),e.jsx("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:fe.partialPayments.map((s,r)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["دفع: ",s.amount," جنيه"]}),e.jsx("span",{children:new Date(s.paidAt).toLocaleString("ar-EG")})]},r))})]})]})]})]}),e.jsxs(Se,{className:"flex gap-2 justify-center",children:[e.jsx(c,{onClick:async()=>{if(fe){const s=St.map(r=>r.id===fe.id?{...r,status:"pending"}:r);Et(s),await Xt(s),Js(!1),i({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمؤجل"})}},variant:"outline",className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:"مؤجل"}),e.jsx(c,{onClick:async()=>{if(fe){const s=fe.amount,r=St.map(a=>a.id===fe.id?{...a,amount:0,paidAmount:Number(((a.paidAmount||0)+s).toFixed(2)),status:"paid",partialPayments:[...a.partialPayments||[],...s>0?[{amount:s,paidAt:new Date}]:[]]}:a);Et(r),s>0&&(ga(s),ds("cash"),Cs(!0)),await Xt(r);try{t!=null&&t.uid&&(fe!=null&&fe.id)&&(async()=>{const a=Ws(ts(ot,"userTransactions"),kt("userId","==",t.uid),kt("linkedDebtId","==",fe.id),kt("status","==","pending")),n=await Fs(a);await Promise.allSettled(n.docs.map(o=>ta(o.ref,{status:"completed",confirmedAt:new Date})))})().catch(a=>console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",a))}catch(a){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",a)}try{const a=Vs(),n=localStorage.getItem(a);if(n){const x=(JSON.parse(n)||[]).map(g=>(g==null?void 0:g.linkedDebtId)===fe.id&&(g==null?void 0:g.status)==="pending"?{...g,status:"completed",confirmedAt:new Date}:g);localStorage.setItem(a,JSON.stringify(x)),nt(g=>g.map(j=>(j==null?void 0:j.linkedDebtId)===fe.id&&(j==null?void 0:j.status)==="pending"?{...j,status:"completed",confirmedAt:new Date}:j))}}catch(a){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",a)}Js(!1),i({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمدفوع"})}},className:"bg-green-500 hover:bg-green-600",children:"مدفوع"}),e.jsx(c,{onClick:async()=>{if(fe){const s=St.filter(r=>r.id!==fe.id);Et(s),await Xt(s),Js(!1),i({title:"تم حذف الدين",description:"تم حذف الدين بنجاح"})}},variant:"destructive",children:"حذف"})]})]})}),e.jsx(oe,{open:pi,onOpenChange:Cs,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsxs(de,{children:[e.jsx(me,{className:"text-right",children:"اختيار إضافة مبلغ السداد"}),e.jsx(Vt,{className:"text-right",children:"هل تريد إضافة مبلغ السداد إلى الفلوس النقدية أم إلى إحدى المحافظ؟"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(c,{variant:Mt==="cash"?"default":"outline",className:Mt==="cash"?"bg-blue-600 text-white":"",onClick:()=>ds("cash"),children:"الفلوس النقدية"}),e.jsx(c,{variant:Mt==="wallet"?"default":"outline",className:Mt==="wallet"?"bg-blue-600 text-white":"",onClick:()=>ds("wallet"),children:"أرصدة المحافظ"}),e.jsx(c,{variant:Mt==="none"?"default":"outline",className:Mt==="none"?"bg-gray-600 text-white":"",onClick:()=>ds("none"),children:"بدون إضافة"})]}),Mt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-right",children:"اختر المحفظة"}),e.jsxs("select",{className:"w-full border rounded p-2 text-right",value:ms,onChange:s=>gr(s.target.value),children:[e.jsx("option",{value:"",children:"— اختر محفظة —"}),ye&&ye.length>0?ye.map(s=>e.jsx("option",{value:s.id,children:s.phone||s.name||s.id},s.id)):Object.keys(ve||{}).map(s=>{var r,a,n,o,x,g;return e.jsx("option",{value:s,children:((r=ye.find(j=>j.id===s))==null?void 0:r.phone)||((n=(a=JSON.parse(localStorage.getItem(hs())||"[]"))==null?void 0:a.find(j=>j.id===s))==null?void 0:n.phone)||((x=(o=JSON.parse(localStorage.getItem(hs())||"[]"))==null?void 0:o.find(j=>j.id===s))==null?void 0:x.name)||((g=ye.find(j=>j.id===s))==null?void 0:g.name)||s},s)})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:["المبلغ المراد إضافته: ",e.jsxs("span",{className:"font-bold",children:[yl," جنيه"]})]})]}),e.jsxs(Se,{className:"flex justify-end",children:[e.jsx(c,{variant:"outline",onClick:()=>{Cs(!1),ga(0),ds(null),gr("")},children:"إلغاء"}),e.jsx(c,{onClick:async()=>{var s,r;try{const a=yl;if(!a||a<=0){Cs(!1);return}if(Mt==="cash"){const n=Ee+a;Ge(n),localStorage.setItem(Ve(),n.toString());const o={cashBalance:n,lastUpdated:new Date().toISOString()},x=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(x,JSON.stringify(o)),t!=null&&t.uid?(je.updateUserData(t.uid,o).catch(()=>xe(!0)),localStorage.removeItem(x),xe(!1)):xe(!0),i({title:"تمت إضافة مبلغ السداد",description:`تمت إضافة ${a} جنيه إلى الفلوس النقدية`})}else if(Mt==="wallet"){if(!ms){i({title:"اختر محفظة أولاً",description:"يرجى اختيار المحفظة لإضافة مبلغ السداد إليها",variant:"destructive"});return}const n={...ve,[ms]:(ve[ms]||0)+a};Be(n);const o=(Ee||0)-a;Ge(o),localStorage.setItem(Ve(),o.toString());const x=new Date().toISOString(),g={walletBalances:n,cashBalance:o,lastUpdated:x},j=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(j,JSON.stringify(g)),localStorage.setItem(Re(),JSON.stringify(n)),localStorage.setItem(`walletBalances_backup_${x}`,JSON.stringify(n)),t!=null&&t.uid){je.updateUserData(t.uid,g).catch(()=>xe(!0));try{localStorage.removeItem(j)}catch{}xe(!1)}else xe(!0);i({title:"تمت إضافة مبلغ السداد",description:`تمت إضافة ${a} جنيه إلى المحفظة ${((s=ye.find(A=>A.id===ms))==null?void 0:s.phone)||((r=ye.find(A=>A.id===ms))==null?void 0:r.name)||ms} وتم خصم نفس المبلغ من درج النقدية`})}else if(Mt==="none"){const n=(Ee||0)-a;Ge(n),localStorage.setItem(Ve(),n.toString());const o={cashBalance:n,lastUpdated:new Date().toISOString()},x=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(x,JSON.stringify(o)),t!=null&&t.uid){je.updateUserData(t.uid,o).catch(()=>xe(!0));try{localStorage.removeItem(x)}catch{}xe(!1)}else xe(!0);i({title:"تم تسجيل السداد",description:`تم خصم ${a} جنيه من درج النقدية بدون إضافة للمحافظ`})}else{i({title:"اختر مصدر الإضافة",description:"يرجى اختيار إضافة المبلغ إلى النقدية أو المحفظة",variant:"destructive"});return}}catch(a){console.error("خطأ أثناء إضافة مبلغ السداد:",a),i({title:"حدث خطأ",description:"تعذر إضافة مبلغ السداد، حاول مرة أخرى",variant:"destructive"})}finally{Cs(!1),ga(0),ds(null),gr("")}},className:"bg-green-600 hover:bg-green-700",children:"تأكيد الإضافة"})]})]})})]}))};export{Pd as default};
